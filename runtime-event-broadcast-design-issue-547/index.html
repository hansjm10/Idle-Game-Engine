<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-runtime-event-broadcast-design-issue-547" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Runtime Event Broadcast Design (Issue 547) | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-broadcast-design-issue-547"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Runtime Event Broadcast Design (Issue 547) | Idle Engine Docs"><meta data-rh="true" name="description" content="Document Control"><meta data-rh="true" property="og:description" content="Document Control"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-broadcast-design-issue-547"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-broadcast-design-issue-547" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-broadcast-design-issue-547" hreflang="x-default"><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.9ddd33c9.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.57fd14dd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a class="navbar__item navbar__link" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><main class="docMainContainer_tfRv docMainContainerEnhanced_qAvX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Runtime Event Broadcast Design (Issue 547)</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Add runtime event broadcast streaming for Issue 547</li>
<li class=""><strong>Authors</strong>: Codex (AI, Runtime Systems)</li>
<li class=""><strong>Reviewers</strong>: Runtime Core maintainers</li>
<li class=""><strong>Status</strong>: Draft</li>
<li class=""><strong>Last Updated</strong>: 2025-12-30</li>
<li class=""><strong>Related Issues</strong>: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/547" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/547</a>, <a href="https://github.com/hansjm10/Idle-Game-Engine/pull/704" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/pull/704</a></li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>Issue 547 adds a server-to-client event broadcast layer that serializes runtime event frames into JSON-friendly broadcast frames, filters or batches them for network efficiency, and hydrates them on the client to trigger local handlers. The solution builds on existing runtime event frames and event bus dispatch order, adding checksum and manifest hash validation for integrity checks plus optional deduplication for replay scenarios.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class=""><strong>Background</strong>: The runtime already captures per-tick events in <code>RuntimeEventFrame</code> via <code>buildRuntimeEventFrame</code> and dispatches events locally with <code>EventBus</code>, but there is no standardized server-to-client broadcast format or hydration helper. Clients and transports must currently invent their own serialization, filtering, and ordering behavior.</li>
<li class=""><strong>Problem</strong>: Without a shared broadcast format, server-to-client event streaming is inconsistent, hard to validate, and lacks support for filtering, batching, and replay deduplication.</li>
<li class=""><strong>Forces</strong>: The solution must remain deterministic, preserve existing event ordering semantics, be JSON friendly for transport, and stay additive to the existing runtime event bus and frame APIs.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Goals</strong>:<!-- -->
<ol>
<li class="">Define a broadcast frame format derived from <code>RuntimeEventFrame</code> with optional checksum and manifest hash.</li>
<li class="">Provide event filtering by type for server-side or client-side visibility control.</li>
<li class="">Support batching, priority flush, and optional coalescing to reduce network overhead.</li>
<li class="">Hydrate broadcast frames into the runtime event bus to trigger local handlers.</li>
<li class="">Provide replay deduplication for repeated frames.</li>
<li class="">Add tests and a benchmark that validates batching behavior.</li>
</ol>
</li>
<li class=""><strong>Non-Goals</strong>:<!-- -->
<ul>
<li class="">Implement network transports, authentication, or encryption.</li>
<li class="">Persist event history beyond the batch window.</li>
<li class="">Replace existing state sync or command transport designs.</li>
<li class="">Provide cryptographic integrity or anti-tamper guarantees.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>: Runtime Core maintainers, networking/transport integrators, client shell developers, QA.</li>
<li class=""><strong>Agent Roles</strong>:</li>
</ul>
<table><thead><tr><th>Agent</th><th>Responsibilities</th></tr></thead><tbody><tr><td>Runtime Implementation Agent</td><td>Implement broadcast frame, batching, dedupe, and hydration helpers in core.</td></tr><tr><td>Testing Agent</td><td>Add unit tests for filtering, batching, coalescing, checksum, and hydration.</td></tr><tr><td>Benchmark Agent</td><td>Add batching overhead benchmark and integrate into benchmark script.</td></tr><tr><td>Docs Agent</td><td>Document usage and options in core README.</td></tr></tbody></table>
<ul>
<li class=""><strong>Affected Packages/Services</strong>:<!-- -->
<ul>
<li class=""><code>packages/core</code> (broadcast helpers, tests, exports)</li>
<li class=""><code>packages/core/benchmarks</code> (batching benchmark)</li>
<li class=""><code>docs/</code> (design doc, README updates)</li>
</ul>
</li>
<li class=""><strong>Compatibility Considerations</strong>:<!-- -->
<ul>
<li class="">Additive API only; existing event bus behavior and event frames remain unchanged.</li>
<li class="">Broadcast frames remain JSON compatible and do not require changes to runtime event frame serialization.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<p><code>packages/core</code> already exposes <code>EventBus</code> and <code>RuntimeEventFrame</code> generation via <code>buildRuntimeEventFrame</code>, but there are no helpers to serialize frames into a broadcast-friendly payload, apply per-client filtering, batch frames, or hydrate them back into the event bus. Transports must implement these behaviors manually, risking inconsistent ordering or replay handling.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ul>
<li class=""><strong>Narrative</strong>: The server builds <code>RuntimeEventFrame</code> objects each tick, converts them into <code>EventBroadcastFrame</code> payloads with optional filtering and checksums, and feeds them through an <code>EventBroadcastBatcher</code> for network efficiency. Clients receive batches, optionally deduplicate replays, and apply frames to a local <code>EventBus</code> using <code>applyEventBroadcastFrame</code>.</li>
<li class=""><strong>Diagram</strong>:</li>
</ul>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">Server EventBus -&gt; buildRuntimeEventFrame -&gt; createEventBroadcastFrame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   |                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   |               filter/checksum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   v                   v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           EventBroadcastBatcher -&gt; EventBroadcastBatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                              Transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client applyEventBroadcastBatch -&gt; applyEventBroadcastFrame -&gt; EventBus.dispatch</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Runtime Changes</strong>:</p>
<ul>
<li class="">Add a new module <code>packages/core/src/events/event-broadcast.ts</code> that defines broadcast frame types, filtering utilities, checksum helpers, batcher/deduper classes, and hydration helpers.</li>
<li class="">Export broadcast APIs from <code>packages/core/src/index.ts</code> and <code>packages/core/src/index.browser.ts</code>.</li>
</ul>
</li>
<li class="">
<p><strong>Data &amp; Schemas</strong>:</p>
</li>
</ul>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">EventBroadcastFrame</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> serverStep</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> events</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> SerializedRuntimeEvent</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> checksum</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> manifestHash</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> RuntimeEventManifestHash</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">EventBroadcastBatch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> frames</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> EventBroadcastFrame</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> fromStep</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> toStep</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> eventCount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li class="">
<p><code>SerializedRuntimeEvent</code> mirrors the runtime event object record and includes <code>type</code>, <code>channel</code>, <code>issuedAt</code>, <code>dispatchOrder</code>, and <code>payload</code>.</p>
</li>
<li class="">
<p><code>checksum</code> is an optional deterministic checksum over <code>serverStep</code>, <code>events</code>, and <code>manifestHash</code> when present.</p>
</li>
<li class="">
<p><strong>APIs &amp; Contracts</strong>:</p>
<ul>
<li class=""><code>createEventTypeFilter(allowedTypes)</code> produces a simple allowlist filter for event types.</li>
<li class=""><code>createEventBroadcastFrame(frame, options)</code> serializes a runtime frame, applies filters, sorts by <code>dispatchOrder</code> by default, and optionally includes checksum and manifest hash.</li>
<li class=""><code>applyEventBroadcastFrame(bus, frame, options)</code> validates manifest and checksum (unless disabled), filters and orders events, begins the tick with <code>resetOutbound</code> defaulting to true, publishes events with their <code>issuedAt</code>, and dispatches the tick.</li>
<li class=""><code>EventBroadcastBatcher</code> batches frames by <code>maxSteps</code>, <code>maxEvents</code>, and <code>maxDelayMs</code>, supports priority event types that flush immediately, and supports coalescing with <code>mode: &#x27;first&#x27; | &#x27;last&#x27;</code>.</li>
<li class=""><code>EventBroadcastDeduper</code> deduplicates replayed events using a ring buffer keyed by <code>{serverStep}:{dispatchOrder}:{type}</code> with a configurable capacity.</li>
</ul>
</li>
<li class="">
<p><strong>Tooling &amp; Automation</strong>:</p>
<ul>
<li class="">Add <code>packages/core/benchmarks/event-broadcast-batching.bench.mjs</code> and include it in the <code>benchmark</code> script.</li>
<li class="">Add <code>packages/core/src/events/event-broadcast.test.ts</code> to cover filtering, hydration order, batching, coalescing, dedupe, and checksum behaviors.</li>
<li class="">Document usage in <code>packages/core/README.md</code>.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>: Core-only, additive change; no migrations or runtime wiring changes.</li>
<li class=""><strong>Telemetry &amp; Observability</strong>: No new runtime telemetry; the benchmark uses telemetry no-ops to avoid noise.</li>
<li class=""><strong>Security &amp; Compliance</strong>: Checksum uses fnv1a32 over deterministic JSON and is not cryptographic. Treat it as an integrity check, not an authentication or anti-tamper mechanism.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td>feat(core): add event broadcast frame helpers</td><td>Define frame type, filter, checksum, and hydration helpers</td><td>Runtime Implementation Agent</td><td>Design approval</td><td>APIs exported; unit tests added</td></tr><tr><td>feat(core): add broadcast batching and dedupe</td><td>Implement batcher, coalescing, and deduper</td><td>Runtime Implementation Agent</td><td>Frame helpers</td><td>Batching and dedupe behaviors covered by tests</td></tr><tr><td>test(core): cover event broadcast scenarios</td><td>Add unit tests for filtering, checksum, ordering, batching</td><td>Testing Agent</td><td>Core helpers</td><td><code>pnpm test --filter @idle-engine/core</code> passes</td></tr><tr><td>bench(core): add broadcast batching benchmark</td><td>Add benchmark and wire into benchmark script</td><td>Benchmark Agent</td><td>Core helpers</td><td>Benchmark outputs JSON payload and asserts expectations</td></tr><tr><td>docs(core): document broadcast usage</td><td>Update README and design doc</td><td>Docs Agent</td><td>Core helpers</td><td>Usage example documented</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1</strong>: Frame helpers, batcher/deduper, exports (delivered in PR #704).</li>
<li class=""><strong>Phase 2</strong>: Tests and benchmark coverage (delivered in PR #704).</li>
<li class=""><strong>Phase 3</strong>: Documentation updates (delivered in PR #704).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Hand-off Package</strong>: <code>packages/core/src/events/event-bus.ts</code>, <code>packages/core/src/events/runtime-event-frame.ts</code>, Issue 547, and PR #704 diff.</li>
<li class=""><strong>Communication Cadence</strong>: Review at PR time; follow-up questions tracked on Issue 547.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class=""><strong>Context Packets</strong>:<!-- -->
<ul>
<li class=""><code>packages/core/src/events/event-bus.ts</code></li>
<li class=""><code>packages/core/src/events/runtime-event-frame.ts</code></li>
<li class=""><code>packages/core/src/events/event-broadcast.ts</code></li>
<li class=""><code>docs/runtime-event-pubsub-design.md</code></li>
</ul>
</li>
<li class=""><strong>Prompting &amp; Constraints</strong>:<!-- -->
<ul>
<li class="">Use type-only imports and exports for type symbols.</li>
<li class="">Preserve deterministic ordering by default; any skips must be explicit (<code>assumeSorted</code>, <code>filter</code>).</li>
<li class="">Do not edit generated <code>dist/</code> artifacts.</li>
</ul>
</li>
<li class=""><strong>Safety Rails</strong>:<!-- -->
<ul>
<li class="">Avoid non-deterministic inputs in checksum generation.</li>
<li class="">Do not add console output in tests that could corrupt the Vitest JSON summary.</li>
<li class="">Do not mutate the event bus dispatch semantics.</li>
</ul>
</li>
<li class=""><strong>Validation Hooks</strong>:<!-- -->
<ul>
<li class=""><code>pnpm test --filter @idle-engine/core</code></li>
<li class=""><code>pnpm -r run typecheck</code></li>
<li class=""><code>pnpm lint</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ol>
<li class=""><strong>Reuse RuntimeEventFrame directly over the wire</strong>: Rejected because typed-array frames are less JSON friendly, lack built-in filtering, and require a dedicated transport schema.</li>
<li class=""><strong>Rely on state sync snapshots alone</strong>: Rejected because UI and gameplay reactions depend on discrete events, not just state deltas.</li>
<li class=""><strong>Stream full event history</strong>: Rejected due to bandwidth and memory costs; batching provides bounded, configurable windows instead.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Unit / Integration</strong>:<!-- -->
<ul>
<li class="">Filtering, hydration ordering, checksum validation, dedupe reset, batching triggers, and coalescing scenarios in <code>packages/core/src/events/event-broadcast.test.ts</code>.</li>
<li class="">Round-trip JSON serialization test to confirm hydration from a serialized frame.</li>
</ul>
</li>
<li class=""><strong>Performance</strong>:<!-- -->
<ul>
<li class=""><code>packages/core/benchmarks/event-broadcast-batching.bench.mjs</code> compares unbatched vs batched scenarios and asserts reduced message overhead.</li>
</ul>
</li>
<li class=""><strong>Tooling / A11y</strong>:<!-- -->
<ul>
<li class="">Not applicable (runtime-only).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<table><thead><tr><th>Risk</th><th>Impact</th><th>Likelihood</th><th>Mitigation</th></tr></thead><tbody><tr><td>Batches never flush when <code>maxDelayMs</code> is set but no new frames arrive</td><td>Medium</td><td>Medium</td><td>Call <code>flush()</code> during idle periods or on transport heartbeat.</td></tr><tr><td>Deduper drops intentional replays with identical <code>{serverStep, dispatchOrder, type}</code></td><td>Low</td><td>Low</td><td>Allow deduper reset and opt-in usage per client.</td></tr><tr><td>Checksum is misinterpreted as cryptographic integrity</td><td>Medium</td><td>Low</td><td>Document checksum as non-cryptographic and optional.</td></tr><tr><td>Client ordering differs if <code>assumeSorted</code> is misused</td><td>Low</td><td>Medium</td><td>Default to sorting by <code>dispatchOrder</code> and document <code>assumeSorted</code> behavior.</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Milestones</strong>: Ship core helpers, tests, and benchmark; then integrate with transport adapters.</li>
<li class=""><strong>Migration Strategy</strong>: Additive API; existing local-only event bus usage remains unchanged.</li>
<li class=""><strong>Communication</strong>: Update core README and link this design doc from Issue 547.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-open-questions">13. Open Questions<a href="#13-open-questions" class="hash-link" aria-label="Direct link to 13. Open Questions" title="Direct link to 13. Open Questions" translate="no">​</a></h2>
<ul>
<li class="">Should a timer-driven batching helper be added so <code>maxDelayMs</code> can flush without new frames?</li>
<li class="">Should the dedupe key include <code>channel</code> or <code>payload</code> for additional safety, or is <code>{serverStep, dispatchOrder, type}</code> sufficient?</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Provide a transport-facing helper to schedule <code>flush()</code> on idle intervals.</li>
<li class="">Add tests for deduper capacity eviction and <code>assumeSorted</code> behavior.</li>
<li class="">Add optional binary encoding for broadcast frames to reduce payload size.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://github.com/hansjm10/Idle-Game-Engine/issues/547" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/547</a></li>
<li class=""><a href="https://github.com/hansjm10/Idle-Game-Engine/pull/704" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/pull/704</a></li>
<li class=""><code>packages/core/src/events/event-broadcast.ts</code></li>
<li class=""><code>packages/core/src/events/event-broadcast.test.ts</code></li>
<li class=""><code>packages/core/benchmarks/event-broadcast-batching.bench.mjs</code></li>
<li class=""><code>packages/core/src/events/event-bus.ts</code></li>
<li class=""><code>packages/core/src/events/runtime-event-frame.ts</code></li>
<li class=""><code>packages/core/src/index.ts</code></li>
<li class=""><code>packages/core/src/index.browser.ts</code></li>
<li class=""><code>packages/core/README.md</code></li>
<li class=""><code>docs/runtime-event-pubsub-design.md</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a---glossary">Appendix A - Glossary<a href="#appendix-a---glossary" class="hash-link" aria-label="Direct link to Appendix A - Glossary" title="Direct link to Appendix A - Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>EventBroadcastFrame</strong>: JSON-friendly payload carrying serialized runtime events for a single server step.</li>
<li class=""><strong>EventBroadcastBatch</strong>: Aggregation of one or more broadcast frames with step range and event count metadata.</li>
<li class=""><strong>EventFilter</strong>: Predicate used to allow or exclude events from broadcast or hydration.</li>
<li class=""><strong>EventBroadcastBatcher</strong>: Helper that groups frames by steps, event counts, delay, and priority events.</li>
<li class=""><strong>EventBroadcastDeduper</strong>: Ring-buffer dedupe helper for replayed frames.</li>
<li class=""><strong>Manifest Hash</strong>: Digest of the runtime event manifest used to validate compatibility.</li>
<li class=""><strong>Checksum</strong>: Deterministic fnv1a32 hash over broadcast payload data for integrity checks.</li>
<li class=""><strong>Coalescing</strong>: Removal of duplicate events within a batch based on a computed key.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b---change-log">Appendix B - Change Log<a href="#appendix-b---change-log" class="hash-link" aria-label="Direct link to Appendix B - Change Log" title="Direct link to Appendix B - Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-12-30</td><td>Codex</td><td>Initial Issue 547 design draft based on PR #704</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/runtime-event-broadcast-design-issue-547.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-open-questions" class="table-of-contents__link toc-highlight">13. Open Questions</a></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a---glossary" class="table-of-contents__link toc-highlight">Appendix A - Glossary</a></li><li><a href="#appendix-b---change-log" class="table-of-contents__link toc-highlight">Appendix B - Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Idle Engine.</div></div></div></footer></div>
</body>
</html>