<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content-compiler-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Content Compiler Design Document | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Content Compiler Design Document | Idle Engine Docs"><meta data-rh="true" name="description" content="Issue: #159"><meta data-rh="true" property="og:description" content="Issue: #159"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Content Compiler Design Document","item":"https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"}]}</script><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.ab48c13f.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.f7253bbf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><aside class="theme-doc-sidebar-container docSidebarContainer_Xlvo"><div class="sidebarViewport_tjEA"><div class="sidebar_ubOv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_CfkH"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Idle-Game-Engine/"><span title="Getting Started" class="categoryLinkLabel_ebxo">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/"><span title="Overview" class="linkLabel_KsAJ">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/contributor-handbook"><span title="Contributor Handbook" class="linkLabel_KsAJ">Contributor Handbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/role-index"><span title="Role Index" class="linkLabel_KsAJ">Role Index</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/design-document-template"><span title="Design Document Template" class="linkLabel_KsAJ">Design Document Template</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/idle-engine-design"><span title="Core Runtime" class="categoryLinkLabel_ebxo">Core Runtime</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content Pipeline" class="categoryLinkLabel_ebxo">Content Pipeline</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content DSL Schema Design" class="linkLabel_KsAJ">Content DSL Schema Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-usage-guidelines"><span title="Content DSL Usage Guidelines" class="linkLabel_KsAJ">Content DSL Usage Guidelines</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Idle-Game-Engine/content-compiler-design"><span title="Content Compiler Design Document" class="linkLabel_KsAJ">Content Compiler Design Document</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-schema-rollout-decisions"><span title="Content Schema Rollout: Decision Log" class="linkLabel_KsAJ">Content Schema Rollout: Decision Log</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-validation-cli-design"><span title="Content Validation CLI Design Document" class="linkLabel_KsAJ">Content Validation CLI Design Document</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/accessibility-smoke-tests-design"><span title="Shell Integration" class="categoryLinkLabel_ebxo">Shell Integration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/coverage/"><span title="Diagnostics &amp; Quality" class="categoryLinkLabel_ebxo">Diagnostics &amp; Quality</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/implementation-plan"><span title="Operations &amp; Process" class="categoryLinkLabel_ebxo">Operations &amp; Process</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_tfRv"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_bxbs" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Idle-Game-Engine/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_p1A9"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Content Pipeline</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Content Compiler Design Document</span></li></ul></nav><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Content Compiler Design Document</h1></header>
<p><strong>Issue:</strong> #159<br>
<strong>Workstream:</strong> Content Pipeline<br>
<strong>Status:</strong> Design<br>
<strong>Last Updated:</strong> 2025-10-22</p>
<blockquote>
<p>Issue #12 unlocks the compiler stage of the content pipeline. With the schema in place, packs must be transformed into deterministic runtime-ready artifacts so the engine and tooling never depend on ad-hoc TypeScript exports.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-problem-statement">1. Problem Statement<a href="#1-problem-statement" class="hash-link" aria-label="Direct link to 1. Problem Statement" title="Direct link to 1. Problem Statement" translate="no">​</a></h2>
<p>The content DSL distributed through <code>@idle-engine/content-schema</code> already returns fully normalized <code>NormalizedContentPack</code> objects, yet every consumer still reparses authoring JSON at runtime. Each import of <code>packages/content-sample</code> calls <code>parseContentPack</code>, rebuilding lookup maps and re-running validation, the CLI (<code>tools/content-schema-cli/src/generate.js</code>) only validates packs while generating the runtime event manifest, and automation has no way to assert that generated artifacts match what is committed. Missing compiler outputs also block downstream tooling from consuming packs without pulling in the schema bundle.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-goals">2. Goals<a href="#2-goals" class="hash-link" aria-label="Direct link to 2. Goals" title="Direct link to 2. Goals" translate="no">​</a></h2>
<ul>
<li class="">Compile each discovered pack into a deterministic <code>SerializedNormalizedContentPack</code> plus an <code>artifactHash</code> so mutations can be detected without revalidation.</li>
<li class="">Publish <code>@idle-engine/content-compiler</code> with a Node entrypoint for the CLI and a browser-safe runtime entrypoint for consumers that only need rehydration helpers.</li>
<li class="">Fold compilation into <code>pnpm generate</code> so validation, manifest regeneration, and compilation happen in one command that supports watch mode, <code>--check</code>, and <code>--clean</code>.</li>
<li class="">Emit TypeScript modules and JSON artifacts that runtime packages import instead of calling <code>parseContentPack</code>, while exposing digests, warning metadata, and positional indices.</li>
<li class="">Surface structured JSON log events that follow data-pipeline logging best practices, enabling CI and observability tooling to gate builds on compiler health.</li>
<li class="">Track discovery metadata and prune stale outputs so committed artifacts align with the set of packs in <code>packages/*/content/</code>.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-non-goals">3. Non-Goals<a href="#3-non-goals" class="hash-link" aria-label="Direct link to 3. Non-Goals" title="Direct link to 3. Non-Goals" translate="no">​</a></h2>
<ul>
<li class="">Pre-evaluating or optimizing pack formulas into bytecode; formula execution remains a runtime responsibility (<code>docs/runtime-step-lifecycle.md</code>).</li>
<li class="">Shipping content balance heuristics, localization exports, or asset bundling flows.</li>
<li class="">Producing bespoke binary assets; JSON and TypeScript output is sufficient for this milestone.</li>
<li class="">Replacing the runtime event manifest generator or altering digest semantics defined by the schema package.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-current-state">4. Current State<a href="#4-current-state" class="hash-link" aria-label="Direct link to 4. Current State" title="Direct link to 4. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>packages/content-sample/src/index.ts</code> now imports the compiler&#x27;s generated module (<code>src/generated/@idle-engine/sample-pack.generated.ts</code>), re-exporting the rehydrated pack alongside digest, summary, and module indices. Earlier revisions called <code>parseContentPack</code> on <code>content/pack.json</code> during import, re-running schema validation for every consumer.</li>
<li class=""><code>tools/content-schema-cli/src/generate.js</code> builds the runtime event manifest and validates packs but does not write pack-level artifacts or logs.</li>
<li class="">No package currently writes <code>content/compiled/</code> or <code>src/generated/</code> outputs; a search for those directories under <code>packages/</code> returns nothing.</li>
<li class="">There is no shared digest registry, and Lefthook cannot assert that authored JSON matches committed outputs because none exist yet.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-target-architecture">5. Target Architecture<a href="#5-target-architecture" class="hash-link" aria-label="Direct link to 5. Target Architecture" title="Direct link to 5. Target Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="51-package-layout--ownership">5.1 Package Layout &amp; Ownership<a href="#51-package-layout--ownership" class="hash-link" aria-label="Direct link to 5.1 Package Layout &amp; Ownership" title="Direct link to 5.1 Package Layout &amp; Ownership" translate="no">​</a></h3>
<p><code>@idle-engine/content-compiler</code> will live in <code>packages/content-compiler</code> and provide two public entrypoints:</p>
<ul>
<li class=""><code>index.ts</code> (Node-only) exposes compiler APIs and filesystem helpers.</li>
<li class=""><code>runtime.ts</code> (browser-safe) exposes rehydration utilities without importing <code>node:</code> modules so web bundles stay lean.</li>
</ul>
<p>Planned layout:</p>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">packages/content-compiler/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pipeline.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifacts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      json.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      module.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      discovery.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      writer.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hashing.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __tests__/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      compiler.test.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts.test.ts</span><br></span></code></pre></div></div>
<p><code>package.json</code> publishes an explicit <code>exports</code> map to prevent bundlers from pulling Node code into browser builds:</p>
<div class="language-json codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-json codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;exports&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;.&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;import&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/index.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/index.d.ts&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;./runtime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;import&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/runtime.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/runtime.d.ts&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;./package.json&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./package.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>To share digest logic without bundling the full schema implementation, <code>@idle-engine/content-schema</code> now publishes a <code>runtime-helpers</code> export that surfaces <code>createContentPackDigest</code>, freeze helpers, and associated types. The compiler package depends on that entrypoint so hashing stays consistent across the workspace. Splitting orchestration from artifact emitters mirrors the manifest-driven content pipeline described in <a href="https://medium.com/@heinapurola/engine-internals-content-pipeline-1af34a117f1" target="_blank" rel="noopener noreferrer" class="">Engine Internals: Content Pipeline</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="52-public-api-surface">5.2 Public API Surface<a href="#52-public-api-surface" class="hash-link" aria-label="Direct link to 5.2 Public API Surface" title="Direct link to 5.2 Public API Surface" translate="no">​</a></h3>
<p><code>@idle-engine/content-compiler</code> will export:</p>
<ul>
<li class=""><code>compileContentPack(document: ContentDocument, options: CompileOptions): Promise&lt;PackArtifactResult&gt;</code> – compile a single document and return artifact buffers plus metadata.</li>
<li class=""><code>compileWorkspacePacks(fs: WorkspaceFS, options: CompileWorkspaceOptions): Promise&lt;WorkspaceCompileResult&gt;</code> – orchestrate discovery, compilation, pruning, logging, and summary emission for all packs.</li>
<li class=""><code>rehydrateNormalizedPack(serialized: SerializedNormalizedContentPack, options?: RehydrateOptions): NormalizedContentPack</code> – rebuild lookup structures in browser or server runtimes.</li>
<li class=""><code>createModuleIndices(pack: NormalizedContentPack): Readonly&lt;ModuleIndexTables&gt;</code> – derive positional indices from frozen module arrays.</li>
<li class="">Types for <code>ContentDocument</code>, <code>SerializedNormalizedContentPack</code>, <code>CompileLogEvent</code>, and <code>WorkspaceSummary</code>.</li>
</ul>
<p><code>ModuleIndexTables</code> is defined as:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ModuleIndexTables</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> upgrades</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> achievements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> automations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> transforms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> prestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> guildPerks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> runtimeEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><code>createModuleIndices</code> preserves the ordering of the serialized module arrays, so each map&#x27;s numeric value matches the zero-based offset in the corresponding array.</p>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="53-compilation-workflow">5.3 Compilation Workflow<a href="#53-compilation-workflow" class="hash-link" aria-label="Direct link to 5.3 Compilation Workflow" title="Direct link to 5.3 Compilation Workflow" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Discover packs</strong> – scan <code>packages/*/content/pack.json</code>, mirroring the manifest generator’s discovery rules. Each file becomes a <code>ContentDocument</code> with absolute path, POSIX-relative path, slug (derived from <code>metadata.id</code>), and parsed JSON:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ContentDocument</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> absolutePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> relativePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> packSlug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> document</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Duplicate slugs emit a <code>content_pack.compilation_failed</code> event and abort the run before any artifacts are written so collisions cannot clobber outputs. Discovery also records every <code>metadata.id</code> and source path in a collision registry used later when verifying digests, following the hash-audit guidance in <a href="https://cowboyprogramming.com/2007/01/04/practical-hash-ids/" target="_blank" rel="noopener noreferrer" class="">Practical Hash IDs</a>.</p>
</li>
<li class="">
<p><strong>Prepare context</strong> – reuse the manifest definitions that <code>tools/content-schema-cli</code> already constructs to populate <code>ContentSchemaOptions</code> (<code>runtimeEventCatalogue</code>, <code>knownPacks</code>, <code>activePackIds</code>). The CLI passes these definitions to the compiler so consumers do not import <code>GENERATED_RUNTIME_EVENT_DEFINITIONS</code> directly.</p>
</li>
<li class="">
<p><strong>Validate and normalize</strong> – call <code>parseContentPack(document, options)</code> exactly once per pack. Persist both the returned <code>NormalizedContentPack</code> and the <code>warnings</code> array so downstream steps can surface severities without re-running schema logic.</p>
</li>
<li class="">
<p><strong>Serialize to compiled payloads</strong> – convert each <code>NormalizedContentPack</code> into a serializable shape:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">SerializedNormalizedContentPack</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> formatVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedMetadata</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> warnings</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> SerializedContentSchemaWarning</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> modules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedResource</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedGenerator</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> upgrades</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedUpgrade</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedMetric</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> achievements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedAchievement</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> automations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedAutomation</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> transforms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedTransform</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> prestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedPrestigeLayer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> guildPerks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedGuildPerk</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> runtimeEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedRuntimeEventContribution</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> digest</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedContentPack</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;digest&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> artifactHash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
</ol>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> `SerializedContentSchemaWarning` copies the schema warning properties onto plain data objects so JSON consumers can read them without prototype baggage. Lookup maps and positional indices are intentionally excluded; they are regenerated during rehydration to preserve referential identity.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Dependency data remains anchored in `metadata.dependencies` so there is a single source of truth for downstream tooling ([What Is a Single Source of Truth?](https://maddevs.io/glossary/single-source-of-truth/)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. **Emit artifacts** – hand each payload to dedicated emitters that produce:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Canonical JSON: `packages/&lt;pack&gt;/content/compiled/&lt;packSlug&gt;.normalized.json`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Generated modules: `packages/&lt;pack&gt;/src/generated/&lt;packSlug&gt;.generated.ts`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Workspace summary: `&lt;repo&gt;/content/compiled/index.json`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Before writing, the compiler compares the current discovery set against existing artifacts and removes any JSON/TypeScript files for packs that disappeared so stale outputs do not linger. Writes go through a temporary file in the target directory followed by an atomic rename to avoid torn files, per the recommendations in [Atomic file creation with temporary files](https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/). If the newly generated bytes match what already exists, the writer skips the rename entirely to minimize churn and keep incremental builds fast, aligning with Unity&#x27;s incremental pipeline guidance ([Unity Incremental Build Pipeline](https://docs.unity3d.com/Manual/incremental-build-pipeline.html)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> If `compileContentPack` throws or returns a failure state, the compiler deletes any existing `content/compiled/&lt;slug&gt;.normalized.json` and `src/generated/&lt;slug&gt;.generated.ts` artifacts before moving on. A `--check` run surfaces the removal as a drift so CI fails visibly, and the workspace summary records the failure to stop automation from silently using stale modules.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> The CLI never lets compilation run ahead of validation. `pnpm generate` persists a validation failure summary and exits early when schema checks break, and `--check` mode flags the run as drifted whenever that summary would change. This sequencing guarantees validation remains the gatekeeper for every artifact write.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. **Log results** – emit machine-readable JSON events (`content_pack.compiled`, `content_pack.compilation_failed`, `content_pack.skipped`, `content_pack.pruned`) that include slug, duration, warning counts, and artifact paths. Validation emits its own `content_pack.validated` / `.validation_failed` events before compilation begins so log consumers can correlate outcomes end-to-end. Watch mode adds a `watch.run` event after each iteration with duration, trigger paths, and outcome to simplify monitoring. Logs follow structured logging practices that favor JSON key/value payloads for downstream parsing ([9 Logging Best Practices You Should Know](https://www.dash0.com/guides/logging-best-practices), [Best Practices for Analyzing Logs in Data Pipelines](https://blog.dreamfactory.com/best-practices-for-analyzing-logs-in-data-pipelines)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 5.4 Artifact Contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Normalized JSON (`content/compiled/*.normalized.json`)**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Contains the exact `SerializedNormalizedContentPack` shape with canonical key ordering and a trailing newline to keep diffs legible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Serves as the source of truth for `pnpm generate --check`, documentation tooling, and automation that needs raw JSON.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Embeds `warnings`, `digest`, and `artifactHash` so checks can fail without invoking the compiler.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Files live beside their originating pack to keep review diffs local to the owning package.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Generated TypeScript modules (`src/generated/*.generated.ts`)**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createModuleIndices,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rehydrateNormalizedPack,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type SerializedNormalizedContentPack,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} from &#x27;@idle-engine/content-compiler/runtime&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const serialized: SerializedNormalizedContentPack = { /* inlined JSON */ };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const runtimeEnv = (globalThis as typeof globalThis &amp; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  process?: { env?: Record&lt;string, string | undefined&gt; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}).process;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const shouldVerifyDigest = runtimeEnv?.env?.NODE_ENV !== &#x27;production&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK = rehydrateNormalizedPack(serialized, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verifyDigest: shouldVerifyDigest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_DIGEST = serialized.digest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_ARTIFACT_HASH = serialized.artifactHash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_INDICES = createModuleIndices(SAMPLE_PACK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_SUMMARY = Object.freeze({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slug: serialized.metadata.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: serialized.metadata.version,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceIds: serialized.modules.resources.map((resource) =&gt; resource.id),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><code>rehydrateNormalizedPack</code> (implemented in <code>runtime.ts</code>) reconstructs lookup maps, freezes arrays, and—when <code>verifyDigest</code> is true—recomputes the digest (artifact hash verification is planned as a follow-up in #159). <code>createModuleIndices</code> iterates the frozen module arrays, asserts identifier uniqueness, and returns immutable lookup tables so runtime code can map identifiers to array offsets without recomputing them on startup. <code>SAMPLE_PACK_INDICES.generators.get(&#x27;starter-generator&#x27;)</code> returns the array index inside <code>SAMPLE_PACK.generators</code>, allowing consumers to map ids to offsets without recomputing lookup tables.
The <code>verifyDigest</code> guard inspects <code>globalThis.process?.env</code> when present instead of assuming <code>import.meta.env</code>, preventing runtime errors in environments that do not expose the Vite-style global (<a href="https://discourse.wicg.io/t/should-the-browser-consider-an-import-meta-env-object/4522/" target="_blank" rel="noopener noreferrer" class="">Should the browser consider an import.meta.env object?</a>).
<code>@idle-engine/content-sample/src/index.ts</code> aliases these exports to ergonomic runtime names (<code>sampleContent</code>, <code>sampleContentSummary</code>, <code>sampleContentIndices</code>, etc.) and throws whenever the compiler recorded warnings so existing guardrails remain in place without reparsing authoring JSON.</p>
<ul>
<li class=""><strong>Workspace summary (<code>content/compiled/index.json</code>)</strong>
<ul>
<li class="">Resides at the repository root and lists every compiled pack with slug, version, digest, artifact hash, dependency set (sourced from <code>metadata.dependencies</code>), warning count, and artifact paths.</li>
<li class="">Serves as the canonical workspace index for automation, docs, and runtime bootstrapping. Consumers must treat the file as stale whenever validation fails or the CLI reports drift and rerun <code>pnpm generate</code> before relying on the data.</li>
<li class="">Doubles as the collision manifest: the compiler records when two packs share a digest or dependency and emits warnings immediately.</li>
<li class="">Drives documentation tooling and allows <code>pnpm generate --check</code> to diff a single file to detect drift.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="55-determinism--integrity">5.5 Determinism &amp; Integrity<a href="#55-determinism--integrity" class="hash-link" aria-label="Direct link to 5.5 Determinism &amp; Integrity" title="Direct link to 5.5 Determinism &amp; Integrity" translate="no">​</a></h3>
<ul>
<li class="">JSON emitters use a stable RFC-8785 compatible stringifier so repeated runs produce byte-identical output. The digest stays aligned with the schema package by deferring to <code>createContentPackDigest</code> from the new <code>runtime-helpers</code> export.</li>
<li class="">Writers operate on temporary files located in the target directory and complete writes with <code>fs.rename</code>, guaranteeing atomic replacements even when the process crashes mid-write (<a href="https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/" target="_blank" rel="noopener noreferrer" class="">Atomic file creation with temporary files</a>).</li>
<li class=""><code>pnpm generate --check</code> recompiles without writing files and exits with status <code>1</code> if any artifact would change, enabling Lefthook and CI to fail fast on stale outputs.</li>
<li class=""><code>pnpm generate --clean</code> invalidates any cached comparisons and forces rewrites, providing the clean-build escape hatch recommended for incremental pipelines (<a href="https://docs.unity3d.com/Manual/incremental-build-pipeline.html" target="_blank" rel="noopener noreferrer" class="">Unity Incremental Build Pipeline</a>).</li>
<li class="">Nightly determinism checks rerun <code>pnpm generate --check</code> twice in isolated working directories (incremental vs clean) and compare summary hashes, following the strategy outlined in <a href="https://blog.llvm.org/2019/11/deterministic-builds-with-clang-and-lld.html" target="_blank" rel="noopener noreferrer" class="">Deterministic builds with clang and lld</a>.</li>
<li class="">The workspace summary omits wall-clock timestamps so artifacts remain byte-identical across runs, in line with reproducible-build guidance to remove timestamp variability (<a href="https://reproducible-builds.org/docs/deterministic-build-systems/" target="_blank" rel="noopener noreferrer" class="">Deterministic build systems</a>).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="551-artifact-integrity-contract">5.5.1 Artifact Integrity Contract<a href="#551-artifact-integrity-contract" class="hash-link" aria-label="Direct link to 5.5.1 Artifact Integrity Contract" title="Direct link to 5.5.1 Artifact Integrity Contract" translate="no">​</a></h3>
<ul>
<li class=""><code>artifactHash</code> is the lowercase hex encoding of the SHA-256 hash of the RFC-8785 canonical JSON representation of the complete <code>SerializedNormalizedContentPack</code>, computed with <code>artifactHash</code> temporarily set to the empty string.<!-- -->
<ul>
<li class="">The compiler canonicalizes a clone of the payload with the hash cleared, hashes those bytes, and then writes the emitted JSON with the computed hash reinserted. Integrity checks repeat the same “blank then canonicalize” procedure before hashing.</li>
<li class=""><code>rehydrateNormalizedPack</code> recomputes the digest when <code>verifyDigest</code> is enabled (artifact hash validation will land alongside the canonical serializer upgrades tracked in #159).</li>
<li class=""><code>formatVersion</code> changes whenever the serialized payload shape or canonicalization rules change. When <code>formatVersion</code> increments, the compiler writes new artifacts and the runtime refuses to rehydrate packs whose <code>formatVersion</code> it does not understand.</li>
<li class=""><code>digest</code> remains the schema-defined content identity (used for dependency tracking, change detection, and collision reporting). <code>artifactHash</code> guarantees the integrity of the compiled artifact itself. Automation treats <code>digest</code> drift as a semantic change in content, while <code>artifactHash</code> mismatches indicate corrupted or stale build output.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="56-dependency-handling">5.6 Dependency Handling<a href="#56-dependency-handling" class="hash-link" aria-label="Direct link to 5.6 Dependency Handling" title="Direct link to 5.6 Dependency Handling" translate="no">​</a></h3>
<ul>
<li class="">The compiler resolves pack order with a topological sort on <code>metadata.dependencies.requires</code>, ensuring dependants always compile after their prerequisites (<a href="https://ipython-books.github.io/143-resolving-dependencies-in-a-directed-acyclic-graph-with-a-topological-sort/" target="_blank" rel="noopener noreferrer" class="">IPython Cookbook - Resolving dependencies in a directed acyclic graph</a>).</li>
<li class="">Missing dependencies trigger warnings and mark the pack as failed; the summary captures the failure so automation can highlight the gap.</li>
<li class="">Dependency cycles emit a single <code>content_pack.compilation_failed</code> event listing every slug in the loop and aborting the run before artifacts are written.</li>
<li class="">The workspace summary records dependency digests so CI can detect mismatches when a referenced pack changed but a dependant did not rebuild.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="57-logging--telemetry">5.7 Logging &amp; Telemetry<a href="#57-logging--telemetry" class="hash-link" aria-label="Direct link to 5.7 Logging &amp; Telemetry" title="Direct link to 5.7 Logging &amp; Telemetry" translate="no">​</a></h3>
<ul>
<li class="">Every compiler run writes structured JSON lines to stdout; human-friendly pretty-printing remains opt-in via <code>--pretty</code>. Each event includes an ISO timestamp, event name, slug, duration, warning count, and file paths. Structured payloads make it trivial for log processors to filter on keys rather than regex parsing (<a href="https://www.dash0.com/guides/logging-best-practices" target="_blank" rel="noopener noreferrer" class="">9 Logging Best Practices You Should Know</a>).</li>
<li class="">Event schema:<!-- -->
<ul>
<li class=""><code>content_pack.compiled</code>: success path with <code>artifacts</code>, <code>warnings</code>, <code>durationMs</code>.</li>
<li class=""><code>content_pack.compilation_failed</code>: failure details with <code>message</code>, <code>path</code>, <code>issues</code>.</li>
<li class=""><code>content_pack.pruned</code>: emitted when stale artifacts are deleted.</li>
<li class=""><code>content_pack.skipped</code>: emitted when <code>--check</code> detects no changes.</li>
</ul>
</li>
<li class="">Logs integrate with existing CI parsers and future observability services without additional adapters.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="58-developer-experience--adoption">5.8 Developer Experience &amp; Adoption<a href="#58-developer-experience--adoption" class="hash-link" aria-label="Direct link to 5.8 Developer Experience &amp; Adoption" title="Direct link to 5.8 Developer Experience &amp; Adoption" translate="no">​</a></h3>
<ul>
<li class=""><code>tools/content-schema-cli</code> gains a <code>compile</code> command (<code>pnpm --filter @idle-engine/content-validation-cli run compile</code>) and updates <code>generate</code> to execute manifest regeneration → validation → compilation in order.</li>
<li class=""><code>--watch</code> uses <code>chokidar</code> to observe authoring JSON and schema inputs, debouncing writes and ignoring compiler-owned outputs (<code>**/content/compiled/**</code>, <code>**/src/generated/*.generated.ts</code>) to avoid loops.</li>
<li class=""><code>packages/content-sample</code> switches to importing the generated module, keeping the direct JSON import only as a fallback test helper.</li>
<li class="">Documentation (<code>docs/content-schema-rollout-decisions.md</code>, <code>docs/implementation-plan.md</code>) and READMEs will be updated once the compiler ships, so contributors know to run <code>pnpm generate</code> after editing content.</li>
<li class="">Lefthook gains a <code>content</code> hook that runs <code>pnpm generate --check</code> to guard against stale artifacts before commit.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-implementation-plan">6. Implementation Plan<a href="#6-implementation-plan" class="hash-link" aria-label="Direct link to 6. Implementation Plan" title="Direct link to 6. Implementation Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-1---package-foundations">Phase 1 - Package Foundations<a href="#phase-1---package-foundations" class="hash-link" aria-label="Direct link to Phase 1 - Package Foundations" title="Direct link to Phase 1 - Package Foundations" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Scaffold <code>packages/content-compiler</code>, add build tooling, exports map, and baseline tests.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Add <code>runtime-helpers</code> export to <code>@idle-engine/content-schema</code> with shared digest utilities.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement discovery, context preparation, and single-pack compilation APIs.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-2---artifact-emitters--cli-wiring">Phase 2 - Artifact Emitters &amp; CLI Wiring<a href="#phase-2---artifact-emitters--cli-wiring" class="hash-link" aria-label="Direct link to Phase 2 - Artifact Emitters &amp; CLI Wiring" title="Direct link to Phase 2 - Artifact Emitters &amp; CLI Wiring" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement canonical JSON and TypeScript emitters with stable ordering, digest calculation, and atomic writes.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Extend <code>tools/content-schema-cli</code> with the new compiler command, integrate logs, and update <code>pnpm generate</code> to run validation and compilation sequentially.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Persist structured warnings in per-pack artifacts and the workspace summary.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement <code>--check</code>, <code>--clean</code>, and artifact pruning; ensure Lefthook/CI adopt the new verification step.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-3---developer-experience--adoption">Phase 3 - Developer Experience &amp; Adoption<a href="#phase-3---developer-experience--adoption" class="hash-link" aria-label="Direct link to Phase 3 - Developer Experience &amp; Adoption" title="Direct link to Phase 3 - Developer Experience &amp; Adoption" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement watch mode with debounced recompilation and change detection.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Update <code>packages/content-sample</code> (and any other consumers) to import generated artifacts.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Backfill documentation and onboarding guides with compiler usage and troubleshooting tips.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-success-criteria">7. Success Criteria<a href="#7-success-criteria" class="hash-link" aria-label="Direct link to 7. Success Criteria" title="Direct link to 7. Success Criteria" translate="no">​</a></h2>
<ul>
<li class="">Every pack produces <code>content/compiled/*.normalized.json</code> and <code>src/generated/*.generated.ts</code> without manual intervention.</li>
<li class=""><code>pnpm generate</code> emits <code>content_pack.*</code> events, fails when artifacts drift, and <code>--check</code> exits non-zero on stale outputs.</li>
<li class="">Runtime consumers no longer call <code>parseContentPack</code> at import time; they rely on generated modules and rehydration helpers.</li>
<li class="">Consecutive compiler runs with unchanged inputs produce no git diffs and skip file rewrites.</li>
<li class="">Removing a pack deletes its compiled artifacts within the same run that detects the removal.</li>
<li class="">Compiler unit tests and CLI smoke tests run under <code>pnpm test</code> and <code>pnpm lint</code>; CI passes with the determinism check enabled.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-open-questions">8. Open Questions<a href="#8-open-questions" class="hash-link" aria-label="Direct link to 8. Open Questions" title="Direct link to 8. Open Questions" translate="no">​</a></h2>
<ol>
<li class=""><strong>Formula precomputation:</strong> Is there value in capturing precomputed coefficients for common formula types during compilation, or should that remain a separate optimization pass?</li>
<li class=""><strong>Artifact granularity:</strong> Do documentation tools need per-module JSON (e.g., <code>resources.json</code>) in addition to the consolidated pack payload?</li>
<li class=""><strong>Bundle outputs:</strong> Should the compiler emit optional multi-pack bundles (e.g., seasonal content sets), or is the workspace summary sufficient for the current roadmap?</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-references">9. References<a href="#9-references" class="hash-link" aria-label="Direct link to 9. References" title="Direct link to 9. References" translate="no">​</a></h2>
<ul>
<li class=""><code>docs/content-dsl-schema-design.md</code></li>
<li class=""><code>docs/content-schema-rollout-decisions.md</code></li>
<li class=""><code>docs/idle-engine-design.md</code> §6.2</li>
<li class=""><code>docs/runtime-command-queue-design.md</code> §13</li>
<li class=""><code>tools/content-schema-cli/src/generate.js</code></li>
<li class=""><code>packages/content-schema/src/pack.ts</code></li>
<li class=""><code>packages/content-sample/src/index.ts</code></li>
<li class=""><a href="https://docs.unity3d.com/Manual/incremental-build-pipeline.html" target="_blank" rel="noopener noreferrer" class="">Unity Incremental Build Pipeline</a></li>
<li class=""><a href="https://cowboyprogramming.com/2007/01/04/practical-hash-ids/" target="_blank" rel="noopener noreferrer" class="">Practical Hash IDs (Cowboy Programming)</a></li>
<li class=""><a href="https://blog.llvm.org/2019/11/deterministic-builds-with-clang-and-lld.html" target="_blank" rel="noopener noreferrer" class="">Deterministic builds with clang and lld</a></li>
<li class=""><a href="https://blog.dreamfactory.com/best-practices-for-analyzing-logs-in-data-pipelines" target="_blank" rel="noopener noreferrer" class="">Best Practices for Analyzing Logs in Data Pipelines</a></li>
<li class=""><a href="https://www.dash0.com/guides/logging-best-practices" target="_blank" rel="noopener noreferrer" class="">9 Logging Best Practices You Should Know</a></li>
<li class=""><a href="https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/" target="_blank" rel="noopener noreferrer" class="">Atomic file creation with temporary files</a></li>
<li class=""><a href="https://ipython-books.github.io/143-resolving-dependencies-in-a-directed-acyclic-graph-with-a-topological-sort/" target="_blank" rel="noopener noreferrer" class="">IPython Cookbook - Resolving dependencies in a directed acyclic graph with a topological sort</a></li>
<li class=""><a href="https://medium.com/@heinapurola/engine-internals-content-pipeline-1af34a117f1" target="_blank" rel="noopener noreferrer" class="">Engine Internals: Content Pipeline</a></li>
<li class=""><a href="https://reproducible-builds.org/docs/deterministic-build-systems/" target="_blank" rel="noopener noreferrer" class="">Deterministic build systems</a></li>
<li class=""><a href="https://maddevs.io/glossary/single-source-of-truth/" target="_blank" rel="noopener noreferrer" class="">What Is a Single Source of Truth?</a></li>
<li class=""><a href="https://discourse.wicg.io/t/should-the-browser-consider-an-import-meta-env-object/4522/" target="_blank" rel="noopener noreferrer" class="">Should the browser consider an import.meta.env object?</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/content-compiler-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Idle-Game-Engine/content-dsl-usage-guidelines"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Content DSL Usage Guidelines</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Idle-Game-Engine/content-schema-rollout-decisions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Content Schema Rollout: Decision Log</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-problem-statement" class="table-of-contents__link toc-highlight">1. Problem Statement</a></li><li><a href="#2-goals" class="table-of-contents__link toc-highlight">2. Goals</a></li><li><a href="#3-non-goals" class="table-of-contents__link toc-highlight">3. Non-Goals</a></li><li><a href="#4-current-state" class="table-of-contents__link toc-highlight">4. Current State</a></li><li><a href="#5-target-architecture" class="table-of-contents__link toc-highlight">5. Target Architecture</a><ul><li><a href="#51-package-layout--ownership" class="table-of-contents__link toc-highlight">5.1 Package Layout &amp; Ownership</a></li><li><a href="#52-public-api-surface" class="table-of-contents__link toc-highlight">5.2 Public API Surface</a></li><li><a href="#53-compilation-workflow" class="table-of-contents__link toc-highlight">5.3 Compilation Workflow</a></li><li><a href="#55-determinism--integrity" class="table-of-contents__link toc-highlight">5.5 Determinism &amp; Integrity</a></li><li><a href="#551-artifact-integrity-contract" class="table-of-contents__link toc-highlight">5.5.1 Artifact Integrity Contract</a></li><li><a href="#56-dependency-handling" class="table-of-contents__link toc-highlight">5.6 Dependency Handling</a></li><li><a href="#57-logging--telemetry" class="table-of-contents__link toc-highlight">5.7 Logging &amp; Telemetry</a></li><li><a href="#58-developer-experience--adoption" class="table-of-contents__link toc-highlight">5.8 Developer Experience &amp; Adoption</a></li></ul></li><li><a href="#6-implementation-plan" class="table-of-contents__link toc-highlight">6. Implementation Plan</a><ul><li><a href="#phase-1---package-foundations" class="table-of-contents__link toc-highlight">Phase 1 - Package Foundations</a></li><li><a href="#phase-2---artifact-emitters--cli-wiring" class="table-of-contents__link toc-highlight">Phase 2 - Artifact Emitters &amp; CLI Wiring</a></li><li><a href="#phase-3---developer-experience--adoption" class="table-of-contents__link toc-highlight">Phase 3 - Developer Experience &amp; Adoption</a></li></ul></li><li><a href="#7-success-criteria" class="table-of-contents__link toc-highlight">7. Success Criteria</a></li><li><a href="#8-open-questions" class="table-of-contents__link toc-highlight">8. Open Questions</a></li><li><a href="#9-references" class="table-of-contents__link toc-highlight">9. References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>