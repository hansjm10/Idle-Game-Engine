<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content-compiler-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Content Compiler Design | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Content Compiler Design | Idle Engine Docs"><meta data-rh="true" name="description" content="Use this template when authoring new design proposals or retrofitting existing notes. Fill out every section or state explicitly why it is not applicable. Replace bracketed guidance with project-specific detail before submitting for review. The structure is optimised for an AI-first delivery model where work is decomposed into issues and executed by autonomous agents under human orchestration."><meta data-rh="true" property="og:description" content="Use this template when authoring new design proposals or retrofitting existing notes. Fill out every section or state explicitly why it is not applicable. Replace bracketed guidance with project-specific detail before submitting for review. The structure is optimised for an AI-first delivery model where work is decomposed into issues and executed by autonomous agents under human orchestration."><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Content Compiler Design","item":"https://hansjm10.github.io/Idle-Game-Engine/content-compiler-design"}]}</script><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.634c7438.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.c11039b9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><aside class="theme-doc-sidebar-container docSidebarContainer_Xlvo"><div class="sidebarViewport_tjEA"><div class="sidebar_ubOv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_CfkH"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Idle-Game-Engine/"><span title="Getting Started" class="categoryLinkLabel_ebxo">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/"><span title="Overview" class="linkLabel_KsAJ">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/contributor-handbook"><span title="Contributor Handbook" class="linkLabel_KsAJ">Contributor Handbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/role-index"><span title="Role Index" class="linkLabel_KsAJ">Role Index</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/design-document-template"><span title="Design Document Template" class="linkLabel_KsAJ">Design Document Template</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/idle-engine-design"><span title="Core Runtime" class="categoryLinkLabel_ebxo">Core Runtime</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content Pipeline" class="categoryLinkLabel_ebxo">Content Pipeline</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content DSL Schema Design" class="linkLabel_KsAJ">Content DSL Schema Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-usage-guidelines"><span title="Content DSL Usage Guidelines" class="linkLabel_KsAJ">Content DSL Usage Guidelines</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Idle-Game-Engine/content-compiler-design"><span title="Content Compiler Design" class="linkLabel_KsAJ">Content Compiler Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-schema-rollout-decisions"><span title="Content Schema Rollout Decisions" class="linkLabel_KsAJ">Content Schema Rollout Decisions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-validation-cli-design"><span title="Content Validation CLI Design" class="linkLabel_KsAJ">Content Validation CLI Design</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/coverage/"><span title="Diagnostics &amp; Quality" class="categoryLinkLabel_ebxo">Diagnostics &amp; Quality</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/implementation-plan"><span title="Operations &amp; Process" class="categoryLinkLabel_ebxo">Operations &amp; Process</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_tfRv"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_bxbs" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Idle-Game-Engine/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_p1A9"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Content Pipeline</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Content Compiler Design</span></li></ul></nav><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Content Compiler Design</h1></header>
<p>Use this template when authoring new design proposals or retrofitting existing notes. Fill out every section or state explicitly why it is not applicable. Replace bracketed guidance with project-specific detail before submitting for review. The structure is optimised for an AI-first delivery model where work is decomposed into issues and executed by autonomous agents under human orchestration.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Introduce Deterministic Content Pack Compilation</li>
<li class=""><strong>Authors</strong>: Content Pipeline Team</li>
<li class=""><strong>Reviewers</strong>: N/A</li>
<li class=""><strong>Status</strong>: Design</li>
<li class=""><strong>Last Updated</strong>: 2025-10-22</li>
<li class=""><strong>Related Issues</strong>: #159, #12</li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>The content compiler transforms validated content packs into deterministic, runtime-ready artifacts (normalized JSON and TypeScript modules) to eliminate redundant parsing, enable integrity verification, and unlock downstream tooling without bundling the full schema implementation. This design introduces <code>@idle-engine/content-compiler</code> to orchestrate discovery, compilation, atomic artifact emission, and structured logging, integrating into <code>pnpm generate</code> with watch mode, check mode, and clean-build support.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class=""><strong>Background</strong>: The content DSL distributed through <code>@idle-engine/content-schema</code> already returns fully normalized <code>NormalizedContentPack</code> objects, yet every consumer still reparses authoring JSON at runtime. Each import of <code>packages/content-sample</code> calls <code>parseContentPack</code>, rebuilding lookup maps and re-running validation. The CLI (<code>tools/content-schema-cli/src/generate.js</code>) only validates packs while generating the runtime event manifest, and automation has no way to assert that generated artifacts match what is committed. Missing compiler outputs also block downstream tooling from consuming packs without pulling in the schema bundle.</li>
<li class=""><strong>Problem</strong>: Issue #12 unlocks the compiler stage of the content pipeline. With the schema in place, packs must be transformed into deterministic runtime-ready artifacts so the engine and tooling never depend on ad-hoc TypeScript exports.</li>
<li class=""><strong>Forces</strong>: Artifacts must be deterministic (byte-identical across runs), atomic (avoid torn files on crash), and verifiable (support <code>--check</code> mode for CI). Compilation must integrate seamlessly into existing workflows without breaking watch mode or incremental builds.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Goals</strong>:<!-- -->
<ul>
<li class="">Compile each discovered pack into a deterministic <code>SerializedNormalizedContentPack</code> plus an <code>artifactHash</code> so mutations can be detected without revalidation.</li>
<li class="">Publish <code>@idle-engine/content-compiler</code> with a Node entrypoint for the CLI and a browser-safe runtime entrypoint for consumers that only need rehydration helpers.</li>
<li class="">Fold compilation into <code>pnpm generate</code> so validation, manifest regeneration, and compilation happen in one command that supports watch mode, <code>--check</code>, and <code>--clean</code>.</li>
<li class="">Emit TypeScript modules and JSON artifacts that runtime packages import instead of calling <code>parseContentPack</code>, while exposing digests, warning metadata, and positional indices.</li>
<li class="">Surface structured JSON log events that follow data-pipeline logging best practices, enabling CI and observability tooling to gate builds on compiler health.</li>
<li class="">Track discovery metadata and prune stale outputs so committed artifacts align with the set of packs in <code>packages/*/content/</code>.</li>
</ul>
</li>
<li class=""><strong>Non-Goals</strong>:<!-- -->
<ul>
<li class="">Pre-evaluating or optimizing pack formulas into bytecode; formula execution remains a runtime responsibility (<code>docs/runtime-step-lifecycle.md</code>).</li>
<li class="">Shipping content balance heuristics, localization exports, or asset bundling flows.</li>
<li class="">Producing bespoke binary assets; JSON and TypeScript output is sufficient for this milestone.</li>
<li class="">Replacing the runtime event manifest generator or altering digest semantics defined by the schema package.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>: Content Pipeline Team</li>
<li class=""><strong>Agent Roles</strong>:<!-- -->
<ul>
<li class="">Docs Agent: Migrate design document to template format, update onboarding guides.</li>
<li class="">Runtime Implementation Agent: Implement compiler package, CLI integration, and test coverage.</li>
</ul>
</li>
<li class=""><strong>Affected Packages/Services</strong>:<!-- -->
<ul>
<li class=""><code>packages/content-compiler</code> (new)</li>
<li class=""><code>packages/content-schema</code> (runtime-helpers export)</li>
<li class=""><code>packages/content-sample</code> (consumer migration)</li>
<li class=""><code>tools/content-schema-cli</code> (compile command integration)</li>
</ul>
</li>
<li class=""><strong>Compatibility Considerations</strong>: Generated modules must remain compatible with both Node and browser runtimes. <code>formatVersion</code> changes require coordinated runtime updates to prevent rehydration failures.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>packages/content-sample/src/index.ts</code> now imports the compiler&#x27;s generated module (<code>src/generated/@idle-engine/sample-pack.generated.ts</code>), re-exporting the rehydrated pack alongside digest, summary, and module indices. Earlier revisions called <code>parseContentPack</code> on <code>content/pack.json</code> during import, re-running schema validation for every consumer.</li>
<li class=""><code>tools/content-schema-cli/src/generate.js</code> builds the runtime event manifest and validates packs but does not write pack-level artifacts or logs.</li>
<li class="">No package currently writes <code>content/compiled/</code> or <code>src/generated/</code> outputs; a search for those directories under <code>packages/</code> returns nothing.</li>
<li class="">There is no shared digest registry, and Lefthook cannot assert that authored JSON matches committed outputs because none exist yet.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ul>
<li class=""><strong>Narrative</strong>: <code>@idle-engine/content-compiler</code> orchestrates pack discovery, validation, serialization, and artifact emission. The compiler scans <code>packages/*/content/pack.json</code>, topologically sorts packs by dependencies, validates each using the existing schema, serializes normalized packs to canonical JSON and TypeScript modules, and emits a workspace summary at the repository root. Atomic writes prevent torn files, and <code>--check</code> mode enables CI drift detection without modifying outputs.</li>
<li class=""><strong>Diagram</strong>: N/A (consider adding system diagram in future iteration)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<ul>
<li class=""><strong>Runtime Changes</strong>: Runtime packages import generated TypeScript modules instead of calling <code>parseContentPack</code> at startup. Rehydration rebuilds lookup maps and freezes arrays without re-running schema validation. Generated modules conditionally verify digests in non-production environments to catch corruption early.</li>
<li class=""><strong>Data &amp; Schemas</strong>:<!-- -->
<ul>
<li class=""><code>SerializedNormalizedContentPack</code> captures normalized modules, metadata, warnings, digest, and <code>artifactHash</code> in a frozen shape with <code>formatVersion: 1</code>.</li>
<li class=""><code>ContentDocument</code> wraps each discovered pack with absolute path, POSIX-relative path, slug, and parsed JSON.</li>
<li class=""><code>ModuleIndexTables</code> provides immutable maps from module IDs to array offsets.</li>
<li class="">RFC-8785 canonical JSON ensures byte-identical serialization across runs.</li>
</ul>
</li>
<li class=""><strong>APIs &amp; Contracts</strong>:<!-- -->
<ul>
<li class=""><code>compileContentPack(document: ContentDocument, options: CompileOptions): Promise&lt;PackArtifactResult&gt;</code> – compile a single document and return artifact buffers plus metadata.</li>
<li class=""><code>compileWorkspacePacks(fs: WorkspaceFS, options: CompileWorkspaceOptions): Promise&lt;WorkspaceCompileResult&gt;</code> – orchestrate discovery, compilation, pruning, logging, and summary emission for all packs.</li>
<li class=""><code>rehydrateNormalizedPack(serialized: SerializedNormalizedContentPack, options?: RehydrateOptions): NormalizedContentPack</code> – rebuild lookup structures in browser or server runtimes.</li>
<li class=""><code>createModuleIndices(pack: NormalizedContentPack): Readonly&lt;ModuleIndexTables&gt;</code> – derive positional indices from frozen module arrays.</li>
</ul>
</li>
<li class=""><strong>Tooling &amp; Automation</strong>:<!-- -->
<ul>
<li class=""><code>tools/content-schema-cli</code> gains a <code>compile</code> command and integrates compilation into <code>pnpm generate</code>.</li>
<li class=""><code>--watch</code> uses <code>chokidar</code> to observe authoring JSON and schema inputs, debouncing writes and ignoring compiler-owned outputs.</li>
<li class=""><code>--check</code> recompiles without writing files and exits with status 1 if any artifact would change.</li>
<li class=""><code>--clean</code> invalidates cached comparisons and forces rewrites.</li>
<li class="">Lefthook gains a <code>content</code> hook running <code>pnpm generate --check</code> to guard against stale artifacts before commit.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>: No CI/CD changes required beyond adding <code>pnpm generate --check</code> to the verification step. Nightly determinism checks rerun <code>--check</code> twice (incremental vs clean) and compare summary hashes.</li>
<li class=""><strong>Telemetry &amp; Observability</strong>: Structured JSON log events (<code>content_pack.compiled</code>, <code>content_pack.compilation_failed</code>, <code>content_pack.skipped</code>, <code>content_pack.pruned</code>) include slug, duration, warning counts, and artifact paths. Validation emits <code>content_pack.validated</code> / <code>.validation_failed</code> before compilation for end-to-end correlation.</li>
<li class=""><strong>Security &amp; Compliance</strong>: N/A (no PII handling; compiler operates on local workspace content only)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td>feat(content-compiler): scaffold package foundations</td><td>Scaffold <code>packages/content-compiler</code>, add build tooling, exports map, baseline tests</td><td>Runtime Implementation Agent</td><td>Doc approval</td><td>Package builds; exports map verified; unit tests pass</td></tr><tr><td>feat(content-schema): add runtime-helpers export</td><td>Add <code>runtime-helpers</code> export with shared digest utilities</td><td>Runtime Implementation Agent</td><td>Package scaffold</td><td>Export available; digest helpers tested</td></tr><tr><td>feat(content-compiler): implement discovery and single-pack compilation</td><td>Implement discovery, context preparation, single-pack compilation APIs</td><td>Runtime Implementation Agent</td><td>Runtime helpers</td><td>Discovery returns <code>ContentDocument</code>; single pack compiles</td></tr><tr><td>feat(content-compiler): implement artifact emitters</td><td>Implement canonical JSON and TypeScript emitters with stable ordering, atomic writes</td><td>Runtime Implementation Agent</td><td>Single-pack compilation</td><td>Emitters produce RFC-8785 JSON; atomic rename verified</td></tr><tr><td>feat(content-schema-cli): integrate compiler command</td><td>Extend CLI with compile command, integrate logs, update <code>pnpm generate</code></td><td>Runtime Implementation Agent</td><td>Artifact emitters</td><td><code>pnpm generate</code> runs validation then compilation; logs emit</td></tr><tr><td>feat(content-compiler): implement check/clean modes</td><td>Implement <code>--check</code>, <code>--clean</code>, artifact pruning</td><td>Runtime Implementation Agent</td><td>CLI integration</td><td><code>--check</code> detects drift; <code>--clean</code> forces rewrites</td></tr><tr><td>feat(content-compiler): implement watch mode</td><td>Implement watch mode with debounced recompilation</td><td>Runtime Implementation Agent</td><td>Check/clean modes</td><td>Watch detects changes; ignores generated outputs</td></tr><tr><td>chore(content-sample): migrate to generated artifacts</td><td>Update <code>packages/content-sample</code> to import generated modules</td><td>Runtime Implementation Agent</td><td>Compiler command</td><td>Runtime no longer calls <code>parseContentPack</code> at import</td></tr><tr><td>docs: update content pipeline documentation</td><td>Backfill docs with compiler usage and troubleshooting</td><td>Docs Agent</td><td>Sample migration</td><td>Documentation updated; onboarding complete</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1 - Package Foundations</strong>: Scaffold <code>packages/content-compiler</code>, add <code>runtime-helpers</code> export to <code>@idle-engine/content-schema</code>, implement discovery and single-pack compilation APIs. Target: Week 1.</li>
<li class=""><strong>Phase 2 - Artifact Emitters &amp; CLI Wiring</strong>: Implement canonical JSON and TypeScript emitters, extend CLI, persist warnings, implement <code>--check</code>/<code>--clean</code>, add Lefthook hook. Target: Week 2-3.</li>
<li class=""><strong>Phase 3 - Developer Experience &amp; Adoption</strong>: Implement watch mode, migrate <code>packages/content-sample</code>, backfill documentation. Target: Week 4.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Hand-off Package</strong>: Compiler design doc, schema package source, CLI source, sample package import pattern.</li>
<li class=""><strong>Communication Cadence</strong>: Weekly status updates; review checkpoints at end of each phase; escalate blocking issues to Content Pipeline Team immediately.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class=""><strong>Context Packets</strong>: Load <code>docs/content-dsl-schema-design.md</code>, <code>docs/content-schema-rollout-decisions.md</code>, <code>docs/idle-engine-design.md</code> §6.2, <code>docs/runtime-command-queue-design.md</code> §13. Review <code>packages/content-schema/src/pack/index.ts</code> and <code>tools/content-schema-cli/src/generate.js</code> before implementation.</li>
<li class=""><strong>Prompting &amp; Constraints</strong>: Use conventional commit format (<code>feat(content-compiler):</code>, <code>chore(content-sample):</code>, <code>docs:</code>). All generated modules must include header comment: <code>// Generated by @idle-engine/content-compiler - DO NOT EDIT</code>. Follow RFC-8785 for canonical JSON; use <code>fs.rename</code> for atomic writes.</li>
<li class=""><strong>Safety Rails</strong>: Do not modify <code>packages/content-schema/src/pack/normalize.ts</code> digest logic. Do not remove existing <code>parseContentPack</code> tests until migration is complete. Never commit compiled artifacts without corresponding authored JSON changes.</li>
<li class=""><strong>Validation Hooks</strong>: Run <code>pnpm test</code> and <code>pnpm lint</code> before marking tasks complete. Verify <code>pnpm generate --check</code> exits 0 on clean workspace and 1 after manual artifact edits.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ul>
<li class=""><strong>In-memory compilation without artifacts</strong>: Rejected because downstream tooling (docs, automation) needs stable JSON outputs, and CI cannot verify drift without committed artifacts.</li>
<li class=""><strong>Binary artifact format</strong>: Rejected for this milestone; JSON and TypeScript provide sufficient performance and debuggability. Binary formats deferred to future optimization pass.</li>
<li class=""><strong>Per-module JSON files</strong> (e.g., <code>resources.json</code>, <code>generators.json</code>): Rejected to minimize file proliferation; consolidated pack payload is sufficient, and the workspace summary provides cross-pack indexing.</li>
<li class=""><strong>Formula precomputation during compilation</strong>: Deferred to future optimization; formula execution remains a runtime responsibility per <code>docs/runtime-step-lifecycle.md</code>.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Unit / Integration</strong>:<!-- -->
<ul>
<li class="">Compiler unit tests (<code>compiler.test.ts</code>, <code>artifacts.test.ts</code>) verify discovery, serialization, atomic writes, and determinism.</li>
<li class="">CLI integration tests verify <code>--check</code>, <code>--clean</code>, <code>--watch</code>, and log event emission.</li>
<li class="">Rehydration tests verify digest verification and lookup map reconstruction.</li>
<li class="">Coverage expectation: 90% for compiler core, 80% for CLI integration.</li>
</ul>
</li>
<li class=""><strong>Performance</strong>:<!-- -->
<ul>
<li class="">Benchmark compilation time for sample pack (target: <code>&lt;100ms</code> on warm runs).</li>
<li class="">Benchmark rehydration time for sample pack (target: <code>&lt;10ms</code>).</li>
<li class="">Verify consecutive runs skip rewrites when inputs unchanged.</li>
</ul>
</li>
<li class=""><strong>Tooling / A11y</strong>: N/A (no UI components)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Risk</strong>: Compilation breaks watch mode or incremental builds.<!-- -->
<ul>
<li class=""><strong>Mitigation</strong>: <code>--watch</code> ignores compiler-owned outputs (<code>**/content/compiled/**</code>, <code>**/src/generated/*.generated.ts</code>). Emitters skip rewrites when bytes match. Test watch mode in CI.</li>
</ul>
</li>
<li class=""><strong>Risk</strong>: Digest mismatches between schema and compiler.<!-- -->
<ul>
<li class=""><strong>Mitigation</strong>: Compiler defers to <code>createContentPackDigest</code> from <code>runtime-helpers</code> export. Nightly determinism checks verify digest stability.</li>
</ul>
</li>
<li class=""><strong>Risk</strong>: Stale artifacts merged to main.<!-- -->
<ul>
<li class=""><strong>Mitigation</strong>: Lefthook runs <code>pnpm generate --check</code> pre-commit. CI runs same check in verify step. PR reviewers verify compiled artifacts changed when authoring JSON changed.</li>
</ul>
</li>
<li class=""><strong>Risk</strong>: Formula precomputation blockers emerge.<!-- -->
<ul>
<li class=""><strong>Mitigation</strong>: Non-goal for this milestone; deferred to future optimization pass once compiler is stable.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Milestones</strong>: See §7.2 (Phase 1-3 over 4 weeks).</li>
<li class=""><strong>Migration Strategy</strong>:<!-- -->
<ul>
<li class="">Phase 1: Scaffold compiler, no runtime changes.</li>
<li class="">Phase 2: Emit artifacts, add Lefthook hook, no consumer migration yet.</li>
<li class="">Phase 3: Migrate <code>packages/content-sample</code> to generated modules; other consumers follow in subsequent PRs.</li>
<li class="">Backward compatibility: Existing <code>parseContentPack</code> imports remain functional during migration; remove only after all consumers migrated.</li>
</ul>
</li>
<li class=""><strong>Communication</strong>: Announce compiler availability in #content-pipeline. Update onboarding docs. Add troubleshooting guide for common <code>--check</code> failures.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-open-questions">13. Open Questions<a href="#13-open-questions" class="hash-link" aria-label="Direct link to 13. Open Questions" title="Direct link to 13. Open Questions" translate="no">​</a></h2>
<ol>
<li class=""><strong>Formula precomputation:</strong> Is there value in capturing precomputed coefficients for common formula types during compilation, or should that remain a separate optimization pass?</li>
<li class=""><strong>Artifact granularity:</strong> Do documentation tools need per-module JSON (e.g., <code>resources.json</code>) in addition to the consolidated pack payload?</li>
<li class=""><strong>Bundle outputs:</strong> Should the compiler emit optional multi-pack bundles (e.g., seasonal content sets), or is the workspace summary sufficient for the current roadmap?</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Artifact hash verification during rehydration (tracked in #159).</li>
<li class="">Canonical serializer upgrades when <code>formatVersion</code> increments (tracked in #159).</li>
<li class="">Binary artifact format exploration (deferred pending performance benchmarks).</li>
<li class="">Per-module JSON emitters if documentation tooling requires them (pending stakeholder feedback).</li>
<li class="">Formula precomputation optimization pass (pending runtime profiling).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class=""><code>docs/content-dsl-schema-design.md</code></li>
<li class=""><code>docs/content-schema-rollout-decisions.md</code></li>
<li class=""><code>docs/idle-engine-design.md</code> §6.2</li>
<li class=""><code>docs/runtime-command-queue-design.md</code> §13</li>
<li class=""><code>tools/content-schema-cli/src/generate.js</code></li>
<li class=""><code>packages/content-schema/src/pack/index.ts</code></li>
<li class=""><code>packages/content-sample/src/index.ts</code></li>
<li class=""><a href="https://docs.unity3d.com/Manual/incremental-build-pipeline.html" target="_blank" rel="noopener noreferrer" class="">Unity Incremental Build Pipeline</a></li>
<li class=""><a href="https://cowboyprogramming.com/2007/01/04/practical-hash-ids/" target="_blank" rel="noopener noreferrer" class="">Practical Hash IDs (Cowboy Programming)</a></li>
<li class=""><a href="https://blog.llvm.org/2019/11/deterministic-builds-with-clang-and-lld.html" target="_blank" rel="noopener noreferrer" class="">Deterministic builds with clang and lld</a></li>
<li class=""><a href="https://blog.dreamfactory.com/best-practices-for-analyzing-logs-in-data-pipelines" target="_blank" rel="noopener noreferrer" class="">Best Practices for Analyzing Logs in Data Pipelines</a></li>
<li class=""><a href="https://www.dash0.com/guides/logging-best-practices" target="_blank" rel="noopener noreferrer" class="">9 Logging Best Practices You Should Know</a></li>
<li class=""><a href="https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/" target="_blank" rel="noopener noreferrer" class="">Atomic file creation with temporary files</a></li>
<li class=""><a href="https://ipython-books.github.io/143-resolving-dependencies-in-a-directed-acyclic-graph-with-a-topological-sort/" target="_blank" rel="noopener noreferrer" class="">IPython Cookbook - Resolving dependencies in a directed acyclic graph with a topological sort</a></li>
<li class=""><a href="https://medium.com/@heinapurola/engine-internals-content-pipeline-1af34a117f1" target="_blank" rel="noopener noreferrer" class="">Engine Internals: Content Pipeline</a></li>
<li class=""><a href="https://reproducible-builds.org/docs/deterministic-build-systems/" target="_blank" rel="noopener noreferrer" class="">Deterministic build systems</a></li>
<li class=""><a href="https://maddevs.io/glossary/single-source-of-truth/" target="_blank" rel="noopener noreferrer" class="">What Is a Single Source of Truth?</a></li>
<li class=""><a href="https://discourse.wicg.io/t/should-the-browser-consider-an-import-meta-env-object/4522/" target="_blank" rel="noopener noreferrer" class="">Should the browser consider an import.meta.env object?</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Artifact Hash</strong>: SHA-256 hash of the RFC-8785 canonical JSON representation of a <code>SerializedNormalizedContentPack</code>, used to detect corruption or stale build outputs.</li>
<li class=""><strong>Content Pack</strong>: A collection of game content modules (resources, generators, upgrades, etc.) defined in authoring JSON and compiled into normalized runtime artifacts.</li>
<li class=""><strong>Digest</strong>: Schema-defined content identity hash used for dependency tracking and change detection (distinct from artifact hash).</li>
<li class=""><strong>Rehydration</strong>: Process of reconstructing lookup maps and freezing arrays from serialized pack data without re-running schema validation.</li>
<li class=""><strong>RFC-8785</strong>: JSON Canonicalization Scheme ensuring byte-identical serialization across implementations.</li>
<li class=""><strong>SerializedNormalizedContentPack</strong>: Frozen, serializable representation of a validated content pack including metadata, modules, warnings, digest, and artifact hash.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-10-22</td><td>Content Pipeline Team</td><td>Initial draft</td></tr><tr><td>2025-12-21</td><td>Docs Agent</td><td>Migrated to design document template format</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="package-layout--ownership">Package Layout &amp; Ownership<a href="#package-layout--ownership" class="hash-link" aria-label="Direct link to Package Layout &amp; Ownership" title="Direct link to Package Layout &amp; Ownership" translate="no">​</a></h2>
<p><code>@idle-engine/content-compiler</code> will live in <code>packages/content-compiler</code> and provide two public entrypoints:</p>
<ul>
<li class=""><code>index.ts</code> (Node-only) exposes compiler APIs and filesystem helpers.</li>
<li class=""><code>runtime.ts</code> (browser-safe) exposes rehydration utilities without importing <code>node:</code> modules so web bundles stay lean.</li>
</ul>
<p>Planned layout:</p>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">packages/content-compiler/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pipeline.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifacts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      json.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      module.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      discovery.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      writer.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hashing.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __tests__/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      compiler.test.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts.test.ts</span><br></span></code></pre></div></div>
<p><code>package.json</code> publishes an explicit <code>exports</code> map to prevent bundlers from pulling Node code into browser builds:</p>
<div class="language-json codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-json codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;exports&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;.&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;import&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/index.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/index.d.ts&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;./runtime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;import&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/runtime.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./dist/runtime.d.ts&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;./package.json&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./package.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>To share digest logic without bundling the full schema implementation, <code>@idle-engine/content-schema</code> now publishes a <code>runtime-helpers</code> export that surfaces <code>createContentPackDigest</code>, freeze helpers, and associated types. The compiler package depends on that entrypoint so hashing stays consistent across the workspace. Splitting orchestration from artifact emitters mirrors the manifest-driven content pipeline described in <a href="https://medium.com/@heinapurola/engine-internals-content-pipeline-1af34a117f1" target="_blank" rel="noopener noreferrer" class="">Engine Internals: Content Pipeline</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="public-api-surface">Public API Surface<a href="#public-api-surface" class="hash-link" aria-label="Direct link to Public API Surface" title="Direct link to Public API Surface" translate="no">​</a></h2>
<p><code>@idle-engine/content-compiler</code> will export:</p>
<ul>
<li class=""><code>compileContentPack(document: ContentDocument, options: CompileOptions): Promise&lt;PackArtifactResult&gt;</code> – compile a single document and return artifact buffers plus metadata.</li>
<li class=""><code>compileWorkspacePacks(fs: WorkspaceFS, options: CompileWorkspaceOptions): Promise&lt;WorkspaceCompileResult&gt;</code> – orchestrate discovery, compilation, pruning, logging, and summary emission for all packs.</li>
<li class=""><code>rehydrateNormalizedPack(serialized: SerializedNormalizedContentPack, options?: RehydrateOptions): NormalizedContentPack</code> – rebuild lookup structures in browser or server runtimes.</li>
<li class=""><code>createModuleIndices(pack: NormalizedContentPack): Readonly&lt;ModuleIndexTables&gt;</code> – derive positional indices from frozen module arrays.</li>
<li class="">Types for <code>ContentDocument</code>, <code>SerializedNormalizedContentPack</code>, <code>CompileLogEvent</code>, and <code>WorkspaceSummary</code>.</li>
</ul>
<p><code>ModuleIndexTables</code> is defined as:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ModuleIndexTables</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> upgrades</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> achievements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> automations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> transforms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> prestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> runtimeEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ReadonlyMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><code>createModuleIndices</code> preserves the ordering of the serialized module arrays, so each map&#x27;s numeric value matches the zero-based offset in the corresponding array.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="compilation-workflow">Compilation Workflow<a href="#compilation-workflow" class="hash-link" aria-label="Direct link to Compilation Workflow" title="Direct link to Compilation Workflow" translate="no">​</a></h2>
<ol>
<li class="">
<p><strong>Discover packs</strong> – scan <code>packages/*/content/pack.json</code>, mirroring the manifest generator&#x27;s discovery rules. Each file becomes a <code>ContentDocument</code> with absolute path, POSIX-relative path, slug (derived from <code>metadata.id</code>), and parsed JSON:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ContentDocument</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> absolutePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> relativePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> packSlug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> document</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Duplicate slugs emit a <code>content_pack.compilation_failed</code> event and abort the run before any artifacts are written so collisions cannot clobber outputs. Discovery also records every <code>metadata.id</code> and source path in a collision registry used later when verifying digests, following the hash-audit guidance in <a href="https://cowboyprogramming.com/2007/01/04/practical-hash-ids/" target="_blank" rel="noopener noreferrer" class="">Practical Hash IDs</a>.</p>
</li>
<li class="">
<p><strong>Prepare context</strong> – reuse the manifest definitions that <code>tools/content-schema-cli</code> already constructs to populate <code>ContentSchemaOptions</code> (<code>runtimeEventCatalogue</code>, <code>knownPacks</code>, <code>activePackIds</code>). The CLI passes these definitions to the compiler so consumers do not import <code>GENERATED_RUNTIME_EVENT_DEFINITIONS</code> directly.</p>
</li>
<li class="">
<p><strong>Validate and normalize</strong> – call <code>parseContentPack(document, options)</code> exactly once per pack. Persist both the returned <code>NormalizedContentPack</code> and the <code>warnings</code> array so downstream steps can surface severities without re-running schema logic.</p>
</li>
<li class="">
<p><strong>Serialize to compiled payloads</strong> – convert each <code>NormalizedContentPack</code> into a serializable shape:</p>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">SerializedNormalizedContentPack</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> formatVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedMetadata</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> warnings</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> SerializedContentSchemaWarning</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> modules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedResource</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedGenerator</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> upgrades</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedUpgrade</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedMetric</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> achievements</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedAchievement</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> automations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedAutomation</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> transforms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedTransform</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> prestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedPrestigeLayer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> runtimeEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> NormalizedRuntimeEventContribution</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> digest</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedContentPack</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;digest&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> artifactHash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
</ol>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> `SerializedContentSchemaWarning` copies the schema warning properties onto plain data objects so JSON consumers can read them without prototype baggage. Lookup maps and positional indices are intentionally excluded; they are regenerated during rehydration to preserve referential identity.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Dependency data remains anchored in `metadata.dependencies` so there is a single source of truth for downstream tooling ([What Is a Single Source of Truth?](https://maddevs.io/glossary/single-source-of-truth/)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. **Emit artifacts** – hand each payload to dedicated emitters that produce:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Canonical JSON: `packages/&lt;pack&gt;/content/compiled/&lt;packSlug&gt;.normalized.json`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Generated modules: `packages/&lt;pack&gt;/src/generated/&lt;packSlug&gt;.generated.ts`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - Workspace summary: `&lt;repo&gt;/content/compiled/index.json`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Before writing, the compiler compares the current discovery set against existing artifacts and removes any JSON/TypeScript files for packs that disappeared so stale outputs do not linger. Writes go through a temporary file in the target directory followed by an atomic rename to avoid torn files, per the recommendations in [Atomic file creation with temporary files](https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/). If the newly generated bytes match what already exists, the writer skips the rename entirely to minimize churn and keep incremental builds fast, aligning with Unity&#x27;s incremental pipeline guidance ([Unity Incremental Build Pipeline](https://docs.unity3d.com/Manual/incremental-build-pipeline.html)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> If `compileContentPack` throws or returns a failure state, the compiler deletes any existing `content/compiled/&lt;slug&gt;.normalized.json` and `src/generated/&lt;slug&gt;.generated.ts` artifacts before moving on. A `--check` run surfaces the removal as a drift so CI fails visibly, and the workspace summary records the failure to stop automation from silently using stale modules.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> The CLI never lets compilation run ahead of validation. `pnpm generate` persists a validation failure summary and exits early when schema checks break, and `--check` mode flags the run as drifted whenever that summary would change. This sequencing guarantees validation remains the gatekeeper for every artifact write.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. **Log results** – emit machine-readable JSON events (`content_pack.compiled`, `content_pack.compilation_failed`, `content_pack.skipped`, `content_pack.pruned`) that include slug, duration, warning counts, and artifact paths. Validation emits its own `content_pack.validated` / `.validation_failed` events before compilation begins so log consumers can correlate outcomes end-to-end. Watch mode adds a `watch.run` event after each iteration with duration, trigger paths, and outcome to simplify monitoring. Logs follow structured logging practices that favor JSON key/value payloads for downstream parsing ([9 Logging Best Practices You Should Know](https://www.dash0.com/guides/logging-best-practices), [Best Practices for Analyzing Logs in Data Pipelines](https://blog.dreamfactory.com/best-practices-for-analyzing-logs-in-data-pipelines)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Artifact Contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Normalized JSON (`content/compiled/*.normalized.json`)**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Contains the exact `SerializedNormalizedContentPack` shape with canonical key ordering and a trailing newline to keep diffs legible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Serves as the source of truth for `pnpm generate --check`, documentation tooling, and automation that needs raw JSON.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Embeds `warnings`, `digest`, and `artifactHash` so checks can fail without invoking the compiler.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Files live beside their originating pack to keep review diffs local to the owning package.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Generated TypeScript modules (`src/generated/*.generated.ts`)**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createModuleIndices,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rehydrateNormalizedPack,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type SerializedNormalizedContentPack,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} from &#x27;@idle-engine/content-compiler/runtime&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const serialized: SerializedNormalizedContentPack = { /* inlined JSON */ };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const runtimeEnv = (globalThis as typeof globalThis &amp; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  process?: { env?: Record&lt;string, string | undefined&gt; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}).process;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const shouldVerifyDigest = runtimeEnv?.env?.NODE_ENV !== &#x27;production&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK = rehydrateNormalizedPack(serialized, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verifyDigest: shouldVerifyDigest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_DIGEST = serialized.digest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_ARTIFACT_HASH = serialized.artifactHash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_INDICES = createModuleIndices(SAMPLE_PACK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const SAMPLE_PACK_SUMMARY = Object.freeze({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slug: serialized.metadata.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version: serialized.metadata.version,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceIds: serialized.modules.resources.map((resource) =&gt; resource.id),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><code>rehydrateNormalizedPack</code> (implemented in <code>runtime.ts</code>) reconstructs lookup maps, freezes arrays, and—when <code>verifyDigest</code> is true—recomputes the digest (artifact hash verification is planned as a follow-up in #159). <code>createModuleIndices</code> iterates the frozen module arrays, asserts identifier uniqueness, and returns immutable lookup tables so runtime code can map identifiers to array offsets without recomputing them on startup. <code>SAMPLE_PACK_INDICES.generators.get(&#x27;starter-generator&#x27;)</code> returns the array index inside <code>SAMPLE_PACK.generators</code>, allowing consumers to map ids to offsets without recomputing lookup tables.
The <code>verifyDigest</code> guard inspects <code>globalThis.process?.env</code> when present instead of assuming <code>import.meta.env</code>, preventing runtime errors in environments that do not expose the Vite-style global (<a href="https://discourse.wicg.io/t/should-the-browser-consider-an-import-meta-env-object/4522/" target="_blank" rel="noopener noreferrer" class="">Should the browser consider an import.meta.env object?</a>).
<code>@idle-engine/content-sample/src/index.ts</code> aliases these exports to ergonomic runtime names (<code>sampleContent</code>, <code>sampleContentSummary</code>, <code>sampleContentIndices</code>, etc.) and throws whenever the compiler recorded warnings so existing guardrails remain in place without reparsing authoring JSON.</p>
<ul>
<li class=""><strong>Workspace summary (<code>content/compiled/index.json</code>)</strong>
<ul>
<li class="">Resides at the repository root and lists every compiled pack with slug, version, digest, artifact hash, dependency set (sourced from <code>metadata.dependencies</code>), warning count, and artifact paths.</li>
<li class="">Serves as the canonical workspace index for automation, docs, and runtime bootstrapping. Consumers must treat the file as stale whenever validation fails or the CLI reports drift and rerun <code>pnpm generate</code> before relying on the data.</li>
<li class="">Doubles as the collision manifest: the compiler records when two packs share a digest or dependency and emits warnings immediately.</li>
<li class="">Drives documentation tooling and allows <code>pnpm generate --check</code> to diff a single file to detect drift.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="determinism--integrity">Determinism &amp; Integrity<a href="#determinism--integrity" class="hash-link" aria-label="Direct link to Determinism &amp; Integrity" title="Direct link to Determinism &amp; Integrity" translate="no">​</a></h2>
<ul>
<li class="">JSON emitters use a stable RFC-8785 compatible stringifier so repeated runs produce byte-identical output. The digest stays aligned with the schema package by deferring to <code>createContentPackDigest</code> from the new <code>runtime-helpers</code> export.</li>
<li class="">Writers operate on temporary files located in the target directory and complete writes with <code>fs.rename</code>, guaranteeing atomic replacements even when the process crashes mid-write (<a href="https://yakking.branchable.com/posts/atomic-file-creation-tmpfile/" target="_blank" rel="noopener noreferrer" class="">Atomic file creation with temporary files</a>).</li>
<li class=""><code>pnpm generate --check</code> recompiles without writing files and exits with status <code>1</code> if any artifact would change, enabling Lefthook and CI to fail fast on stale outputs.</li>
<li class=""><code>pnpm generate --clean</code> invalidates any cached comparisons and forces rewrites, providing the clean-build escape hatch recommended for incremental pipelines (<a href="https://docs.unity3d.com/Manual/incremental-build-pipeline.html" target="_blank" rel="noopener noreferrer" class="">Unity Incremental Build Pipeline</a>).</li>
<li class="">Nightly determinism checks rerun <code>pnpm generate --check</code> twice in isolated working directories (incremental vs clean) and compare summary hashes, following the strategy outlined in <a href="https://blog.llvm.org/2019/11/deterministic-builds-with-clang-and-lld.html" target="_blank" rel="noopener noreferrer" class="">Deterministic builds with clang and lld</a>.</li>
<li class="">The workspace summary omits wall-clock timestamps so artifacts remain byte-identical across runs, in line with reproducible-build guidance to remove timestamp variability (<a href="https://reproducible-builds.org/docs/deterministic-build-systems/" target="_blank" rel="noopener noreferrer" class="">Deterministic build systems</a>).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="artifact-integrity-contract">Artifact Integrity Contract<a href="#artifact-integrity-contract" class="hash-link" aria-label="Direct link to Artifact Integrity Contract" title="Direct link to Artifact Integrity Contract" translate="no">​</a></h2>
<ul>
<li class=""><code>artifactHash</code> is the lowercase hex encoding of the SHA-256 hash of the RFC-8785 canonical JSON representation of the complete <code>SerializedNormalizedContentPack</code>, computed with <code>artifactHash</code> temporarily set to the empty string.<!-- -->
<ul>
<li class="">The compiler canonicalizes a clone of the payload with the hash cleared, hashes those bytes, and then writes the emitted JSON with the computed hash reinserted. Integrity checks repeat the same &quot;blank then canonicalize&quot; procedure before hashing.</li>
<li class=""><code>rehydrateNormalizedPack</code> recomputes the digest when <code>verifyDigest</code> is enabled (artifact hash validation will land alongside the canonical serializer upgrades tracked in #159).</li>
<li class=""><code>formatVersion</code> changes whenever the serialized payload shape or canonicalization rules change. When <code>formatVersion</code> increments, the compiler writes new artifacts and the runtime refuses to rehydrate packs whose <code>formatVersion</code> it does not understand.</li>
<li class=""><code>digest</code> remains the schema-defined content identity (used for dependency tracking, change detection, and collision reporting). <code>artifactHash</code> guarantees the integrity of the compiled artifact itself. Automation treats <code>digest</code> drift as a semantic change in content, while <code>artifactHash</code> mismatches indicate corrupted or stale build output.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="dependency-handling">Dependency Handling<a href="#dependency-handling" class="hash-link" aria-label="Direct link to Dependency Handling" title="Direct link to Dependency Handling" translate="no">​</a></h2>
<ul>
<li class="">The compiler resolves pack order with a topological sort on <code>metadata.dependencies.requires</code>, ensuring dependants always compile after their prerequisites (<a href="https://ipython-books.github.io/143-resolving-dependencies-in-a-directed-acyclic-graph-with-a-topological-sort/" target="_blank" rel="noopener noreferrer" class="">IPython Cookbook - Resolving dependencies in a directed acyclic graph</a>).</li>
<li class="">Missing dependencies trigger warnings and mark the pack as failed; the summary captures the failure so automation can highlight the gap.</li>
<li class="">Dependency cycles emit a single <code>content_pack.compilation_failed</code> event listing every slug in the loop and aborting the run before artifacts are written.</li>
<li class="">The workspace summary records dependency digests so CI can detect mismatches when a referenced pack changed but a dependant did not rebuild.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="logging--telemetry">Logging &amp; Telemetry<a href="#logging--telemetry" class="hash-link" aria-label="Direct link to Logging &amp; Telemetry" title="Direct link to Logging &amp; Telemetry" translate="no">​</a></h2>
<ul>
<li class="">Every compiler run writes structured JSON lines to stdout; human-friendly pretty-printing remains opt-in via <code>--pretty</code>. Each event includes an ISO timestamp, event name, slug, duration, warning count, and file paths. Structured payloads make it trivial for log processors to filter on keys rather than regex parsing (<a href="https://www.dash0.com/guides/logging-best-practices" target="_blank" rel="noopener noreferrer" class="">9 Logging Best Practices You Should Know</a>).</li>
<li class="">Event schema:<!-- -->
<ul>
<li class=""><code>content_pack.compiled</code>: success path with <code>artifacts</code>, <code>warnings</code>, <code>durationMs</code>.</li>
<li class=""><code>content_pack.compilation_failed</code>: failure details with <code>message</code>, <code>path</code>, <code>issues</code>.</li>
<li class=""><code>content_pack.pruned</code>: emitted when stale artifacts are deleted.</li>
<li class=""><code>content_pack.skipped</code>: emitted when <code>--check</code> detects no changes.</li>
</ul>
</li>
<li class="">Logs integrate with existing CI parsers and future observability services without additional adapters.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="developer-experience--adoption">Developer Experience &amp; Adoption<a href="#developer-experience--adoption" class="hash-link" aria-label="Direct link to Developer Experience &amp; Adoption" title="Direct link to Developer Experience &amp; Adoption" translate="no">​</a></h2>
<ul>
<li class=""><code>tools/content-schema-cli</code> gains a <code>compile</code> command (<code>pnpm --filter @idle-engine/content-validation-cli run compile</code>) and updates <code>generate</code> to execute manifest regeneration → validation → compilation in order.</li>
<li class=""><code>--watch</code> uses <code>chokidar</code> to observe authoring JSON and schema inputs, debouncing writes and ignoring compiler-owned outputs (<code>**/content/compiled/**</code>, <code>**/src/generated/*.generated.ts</code>) to avoid loops.</li>
<li class=""><code>packages/content-sample</code> switches to importing the generated module, keeping the direct JSON import only as a fallback test helper.</li>
<li class="">Documentation (<code>docs/content-schema-rollout-decisions.md</code>, <code>docs/implementation-plan.md</code>) and READMEs will be updated once the compiler ships, so contributors know to run <code>pnpm generate</code> after editing content.</li>
<li class="">Lefthook gains a <code>content</code> hook that runs <code>pnpm generate --check</code> to guard against stale artifacts before commit.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="implementation-plan">Implementation Plan<a href="#implementation-plan" class="hash-link" aria-label="Direct link to Implementation Plan" title="Direct link to Implementation Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-1---package-foundations">Phase 1 - Package Foundations<a href="#phase-1---package-foundations" class="hash-link" aria-label="Direct link to Phase 1 - Package Foundations" title="Direct link to Phase 1 - Package Foundations" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Scaffold <code>packages/content-compiler</code>, add build tooling, exports map, and baseline tests.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Add <code>runtime-helpers</code> export to <code>@idle-engine/content-schema</code> with shared digest utilities.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement discovery, context preparation, and single-pack compilation APIs.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-2---artifact-emitters--cli-wiring">Phase 2 - Artifact Emitters &amp; CLI Wiring<a href="#phase-2---artifact-emitters--cli-wiring" class="hash-link" aria-label="Direct link to Phase 2 - Artifact Emitters &amp; CLI Wiring" title="Direct link to Phase 2 - Artifact Emitters &amp; CLI Wiring" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement canonical JSON and TypeScript emitters with stable ordering, digest calculation, and atomic writes.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Extend <code>tools/content-schema-cli</code> with the new compiler command, integrate logs, and update <code>pnpm generate</code> to run validation and compilation sequentially.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Persist structured warnings in per-pack artifacts and the workspace summary.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement <code>--check</code>, <code>--clean</code>, and artifact pruning; ensure Lefthook/CI adopt the new verification step.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="phase-3---developer-experience--adoption">Phase 3 - Developer Experience &amp; Adoption<a href="#phase-3---developer-experience--adoption" class="hash-link" aria-label="Direct link to Phase 3 - Developer Experience &amp; Adoption" title="Direct link to Phase 3 - Developer Experience &amp; Adoption" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_InQk">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Implement watch mode with debounced recompilation and change detection.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Update <code>packages/content-sample</code> (and any other consumers) to import generated artifacts.</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->Backfill documentation and onboarding guides with compiler usage and troubleshooting tips.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="success-criteria">Success Criteria<a href="#success-criteria" class="hash-link" aria-label="Direct link to Success Criteria" title="Direct link to Success Criteria" translate="no">​</a></h2>
<ul>
<li class="">Every pack produces <code>content/compiled/*.normalized.json</code> and <code>src/generated/*.generated.ts</code> without manual intervention.</li>
<li class=""><code>pnpm generate</code> emits <code>content_pack.*</code> events, fails when artifacts drift, and <code>--check</code> exits non-zero on stale outputs.</li>
<li class="">Runtime consumers no longer call <code>parseContentPack</code> at import time; they rely on generated modules and rehydration helpers.</li>
<li class="">Consecutive compiler runs with unchanged inputs produce no git diffs and skip file rewrites.</li>
<li class="">Removing a pack deletes its compiled artifacts within the same run that detects the removal.</li>
<li class="">Compiler unit tests and CLI smoke tests run under <code>pnpm test</code> and <code>pnpm lint</code>; CI passes with the determinism check enabled.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/content-compiler-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Idle-Game-Engine/content-dsl-usage-guidelines"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Content DSL Usage Guidelines</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Idle-Game-Engine/content-schema-rollout-decisions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Content Schema Rollout Decisions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-open-questions" class="table-of-contents__link toc-highlight">13. Open Questions</a></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li><li><a href="#package-layout--ownership" class="table-of-contents__link toc-highlight">Package Layout &amp; Ownership</a></li><li><a href="#public-api-surface" class="table-of-contents__link toc-highlight">Public API Surface</a></li><li><a href="#compilation-workflow" class="table-of-contents__link toc-highlight">Compilation Workflow</a></li><li><a href="#determinism--integrity" class="table-of-contents__link toc-highlight">Determinism &amp; Integrity</a></li><li><a href="#artifact-integrity-contract" class="table-of-contents__link toc-highlight">Artifact Integrity Contract</a></li><li><a href="#dependency-handling" class="table-of-contents__link toc-highlight">Dependency Handling</a></li><li><a href="#logging--telemetry" class="table-of-contents__link toc-highlight">Logging &amp; Telemetry</a></li><li><a href="#developer-experience--adoption" class="table-of-contents__link toc-highlight">Developer Experience &amp; Adoption</a></li><li><a href="#implementation-plan" class="table-of-contents__link toc-highlight">Implementation Plan</a><ul><li><a href="#phase-1---package-foundations" class="table-of-contents__link toc-highlight">Phase 1 - Package Foundations</a></li><li><a href="#phase-2---artifact-emitters--cli-wiring" class="table-of-contents__link toc-highlight">Phase 2 - Artifact Emitters &amp; CLI Wiring</a></li><li><a href="#phase-3---developer-experience--adoption" class="table-of-contents__link toc-highlight">Phase 3 - Developer Experience &amp; Adoption</a></li></ul></li><li><a href="#success-criteria" class="table-of-contents__link toc-highlight">Success Criteria</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Idle Engine.</div></div></div></footer></div>
</body>
</html>