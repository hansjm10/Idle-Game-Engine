<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-prestige-system-completion-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Prestige System Completion Design | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/prestige-system-completion-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Prestige System Completion Design | Idle Engine Docs"><meta data-rh="true" name="description" content="Document Control"><meta data-rh="true" property="og:description" content="Document Control"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/prestige-system-completion-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/prestige-system-completion-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/prestige-system-completion-design" hreflang="x-default"><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.29b95cf1.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.12436fc9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a class="navbar__item navbar__link" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><main class="docMainContainer_tfRv docMainContainerEnhanced_qAvX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Prestige System Completion Design</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Complete prestige system with runtime handler, snapshot types, and UI components</li>
<li class=""><strong>Authors</strong>: Idle Engine Team</li>
<li class=""><strong>Reviewers</strong>: Runtime Core Maintainers, Shell UX Maintainers</li>
<li class=""><strong>Status</strong>: Draft</li>
<li class=""><strong>Last Updated</strong>: 2025-11-27</li>
<li class=""><strong>Related Issues</strong>: Idle-Game-Engine#18 (Progression UI)</li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>This design completes the prestige system by adding the missing runtime handler, snapshot types, and UI components. Players will be able to view available prestige layers, preview rewards with resource breakdowns, understand what gets reset vs. retained, and execute prestige resets through a confirmation modal. The implementation extends the existing <code>ProgressionSnapshot</code> contract and follows established patterns from the generator/upgrade UI components.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Background</strong>: The runtime defines <code>PRESTIGE_RESET</code> command type and authorization policy (<code>packages/core/src/command.ts:112,263-272</code>), but no production handler exists. The sample pack includes a complete prestige layer (<code>Ascension Alpha</code>) with unlock conditions, reset targets, and reward formulas (<code>packages/content-sample/content/pack.json:988-1070</code>). UI components exist for resources, generators, and upgrades, but prestige has no UI surface.</p>
</li>
<li class="">
<p><strong>Problem</strong>: Players cannot interact with the prestige system despite content being defined. The <code>ProgressionSnapshot</code> omits prestige layer data, blocking the shell from displaying prestige status or rewards. This leaves a core idle game mechanic inaccessible.</p>
</li>
<li class="">
<p><strong>Forces</strong>: Implementation must follow existing command handler patterns (<code>resource-command-handlers.ts</code>), maintain worker bridge isolation, preserve deterministic replay, and meet accessibility standards established by existing UI components.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals" translate="no">​</a></h3>
<ol>
<li class="">Implement <code>PRESTIGE_RESET</code> command handler in <code>packages/core</code> with proper validation, status checks, and telemetry</li>
<li class="">Extend <code>ProgressionSnapshot</code> with <code>PrestigeLayerView[]</code> containing unlock status, reward preview, and reset targets</li>
<li class="">Build <code>PrestigePanel</code> component rendering a multi-layer list with teaser mode for locked layers</li>
<li class="">Build <code>PrestigeModal</code> component for confirmation flow with reward breakdown and reset summary</li>
<li class="">Wire prestige data through worker bridge to shell state provider</li>
<li class="">Add accessibility support (focus traps, ARIA labels, keyboard navigation)</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="non-goals">Non-Goals<a href="#non-goals" class="hash-link" aria-label="Direct link to Non-Goals" title="Direct link to Non-Goals" translate="no">​</a></h3>
<ul>
<li class="">Multiple prestige resets in quick succession (cooldown enforcement deferred)</li>
<li class="">Prestige layer unlock animations or celebration effects</li>
<li class="">Cross-session prestige statistics tracking</li>
<li class="">Prestige automation (explicitly blocked by command authorization)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>: Runtime Core maintainers, Shell UX maintainers</li>
<li class=""><strong>Agent Roles</strong>: Runtime Implementation Agent (handler, types), Shell UI Implementation Agent (components, integration), QA Agent (tests, accessibility)</li>
<li class=""><strong>Affected Packages/Services</strong>: <code>packages/core</code>, <code>packages/shell-web</code></li>
<li class=""><strong>Compatibility Considerations</strong>: Extends <code>ProgressionSnapshot</code> with new field; existing consumers unaffected as field is additive</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>PRESTIGE_RESET</code> command type defined (<code>packages/core/src/command.ts:112</code>)</li>
<li class=""><code>PrestigeResetPayload</code> interface defined with <code>layer</code> and optional <code>confirmationToken</code> (<code>packages/core/src/command.ts:163-166</code>)</li>
<li class="">Command authorization blocks AUTOMATION priority (<code>packages/core/src/command.ts:265-272</code>)</li>
<li class="">No production handler registered; only test stubs exist (<code>command-dispatcher.test.ts:127</code>)</li>
<li class=""><code>ProgressionSnapshot</code> contains <code>resources</code>, <code>generators</code>, <code>upgrades</code> but no prestige data (<code>packages/core/src/progression.ts:65-71</code>)</li>
<li class="">Sample pack defines <code>Ascension Alpha</code> layer with complex reward formula (<code>packages/content-sample/content/pack.json:988-1070</code>)</li>
<li class="">No prestige UI components exist in <code>packages/shell-web</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<p><strong>Data Flow</strong></p>
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         React Shell                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  PrestigePanel  │───▶│  PrestigeModal  │───▶│  ShellBridge    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  (layer list)   │    │  (confirmation) │    │  sendCommand()  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────┘    └─────────────────┘    └────────┬────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────│───────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                          │ postMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────│───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      Web Worker                         ▼            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ ProgressionSnap │◀───│  PrestigeSystem │◀───│ CommandDispatch │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ (+ prestigeView)│    │  (evaluator)    │    │ PRESTIGE_RESET  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────┘    └─────────────────┘    └─────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<p><strong>Key Components</strong></p>
<ul>
<li class="">
<p><strong>PrestigePanel</strong>: Renders list of prestige layers. Unlocked layers show reward preview and &quot;Prestige&quot; button. Locked layers appear dimmed with teaser hints.</p>
</li>
<li class="">
<p><strong>PrestigeModal</strong>: Confirmation dialog with reward breakdown (expandable), two-column reset summary, and confirm/cancel actions. Focus-trapped for accessibility.</p>
</li>
<li class="">
<p><strong>PrestigeSystemEvaluator</strong>: New evaluator interface in <code>packages/core</code> providing <code>getPrestigeQuote()</code> for reward calculation and <code>applyPrestige()</code> for reset execution.</p>
</li>
<li class="">
<p><strong>PRESTIGE_RESET handler</strong>: Validates layer exists, checks unlock conditions, executes reset via PrestigeSystemEvaluator, emits telemetry.</p>
</li>
<li class="">
<p><strong>PrestigeLayerView</strong>: New type added to <code>ProgressionSnapshot</code> containing layer status, reward preview, reset targets, and unlock hints.</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_EdDC" id="types--interfaces">Types &amp; Interfaces<a href="#types--interfaces" class="hash-link" aria-label="Direct link to Types &amp; Interfaces" title="Direct link to Types &amp; Interfaces" translate="no">​</a></h4>
<p><strong>PrestigeLayerView (new type in <code>packages/core/src/progression.ts</code>)</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">PrestigeLayerView</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  summary</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;locked&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;available&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;completed&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unlockHint</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Teaser text for locked layers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  visible</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rewardPreview</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeRewardPreview</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resetTargets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Resource IDs that will be reset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retainedTargets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Resource IDs that survive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">PrestigeRewardPreview</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  breakdown</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> PrestigeRewardContribution</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">PrestigeRewardContribution</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sourceResourceId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sourceAmount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contribution</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// How much this resource contributes to reward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Extended ProgressionSnapshot</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">ProgressionSnapshot</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  step</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publishedAt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> ResourceView</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> GeneratorView</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upgrades</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> UpgradeView</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> PrestigeLayerView</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>PrestigeSystemEvaluator Interface</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PrestigeQuote</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;locked&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;available&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;completed&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> reward</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeRewardPreview</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> resetTargets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> retainedTargets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PrestigeSystemEvaluator</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getPrestigeQuote</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeQuote </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">applyPrestige</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> confirmationToken</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Implementation Location &amp; Instantiation</strong></p>
<p>The concrete <code>PrestigeSystemEvaluator</code> implementation lives in <code>packages/core/src/prestige-system.ts</code>. It is instantiated by the runtime during initialization when prestige layer definitions are loaded from compiled content:</p>
<ol>
<li class=""><strong>Content Loading</strong>: <code>IdleEngineRuntime</code> receives compiled content pack with <code>prestigeLayers</code> array</li>
<li class=""><strong>Evaluator Creation</strong>: Runtime creates <code>PrestigeSystemEvaluatorImpl</code> passing:<!-- -->
<ul>
<li class="">Prestige layer definitions from content</li>
<li class="">Reference to <code>ResourceState</code> for current values and mutations</li>
<li class="">Reference to expression evaluator for reward formula calculation</li>
</ul>
</li>
<li class=""><strong>Handler Wiring</strong>: Evaluator instance passed to <code>registerResourceCommandHandlers()</code> via <code>prestigeSystem</code> option</li>
<li class=""><strong>Snapshot Building</strong>: Same evaluator instance used by <code>buildProgressionSnapshot()</code> to populate <code>prestigeLayers</code> field</li>
</ol>
<p>The evaluator maintains no internal state beyond references; all prestige state (completion count, timestamps) is stored in <code>ResourceState</code> as special resources or flags defined by content.</p>
<h4 class="anchor anchorTargetStickyNavbar_EdDC" id="prestige_reset-command-handler">PRESTIGE_RESET Command Handler<a href="#prestige_reset-command-handler" class="hash-link" aria-label="Direct link to PRESTIGE_RESET Command Handler" title="Direct link to PRESTIGE_RESET Command Handler" translate="no">​</a></h4>
<p><strong>Handler Registration (in <code>packages/core/src/resource-command-handlers.ts</code>)</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ResourceCommandHandlerOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... existing fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> prestigeSystem</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeSystemEvaluator</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerResourceCommandHandlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ResourceCommandHandlerOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... existing registrations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prestigeSystem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-function function" style="color:#d73a49">register</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">PrestigeResetPayload</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token constant" style="color:#36acaa">RUNTIME_COMMAND_TYPES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PRESTIGE_RESET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">createPrestigeResetHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prestigeSystem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Handler Flow</strong></p>
<ol>
<li class=""><strong>Validate payload</strong> - Check <code>layerId</code> is non-empty string</li>
<li class=""><strong>Get quote</strong> - Call <code>prestigeSystem.getPrestigeQuote(layerId)</code></li>
<li class=""><strong>Check status</strong> - Reject if <code>locked</code> (warning telemetry)</li>
<li class=""><strong>Execute</strong> - Call <code>prestigeSystem.applyPrestige(layerId, confirmationToken)</code></li>
<li class=""><strong>Record success</strong> - <code>telemetry.recordProgress(&#x27;PrestigeResetConfirmed&#x27;, ...)</code></li>
</ol>
<p><strong>Telemetry Events</strong></p>
<table><thead><tr><th>Event</th><th>Level</th><th>When</th></tr></thead><tbody><tr><td><code>PrestigeResetInvalidLayer</code></td><td>error</td><td>Layer ID validation fails</td></tr><tr><td><code>PrestigeResetUnknown</code></td><td>error</td><td>Evaluator returns undefined</td></tr><tr><td><code>PrestigeResetLocked</code></td><td>warning</td><td>Layer not yet available</td></tr><tr><td><code>PrestigeResetApplyFailed</code></td><td>error</td><td>Evaluator throws during apply</td></tr><tr><td><code>PrestigeResetConfirmed</code></td><td>progress</td><td>Success</td></tr></tbody></table>
<p><strong>Design Decisions</strong></p>
<ul>
<li class="">
<p><strong>Change <code>PrestigeResetPayload.layer</code> from number to string</strong>: The existing payload uses <code>layer: number</code>, but content packs define layers with string IDs (e.g., <code>&quot;sample-pack.ascension-alpha&quot;</code>). This design proposes changing to <code>layerId: string</code> for consistency with the content schema and evaluator interface. The existing numeric field was a placeholder; no production code depends on it. Update the payload interface in <code>packages/core/src/command.ts</code>:</p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PrestigeResetPayload</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Changed from layer: number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> confirmationToken</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>No resource cost for prestige</strong>: Prestige layers don&#x27;t have a purchase cost - they have unlock conditions and give rewards. The &quot;cost&quot; is losing progress. This simplifies the handler (no spend/refund transaction needed).</p>
</li>
<li class="">
<p><strong>Confirmation token is advisory</strong>: The token is passed through to <code>applyPrestige()</code> for the evaluator to use if needed (e.g., UI-generated nonce), but the handler doesn&#x27;t validate it. This matches how <code>metadata</code> is passed to <code>applyPurchase()</code> in upgrades.</p>
</li>
<li class="">
<p><strong>Reset scope is content-driven</strong>: The <code>resetTargets</code> array in prestige layer definitions determines which resources are reset (amounts + unlock/visibility returned to content defaults). Packs can also opt into classic prestige resets by specifying <code>resetGenerators</code> (owned/enabled + re-lock) and <code>resetUpgrades</code> (purchase count). The <code>retention</code> list can preserve specific resources, generators, or upgrades across the reset. For the sample pack&#x27;s <code>Ascension Alpha</code> layer, resetting the four listed resources effectively resets early-game progression while preserving prestige currency.</p>
</li>
<li class="">
<p><strong>Empty resetTargets arrays are valid</strong>: Prestige layers with empty <code>resetTargets</code> arrays are intentional &quot;bonus layers&quot; that grant rewards without resetting any resources. Use cases include: milestone rewards that don&#x27;t require sacrifice, achievement-style prestige that stacks with other layers, and tutorial/onboarding layers that introduce prestige mechanics gently without penalizing players.</p>
</li>
<li class="">
<p><strong>Retention specifies what survives with amounts</strong>: The <code>retention</code> array in content defines not just which resources survive but how much (constant value or percentage). The UI simplifies this to <code>retainedTargets: readonly string[]</code> showing resource IDs only; exact retention amounts are an implementation detail handled by the evaluator during reset execution.</p>
</li>
<li class="">
<p><strong>Prestige layers are repeatable</strong>: Status cycles <code>available</code> → <code>completed</code> → <code>available</code>, allowing players to prestige the same layer multiple times. Repeatable prestige creates compounding progression loops (each reset can grant scaling rewards via <code>multiplierCurve</code>), extends session lifetime engagement, and justifies tier expansion (Alpha→Beta→Gamma). This matches successful idle games like Cookie Clicker and AdCap.</p>
</li>
<li class="">
<p><strong>Track prestige count per layer as a resource</strong>: Each prestige layer has an associated counter stored as a standard resource in <code>ResourceState</code> (e.g., <code>sample-pack.ascension-alpha-prestige-count</code>). This leverages existing architecture without special cases and enables: achievement systems, dynamic reward scaling via <code>multiplierCurve</code> expressions that reference the count, unlock conditions for higher prestige tiers (e.g., &quot;Unlock Ascension Beta after 5 successful Alpha resets&quot;), and player motivation through visible progress metrics.</p>
</li>
<li class="">
<p><strong>Locked layers visible with teaser hints</strong>: Locked prestige layers appear in the UI with a dimmed/blurred appearance and an <code>unlockHint</code> teaser. This creates discovery motivation and prevents confusion about progression. Teaser hints should be thematic (&quot;Reach deeper into the machine...&quot;) rather than revealing exact requirements, preserving mystery while showing players a roadmap of future progression.</p>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_EdDC" id="ui-components">UI Components<a href="#ui-components" class="hash-link" aria-label="Direct link to UI Components" title="Direct link to UI Components" translate="no">​</a></h4>
<p><strong>PrestigePanel (<code>packages/shell-web/src/modules/PrestigePanel.tsx</code>)</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PrestigeLayerCardProps</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> layer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeLayerView</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">onPrestige</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PrestigeLayerCard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> layer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onPrestige </span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeLayerCardProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LockedLayerCard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> layer </span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> layer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeLayerView </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LoadingState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EmptyState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PrestigePanel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Layer Card States</strong></p>
<table><thead><tr><th>Status</th><th>Appearance</th><th>Actions</th></tr></thead><tbody><tr><td><code>locked</code></td><td>Dimmed/blurred, teaser hint visible</td><td>None (non-interactive)</td></tr><tr><td><code>available</code></td><td>Full color, reward preview shown</td><td>&quot;Prestige&quot; button opens modal</td></tr><tr><td><code>completed</code></td><td>Checkmark badge, last reward shown</td><td>Can prestige again (if repeatable)</td></tr></tbody></table>
<p><strong>PrestigeModal (<code>packages/shell-web/src/modules/PrestigeModal.tsx</code>)</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PrestigeModalProps</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> open</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> layer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeLayerView </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onConfirm</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PrestigeModal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> open</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> layer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onConfirm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onClose </span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrestigeModalProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Element </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Modal Sections</strong></p>
<ol>
<li class=""><strong>Header</strong> - Layer name, close button</li>
<li class=""><strong>Reward preview</strong> - &quot;You will earn: X Prestige Flux&quot; with expandable breakdown</li>
<li class=""><strong>Reset summary</strong> - Two columns: &quot;Will be reset&quot; | &quot;Will be kept&quot;</li>
<li class=""><strong>Actions</strong> - &quot;Cancel&quot; and &quot;Confirm Prestige&quot; buttons</li>
</ol>
<p><strong>Accessibility</strong>: Focus trap on open, Escape to close, <code>aria-modal=&quot;true&quot;</code>, <code>role=&quot;dialog&quot;</code></p>
<h4 class="anchor anchorTargetStickyNavbar_EdDC" id="worker-bridge-integration">Worker Bridge Integration<a href="#worker-bridge-integration" class="hash-link" aria-label="Direct link to Worker Bridge Integration" title="Direct link to Worker Bridge Integration" translate="no">​</a></h4>
<p><strong>ShellStateProvider Changes</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ShellProgressionContext</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... existing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">selectPrestigeLayers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> PrestigeLayerView</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">selectPrestigeLayerById</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> PrestigeLayerView </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Command Dispatch</strong></p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">shellBridge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sendCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;PRESTIGE_RESET&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  layerId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> layer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  confirmationToken</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">randomUUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Optimistic Updates</strong></p>
<p>Unlike generator/upgrade purchases, prestige resets don&#x27;t need optimistic resource deltas - the entire state changes dramatically. The UI should:</p>
<ol>
<li class="">Show loading/pending state on confirm</li>
<li class="">Wait for next snapshot from worker</li>
<li class="">Snapshot will reflect post-prestige state</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>: No feature flags; prestige UI renders when layers exist in content</li>
<li class=""><strong>Telemetry &amp; Observability</strong>: Handler emits telemetry for all outcomes; UI errors surface via existing bridge error handling</li>
<li class=""><strong>Security &amp; Compliance</strong>: No PII in prestige data; authorization policy prevents automation abuse</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<p><strong>Phase 1: Core Runtime</strong></p>
<table><thead><tr><th>Issue Title</th><th>Scope</th><th>Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>feat(core): change PrestigeResetPayload.layer to layerId</code></td><td>Update payload type from <code>layer: number</code> to <code>layerId: string</code></td><td>Runtime Agent</td><td>None</td><td>Payload uses string ID, tests updated</td></tr><tr><td><code>feat(core): add PrestigeLayerView types</code></td><td>Add types to <code>progression.ts</code>, export from <code>index.ts</code></td><td>Runtime Agent</td><td>Payload change</td><td>Types compile, exported in package</td></tr><tr><td><code>feat(core): implement PrestigeSystemEvaluator interface</code></td><td>Define interface, add to <code>ResourceCommandHandlerOptions</code></td><td>Runtime Agent</td><td>Types</td><td>Interface matches design, optional field</td></tr><tr><td><code>feat(core): add PRESTIGE_RESET handler</code></td><td>Handler with validation, status checks, telemetry</td><td>Runtime Agent</td><td>Evaluator interface</td><td>All handler tests pass</td></tr><tr><td><code>feat(core): extend buildProgressionSnapshot with prestigeLayers</code></td><td>Add prestige layer view generation</td><td>Runtime Agent</td><td>Types, Evaluator</td><td>Snapshot tests cover prestige data</td></tr></tbody></table>
<p><strong>Phase 2: Worker Integration</strong></p>
<table><thead><tr><th>Issue Title</th><th>Scope</th><th>Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>feat(shell-web): wire PrestigeSystemEvaluator in worker</code></td><td>Connect evaluator to runtime, pass to snapshot builder</td><td>Shell Agent</td><td>Phase 1 complete</td><td>Worker publishes prestige data</td></tr><tr><td><code>feat(shell-web): add prestige selectors to ShellStateProvider</code></td><td><code>selectPrestigeLayers</code>, <code>selectPrestigeLayerById</code></td><td>Shell Agent</td><td>Worker wiring</td><td>Selectors return typed data</td></tr></tbody></table>
<p><strong>Phase 3: UI Components</strong></p>
<table><thead><tr><th>Issue Title</th><th>Scope</th><th>Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>feat(shell-web): implement PrestigePanel component</code></td><td>Layer list with locked/available states</td><td>Shell Agent</td><td>Selectors</td><td>Component tests pass, renders in app</td></tr><tr><td><code>feat(shell-web): implement PrestigeModal component</code></td><td>Confirmation flow with breakdown and reset summary</td><td>Shell Agent</td><td>Selectors</td><td>Focus trap works, a11y tests pass</td></tr><tr><td><code>feat(shell-web): integrate PrestigePanel into App</code></td><td>Add panel to main layout, wire command dispatch</td><td>Shell Agent</td><td>Panel, Modal</td><td>End-to-end prestige flow works</td></tr></tbody></table>
<p><strong>Phase 4: Polish &amp; Validation</strong></p>
<table><thead><tr><th>Issue Title</th><th>Scope</th><th>Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>test(a11y): add prestige panel to smoke tests</code></td><td>Playwright tests for panel and modal</td><td>QA Agent</td><td>Phase 3 complete</td><td><code>pnpm test:a11y</code> passes</td></tr><tr><td><code>docs: update progression UI design doc</code></td><td>Mark prestige sections complete, update references</td><td>QA Agent</td><td>Phase 3 complete</td><td>Doc reflects implementation</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1</strong>: Core types and handler complete; prestige data flows internally</li>
<li class=""><strong>Phase 2</strong>: Worker publishes prestige snapshots; shell can consume data</li>
<li class=""><strong>Phase 3</strong>: Full UI functional; players can view and execute prestige</li>
<li class=""><strong>Phase 4</strong>: Accessibility verified; documentation updated</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Hand-off Package</strong>: Types defined in Phase 1 unblock Phase 2-3 parallel work</li>
<li class=""><strong>Communication Cadence</strong>: Update issue threads on completion; review checkpoints at phase boundaries</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class=""><strong>Context Packets</strong>: Agents must preload <code>docs/build-resource-generator-upgrade-ui-components-design.md</code>, <code>packages/core/src/resource-command-handlers.ts</code>, <code>packages/core/src/progression.ts</code></li>
<li class=""><strong>Prompting &amp; Constraints</strong>: Follow existing handler patterns exactly; use <code>telemetry.recordError/recordWarning/recordProgress</code> consistently</li>
<li class=""><strong>Safety Rails</strong>: Do not bypass worker bridge isolation; do not allow AUTOMATION priority for prestige commands</li>
<li class=""><strong>Validation Hooks</strong>: Run <code>pnpm lint</code>, <code>pnpm test --filter core</code>, <code>pnpm test --filter shell-web</code>, <code>pnpm test:a11y</code> after changes</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ol>
<li class="">
<p><strong>Inline prestige button without modal</strong>: Rejected for safety - prestige is irreversible and needs explicit confirmation with clear communication of consequences.</p>
</li>
<li class="">
<p><strong>Single-layer UI design</strong>: Rejected as the schema already supports multiple layers; designing for multi-layer avoids rework.</p>
</li>
<li class="">
<p><strong>Always-visible locked layers with full requirements</strong>: Rejected in favor of teaser mode to create mystery and avoid overwhelming new players.</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="unit-tests">Unit Tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit Tests" title="Direct link to Unit Tests" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>Test File</th><th>Coverage</th></tr></thead><tbody><tr><td><code>PRESTIGE_RESET</code> handler</td><td><code>resource-command-handlers.test.ts</code></td><td>Valid/invalid layer, locked status, success telemetry, apply failure</td></tr><tr><td><code>PrestigeSystemEvaluator</code></td><td><code>progression.test.ts</code></td><td>Quote generation, reward calculation, reset execution</td></tr><tr><td><code>buildProgressionSnapshot</code></td><td><code>progression.test.ts</code></td><td><code>prestigeLayers</code> field population, status mapping</td></tr><tr><td><code>PrestigePanel</code></td><td><code>PrestigePanel.test.tsx</code></td><td>Loading/empty/locked/available states, button interactions</td></tr><tr><td><code>PrestigeModal</code></td><td><code>PrestigeModal.test.tsx</code></td><td>Focus trap, breakdown expansion, confirm/cancel actions</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="handler-test-cases">Handler Test Cases<a href="#handler-test-cases" class="hash-link" aria-label="Direct link to Handler Test Cases" title="Direct link to Handler Test Cases" translate="no">​</a></h3>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;PRESTIGE_RESET handler&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;rejects invalid layer with PrestigeResetInvalidLayer telemetry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;rejects unknown layer with PrestigeResetUnknown telemetry&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;rejects locked layer with PrestigeResetLocked warning&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;executes prestige and emits PrestigeResetConfirmed on success&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;emits PrestigeResetApplyFailed and rethrows on evaluator error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;passes confirmationToken through to applyPrestige&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;blocks AUTOMATION priority via command authorization&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="component-test-cases">Component Test Cases<a href="#component-test-cases" class="hash-link" aria-label="Direct link to Component Test Cases" title="Direct link to Component Test Cases" translate="no">​</a></h3>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;PrestigePanel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;renders loading state when bridge not ready&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;renders empty state when no prestige layers defined&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;renders locked layers with dimmed appearance and teaser hint&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;renders available layers with prestige button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;opens modal when prestige button clicked&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;PrestigeModal&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;traps focus within modal when open&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;closes on Escape key&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;displays reward amount and breakdown&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;shows reset/retained columns&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;calls onConfirm with layer ID when confirmed&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;displays error toast on command failure&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="accessibility-tests">Accessibility Tests<a href="#accessibility-tests" class="hash-link" aria-label="Direct link to Accessibility Tests" title="Direct link to Accessibility Tests" translate="no">​</a></h3>
<ul>
<li class="">Add prestige panel to Playwright smoke suite (<code>tools/a11y-smoke-tests</code>)</li>
<li class="">Verify modal focus trap and restore</li>
<li class="">Check ARIA labels on layer cards and buttons</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<table><thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead><tbody><tr><td>Prestige reward formula evaluation complexity</td><td>Incorrect rewards, player frustration</td><td>Reuse existing expression evaluator from content-schema; add property-based tests for edge cases</td></tr><tr><td>Worker snapshot size increase</td><td>Slower postMessage, UI lag</td><td>Prestige layers are few (fewer than 10 expected); monitor payload size in diagnostics</td></tr><tr><td>Modal focus trap conflicts with other modals</td><td>Accessibility issues</td><td>Ensure only one modal renders at a time; follow UpgradeModal pattern exactly</td></tr><tr><td>Reset targets misconfigured in content</td><td>Wrong resources reset, data loss</td><td>Validate <code>resetTargets</code> reference valid resource IDs at content compile time</td></tr><tr><td>Locked layer teaser hints reveal too much</td><td>Spoils progression discovery</td><td>Keep hints vague (&quot;Reach deeper...&quot;); content authors control hint text</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Phase 1-2</strong>: Internal only; no user-facing changes</li>
<li class=""><strong>Phase 3</strong>: Prestige UI visible when content defines layers</li>
<li class=""><strong>Phase 4</strong>: Full validation before release</li>
<li class=""><strong>Migration Strategy</strong>: None required; additive feature</li>
<li class=""><strong>Communication</strong>: Document prestige UI in user-facing changelog</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-follow-up-work">13. Follow-Up Work<a href="#13-follow-up-work" class="hash-link" aria-label="Direct link to 13. Follow-Up Work" title="Direct link to 13. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Prestige layer unlock animations and celebration effects</li>
<li class="">Cross-session prestige statistics and achievements</li>
<li class="">Prestige automation rules (if authorization policy changes)</li>
<li class="">Multi-currency prestige rewards (beyond single resource)</li>
<li class="">Prestige UI: surface generator/upgrade reset + retention targets in the reset summary</li>
<li class="">Multiplier curve support for scaling rewards based on prestige count</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-references">14. References<a href="#14-references" class="hash-link" aria-label="Direct link to 14. References" title="Direct link to 14. References" translate="no">​</a></h2>
<ul>
<li class=""><code>packages/core/src/command.ts:106-166</code> - Command types and payloads</li>
<li class=""><code>packages/core/src/command.ts:230-290</code> - Command authorizations</li>
<li class=""><code>packages/core/src/resource-command-handlers.ts</code> - Existing handler patterns</li>
<li class=""><code>packages/core/src/progression.ts</code> - ProgressionSnapshot and view types</li>
<li class=""><code>packages/content-sample/content/pack.json:988-1070</code> - Sample prestige layer</li>
<li class=""><code>packages/shell-web/src/modules/UpgradeModal.tsx</code> - Modal pattern reference</li>
<li class=""><code>packages/shell-web/src/modules/GeneratorPanel.tsx</code> - Panel pattern reference</li>
<li class=""><code>docs/build-resource-generator-upgrade-ui-components-design.md</code> - Related progression UI design</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Prestige Layer</strong>: A reset mechanic that exchanges accumulated progress for permanent rewards</li>
<li class=""><strong>PrestigeLayerView</strong>: UI-facing snapshot of a prestige layer&#x27;s current state</li>
<li class=""><strong>Teaser Mode</strong>: Display style for locked layers showing blurred appearance with hints</li>
<li class=""><strong>Reset Targets</strong>: Resources that are reset to initial values when prestiging</li>
<li class=""><strong>Retained Targets</strong>: Resources that survive a prestige reset</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-11-27</td><td>Idle Engine Team</td><td>Initial draft</td></tr><tr><td>2025-11-28</td><td>Idle Engine Team</td><td>Review and completion: clarified layer ID type change, added evaluator implementation location, expanded design decisions (repeatable prestige, prestige count tracking, locked layer visibility), updated work breakdown tables with Agent/Dependencies columns, removed Open Questions section (all resolved and integrated into design)</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/prestige-system-completion-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a><ul><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#non-goals" class="table-of-contents__link toc-highlight">Non-Goals</a></li></ul></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a><ul><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit Tests</a></li><li><a href="#handler-test-cases" class="table-of-contents__link toc-highlight">Handler Test Cases</a></li><li><a href="#component-test-cases" class="table-of-contents__link toc-highlight">Component Test Cases</a></li><li><a href="#accessibility-tests" class="table-of-contents__link toc-highlight">Accessibility Tests</a></li></ul></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-follow-up-work" class="table-of-contents__link toc-highlight">13. Follow-Up Work</a></li><li><a href="#14-references" class="table-of-contents__link toc-highlight">14. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>