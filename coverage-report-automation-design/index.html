<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-coverage-report-automation-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Vitest Coverage Report Automation | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/coverage-report-automation-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Vitest Coverage Report Automation | Idle Engine Docs"><meta data-rh="true" name="description" content="Document Control"><meta data-rh="true" property="og:description" content="Document Control"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/coverage-report-automation-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/coverage-report-automation-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/coverage-report-automation-design" hreflang="x-default"><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.9621a60d.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.267f9d33.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a class="navbar__item navbar__link" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><main class="docMainContainer_tfRv docMainContainerEnhanced_qAvX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Vitest Coverage Report Automation</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Vitest Coverage Report Automation</li>
<li class=""><strong>Document ID</strong>: 342</li>
<li class=""><strong>Authors</strong>: Codex Automation Agent</li>
<li class=""><strong>Reviewers</strong>: Quality &amp; Diagnostics maintainers</li>
<li class=""><strong>Status</strong>: Draft</li>
<li class=""><strong>Last Updated</strong>: 2025-11-07</li>
<li class=""><strong>Related Issues</strong>: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/342" target="_blank" rel="noopener noreferrer" class="">#342</a></li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>CI lacks a deterministic view of Vitest coverage, forcing stakeholders to run local commands to inspect coverage drift. This design introduces a workspace command (<code>pnpm coverage:md</code>) that runs coverage-enabled Vitest suites for every package, aggregates the resulting <code>coverage-summary.json</code> files, and generates a Docusaurus page (<code>docs/coverage/index.md</code>) with both overall and per-package coverage tables plus regeneration instructions. The automation fails fast when coverage artifacts are missing or stale, runs inside CI, and keeps the generated markdown checked in so documentation stays in sync with test health.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class=""><strong>Background</strong>: Each package already runs Vitest via <code>pnpm test</code>/<code>pnpm test:ci</code>, but coverage reporters (<code>text</code>, <code>lcov</code>) only emit to stdout or artifacts that are never published. Docs visitors have no telemetry showing whether tests meaningfully cover the runtime, shell, or content tooling.</li>
<li class=""><strong>Problem</strong>: Release managers and external contributors cannot verify coverage budgets or identify regressions without cloning the repo, running Vitest with <code>--coverage</code>, and manually inspecting multiple <code>coverage-summary.json</code> files.</li>
<li class=""><strong>Forces</strong>: Coverage must be deterministic, CI-safe, and headless (no browsers). The generated markdown must remain noise-free so downstream agents parsing docs or the final JSON reporter stay reliable. Time spent regenerating docs should stay below 3 minutes on CI hardware.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Goals</strong>
<ol>
<li class="">One-shot coverage command that fans out across every workspace package using Vitest.</li>
<li class="">Deterministic aggregation script that renders overall and per-package coverage tables plus operator guidance.</li>
<li class="">CI enforcement to prevent merges when coverage artifacts or docs drift.</li>
<li class="">Documentation updates (sidebar + contributor handbook) so humans discover the workflow.</li>
</ol>
</li>
<li class=""><strong>Non-Goals</strong>
<ul>
<li class="">Tracking historical coverage trends or charts (handled later via analytics).</li>
<li class="">Converting all packages to 100% coverage; this work only reports current state.</li>
<li class="">Replacing LCov reporters or publishing HTML dashboards.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>: Quality &amp; Diagnostics maintainers, Docs maintainers.</li>
<li class=""><strong>Agent Roles</strong>
<ul>
<li class=""><em>Tooling Automation Agent</em>: implements the coverage command, aggregator script, and CI wiring.</li>
<li class=""><em>Docs Agent</em>: owns the generated markdown, sidebar entry, and contributor guidance.</li>
</ul>
</li>
<li class=""><strong>Affected Packages/Services</strong>: <code>@idle-engine/core</code>, <code>@idle-engine/shell-web</code>, <code>@idle-engine/content-*</code>, <code>packages/docs</code>, new <code>tools/coverage-report</code> utility, <code>.github/workflows/ci.yml</code>, root <code>package.json</code>.</li>
<li class=""><strong>Compatibility Considerations</strong>: Coverage command must respect existing test filters and avoid mutating package APIs. Generated docs are additive and should not break existing sidebar routes.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class="">Workspace scripts (<code>pnpm test</code>, <code>pnpm test:ci</code>) call <code>tools/scripts/run-workspace-test.sh</code>, which runs each package’s <code>test</code> or <code>test:ci</code> script but never enables coverage.</li>
<li class=""><code>@idle-engine/config-vitest</code> only emits <code>text</code> and <code>lcov</code> coverage reporters, so there is no <code>coverage/coverage-summary.json</code> to parse when tests succeed normally.</li>
<li class="">There is no <code>docs/coverage/</code> directory, no sidebar entry, and no README mention of coverage workflows.</li>
<li class="">CI’s <code>Quality Gate</code> job stops at <code>pnpm test:ci</code>; it neither runs coverage nor verifies docs derived from coverage.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ol>
<li class=""><strong>Collection</strong>: <code>pnpm coverage:md</code> invokes a new helper (<code>tools/scripts/run-workspace-coverage.sh</code>) that reuses the existing workspace runner but always forwards <code>vitest run --coverage --reporter=json</code> to each package. Coverage config adds <code>json-summary</code> so Vitest writes <code>coverage/coverage-summary.json</code> under every package.</li>
<li class=""><strong>Aggregation</strong>: After tests finish, the command executes <code>tsx tools/coverage-report/index.ts</code>. The script crawls <code>packages/</code>, <code>services/</code>, and <code>tools/</code> for <code>coverage/coverage-summary.json</code>, infers the package name from the nearest <code>package.json</code>, and aggregates totals plus per-package stats.</li>
<li class=""><strong>Publication</strong>: The script writes <code>docs/coverage/index.md</code> with (a) an intro + regeneration instructions, (b) an overall coverage table, and (c) a per-package table sorted alphabetically. Formatting uses fixed-width percentage strings (two decimals) to keep diffs stable.</li>
<li class=""><strong>Enforcement</strong>: CI gains a <code>Coverage Report</code> step after <code>pnpm test:ci</code> that runs <code>pnpm coverage:md</code> and fails when coverage generation or markdown emission leaves a dirty working tree, guaranteeing main always contains the latest report.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<ul>
<li class=""><strong>Coverage command</strong>
<ul>
<li class="">Add <code>tools/scripts/run-workspace-coverage.sh</code> mirroring <code>run-workspace-test.sh</code> but forcing <code>pnpm -r run --if-present test:ci -- --coverage --reporter=json</code>.</li>
<li class="">Root <code>package.json</code> defines <code>&quot;coverage:md&quot;: &quot;./tools/scripts/run-workspace-coverage.sh &amp;&amp; tsx tools/coverage-report/index.ts&quot;</code>.</li>
<li class="">Each package extends scripts with <code>test:coverage</code> or reuses <code>test:ci</code> to ensure <code>vitest run --coverage</code> works headlessly.</li>
</ul>
</li>
<li class=""><strong>Coverage reporter configuration</strong>
<ul>
<li class="">Update <code>@idle-engine/config-vitest</code> to include <code>&#x27;json-summary&#x27;</code> in <code>coverage.reporter</code>.</li>
<li class="">Standardize output directories by setting <code>coverage.dir = &#x27;coverage&#x27;</code> to avoid OS-specific defaults.</li>
</ul>
</li>
<li class=""><strong>Aggregator script</strong>
<ul>
<li class="">Implemented in TypeScript using built-in <code>fs/promises</code> plus <code>node:path</code>.</li>
<li class="">Discovers coverage files via manual directory walk limited to workspace roots to avoid node_modules.</li>
<li class="">Validates each file (schema: <code>total</code> + per-file objects) and ensures every participating package exposes <code>coverage.total</code>.</li>
<li class="">Aggregates totals by summing <code>covered</code> and <code>total</code> counts for the four metrics; <code>pct</code> recomputed instead of trusting input strings.</li>
<li class="">Output structure:<!-- -->
<div class="language-text codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-text codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain"># Coverage Report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_Last updated: 2025-11-07_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run `pnpm coverage:md` ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Overall Coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Metric | Covered | Total | % |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ...    | ...     | ...   | ... |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Coverage by Package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Package | Statements ... |</span><br></span></code></pre></div></div>
</li>
<li class="">Script exits with non-zero code when (a) any package listed in <code>coverage.manifest.json</code> is missing coverage artifacts, (b) JSON parsing fails, or (c) no packages produced coverage (guarding against misconfigured runs).</li>
</ul>
</li>
<li class=""><strong>Docs updates</strong>
<ul>
<li class="">New generated file <code>docs/coverage/index.md</code> checked in and linked under a new “Diagnostics &amp; Quality” sidebar category.</li>
<li class=""><code>docs/contributor-handbook.md</code> (or README) documents how to regenerate the coverage page and expectations for PRs touching tests.</li>
</ul>
</li>
<li class=""><strong>Tooling dependencies</strong>
<ul>
<li class="">Add <code>tsx</code> (or <code>ts-node</code>) as a dev dependency to run the TypeScript aggregator without a build step.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>: No runtime deployment; CI adds a deterministic gate. Local developers run <code>pnpm coverage:md</code> before pushing when tests change coverage behavior.</li>
<li class=""><strong>Telemetry &amp; Observability</strong>: None beyond coverage numbers themselves; <code>vitest-llm-reporter</code> remains unaffected because the coverage command runs in a separate script after standard <code>pnpm test:ci</code>.</li>
<li class=""><strong>Security &amp; Compliance</strong>: Script only reads workspace files and writes docs; no network calls or secrets involved.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td>docs: automate Vitest coverage summary for Docusaurus (#342)</td><td>Add coverage command, aggregator, docs, and CI wiring</td><td>Tooling Automation Agent</td><td>This design approved</td><td><code>pnpm coverage:md</code> and CI step succeed; docs updated</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1 (This issue)</strong>: Land coverage command, aggregator, generated doc, sidebar updates, and CI enforcement.</li>
<li class=""><strong>Phase 2 (Backlog)</strong>: Evaluate publishing historical coverage trends (e.g., pushing JSON to an S3 bucket or GitHub Pages visualisation).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class="">Hand-off bundle: issue description, this design, <code>.github/workflows/ci.yml</code>, <code>packages/config-vitest/index.js</code>, and doc targets.</li>
<li class="">Status sync: update GitHub issue comments when the design is approved and after CI verifies the first generated report.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class="">Load <code>docs/coverage-report-automation-design.md</code> and issue #342 before implementing.</li>
<li class="">Use Conventional Commits with <code>Fixes #342</code> in the footer/body.</li>
<li class="">Never edit generated <code>docs/coverage/index.md</code> manually; always rerun <code>pnpm coverage:md</code>.</li>
<li class="">Keep tables ASCII-only and percentages formatted with <code>toFixed(2)</code> to stabilise diffs.</li>
<li class="">CI must fail on dirty working trees after coverage generation; do not auto-commit in CI contexts.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ol>
<li class=""><strong>Docusaurus plugin that reads <code>coverage-summary.json</code> at runtime</strong> – rejected because docs deployments would drift from <code>main</code> without CI enforcement and would require bundling coverage JSON into the docs build.</li>
<li class=""><strong>Publishing HTML coverage reports per package</strong> – rejected to avoid bloating the repo and because stakeholders requested a single markdown summary.</li>
<li class=""><strong>Extending <code>pnpm test:ci</code> to always run with coverage</strong> – rejected due to the additional runtime overhead for every PR; coverage should be opt-in via <code>pnpm coverage:md</code>.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class="">Unit-test the aggregator (pure functions) with fixture coverage JSON to verify sorting, aggregation, and failure modes.</li>
<li class="">Run <code>pnpm coverage:md</code> locally on a clean workspace and confirm the resulting markdown matches expectations; rerun without code changes to verify determinism.</li>
<li class="">Update CI to run the command on every push/PR; the job fails if coverage or markdown generation fails.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Long-running coverage suites</strong>: Coverage adds overhead; mitigate by running packages sequentially (default <code>pnpm -r run</code>) and documenting estimated runtime.</li>
<li class=""><strong>Missing coverage artifacts</strong>: Agents might forget to run the command after adding tests. Script throws clear errors listing missing packages, and CI prevents merges until resolved.</li>
<li class=""><strong>Markdown churn</strong>: Small floating-point differences could thrash diffs. Recomputing percentages with fixed precision and consistent ordering keeps diffs predictable.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class="">Land this design + implementation via #342.</li>
<li class="">Monitor CI runtime; if it grows significantly, consider gating coverage runs behind a nightly workflow.</li>
<li class="">Announce the new command in the contributor handbook and link to the generated page.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-open-questions">13. Open Questions<a href="#13-open-questions" class="hash-link" aria-label="Direct link to 13. Open Questions" title="Direct link to 13. Open Questions" translate="no">​</a></h2>
<ol>
<li class="">Should the coverage command skip packages that intentionally lack tests (<code>test</code> script absent), or should we maintain an explicit allowlist?</li>
<li class="">Do we also want to publish branch coverage thresholds or alerts when a package drops below a target percentage?</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Automate historical coverage trend storage once stakeholders confirm the static report meets their needs.</li>
<li class="">Investigate embedding sparkline charts in the docs page once Docusaurus theme work is prioritised.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class=""><code>packages/config-vitest/index.js</code></li>
<li class=""><code>.github/workflows/ci.yml</code></li>
<li class=""><code>tools/scripts/run-workspace-test.sh</code></li>
<li class="">Issue <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/342" target="_blank" rel="noopener noreferrer" class="">#342</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Coverage Summary</strong>: The <code>coverage-summary.json</code> file emitted by Vitest/NYC containing <code>statements</code>, <code>branches</code>, <code>functions</code>, and <code>lines</code> totals.</li>
<li class=""><strong>Workspace Runner</strong>: Helper scripts under <code>tools/scripts/</code> that execute a pnpm command across every package in the monorepo.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-11-07</td><td>Codex Automation Agent</td><td>Initial draft</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/coverage-report-automation-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-open-questions" class="table-of-contents__link toc-highlight">13. Open Questions</a></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>