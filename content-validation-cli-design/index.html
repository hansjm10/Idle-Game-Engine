<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content-validation-cli-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Content Validation CLI Design | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/content-validation-cli-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Content Validation CLI Design | Idle Engine Docs"><meta data-rh="true" name="description" content="Use this document to understand how content validation tooling is integrated into the shared CLI so pnpm generate enforces schema health before the compiler emits artifacts."><meta data-rh="true" property="og:description" content="Use this document to understand how content validation tooling is integrated into the shared CLI so pnpm generate enforces schema health before the compiler emits artifacts."><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/content-validation-cli-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-validation-cli-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/content-validation-cli-design" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Content Validation CLI Design","item":"https://hansjm10.github.io/Idle-Game-Engine/content-validation-cli-design"}]}</script><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.0ca8729c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.ae87cd86.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.7e05ebdb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_sIzO" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_yXCL themedComponent--light_m26g"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_yXCL themedComponent--dark_DQxa"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_zgE_"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_VTTy colorModeToggle_mrTp"><button class="clean-btn toggleButton_Qf8c toggleButtonDisabled_hCyI" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_j9FX lightToggleIcon_i4Ty"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_j9FX darkToggleIcon_B1fV"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_j9FX systemToggleIcon_d9Wq"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_xdO6"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_fCXc"><div class="docsWrapper_oodB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ZUBg" type="button"></button><div class="docRoot_zYbW"><aside class="theme-doc-sidebar-container docSidebarContainer_cQjy"><div class="sidebarViewport_guUk"><div class="sidebar_flRn"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_e0X4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_WJIo menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Idle-Game-Engine/"><span title="Getting Started" class="categoryLinkLabel_uVix">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/"><span title="Overview" class="linkLabel_Hws7">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/contributor-handbook"><span title="Contributor Handbook" class="linkLabel_Hws7">Contributor Handbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/role-index"><span title="Role Index" class="linkLabel_Hws7">Role Index</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/design-document-template"><span title="Design Document Template" class="linkLabel_Hws7">Design Document Template</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_WJIo menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/idle-engine-design"><span title="Core Runtime" class="categoryLinkLabel_uVix">Core Runtime</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_WJIo menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content Pipeline" class="categoryLinkLabel_uVix">Content Pipeline</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content DSL Schema Design" class="linkLabel_Hws7">Content DSL Schema Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-dsl-usage-guidelines"><span title="Content DSL Usage Guidelines" class="linkLabel_Hws7">Content DSL Usage Guidelines</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-schema-reference"><span title="Document Content Schema Enums" class="linkLabel_Hws7">Document Content Schema Enums</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-compiler-design"><span title="Content Compiler Design" class="linkLabel_Hws7">Content Compiler Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/content-schema-rollout-decisions"><span title="Content Schema Rollout Decisions" class="linkLabel_Hws7">Content Schema Rollout Decisions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Idle-Game-Engine/content-validation-cli-design"><span title="Content Validation CLI Design" class="linkLabel_Hws7">Content Validation CLI Design</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_WJIo menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/coverage/"><span title="Diagnostics &amp; Quality" class="categoryLinkLabel_uVix">Diagnostics &amp; Quality</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_WJIo menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/implementation-plan"><span title="Operations &amp; Process" class="categoryLinkLabel_uVix">Operations &amp; Process</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_BJhZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_NkVs"><div class="docItemContainer_WMJH"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_iCU1" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Idle-Game-Engine/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_HviJ"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Content Pipeline</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Content Validation CLI Design</span></li></ul></nav><div class="tocCollapsible_Kd7K theme-doc-toc-mobile tocMobile_Gv4l"><button type="button" class="clean-btn tocCollapsibleButton_ajnv">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Content Validation CLI Design</h1></header>
<p>Use this document to understand how content validation tooling is integrated into the shared CLI so <code>pnpm generate</code> enforces schema health before the compiler emits artifacts.</p>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Integrate Content Validation into Shared CLI Workflow</li>
<li class=""><strong>Authors</strong>: TODO</li>
<li class=""><strong>Reviewers</strong>: TODO</li>
<li class=""><strong>Status</strong>: Design</li>
<li class=""><strong>Last Updated</strong>: 2025-10-23</li>
<li class=""><strong>Related Issues</strong>: #13</li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>The Idle Engine repository currently ships a schema package (<code>@idle-engine/content-schema</code>) and a CLI scaffold under <code>tools/content-schema-cli</code>. The CLI generates the runtime event manifest but content packs can still ship invalid data because validation is not part of the default workflow. This design integrates content pack validation into the <code>pnpm generate</code> command so that schema violations abort compilation, emit actionable diagnostics as structured logs, and protect the deterministic runtime loop. The solution discovers packs, validates them in dependency order, produces machine-readable JSON events for CI consumption, and persists a workspace-level summary tracking validation and compilation outcomes.</p>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Background</strong>: The Idle Engine content pipeline relies on schemas defined in <code>@idle-engine/content-schema</code> and a compiler (<code>@idle-engine/content-compiler</code>) that generates deterministic JSON/TypeScript artifacts. The CLI under <code>tools/content-schema-cli</code> currently focuses on manifest regeneration via <code>pnpm generate</code> but does not validate content packs before compilation. Historical decisions emphasized runtime event manifest generation (<code>docs/idle-engine-design.md</code> §6.2) and schema contracts (<code>docs/content-dsl-schema-design.md</code>), but enforcement was deferred.</p>
</li>
<li class="">
<p><strong>Problem</strong>: Content packs can ship invalid data because validation is not wired into the default workflow. Contributors can land malformed content without local or CI-level warnings. Existing runs emit human-readable console noise that downstream automation cannot parse reliably, and artifacts may drift from authored packs without detection. The deterministic runtime loop is at risk when invalid content bypasses the compiler pipeline.</p>
</li>
<li class="">
<p><strong>Forces</strong>:</p>
<ul>
<li class="">Performance targets: validation must remain performant for dozens of packs</li>
<li class="">Timeline: must integrate before schema regressions slip through CI</li>
<li class="">Partner requirements: structured logging guidance in <code>docs/idle-engine-design.md</code> §6.2 must be met</li>
<li class="">Compatibility: Node ≥20.10, pnpm ≥8 as defined in <code>package.json</code></li>
<li class="">Workflow integration: Lefthook and CI depend on <code>pnpm generate</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Goals</strong>:</p>
<ol>
<li class=""><strong>Deterministic enforcement</strong>: Every <code>pnpm generate</code> run must validate all discovered packs before emitting runtime artifacts, aborting on schema failures to protect the deterministic runtime loop (<code>docs/idle-engine-design.md</code> §6.2).</li>
<li class=""><strong>Actionable diagnostics</strong>: Emit machine-readable JSON events (<code>content_pack.*</code>) that surface pack slug, file path, warning counts, and blocker details so CI and humans can triage quickly without parsing prose logs.</li>
<li class=""><strong>Workflow integration</strong>: Support one-shot, <code>--check</code>, and <code>--watch</code> modes with consistent exit codes, clean handling of drift, and optional pretty-printing to keep the developer experience aligned with other repo tooling.</li>
<li class=""><strong>Summary visibility</strong>: Persist a workspace-level summary (<code>content/compiled/index.json</code>) that records validation and compilation outcomes—even when validation aborts compilation—so downstream scripts never read stale success snapshots.</li>
<li class=""><strong>Build hygiene</strong>: Automatically build <code>@idle-engine/content-compiler</code> on demand, skip redundant rewrites, and prune stale artifacts so committed outputs always match authored packs.</li>
</ol>
</li>
<li class="">
<p><strong>Non-Goals</strong>:</p>
<ul>
<li class="">Replacing or redefining schema rules (tracked in Issue #11 and the schema design document)</li>
<li class="">Designing visual authoring tools or IDE plugins for content authors</li>
<li class="">Shipping content balance heuristics, localisation audits, or runtime formula inspection (compiler follow-ups cover those capabilities)</li>
<li class="">Altering the runtime event manifest format; the CLI continues to call <code>buildRuntimeEventManifest</code> for that responsibility</li>
<li class="">Introducing additional package managers or workflow orchestration beyond pnpm and chokidar</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Primary Stakeholders</strong>: Content pipeline team, CI/CD infrastructure owners, content pack authors</p>
</li>
<li class="">
<p><strong>Agent Roles</strong>:</p>
<ul>
<li class=""><strong>CLI Implementation Agent</strong>: Responsible for wiring validation into the compile entrypoint, implementing CLI options, and ensuring structured logging</li>
<li class=""><strong>Testing Agent</strong>: Covers unit tests for validation flows, watch mode, drift detection, and property-based tests</li>
<li class=""><strong>Docs Agent</strong>: Updates repository documentation to reflect new workflow behaviors</li>
</ul>
</li>
<li class="">
<p><strong>Affected Packages/Services</strong>:</p>
<ul>
<li class=""><code>tools/content-schema-cli</code>: main integration point for validation wiring</li>
<li class=""><code>@idle-engine/content-schema</code>: provides <code>createContentPackValidator</code> and <code>validateContentPacks</code></li>
<li class=""><code>@idle-engine/content-compiler</code>: consumes schema options, produces artifacts</li>
<li class=""><code>packages/**/content/</code>: all content packs under validation</li>
</ul>
</li>
<li class="">
<p><strong>Compatibility Considerations</strong>:</p>
<ul>
<li class="">Backward compatibility: existing <code>pnpm generate</code> invocations will now validate packs and may fail where they previously succeeded with invalid content</li>
<li class="">API stability: structured log event schemas (<code>content_pack.*</code>, <code>watch.*</code>, <code>cli.*</code>) should remain stable for CI parsing</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>tools/content-schema-cli/src/generate.js</code> reads runtime event metadata, builds the manifest module, and exposes <code>validateContentPacks</code> but this function is not wired into the default command.</li>
<li class=""><code>pnpm generate</code> executes <code>pnpm --filter @idle-engine/content-validation-cli run compile</code>, which currently focuses on manifest regeneration and does not surface pack-level diagnostics or compiler integration.</li>
<li class="">Structured logging guidance in <code>docs/idle-engine-design.md</code> (§6.2) is unmet; existing runs emit human-readable console noise that downstream automation cannot parse reliably.</li>
<li class=""><code>packages/content-compiler</code> can compile packs into deterministic JSON/TypeScript artifacts (<code>docs/content-compiler-design.md</code>), but nothing triggers it during workspace routines and artifacts may drift.</li>
<li class="">CI and Lefthook depend on <code>pnpm generate</code>; without validation wiring, schema regressions slip through local workflows.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Narrative</strong>: The solution extends the existing <code>tools/content-schema-cli/src/compile.js</code> entrypoint to orchestrate a four-stage pipeline: (1) build the runtime event manifest, (2) validate all discovered content packs using schema validators, (3) write the manifest module, and (4) compile validated packs into deterministic artifacts. Each stage emits structured JSON logs for CI consumption. Validation failures abort compilation and persist a failure summary so downstream tooling observes the latest state. Watch mode adds debounced file system observation with trigger summarization. The CLI respects <code>--check</code> for drift detection, <code>--clean</code> for forced rewrites, and <code>--pretty</code> for human-readable output.</p>
</li>
<li class="">
<p><strong>Diagram</strong>: N/A (CLI orchestration flow documented in §6.2)</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_pQUT" id="execution-pipeline">Execution Pipeline<a href="#execution-pipeline" class="hash-link" aria-label="Direct link to Execution Pipeline" title="Direct link to Execution Pipeline" translate="no">​</a></h4>
<ol>
<li class=""><strong>Detect workspace root</strong> and resolve options (<code>cwd</code>, <code>summary</code>, watch flags).</li>
<li class=""><strong>Ensure compiler availability</strong> by attempting to import <code>@idle-engine/content-compiler</code>; if it is missing, spawn <code>pnpm --filter @idle-engine/content-compiler run build</code> before retrying the import.</li>
<li class=""><strong>Build runtime event manifest</strong> via <code>buildRuntimeEventManifest</code>, capturing the generated source, manifest entries, and schema options (<code>manifestDefinitions</code>).</li>
<li class=""><strong>Validate content packs</strong> by calling <code>validateContentPacks(manifest.manifestDefinitions, options)</code>. The function:<!-- -->
<ul>
<li class="">Discovers pack documents under <code>packages/**/content/pack.(json|json5)</code>.</li>
<li class="">Supports both <code>pack.json</code> and <code>pack.json5</code>, using JSON.parse for strict JSON files and the JSON5 parser for relaxed syntax.</li>
<li class="">Builds a validator with <code>createContentPackValidator</code>.</li>
<li class="">Emits a <code>content_pack.validated</code> log per pack, including balance warnings/errors when present.</li>
<li class="">Emits <code>content_pack.validation_failed</code> logs for schema errors and throws when any failure occurs.</li>
<li class="">Serializes a failure summary to the workspace summary path before bubbling the error so consumers observe the latest validation status.</li>
<li class="">Returns schema options to seed the compiler (known packs, active IDs, runtime event catalogue) when validation succeeds.</li>
</ul>
</li>
<li class=""><strong>Write manifest</strong> using <code>writeRuntimeEventManifest</code>, respecting <code>check</code> and <code>clean</code>.</li>
<li class=""><strong>Compile packs</strong> by calling <code>compileWorkspacePacks</code> with the workspace filesystem implementation and schema options from step 4. The compiler:<!-- -->
<ul>
<li class="">Topologically sorts packs based on declared dependencies (respects <code>metadata.dependencies.requires</code>).</li>
<li class="">Serializes normalized packs to deterministic JSON and generated TypeScript modules.</li>
<li class="">Produces artifact operations (written, deleted, unchanged) for per-pack outputs and the workspace summary.</li>
</ul>
</li>
<li class=""><strong>Emit compiler logs</strong> using the logger returned by <code>loadContentCompiler().createLogger</code>, producing <code>content_pack.compiled</code>, <code>content_pack.skipped</code>, <code>content_pack.compilation_failed</code>, and <code>content_pack.pruned</code> events.</li>
<li class=""><strong>Summarise run</strong> by merging manifest and compiler results into a structured summary (pack totals, artifact actions, changed pack slugs). When validation fails, write a structured failure summary that captures the offending packs and skip compilation details. Watch mode emits an additional <code>watch.run</code> event with duration and trigger metadata.</li>
<li class=""><strong>Set exit codes</strong>: any validation failure, compiler failure, or drift in <code>--check</code> mode results in a non-zero exit status.</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_pQUT" id="runtime-changes">Runtime Changes<a href="#runtime-changes" class="hash-link" aria-label="Direct link to Runtime Changes" title="Direct link to Runtime Changes" translate="no">​</a></h4>
<ul>
<li class="">Extend <code>compile.js</code> to invoke <code>validateContentPacks</code> after manifest build and before manifest write</li>
<li class="">Plumb schema options from validation into the compiler call</li>
<li class="">Add automatic compiler build step if <code>@idle-engine/content-compiler</code> is not importable</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_pQUT" id="data--schemas">Data &amp; Schemas<a href="#data--schemas" class="hash-link" aria-label="Direct link to Data &amp; Schemas" title="Direct link to Data &amp; Schemas" translate="no">​</a></h4>
<ul>
<li class="">
<p><strong>Validation Events</strong>:</p>
<ul>
<li class=""><code>content_pack.validated</code>: <code>{ event, packSlug, path, warningCount, warnings, balanceWarningCount, balanceWarnings, balanceErrorCount, balanceErrors }</code></li>
<li class=""><code>content_pack.validation_failed</code>: <code>{ event, packSlug, packVersion, path, issues, message }</code></li>
</ul>
</li>
<li class="">
<p><strong>Compiler Events</strong>:</p>
<ul>
<li class=""><code>content_pack.compiled</code>: <code>{ name, slug, path, durationMs, warnings, artifacts, check }</code></li>
<li class=""><code>content_pack.skipped</code>: same shape but indicates all artifacts unchanged during <code>--check</code></li>
<li class=""><code>content_pack.compilation_failed</code>: adds <code>message</code> and <code>stack</code></li>
<li class=""><code>content_pack.pruned</code>: emitted when stale artifacts are removed</li>
</ul>
</li>
<li class="">
<p><strong>Watch Events</strong>:</p>
<ul>
<li class=""><code>watch.status</code>, <code>watch.hint</code>, <code>watch.run</code>: summarize triggers and run outcomes</li>
</ul>
</li>
<li class="">
<p><strong>Error Events</strong>:</p>
<ul>
<li class=""><code>cli.unhandled_error</code>: <code>{ event, message, stack, fatal, timestamp }</code></li>
</ul>
</li>
<li class="">
<p><strong>Workspace Summary</strong> (<code>content/compiled/index.json</code>):</p>
<ul>
<li class="">Pack totals (compiled, failed, warning counts)</li>
<li class="">Artifact action counts grouped by action</li>
<li class="">Lists of changed and failed pack slugs</li>
<li class="">Manifest and summary action states</li>
<li class="">Timestamp and CLI version metadata</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_pQUT" id="apis--contracts">APIs &amp; Contracts<a href="#apis--contracts" class="hash-link" aria-label="Direct link to APIs &amp; Contracts" title="Direct link to APIs &amp; Contracts" translate="no">​</a></h4>
<ul>
<li class="">
<p><strong>CLI Options</strong>:</p>
<ul>
<li class=""><code>--check</code>: run without applying filesystem mutations; exit with code 1 if manifests, validation, or compiler artifacts would change</li>
<li class=""><code>--clean</code>: force rewrites even when outputs match, ensuring stale artifacts are replaced (ignored in <code>--check</code> runs)</li>
<li class=""><code>--watch</code>: observe content, manifest metadata, and base manifest files with chokidar; rerun the pipeline with debouncing</li>
<li class=""><code>--pretty</code>: pretty-print JSON log lines for human readability</li>
<li class=""><code>--cwd</code>/<code>-C</code>: override the workspace root (used for tests and sandboxes)</li>
<li class=""><code>--summary</code>: override the workspace summary output path (default: <code>content/compiled/index.json</code>)</li>
</ul>
</li>
<li class="">
<p><strong>Exit Codes</strong>:</p>
<ul>
<li class=""><code>0</code>: success</li>
<li class=""><code>1</code>: validation failure, compilation failure, or drift detected in <code>--check</code> mode</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_pQUT" id="tooling--automation">Tooling &amp; Automation<a href="#tooling--automation" class="hash-link" aria-label="Direct link to Tooling &amp; Automation" title="Direct link to Tooling &amp; Automation" translate="no">​</a></h4>
<ul>
<li class="">Update <code>printUsage()</code> to describe the integrated validation stage and log events</li>
<li class="">Extend pack discovery to read both <code>pack.json</code> and <code>pack.json5</code>, falling back to JSON5 parser when relaxed syntax is detected</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Deployment</strong>: No changes to CI/CD beyond ensuring <code>pnpm generate</code> continues to run; structured logs enable future parsing for dashboards</p>
</li>
<li class="">
<p><strong>Telemetry &amp; Observability</strong>:</p>
<ul>
<li class="">JSON-per-line logs with no trailing commentary to protect downstream ingestion</li>
<li class="">All log emitters accept <code>pretty</code> to switch between single-line and indented JSON without changing field names</li>
<li class="">Unexpected runtime errors surface as <code>cli.unhandled_error</code> events, keeping console output machine-readable while preserving stack traces</li>
</ul>
</li>
<li class="">
<p><strong>Security &amp; Compliance</strong>: N/A (no PII handling, no new permissions required)</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td>feat(content-schema-cli): wire validation into generate command</td><td>Import and invoke <code>validateContentPacks</code> from compile entrypoint; plumb schema options into compiler</td><td>CLI Implementation Agent</td><td>Schema package stable</td><td>Validation runs before compilation; schema failures abort pipeline</td></tr><tr><td>feat(content-schema-cli): add structured logging for validation</td><td>Emit <code>content_pack.validated</code> and <code>content_pack.validation_failed</code> events with actionable diagnostics</td><td>CLI Implementation Agent</td><td>Validation wiring complete</td><td>All validation outcomes emit structured JSON logs</td></tr><tr><td>feat(content-schema-cli): persist workspace summary</td><td>Write deterministic summary JSON tracking validation/compilation outcomes; handle failure summaries</td><td>CLI Implementation Agent</td><td>Logging complete</td><td>Summary written on success and failure; <code>--check</code> detects drift</td></tr><tr><td>feat(content-schema-cli): support pack.json5 discovery</td><td>Extend pack discovery to read both <code>.json</code> and <code>.json5</code>; use JSON5 parser for relaxed syntax</td><td>CLI Implementation Agent</td><td>Validation wiring complete</td><td>Both formats validated; diagnostics surface for JSON5 files</td></tr><tr><td>test(content-schema-cli): cover validation flows</td><td>Add Vitest tests for validation success/failure, exit codes, drift detection, watch mode triggers</td><td>Testing Agent</td><td>CLI implementation complete</td><td>Unit tests pass; coverage includes property-based formula sanitization</td></tr><tr><td>docs: update content pipeline documentation</td><td>Revise README, <code>content-dsl-schema-design.md</code>, <code>content-compiler-design.md</code> to reflect new CLI behavior</td><td>Docs Agent</td><td>Implementation complete</td><td>Documentation accurately describes integrated workflow</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Phase 1: Core Integration</strong> (Steps 1-3 from Implementation Plan)</p>
<ul>
<li class="">Deliverables: Validation wiring, structured logging, summary output, drift detection</li>
<li class="">Timeline: Must complete before CI accepts changes</li>
<li class="">Gating criteria: All validation and compilation flows emit correct structured logs; exit codes match spec</li>
</ul>
</li>
<li class="">
<p><strong>Phase 2: Testing &amp; Documentation</strong> (Step 4 from Implementation Plan)</p>
<ul>
<li class="">Deliverables: Vitest coverage, updated docs, onboarding guides</li>
<li class="">Timeline: Can land incrementally but must finish before closing Issue #13</li>
<li class="">Gating criteria: Tests pass in CI; documentation reviewed and merged</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_pQUT" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Hand-off Package</strong>: Existing source files under <code>tools/content-schema-cli/src/</code>, schema package <code>@idle-engine/content-schema</code>, compiler package <code>@idle-engine/content-compiler</code></p>
</li>
<li class="">
<p><strong>Communication Cadence</strong>: Status updates per milestone completion; review checkpoints before merging phase 1 and phase 2</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Context Packets</strong>:</p>
<ul>
<li class="">Review <code>docs/idle-engine-design.md</code> §6.2 for structured logging guidance</li>
<li class="">Review <code>docs/content-dsl-schema-design.md</code> for schema contracts</li>
<li class="">Review <code>docs/content-compiler-design.md</code> for compiler integration</li>
<li class="">Load existing <code>tools/content-schema-cli/src/generate.js</code> and <code>compile.js</code> source</li>
</ul>
</li>
<li class="">
<p><strong>Prompting &amp; Constraints</strong>:</p>
<ul>
<li class="">All console output must be structured JSON (JSON-per-line)</li>
<li class="">Commit messages follow conventional commits format</li>
<li class="">Use <code>vitest</code> for all test coverage</li>
<li class="">Preserve Node ≥20.10 and pnpm ≥8 compatibility</li>
</ul>
</li>
<li class="">
<p><strong>Safety Rails</strong>:</p>
<ul>
<li class="">Do not modify schema rules or compiler output formats</li>
<li class="">Do not alter runtime event manifest structure</li>
<li class="">Do not reset git history</li>
<li class="">Avoid incidental <code>console.log</code> calls that corrupt JSON output</li>
</ul>
</li>
<li class="">
<p><strong>Validation Hooks</strong>:</p>
<ul>
<li class="">Run <code>pnpm test</code> to verify unit tests pass</li>
<li class="">Run <code>pnpm generate</code> to ensure CLI executes without errors</li>
<li class="">Run <code>pnpm generate --check</code> to confirm drift detection works</li>
<li class="">Run <code>pnpm generate --watch --pretty</code> and modify a pack to verify watch events fire</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Separate <code>validate</code> subcommand</strong>: Considered adding a standalone validation command for quick checks without manifest/compile work. Rejected because it would fragment the workflow and increase maintenance burden. The combined pipeline is sufficient and ensures validation always precedes compilation.</p>
</li>
<li class="">
<p><strong>Fail-fast vs. continue-on-error for compilation</strong>: Considered aborting compilation when any single pack fails vs. compiling independent packs and surfacing aggregate failures. Chose continue-on-error to maximize feedback during development while still setting non-zero exit codes.</p>
</li>
<li class="">
<p><strong>Warning thresholds as errors</strong>: Considered treating warnings as failures via <code>--fail-on-warning</code> flag. Deferred to future work as it requires product decisions on acceptable warning levels.</p>
</li>
<li class="">
<p><strong>Parallel validation</strong>: Considered parallelizing validation across packs for performance. Deferred because single validator instance with sequential discovery is sufficient for current pack counts; can revisit if performance degrades.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Unit / Integration</strong>:</p>
<ul>
<li class="">Vitest tests under <code>tools/content-schema-cli/src/__tests__/compile.test.js</code>:<!-- -->
<ul>
<li class="">Validation success and failure scenarios, asserting exit codes and emitted logs</li>
<li class="">Pack discovery covering both <code>pack.json</code> and <code>pack.json5</code> inputs</li>
<li class=""><code>--check</code> drift detection for manifest and compiler artifacts</li>
<li class="">Top-level error handling emits <code>cli.unhandled_error</code> JSON logs</li>
<li class="">Watch mode trigger summarization and repeated failure handling</li>
</ul>
</li>
<li class="">Property-based sanitization tests in <code>tools/content-schema-cli/src/__tests__/validation.property.test.ts</code>:<!-- -->
<ul>
<li class="">Reuse <code>DEFAULT_FORMULA_PROPERTY_SEED</code> from <code>@idle-engine/content-schema</code> with fixed offsets for deterministic <code>vitest-llm-reporter</code> JSON</li>
<li class="">Update documented offsets if seeds change (see <code>docs/content-schema-rollout-decisions.md#6-property-based-formula-sanitization-guidance</code>)</li>
</ul>
</li>
<li class="">Integration tests in <code>packages/content-compiler</code>: verify schema options honored and dependency ordering works</li>
</ul>
</li>
<li class="">
<p><strong>Performance</strong>:</p>
<ul>
<li class="">Cache validator instance, avoid repeated filesystem reads</li>
<li class="">Measure wall-clock time in tests</li>
<li class="">Future: parallel validation if necessary</li>
</ul>
</li>
<li class="">
<p><strong>Tooling / A11y</strong>: N/A (CLI tool, no UI components)</p>
</li>
<li class="">
<p><strong>Manual QA</strong>:</p>
<ul>
<li class="">Run <code>pnpm generate</code> after editing a pack to ensure artifacts update and logs show <code>content_pack.compiled</code></li>
<li class="">Run <code>pnpm generate --check</code> to confirm drift detection</li>
<li class="">Run <code>pnpm generate --watch --pretty</code> and modify packs to ensure watch events fire</li>
</ul>
</li>
<li class="">
<p><strong>CI Validation</strong>:</p>
<ul>
<li class="">Extend pipeline to parse final log line and assert exit statuses</li>
<li class="">Ensure no console noise corrupts JSON output (supports <code>vitest-llm-reporter</code> downstream)</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<table><thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead><tbody><tr><td>Log noise breaking JSON consumers</td><td>CI parsing fails; <code>vitest-llm-reporter</code> breaks</td><td>Constrain all console output to structured JSON; lint tests for incidental <code>console.log</code> calls; review diffs for prose output</td></tr><tr><td>Performance degradation with many packs</td><td>Slow local workflows; CI timeouts</td><td>Cache validator instance; avoid repeated filesystem reads; measure wall-clock time; parallel validation if needed</td></tr><tr><td>Watch mode instability</td><td>Developer confusion; lost error signals</td><td>Debounce file system events (150ms); cap trigger logging (<code>MAX_TRIGGER_PATHS = 10</code>); emit clear status events</td></tr><tr><td>Schema/CLI version mismatch</td><td>Import errors; cryptic failures</td><td>Build compiler on demand; bubble import errors with contextual messaging directing developers to <code>pnpm install</code></td></tr><tr><td>Breaking existing workflows</td><td>Contributors blocked by new failures</td><td>Document migration path; provide clear diagnostics for validation errors; staged rollout with warning period if needed</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Milestones</strong>: See §7.2 (Phase 1: Core Integration, Phase 2: Testing &amp; Documentation)</p>
</li>
<li class="">
<p><strong>Migration Strategy</strong>:</p>
<ul>
<li class="">Existing <code>pnpm generate</code> invocations will now validate packs; invalid content will surface as failures</li>
<li class="">No data migrations required</li>
<li class="">No feature flags (validation always runs)</li>
<li class="">Backwards compatibility: existing valid packs continue to work; invalid packs now fail explicitly</li>
</ul>
</li>
<li class="">
<p><strong>Communication</strong>:</p>
<ul>
<li class="">Update repository README to describe new validation behavior</li>
<li class="">Document structured log schema for CI consumers</li>
<li class="">Provide runbook for triaging validation failures</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="13-open-questions">13. Open Questions<a href="#13-open-questions" class="hash-link" aria-label="Direct link to 13. Open Questions" title="Direct link to 13. Open Questions" translate="no">​</a></h2>
<ul>
<li class="">Should warning thresholds escalate to failures in CI (e.g., treat warnings as errors via <code>--fail-on-warning</code>)?</li>
<li class="">Do we need a standalone <code>validate</code> subcommand for quick checks without manifest/compile work, or is the combined pipeline sufficient?</li>
<li class="">How should we expose the summary JSON schema to other tooling (publish types or JSON Schema artifact)?</li>
<li class="">When content packs specify optional digests or compatibility metadata, should validation enforce semantic version ranges beyond basic format checks (ties to Issue #138)?</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class=""><strong>Warning threshold enforcement</strong> (<code>--fail-on-warning</code> flag): product decision required on acceptable warning levels; new issue to track</li>
<li class=""><strong>Parallel validation optimization</strong>: revisit if performance degrades with larger pack counts; benchmark and profile first</li>
<li class=""><strong>Standalone validate subcommand</strong>: defer until clear user demand emerges; current pipeline may be sufficient</li>
<li class=""><strong>Summary JSON schema publication</strong>: publish TypeScript types or JSON Schema artifact for CI tooling; track in separate issue</li>
<li class=""><strong>Semantic version validation</strong>: extend validation to enforce version ranges for pack dependencies (Issue #138)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class=""><code>docs/idle-engine-design.md</code> §6.2: Structured logging guidance and deterministic runtime loop</li>
<li class=""><code>docs/content-dsl-schema-design.md</code>: Schema contracts for content packs</li>
<li class=""><code>docs/content-compiler-design.md</code>: Compiler artifact generation and integration points</li>
<li class=""><code>docs/content-schema-rollout-decisions.md#6-property-based-formula-sanitization-guidance</code>: Property-based test authoring guidance</li>
<li class="">Issue #11: Schema rule definitions</li>
<li class="">Issue #13: Content validation CLI wiring (this document)</li>
<li class="">Issue #138: Semantic version validation for pack dependencies</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Content Pack</strong>: A JSON or JSON5 document under <code>packages/**/content/pack.(json|json5)</code> defining game content (resources, generators, upgrades, etc.)</li>
<li class=""><strong>Runtime Event Manifest</strong>: Generated module exposing metadata about available runtime events for validation</li>
<li class=""><strong>Schema Validator</strong>: Instance of <code>createContentPackValidator</code> that enforces content pack schema rules</li>
<li class=""><strong>Structured Logging</strong>: JSON-per-line log format for machine parsing (aligned with <code>docs/idle-engine-design.md</code> §6.2)</li>
<li class=""><strong>Workspace Summary</strong>: Deterministic JSON artifact at <code>content/compiled/index.json</code> tracking validation and compilation outcomes</li>
<li class=""><strong>Drift Detection</strong>: Mechanism in <code>--check</code> mode to detect when generated artifacts differ from what would be written</li>
<li class=""><strong>Topological Sort</strong>: Ordering content packs based on declared dependencies so dependent packs compile after their requirements</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_pQUT" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-10-23</td><td>TODO</td><td>Initial design document</td></tr><tr><td>2025-12-21</td><td>Claude Opus 4.5</td><td>Migrated to template format for Issue #195</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_zkN7"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/content-validation-cli-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_URLU" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_DCA4"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Idle-Game-Engine/content-schema-rollout-decisions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Content Schema Rollout Decisions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Idle-Game-Engine/coverage/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Coverage Report</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_7BTH thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-open-questions" class="table-of-contents__link toc-highlight">13. Open Questions</a></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_zgE_"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_zgE_"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Idle Engine.</div></div></div></footer></div>
</body>
</html>