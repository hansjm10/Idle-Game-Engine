<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-runtime-transform-system-design-issue-523" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Runtime Transform System — Core Support for Content Transforms (issue-523) | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/runtime-transform-system-design-issue-523"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Runtime Transform System — Core Support for Content Transforms (issue-523) | Idle Engine Docs"><meta data-rh="true" name="description" content="Document Control"><meta data-rh="true" property="og:description" content="Document Control"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-transform-system-design-issue-523"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-transform-system-design-issue-523" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-transform-system-design-issue-523" hreflang="x-default"><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.b25809c0.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.267f9d33.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a class="navbar__item navbar__link" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><main class="docMainContainer_tfRv docMainContainerEnhanced_qAvX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Runtime Transform System — Core Support for Content Transforms (issue-523)</h1></header><h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Implement deterministic runtime support for content transforms (issue-523)</li>
<li class=""><strong>Authors</strong>: Idle Engine Design-Authoring Agent (AI)</li>
<li class=""><strong>Reviewers</strong>: Core Runtime Maintainers; Content Pipeline Maintainers; Shell-Web Maintainers</li>
<li class=""><strong>Status</strong>: Draft</li>
<li class=""><strong>Last Updated</strong>: 2025-12-16</li>
<li class=""><strong>Related Issues</strong>: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/523" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/523</a></li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>GitHub issue #523 (“feat(core): implement runtime support for transforms”) introduces deterministic runtime execution for content-authored <code>transforms</code>, eliminating shell-specific implementations. The proposal adds a <code>TransformSystem</code> to <code>packages/core</code> that maintains transform runtime state (unlock/visibility, cooldown, and outstanding batches), executes atomic resource conversions according to <code>mode</code> (<code>instant</code>, <code>batch</code>, and later <code>continuous</code>), supports <code>manual</code> transforms via a new runtime command, and supports at least one non-manual trigger path (<code>event</code> and/or <code>condition</code>) by subscribing to the runtime event bus and evaluating <code>ConditionContext</code>. The initiative includes save/load persistence and a snapshot view so shells can render transforms and drive manual execution, satisfying issue-523 acceptance criteria while preserving determinism, tick budget, and backward compatibility.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class=""><strong>Background</strong>:<!-- -->
<ul>
<li class="">Content schema already defines transforms (triggers, modes, formulas, safety guards) in <code>packages/content-schema/src/modules/transforms.ts:42</code> and validates references/cycles in <code>packages/content-schema/src/pack.ts:1633</code>.</li>
<li class="">The runtime tick loop executes commands, dispatches events, then ticks systems deterministically (<code>packages/core/src/index.ts:309</code>), and already supports similar “definition + system + persistence + snapshot” patterns for automations (<code>packages/core/src/automation-system.ts:178</code>) and progression snapshots (<code>packages/core/src/progression.ts:232</code>).</li>
<li class="">Shell-web’s worker currently wires progression + automation only and emits <code>STATE_UPDATE</code> without any transform state (<code>packages/shell-web/src/runtime.worker.ts:194</code>, <code>packages/shell-web/src/runtime.worker.ts:317</code>).</li>
</ul>
</li>
<li class=""><strong>Problem</strong> (issue-523):<!-- -->
<ul>
<li class="">Core has no <code>TransformSystem</code>, no command type to manually run a transform (<code>packages/core/src/command.ts:107</code>), no persistence for transform state (<code>packages/core/src/resource-state.ts:124</code>), and no snapshot view for transforms (<code>packages/shell-web/src/runtime.worker.ts:317</code>).</li>
<li class="">As a result, content packs cannot use transforms deterministically without bespoke shell code, undermining the “core runtime owns simulation” constraint and blocking authored mechanics.</li>
</ul>
</li>
<li class=""><strong>Forces</strong>:<!-- -->
<ul>
<li class=""><strong>Determinism</strong>: Transform execution must be replayable and stable across ticks and environments (align with command queue ordering in <code>packages/core/src/index.ts:318</code>).</li>
<li class=""><strong>Atomicity</strong>: Multi-resource input spends must behave transactionally (all-or-nothing) using <code>ResourceState.spendAmount</code> semantics (<code>packages/core/src/resource-state.ts:729</code>).</li>
<li class=""><strong>Safety</strong>: Runtime must enforce <code>safety.maxRunsPerTick</code> and <code>safety.maxOutstandingBatches</code> from schema (<code>packages/content-schema/src/modules/transforms.ts:149</code>) to prevent runaway loops.</li>
<li class=""><strong>Compatibility</strong>: Save schema additions must be backwards compatible and support step rebasing during restore (<code>packages/shell-web/src/runtime.worker.ts:835</code>).</li>
<li class=""><strong>Performance</strong>: Trigger evaluation and formula evaluation must stay within the 100ms step budget for typical packs; avoid O(N*M) per tick when possible.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Goals</strong>:<!-- -->
<ol>
<li class="">Deliver issue-523: add deterministic transform execution to <code>@idle-engine/core</code> with a dedicated <code>TransformSystem</code>.</li>
<li class="">Support <code>instant</code> + <code>manual</code> transforms end-to-end via a new runtime command (spend inputs → produce outputs) and unit tests.</li>
<li class="">Support at least one additional trigger path for issue-523 (<code>event</code> and/or <code>condition</code>) using the existing runtime event bus (<code>packages/core/src/events/runtime-event-catalog.ts:61</code>) and <code>ConditionContext</code> (<code>packages/core/src/condition-evaluator.ts:39</code>).</li>
<li class="">Enforce <code>cooldown</code> and <code>safety.maxRunsPerTick</code> deterministically; for batch transforms, enforce <code>safety.maxOutstandingBatches</code>.</li>
<li class="">Add save/load hooks for transform state and batch queues, including step rebasing on restore (patterned after <code>AutomationSystem.restoreState</code>).</li>
<li class="">Provide a snapshot view of transforms suitable for shell rendering and manual command issuance, and wire it into the worker <code>STATE_UPDATE</code> envelope.</li>
</ol>
</li>
<li class=""><strong>Non-Goals</strong>:<!-- -->
<ul>
<li class="">Delivering a complete shell-web UI for transforms (panels, layouts, animations) beyond exposing snapshot data and command wiring.</li>
<li class="">Implementing transform-trigger integration with automation targets (schema has <code>trigger.kind === &#x27;automation&#x27;</code>, but runtime support is deferred unless explicitly pulled into scope).</li>
<li class="">Introducing generalized transactional resource operations beyond the transform system’s atomic multi-spend logic.</li>
<li class="">Expanding content DSL/schema (issue-523 assumes schema is authoritative and stable).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>:<!-- -->
<ul>
<li class="">Core Runtime Maintainers (deterministic runtime behavior, saves, commands)</li>
<li class="">Content Authors / Content Pipeline Maintainers (authoring transforms, validation, sample packs)</li>
<li class="">Shell-Web Maintainers (snapshot consumption, worker bridge contracts)</li>
<li class="">QA / Determinism Verification Owners (test stability, replay consistency)</li>
</ul>
</li>
<li class=""><strong>Agent Roles</strong> (AI-led execution for issue-523):<!-- -->
<ul>
<li class="">Runtime Implementation Agent: implement <code>TransformSystem</code>, command handlers, and core unit tests in <code>packages/core</code>.</li>
<li class="">Persistence Agent: extend save schema and restore logic (resource-state export + worker snapshot/restore integration).</li>
<li class="">Event/Condition Trigger Agent: implement event subscriptions and condition evaluation trigger path.</li>
<li class="">Snapshot/Contract Agent: define and wire transform snapshot view into worker messages and shell bridge typings.</li>
<li class="">Content Authoring Agent: add minimal sample transform content and ensure compiler outputs are regenerated.</li>
<li class="">Docs Agent: update authoring guidance to include runtime semantics and limitations for transforms.</li>
<li class="">CI/Validation Agent: run <code>pnpm lint</code>, <code>pnpm test</code>, and <code>pnpm coverage:md</code> when coverage-affecting changes land; keep Vitest JSON summary intact.</li>
</ul>
</li>
<li class=""><strong>Affected Packages/Services</strong>:<!-- -->
<ul>
<li class=""><code>packages/core</code> (new system, commands, persistence types, snapshot builder, tests)</li>
<li class=""><code>packages/shell-web</code> (worker state envelope, session snapshot/restore integration)</li>
<li class=""><code>packages/content-schema</code> (no schema changes expected; referenced for contracts)</li>
<li class=""><code>packages/content-sample</code> (optional: add authored transforms to validate end-to-end usage)</li>
<li class=""><code>docs/</code> (this design + authoring semantics updates)</li>
</ul>
</li>
<li class=""><strong>Compatibility Considerations</strong>:<!-- -->
<ul>
<li class="">Additive command types and additive snapshot fields are backward compatible when gated by consumer capability checks.</li>
<li class="">Save format is extended additively (new optional <code>transformState</code> field) to preserve compatibility with existing saves; restore must tolerate absence.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class="">Transform definitions exist, but are inert at runtime:<!-- -->
<ul>
<li class="">Schema: <code>packages/content-schema/src/modules/transforms.ts:97</code> defines <code>mode</code>, <code>trigger</code>, <code>duration</code>, <code>cooldown</code>, and <code>safety</code>.</li>
<li class="">Validation: pack cross-reference checks include transforms (<code>packages/content-schema/src/pack.ts:1352</code>) and cycles (<code>packages/content-schema/src/pack.ts:1633</code>).</li>
<li class="">Compiler: transforms are carried through into the normalized pack (<code>packages/content-compiler/src/runtime.ts:57</code>).</li>
</ul>
</li>
<li class="">Runtime execution infrastructure exists but does not include transforms:<!-- -->
<ul>
<li class="">Commands: no transform-related command identifiers exist (<code>packages/core/src/command.ts:107</code>).</li>
<li class="">Systems: runtime ticks systems after dispatching command-produced events (<code>packages/core/src/index.ts:365</code>), suitable for event-driven triggers.</li>
<li class="">Conditions: shared <code>ConditionContext</code> exists for unlock/visibility and trigger evaluation (<code>packages/core/src/condition-evaluator.ts:39</code>), exposed by progression coordinator (<code>packages/core/src/progression-coordinator.ts:1226</code>).</li>
<li class="">Persistence: resource save payload currently optionally embeds <code>automationState</code> only (<code>packages/core/src/resource-state.ts:124</code>); shell worker persists automation state but nothing for transforms (<code>packages/shell-web/src/runtime.worker.ts:939</code>).</li>
</ul>
</li>
<li class="">Shell-web state channel does not surface transforms:<!-- -->
<ul>
<li class="">Worker emits <code>STATE_UPDATE</code> with progression snapshot only (<code>packages/shell-web/src/runtime.worker.ts:317</code>), preventing shells from rendering transforms or issuing deterministic transform commands.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ul>
<li class=""><strong>Narrative</strong>:<!-- -->
<ul>
<li class="">Implement issue-523 by adding a deterministic <code>TransformSystem</code> to <code>packages/core</code> that owns transform runtime execution and state.</li>
<li class="">Add a new runtime command (provisionally <code>RUN_TRANSFORM</code>) for manual invocation. Command handlers call into <code>TransformSystem</code> so command ordering remains authoritative relative to other commands in the same tick (<code>packages/core/src/index.ts:318</code>).</li>
<li class="">Support at least one non-manual trigger path for issue-523:<!-- -->
<ul>
<li class=""><strong>Event triggers</strong>: <code>TransformSystem.setup()</code> subscribes to relevant runtime events and records pending triggers, then executes transforms in <code>tick()</code>.</li>
<li class=""><strong>Condition triggers</strong>: <code>TransformSystem.tick()</code> evaluates transform conditions via <code>evaluateCondition</code> against the shared <code>ConditionContext</code>.</li>
</ul>
</li>
<li class=""><code>TransformSystem</code> enforces safety guards deterministically per tick and persists its state (including batch queues) via additive save fields.</li>
</ul>
</li>
<li class=""><strong>Diagram</strong>:<!-- -->
<ul>
<li class="">TODO (Docs Agent): add a small diagram (Mermaid or SVG) showing command → dispatcher → transform system → resource state and event bus trigger flow.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Runtime Changes</strong>:</p>
<ul>
<li class="">Add <code>packages/core/src/transform-system.ts</code> exporting:<!-- -->
<ul>
<li class=""><code>createTransformSystem(options)</code> returning a <code>System</code> plus <code>getState()</code> / <code>restoreState()</code> and a <code>runManualTransform()</code> method used by command handlers.</li>
<li class=""><code>TransformState</code> (mutable internal) and <code>SerializedTransformState</code> (JSON-safe, step-based scheduling fields).</li>
<li class="">Batch queue entries (e.g., <code>TransformBatchState</code>) for <code>mode === &#x27;batch&#x27;</code>.</li>
</ul>
</li>
<li class="">Transform execution order and determinism:<!-- -->
<ul>
<li class="">Transform evaluation/execution order in <code>tick()</code> is stable: sort by <code>(order ?? 0, id)</code> using the transform definitions from the normalized pack (<code>packages/content-schema/src/modules/transforms.ts:69</code>).</li>
<li class="">Pending event triggers are coalesced per transform per tick (boolean pending via <code>Set&lt;transformId&gt;</code>), matching the AutomationSystem pattern (see Section 13.2 for rationale).</li>
</ul>
</li>
<li class="">Trigger semantics (issue-523):<!-- -->
<ul>
<li class=""><code>manual</code>: executed only via <code>RUN_TRANSFORM</code> command handler; validates that <code>trigger.kind === &#x27;manual&#x27;</code>.</li>
<li class=""><code>condition</code>: evaluated each tick; when true and transform is unlocked and not in cooldown, attempt one run (subject to safety).</li>
<li class=""><code>event</code>: when a subscribed event is received, mark transform as pending; <code>tick()</code> attempts one run per pending transform per tick (subject to safety), preserving pending state when the run is blocked (locked/cooldown/insufficient inputs/safety).</li>
<li class=""><code>automation</code>: <strong>Deferred to follow-up work</strong> (see Section 13.3). Not in scope for issue-523; requires new <code>automation:fired</code> event infrastructure.</li>
</ul>
</li>
<li class="">Mode semantics (issue-523 “schedule output application according to mode”):<!-- -->
<ul>
<li class=""><code>instant</code>:<!-- -->
<ul>
<li class="">Evaluate inputs/outputs formulas (see “Formulas &amp; Evaluation Context” below).</li>
<li class="">Atomically spend all inputs; if any input is unaffordable, fail without applying cooldown.</li>
<li class="">Apply outputs immediately (same command execution for manual; same tick for system-triggered runs).</li>
</ul>
</li>
<li class=""><code>batch</code>:<!-- -->
<ul>
<li class="">On trigger, atomically spend inputs, then schedule outputs for delivery at <code>completeAtStep = currentStep + ceil(durationMs / stepDurationMs)</code>.</li>
<li class="">Enforce <code>safety.maxOutstandingBatches</code> at scheduling time; reject/skip new batches when at cap.</li>
<li class="">On <code>tick()</code>, deliver outputs for due batches deterministically in FIFO order (ties broken by schedule time then id).</li>
</ul>
</li>
<li class=""><code>continuous</code> (see Section 13.1 for rationale):<!-- -->
<ul>
<li class="">Amounts are <strong>per-second rates</strong>: <code>amountThisTick = formula * deltaSeconds</code>.</li>
<li class="">Each tick while trigger is active: evaluate input/output formulas as rates, multiply by <code>deltaSeconds</code>, attempt spend/produce cycle.</li>
<li class="">If <code>duration</code> is undefined: continuous transform remains active while trigger condition is true.</li>
<li class="">If <code>duration</code> is specified: continuous transform remains active for <code>durationMs</code> after trigger activation, even if trigger becomes false.</li>
<li class="">Fractional amounts accumulate across ticks using ProductionSystem-style accumulators to prevent integer truncation.</li>
<li class="">Cooldown applies after each successful spend/produce cycle, not after duration expiration.</li>
<li class="">Subject to <code>maxRunsPerTick</code> safety cap per tick.</li>
</ul>
</li>
</ul>
</li>
<li class="">Formulas &amp; evaluation context:<!-- -->
<ul>
<li class="">Transform formulas (<code>inputs[].amount</code>, <code>outputs[].amount</code>, <code>duration</code>, <code>cooldown</code>) use a <code>FormulaEvaluationContext</code> consistent with existing runtime patterns:<!-- -->
<ul>
<li class="">Prefer reusing <code>ProgressionCoordinator.createFormulaEvaluationContext</code> (<code>packages/core/src/progression-coordinator.ts:1459</code>) or <code>createAutomationFormulaEvaluationContext</code> (<code>packages/core/src/automation-system.ts:46</code>) as the baseline (level=0, time/deltaTime from <code>step</code>/<code>stepDurationMs</code>, entities backed by <code>ConditionContext</code>).</li>
</ul>
</li>
<li class="">Guardrails:<!-- -->
<ul>
<li class="">Non-finite evaluations (<code>NaN</code>, <code>±Infinity</code>) invalidate the run (no spend, no outputs, no cooldown), with deterministic telemetry/error codes.</li>
<li class="">Negative evaluations are clamped to <code>0</code> for costs/outputs/durations/cooldowns (consistent with automation resourceCost handling).</li>
<li class="">Evaluate and normalize all input costs before spending; spend in a deterministic order to preserve atomicity and replay stability.</li>
</ul>
</li>
</ul>
</li>
<li class="">Unlock/visibility state:<!-- -->
<ul>
<li class=""><code>unlockCondition</code> (optional): evaluate via <code>evaluateCondition</code> (<code>packages/core/src/condition-evaluator.ts:122</code>) and apply <strong>monotonically</strong> (once unlocked, stay unlocked) to avoid regressions during replay and to match automation unlock persistence patterns.</li>
<li class=""><code>visibilityCondition</code> (optional): evaluate per tick to compute <code>isVisible</code> (default <code>true</code> when undefined, consistent with progression coordinator visibility semantics at <code>packages/core/src/progression-coordinator.ts:1455</code>).</li>
<li class="">Execution gating: <code>unlockCondition</code> gates execution; <code>visibilityCondition</code> gates snapshot/UI only.</li>
</ul>
</li>
<li class="">Safety enforcement (see Section 13.4 for rationale):<!-- -->
<ul>
<li class=""><code>maxRunsPerTick</code>: default <code>10</code>, hard cap <code>100</code>. When undefined, use <code>DEFAULT_MAX_RUNS_PER_TICK = 10</code>. When authored value exceeds cap, clamp and record telemetry warning.</li>
<li class=""><code>maxOutstandingBatches</code>: default <code>50</code>, hard cap <code>1,000</code>. Enforced only for <code>batch</code> mode; reject new batches when at cap.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Data &amp; Schemas</strong>:</p>
<ul>
<li class="">Add a new serialized transform state payload and embed it additively into the save payload:<!-- -->
<ul>
<li class="">Extend <code>packages/core/src/resource-state.ts:124</code> with <code>transformState?: readonly SerializedTransformState[]</code>.</li>
<li class="">Keep <code>PERSISTENCE_SCHEMA_VERSION</code> unchanged if the field is optional and restoration is backward compatible; bump only if a breaking change is introduced.</li>
</ul>
</li>
<li class="">Serialized transform state (proposed):<!-- -->
<ul>
<li class=""><code>id: string</code></li>
<li class=""><code>unlocked: boolean</code></li>
<li class=""><code>cooldownExpiresStep: number</code></li>
<li class=""><code>pendingEvent?: boolean</code> (optional; not persisted if derived)</li>
<li class=""><code>batches?: readonly { completeAtStep: number; outputs: readonly { resourceId: string; amount: number }[] }[]</code></li>
<li class=""><code>continuous?: { enabled: boolean; activeUntilStep?: number }</code> (deferred until continuous semantics are confirmed)</li>
</ul>
</li>
<li class="">Step rebasing on restore:<!-- -->
<ul>
<li class="">Mirror the automation restore strategy (<code>packages/core/src/automation-system.ts:242</code>): adjust step-based fields by <code>(currentStep - savedWorkerStep)</code> so cooldowns and batch completions preserve relative time across restores (<code>packages/shell-web/src/runtime.worker.ts:836</code>).</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>APIs &amp; Contracts</strong>:</p>
<ul>
<li class="">Add command type and payload (issue-523 manual trigger):<!-- -->
<ul>
<li class=""><code>RUNTIME_COMMAND_TYPES.RUN_TRANSFORM = &#x27;RUN_TRANSFORM&#x27;</code> in <code>packages/core/src/command.ts:107</code>.</li>
<li class=""><code>RunTransformPayload = { transformId: string; runs?: number }</code> (runs default 1; capped by safety).</li>
<li class="">Authorization policy (see Section 13.5 for rationale): restrict to <code>[PLAYER, SYSTEM]</code> priorities; block <code>AUTOMATION</code>. Manual transforms are player-initiated; automatic transforms (event/condition triggers) bypass the command system.</li>
</ul>
</li>
<li class="">Add <code>registerTransformCommandHandlers({ dispatcher, transformSystem })</code> in <code>packages/core</code> mirroring <code>registerAutomationCommandHandlers</code> (<code>packages/core/src/automation-command-handlers.ts:27</code>).</li>
<li class="">Add a snapshot builder in <code>packages/core</code>:<!-- -->
<ul>
<li class=""><code>buildTransformSnapshot(step, publishedAt, { transforms, state, conditionContext, resourceState })</code> returning UI-ready transform views.</li>
<li class="">Transform view fields (proposed minimal contract):<!-- -->
<ul>
<li class=""><code>id</code>, <code>displayName</code>, <code>description</code>, <code>mode</code>, <code>isUnlocked</code>, <code>isVisible</code></li>
<li class=""><code>cooldownRemainingMs</code>, <code>inputs</code>, <code>outputs</code></li>
<li class=""><code>outstandingBatches</code> and <code>nextBatchReadyAtStep</code> (batch mode)</li>
</ul>
</li>
</ul>
</li>
<li class="">Wire into shell-web worker state updates (issue-523 snapshot view):<!-- -->
<ul>
<li class="">Extend <code>STATE_UPDATE.state</code> to include <code>transforms</code> alongside <code>progression</code> (<code>packages/shell-web/src/runtime.worker.ts:317</code>).</li>
<li class="">Extend session snapshot capture/restore to include transform state:<!-- -->
<ul>
<li class="">Capture: include transform state in <code>exportForSave</code> or as a sibling field (<code>packages/shell-web/src/runtime.worker.ts:939</code>).</li>
<li class="">Restore: call <code>transformSystem.restoreState(...)</code> if present (<code>packages/shell-web/src/runtime.worker.ts:835</code>).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Tooling &amp; Automation</strong>:</p>
<ul>
<li class="">Unit tests:<!-- -->
<ul>
<li class="">Add colocated <code>*.test.ts</code> under <code>packages/core/src/</code> covering: manual instant success/failure, cooldown behavior, <code>maxRunsPerTick</code>, and one additional trigger path (event or condition) per issue-523.</li>
</ul>
</li>
<li class="">Determinism discipline:<!-- -->
<ul>
<li class="">Avoid console noise in tests to preserve <code>vitest-llm-reporter</code> JSON summary output (repo guidelines in <code>AGENTS.md</code>).</li>
</ul>
</li>
<li class="">Coverage:<!-- -->
<ul>
<li class="">If tests meaningfully change workspace coverage, regenerate <code>docs/coverage/index.md</code> via <code>pnpm coverage:md</code> (do not edit manually).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>:<!-- -->
<ul>
<li class=""><code>packages/core</code> publishes additive APIs (system + command types). Shells must consume the new snapshot field and command(s) before transforms are usable end-to-end.</li>
<li class="">Roll out in phases with feature-gated UI exposure; core support can land first without enabling authored transforms in sample content.</li>
</ul>
</li>
<li class=""><strong>Telemetry &amp; Observability</strong>:<!-- -->
<ul>
<li class="">Add telemetry counters/errors for: invalid transform command payloads, unknown transform ids, insufficient resources, cooldown blocked, safety clamped, batch overflow.</li>
<li class="">Optionally publish runtime events for transform execution (e.g., <code>transform:executed</code>) as a follow-up, ensuring event catalogue updates remain deterministic (<code>packages/core/src/events/runtime-event-manifest.generated.ts:52</code>).</li>
</ul>
</li>
<li class=""><strong>Security &amp; Compliance</strong>:<!-- -->
<ul>
<li class="">No PII in transform state/snapshots. Persist only ids and numeric scheduling/amount data. Validate all command payloads defensively (pattern in <code>packages/core/src/automation-command-handlers.ts:52</code>).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<p>Populate the table as the canonical source for downstream GitHub issues.</p>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>docs: author runtime transform system design (issue-523)</code></td><td>Finalize this design doc and confirm open questions for issue-523 scope.</td><td>Docs Agent</td><td>None</td><td>Doc approved; defaults/semantics agreed; issue map accepted.</td></tr><tr><td><code>feat(core): add TransformSystem scaffolding + state (issue-523)</code></td><td>Create <code>TransformSystem</code> with unlock/visibility, cooldown fields, deterministic ordering, and APIs for execution.</td><td>Runtime Implementation Agent</td><td>Design approved</td><td><code>createTransformSystem</code> exists; state tracked; no regressions in core tests.</td></tr><tr><td><code>feat(core): add RUN_TRANSFORM command + handler (issue-523)</code></td><td>Add <code>RUN_TRANSFORM</code> to command catalog, payload typing, authorization policy, and handler that executes <code>instant</code> manual transforms atomically.</td><td>Runtime Implementation Agent</td><td>TransformSystem scaffold</td><td>Manual instant transform works end-to-end; invalid payloads fail with stable error codes; unit tests pass.</td></tr><tr><td><code>feat(core): implement trigger path (condition or event) (issue-523)</code></td><td>Implement at least one non-manual trigger path using <code>ConditionContext</code> and/or event subscriptions.</td><td>Event/Condition Trigger Agent</td><td>TransformSystem scaffold</td><td>At least one trigger path works; unit tests cover trigger activation + cooldown interaction.</td></tr><tr><td><code>feat(core): implement batch scheduling + maxOutstandingBatches (issue-523)</code></td><td>Add batch queue, duration scheduling, output delivery, and safety cap enforcement.</td><td>Runtime Implementation Agent</td><td>TransformSystem scaffold</td><td>Batch transforms schedule and deliver outputs deterministically; cap enforced; unit tests cover queue + cap.</td></tr><tr><td><code>feat(core): persist transform state + restore rebasing (issue-523)</code></td><td>Extend <code>SerializedResourceState</code> with <code>transformState</code>, export/import helpers, and step rebasing on restore.</td><td>Persistence Agent</td><td>Transform state defined</td><td>Save includes transform state; restore rebases steps correctly; integration test covers round-trip.</td></tr><tr><td><code>feat(shell-web): surface transform snapshot + save/restore wiring (issue-523)</code></td><td>Extend worker <code>STATE_UPDATE</code> to include transform snapshot and ensure session snapshot/restore includes transform state.</td><td>Snapshot/Contract Agent</td><td>Core snapshot API + persistence</td><td>Worker emits transforms snapshot; restore rehydrates state; existing worker tests updated and pass.</td></tr><tr><td><code>feat(content-sample): add minimal transforms exercising runtime (issue-523)</code></td><td>Add at least one transform to sample content to validate wiring; regenerate compiled artifacts.</td><td>Content Authoring Agent</td><td>Core support landed</td><td><code>pnpm generate</code> clean; sample pack includes transform; optional integration smoke test passes.</td></tr><tr><td><code>docs: update transform authoring guidance (issue-523)</code></td><td>Document runtime semantics (manual/event/condition, cooldown, batch scheduling, safety defaults).</td><td>Docs Agent</td><td>Core semantics finalized</td><td>Docs updated; references to code paths and limitations included.</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1</strong>: MVP for issue-523 acceptance criteria<!-- -->
<ul>
<li class="">Deliver <code>TransformSystem</code> + <code>RUN_TRANSFORM</code> for <code>instant</code> manual transforms, cooldown, <code>maxRunsPerTick</code>, and one additional trigger path (event or condition), with unit tests.</li>
<li class="">Gate: <code>pnpm test --filter @idle-engine/core</code> green; deterministic behavior verified via repeated runs.</li>
</ul>
</li>
<li class=""><strong>Phase 2</strong>: Batch mode and persistence/snapshot completeness<!-- -->
<ul>
<li class="">Deliver batch scheduling, <code>maxOutstandingBatches</code>, save/load of transform state, and shell worker snapshot wiring.</li>
<li class="">Gate: session snapshot/restore integration test green; no regressions in worker bridge.</li>
</ul>
</li>
<li class=""><strong>Phase 3</strong>: Continuous mode and automation-trigger support (if required to fully close issue-523)<!-- -->
<ul>
<li class="">Resolve semantics, implement continuous execution, and add automation trigger integration or explicitly split into a follow-up issue.</li>
<li class="">Gate: performance budget verified; additional tests for continuous determinism.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Hand-off Package</strong>:<!-- -->
<ul>
<li class="">Issue scope: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/523" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/523</a></li>
<li class="">Contracts: <code>packages/content-schema/src/modules/transforms.ts:97</code>, <code>docs/content-dsl-schema-design.md:738</code></li>
<li class="">Runtime patterns: <code>packages/core/src/automation-system.ts:178</code>, <code>packages/core/src/index.ts:309</code>, <code>packages/core/src/resource-state.ts:124</code></li>
<li class="">Shell worker wiring: <code>packages/shell-web/src/runtime.worker.ts:194</code>, <code>packages/shell-web/src/runtime.worker.ts:939</code></li>
</ul>
</li>
<li class=""><strong>Communication Cadence</strong>:<!-- -->
<ul>
<li class="">Daily status updates on issue-523 with: completed issues, failing tests, and next agent assignment.</li>
<li class="">Review checkpoints at end of each phase; do not begin the next phase until reviewers sign off on the prior phase’s acceptance criteria.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class=""><strong>Context Packets</strong>:<!-- -->
<ul>
<li class="">Read: <code>docs/content-dsl-schema-design.md:738</code> (transform schema intent), <code>docs/content-dsl-usage-guidelines.md:288</code> (cycle/safety notes), and issue-523 body.</li>
<li class="">Load code context: <code>packages/content-schema/src/modules/transforms.ts</code>, <code>packages/core/src/automation-system.ts</code>, <code>packages/core/src/resource-state.ts</code>, <code>packages/core/src/events/runtime-event-catalog.ts</code>, <code>packages/shell-web/src/runtime.worker.ts</code>.</li>
</ul>
</li>
<li class=""><strong>Prompting &amp; Constraints</strong>:<!-- -->
<ul>
<li class="">Canonical implementation prompt (Runtime Implementation Agent):<!-- -->
<ul>
<li class="">“Implement issue-523 by adding <code>TransformSystem</code> and <code>RUN_TRANSFORM</code> support in <code>packages/core</code>. Follow existing automation patterns for determinism, defensive validation, and persistence. Keep changes minimal, add colocated Vitest tests, and avoid console output.”</li>
</ul>
</li>
<li class="">Canonical integration prompt (Shell Agent):<!-- -->
<ul>
<li class="">“Extend worker <code>STATE_UPDATE</code> to include transform snapshot data and ensure session snapshot/restore persists transform state. Maintain backwards compatibility with older snapshots.”</li>
</ul>
</li>
<li class="">Repo constraints:<!-- -->
<ul>
<li class="">Use type-only imports/exports (<code>@typescript-eslint/consistent-type-imports/exports</code> is enforced).</li>
<li class="">Do not edit checked-in <code>dist/</code> outputs by hand; regenerate via workspace scripts if required.</li>
</ul>
</li>
</ul>
</li>
<li class=""><strong>Safety Rails</strong>:<!-- -->
<ul>
<li class="">Do not reset git history, rewrite tags, or modify unrelated packages.</li>
<li class="">Avoid adding non-deterministic sources (Date.now in core logic); use runtime <code>step</code>/<code>timestamp</code> only when explicitly required.</li>
<li class="">Treat event-trigger backlogs defensively (coalesce by default) to avoid unbounded memory growth.</li>
</ul>
</li>
<li class=""><strong>Validation Hooks</strong>:<!-- -->
<ul>
<li class=""><code>pnpm lint</code></li>
<li class=""><code>pnpm test --filter @idle-engine/core</code></li>
<li class=""><code>pnpm test --filter shell-web</code> (when worker contracts change)</li>
<li class=""><code>pnpm coverage:md</code> (only when coverage-affecting tests/code land; commit <code>docs/coverage/index.md</code>)</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ul>
<li class=""><strong>Shell-only transforms</strong>:<!-- -->
<ul>
<li class="">Rejected: violates the deterministic-core architecture and fragments authored mechanics across shells; contradicts issue-523 goal.</li>
</ul>
</li>
<li class=""><strong>Model transforms as generators (reuse ProductionSystem)</strong>:<!-- -->
<ul>
<li class="">Pros: continuous transforms become “rates” naturally; can reuse accumulation and scaling.</li>
<li class="">Cons: awkward mapping for <code>instant</code> and <code>batch</code> semantics; introduces coupling and potentially leaks generator assumptions into transforms. Keep as a potential implementation strategy for <code>continuous</code> only.</li>
</ul>
</li>
<li class=""><strong>Execute transforms exclusively via commands (no system)</strong>:<!-- -->
<ul>
<li class="">Pros: preserves command ordering and simplifies determinism.</li>
<li class="">Cons: cannot naturally support event/condition triggers without synthesizing commands; batch delivery requires scheduled command emission anyway. A system remains the clearest owner for scheduled/batched work.</li>
</ul>
</li>
<li class=""><strong>Evaluate batch outputs at completion instead of start</strong>:<!-- -->
<ul>
<li class="">Pros: allows outputs to reflect late-bound state changes.</li>
<li class="">Cons: makes player-facing previews harder and complicates deterministic save/restore (requires re-evaluating formulas at completion). Prefer evaluating and freezing outputs at scheduling time for issue-523.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Unit / Integration</strong>:<!-- -->
<ul>
<li class=""><code>packages/core/src/transform-system.test.ts</code> (new): manual instant run success/failure, cooldown behavior, <code>maxRunsPerTick</code>, and one trigger path (<code>event</code> or <code>condition</code>) per issue-523.</li>
<li class=""><code>packages/shell-web/src/runtime.worker.test.ts</code> updates: assert <code>STATE_UPDATE</code> includes transform snapshot when enabled; session snapshot/restore round-trips transform state.</li>
</ul>
</li>
<li class=""><strong>Performance</strong>:<!-- -->
<ul>
<li class="">Add a targeted benchmark or test harness in <code>packages/core/benchmarks/</code> if transform evaluation becomes hot; validate no material regression versus baseline tick loop.</li>
</ul>
</li>
<li class=""><strong>Tooling / A11y</strong>:<!-- -->
<ul>
<li class="">No UI changes required for issue-523 MVP; if shell UI is extended to display transforms, run <code>pnpm test:a11y</code>.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Issue-523 scope drift (modes/triggers)</strong>:<!-- -->
<ul>
<li class="">Mitigation: gate implementation by Phase 1 acceptance criteria; split <code>continuous</code> and <code>automation</code> triggers into explicit follow-up issues if semantics are not confirmed.</li>
</ul>
</li>
<li class=""><strong>Ambiguous continuous semantics</strong>:<!-- -->
<ul>
<li class="">Mitigation: explicitly confirm continuous semantics before implementation (Open Questions); stage continuous as Phase 3 if needed.</li>
</ul>
</li>
<li class=""><strong>Event-trigger backlog growth</strong>:<!-- -->
<ul>
<li class="">Mitigation: coalesce event triggers per transform per tick; keep pending state on blocked runs; add hard cap if counts are later introduced.</li>
</ul>
</li>
<li class=""><strong>Non-atomic multi-resource spends</strong>:<!-- -->
<ul>
<li class="">Mitigation: precompute and validate all input costs before spending; spend in a deterministic order (sorted by resource id/index) and fail fast without partial application.</li>
</ul>
</li>
<li class=""><strong>Save/restore step drift</strong>:<!-- -->
<ul>
<li class="">Mitigation: rebase step-based fields using savedWorkerStep/currentStep (patterned after automation restore); add tests covering rebasing.</li>
</ul>
</li>
<li class=""><strong>Performance regression with many transforms</strong>:<!-- -->
<ul>
<li class="">Mitigation: evaluate unlock/visibility lazily for non-visible transforms; avoid recomputing quotes for hidden transforms; keep formula evaluation bounded.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Milestones</strong>:<!-- -->
<ul>
<li class="">Phase 1: land core scaffolding + manual instant + one extra trigger path + tests.</li>
<li class="">Phase 2: land batch + persistence + snapshot wiring to shell-web worker.</li>
<li class="">Phase 3: land continuous + automation trigger integration (or split as follow-up if not required to close issue-523).</li>
</ul>
</li>
<li class=""><strong>Migration Strategy</strong>:<!-- -->
<ul>
<li class="">Additive save field <code>transformState</code> only; restore tolerates absence; no migration required for existing saves.</li>
<li class="">If later changes require non-additive updates, bump <code>PERSISTENCE_SCHEMA_VERSION</code> and add migration transforms per <code>docs/persistence-migration-guide.md</code>.</li>
</ul>
</li>
<li class=""><strong>Communication</strong>:<!-- -->
<ul>
<li class="">Update issue-523 with phase completion notes and commands run.</li>
<li class="">Provide a short shell-web changelog entry when worker state envelope changes to ensure consumer alignment.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-resolved-design-decisions">13. Resolved Design Decisions<a href="#13-resolved-design-decisions" class="hash-link" aria-label="Direct link to 13. Resolved Design Decisions" title="Direct link to 13. Resolved Design Decisions" translate="no">​</a></h2>
<p>The following questions were researched against existing codebase patterns, schema definitions, and idle game best practices. Each resolution includes rationale and references.</p>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="131-continuous-mode-semantics-">13.1 Continuous Mode Semantics ✓<a href="#131-continuous-mode-semantics-" class="hash-link" aria-label="Direct link to 13.1 Continuous Mode Semantics ✓" title="Direct link to 13.1 Continuous Mode Semantics ✓" translate="no">​</a></h3>
<p><strong>Decision</strong>: For <code>continuous</code> transforms, <code>inputs/outputs[].amount</code> formulas evaluate to <strong>per-second rates</strong> (not per-tick amounts). The <code>duration</code> field, when specified, defines an <strong>active window</strong> in milliseconds.</p>
<p><strong>Rationale</strong>:</p>
<ul>
<li class="">The ProductionSystem establishes per-second rates as the engine standard (<code>packages/core/src/production-system.ts:83-92</code>): <code>production = rate * owned * multiplier * deltaSeconds * consumptionRatio</code>.</li>
<li class="">Formula evaluation context already provides <code>deltaTime</code> (seconds per step) for rate-to-amount conversion (<code>packages/core/src/automation-system.ts:46-99</code>).</li>
<li class="">Per-second rates enable consistent scaling across varying tick durations and support accumulator patterns for fractional amounts.</li>
</ul>
<p><strong>Implementation semantics</strong>:</p>
<ul>
<li class="">Each tick while trigger is active: <code>amountThisTick = formula * deltaSeconds</code>.</li>
<li class="">If <code>duration</code> is undefined: continuous transform remains active while trigger condition is true.</li>
<li class="">If <code>duration</code> is specified: continuous transform remains active for <code>durationMs</code> after trigger activation, even if trigger becomes false.</li>
<li class="">Cooldown applies after each successful run (spend + produce cycle), not after duration expiration.</li>
<li class="">Fractional amounts should accumulate across ticks (reuse ProductionSystem accumulator pattern) to prevent integer truncation.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="132-event-trigger-multiplicity-">13.2 Event Trigger Multiplicity ✓<a href="#132-event-trigger-multiplicity-" class="hash-link" aria-label="Direct link to 13.2 Event Trigger Multiplicity ✓" title="Direct link to 13.2 Event Trigger Multiplicity ✓" translate="no">​</a></h3>
<p><strong>Decision</strong>: Multiple events of the same type firing in one tick are <strong>coalesced</strong> to a single trigger activation per transform (boolean pending state, not counted).</p>
<p><strong>Rationale</strong>:</p>
<ul>
<li class="">The AutomationSystem establishes coalescing as the engine pattern (<code>packages/core/src/automation-system.ts:220, 307</code>): pending triggers are tracked via <code>Set&lt;string&gt;</code> (idempotent adds), not counted.</li>
<li class="">Coalescing prevents unbounded transform runs if many events fire in a burst.</li>
<li class="">Pending state is retained across ticks when execution is blocked (cooldown, insufficient resources), preventing event loss without counting.</li>
</ul>
<p><strong>Implementation semantics</strong>:</p>
<ul>
<li class=""><code>TransformSystem</code> maintains <code>pendingEventTriggers: Set&lt;transformId&gt;</code>.</li>
<li class="">Event subscription: <code>events.on(eventId, () =&gt; pendingEventTriggers.add(transformId))</code>.</li>
<li class=""><code>tick()</code> attempts one run per pending transform per tick (subject to safety caps).</li>
<li class="">On successful run: remove from pending set.</li>
<li class="">On blocked run (cooldown, resources, safety): retain in pending set for next tick.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="133-automation-trigger-support-">13.3 Automation Trigger Support ✓<a href="#133-automation-trigger-support-" class="hash-link" aria-label="Direct link to 13.3 Automation Trigger Support ✓" title="Direct link to 13.3 Automation Trigger Support ✓" translate="no">​</a></h3>
<p><strong>Decision</strong>: <code>trigger.kind === &#x27;automation&#x27;</code> is <strong>out of scope for issue-523</strong> and explicitly deferred to follow-up work.</p>
<p><strong>Rationale</strong>:</p>
<ul>
<li class="">The design document already lists this as a non-goal (line 43): &quot;Implementing transform-trigger integration with automation targets... is deferred unless explicitly pulled into scope.&quot;</li>
<li class="">Current infrastructure gap: no <code>automation:fired</code> event exists; only <code>automation:toggled</code> (which fires on enable/disable, not on automation execution).</li>
<li class="">Semantic ambiguity: content authors likely expect &quot;automation trigger&quot; to mean &quot;when automation fires,&quot; not &quot;when automation is toggled on.&quot;</li>
</ul>
<p><strong>Follow-up recommendation</strong>:</p>
<ul>
<li class="">Create new <code>automation:fired</code> event in event catalog (published from <code>AutomationSystem.tick()</code> when automation successfully executes).</li>
<li class="">Transform subscribes to <code>automation:fired</code> with payload filter for <code>automationId</code>.</li>
<li class="">This provides cleaner semantics than binding to toggle state.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="134-safety-defaults-and-caps-">13.4 Safety Defaults and Caps ✓<a href="#134-safety-defaults-and-caps-" class="hash-link" aria-label="Direct link to 13.4 Safety Defaults and Caps ✓" title="Direct link to 13.4 Safety Defaults and Caps ✓" translate="no">​</a></h3>
<p><strong>Decision</strong>: Canonical defaults and hard caps are established as follows:</p>
<table><thead><tr><th>Parameter</th><th>Default</th><th>Hard Cap</th><th>Rationale</th></tr></thead><tbody><tr><td><code>maxRunsPerTick</code></td><td><strong>10</strong></td><td><strong>100</strong></td><td>Matches condition depth cap (100); prevents runaway loops while allowing controlled cascades.</td></tr><tr><td><code>maxOutstandingBatches</code></td><td><strong>50</strong></td><td><strong>1,000</strong></td><td>Proportional to command queue cap (10,000); prevents memory exhaustion from queued batches.</td></tr></tbody></table>
<p><strong>Rationale</strong>:</p>
<ul>
<li class=""><code>MAX_CONDITION_DEPTH = 100</code> (<code>packages/core/src/condition-evaluator.ts:34</code>) establishes 100 as a safe recursion/iteration bound.</li>
<li class=""><code>DEFAULT_MAX_QUEUE_SIZE = 10_000</code> (<code>packages/core/src/command-queue.ts:27</code>) establishes queue overflow semantics.</li>
<li class="">Most idle games process 5-20 actions per tick; 10 is conservative for defaults while 100 allows intentional high-throughput designs.</li>
<li class="">Each outstanding batch stores <code>{ completeAtStep, outputs[] }</code>; 1,000 batches ≈ 50-100KB (negligible memory).</li>
</ul>
<p><strong>Implementation semantics</strong>:</p>
<ul>
<li class="">When <code>safety.maxRunsPerTick</code> is undefined: use <code>DEFAULT_MAX_RUNS_PER_TICK = 10</code>.</li>
<li class="">When authored value exceeds hard cap: clamp to <code>HARD_CAP_MAX_RUNS_PER_TICK = 100</code> and record telemetry warning.</li>
<li class="">Apply same pattern for <code>maxOutstandingBatches</code> with defaults 50/1000.</li>
<li class="">Non-finite or non-positive authored values fall back to defaults.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="135-command-authorization-">13.5 Command Authorization ✓<a href="#135-command-authorization-" class="hash-link" aria-label="Direct link to 13.5 Command Authorization ✓" title="Direct link to 13.5 Command Authorization ✓" translate="no">​</a></h3>
<p><strong>Decision</strong>: <code>RUN_TRANSFORM</code> is restricted to <strong><code>[PLAYER, SYSTEM]</code></strong> priorities. <code>AUTOMATION</code> priority is blocked.</p>
<p><strong>Rationale</strong>:</p>
<ul>
<li class="">Manual transforms (via <code>RUN_TRANSFORM</code>) are player-initiated or system-driven, matching the <code>PRESTIGE_RESET</code> pattern (<code>packages/core/src/command.ts:275-281</code>).</li>
<li class="">Automatic transforms (event/condition triggers) execute within <code>TransformSystem.tick()</code>, bypassing the command system entirely—no priority gating needed.</li>
<li class="">Future automation-triggered transforms (if implemented) would use a separate trigger path (not routed through <code>RUN_TRANSFORM</code>), keeping concerns separated.</li>
</ul>
<p><strong>Implementation semantics</strong>:</p>
<div class="language-typescript codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-typescript codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">RUN_TRANSFORM</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">RUNTIME_COMMAND_TYPES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RUN_TRANSFORM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowedPriorities</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">freeze</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CommandPriority</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SYSTEM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CommandPriority</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PLAYER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rationale</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Manual transforms are player-initiated or system-driven; automation trigger path is implemented separately.&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unauthorizedEvent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UnauthorizedTransformCommand&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="136-remaining-follow-up-items">13.6 Remaining Follow-Up Items<a href="#136-remaining-follow-up-items" class="hash-link" aria-label="Direct link to 13.6 Remaining Follow-Up Items" title="Direct link to 13.6 Remaining Follow-Up Items" translate="no">​</a></h3>
<p>No unresolved questions remain for issue-523 MVP scope. The following items are tracked as explicit follow-up work:</p>
<ol>
<li class=""><strong>Automation trigger implementation</strong>: Create <code>automation:fired</code> event and wire transform subscription (see Section 13.3).</li>
<li class=""><strong>Continuous mode accumulator pattern</strong>: Confirm whether to reuse ProductionSystem&#x27;s accumulator or implement transform-specific fractional handling.</li>
<li class=""><strong>Transform execution events</strong>: Consider publishing <code>transform:executed</code> events for observability (requires event manifest update).</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Implement <code>trigger.kind === &#x27;automation&#x27;</code> support once semantics are confirmed (new issue derived from issue-523).</li>
<li class="">Implement/confirm <code>continuous</code> mode behavior and add dedicated tests/benchmarks (new issue if split).</li>
<li class="">Add optional runtime events for transform execution and wire into event manifest tooling (requires manifest regeneration and schema updates).</li>
<li class="">Build shell-web UI surfaces for transforms (panel, affordance/disabled states, cooldown timers).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class="">GitHub issue #523: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/523" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/523</a></li>
<li class="">Transform schema: <code>packages/content-schema/src/modules/transforms.ts:97</code></li>
<li class="">Transform validation + cycles: <code>packages/content-schema/src/pack.ts:1633</code></li>
<li class="">Runtime tick ordering: <code>packages/core/src/index.ts:309</code></li>
<li class="">Condition evaluation context: <code>packages/core/src/condition-evaluator.ts:39</code></li>
<li class="">Event catalogue / channels: <code>packages/core/src/events/runtime-event-catalog.ts:61</code></li>
<li class="">Worker runtime wiring + state update: <code>packages/shell-web/src/runtime.worker.ts:194</code></li>
<li class="">Worker snapshot capture (automation only today): <code>packages/shell-web/src/runtime.worker.ts:939</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Transform (issue-523)</strong>: A content-authored conversion that spends input resources and produces output resources under a trigger and mode (<code>packages/content-schema/src/modules/transforms.ts:97</code>).</li>
<li class=""><strong>Mode</strong>: Execution style of a transform: <code>instant</code> (immediate), <code>batch</code> (delayed completion), <code>continuous</code> (repeating per tick or rate-based; semantics TBD).</li>
<li class=""><strong>Trigger</strong>: Activation mechanism for a transform: <code>manual</code>, <code>condition</code>, <code>event</code>, <code>automation</code> (<code>packages/content-schema/src/modules/transforms.ts:115</code>).</li>
<li class=""><strong>Cooldown</strong>: Minimum time between successful transform starts; computed deterministically in steps from a <code>NumericFormula</code>.</li>
<li class=""><strong>Outstanding batch</strong>: A queued batch transform instance waiting to deliver outputs at a scheduled future step.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-12-16</td><td>Idle Engine Design-Authoring Agent (AI)</td><td>Initial draft for issue-523: TransformSystem, commands, triggers, persistence, snapshot plan.</td></tr><tr><td>2025-12-16</td><td>Claude Code (AI)</td><td>Resolved all 5 open questions with codebase research: continuous mode semantics (per-second rates), event coalescing (Set-based), automation triggers (deferred), safety caps (10/100, 50/1000), command auth (PLAYER+SYSTEM only). Updated Section 13 with rationale and implementation semantics.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/runtime-transform-system-design-issue-523.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-resolved-design-decisions" class="table-of-contents__link toc-highlight">13. Resolved Design Decisions</a><ul><li><a href="#131-continuous-mode-semantics-" class="table-of-contents__link toc-highlight">13.1 Continuous Mode Semantics ✓</a></li><li><a href="#132-event-trigger-multiplicity-" class="table-of-contents__link toc-highlight">13.2 Event Trigger Multiplicity ✓</a></li><li><a href="#133-automation-trigger-support-" class="table-of-contents__link toc-highlight">13.3 Automation Trigger Support ✓</a></li><li><a href="#134-safety-defaults-and-caps-" class="table-of-contents__link toc-highlight">13.4 Safety Defaults and Caps ✓</a></li><li><a href="#135-command-authorization-" class="table-of-contents__link toc-highlight">13.5 Command Authorization ✓</a></li><li><a href="#136-remaining-follow-up-items" class="table-of-contents__link toc-highlight">13.6 Remaining Follow-Up Items</a></li></ul></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>