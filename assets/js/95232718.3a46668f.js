"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[1870],{7678:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(9430);const d={},r=i.createContext(d);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},8712:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"issue-810-design","title":"shell-desktop \u2014 Bundle renderer deps (issue-810)","description":"Document Control","source":"@site/../../docs/issue-810-design.md","sourceDirName":".","slug":"/issue-810-design","permalink":"/Idle-Game-Engine/issue-810-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-810-design.md","tags":[],"version":"current","sidebarPosition":99,"frontMatter":{"title":"shell-desktop \u2014 Bundle renderer deps (issue-810)","sidebar_position":99}}');var d=s(5270),r=s(7678);const l={title:"shell-desktop \u2014 Bundle renderer deps (issue-810)",sidebar_position:99},t="shell-desktop \u2014 Bundle renderer deps (issue-810)",c={},o=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"Background",id:"background",level:3},{value:"Problem",id:"problem",level:3},{value:"Forces",id:"forces",level:3},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"Goals",id:"goals",level:3},{value:"Non-Goals",id:"non-goals",level:3},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"Primary Stakeholders",id:"primary-stakeholders",level:3},{value:"Agent Roles",id:"agent-roles",level:3},{value:"Affected Packages/Services",id:"affected-packagesservices",level:3},{value:"Compatibility Considerations",id:"compatibility-considerations",level:3},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"Runtime Changes",id:"runtime-changes",level:4},{value:"Data &amp; Schemas",id:"data--schemas",level:4},{value:"APIs &amp; Contracts",id:"apis--contracts",level:4},{value:"Tooling &amp; Automation",id:"tooling--automation",level:4},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"Deployment",id:"deployment",level:4},{value:"Telemetry &amp; Observability",id:"telemetry--observability",level:4},{value:"Security &amp; Compliance",id:"security--compliance",level:4},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"shell-desktop--bundle-renderer-deps-issue-810",children:"shell-desktop \u2014 Bundle renderer deps (issue-810)"})}),"\n",(0,d.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Title"}),": Bundle ",(0,d.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," renderer dependencies (avoid ",(0,d.jsx)(n.code,{children:"dist/"}),"-relative imports)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Authors"}),": Ralph (AI agent)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Reviewers"}),": Jordan Hans (hansjm10), Desktop Shell Maintainers"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-24"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Related Issues"}),": ",(0,d.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/810",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/810"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," renderer currently imports sibling workspace packages via deep relative paths that point into checked-in ",(0,d.jsx)(n.code,{children:"dist/"})," outputs (for example ",(0,d.jsx)(n.code,{children:"../../../renderer-webgpu/dist/index.js"}),"). This works in-repo but is brittle for packaging (it assumes a monorepo directory layout at runtime) and makes it easy to accidentally run against stale builds. This design bundles the renderer entrypoint into a self-contained ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," (plus optional sourcemap), so the desktop renderer no longer relies on ",(0,d.jsx)(n.code,{children:"../../../*/dist/*"})," imports while keeping dev and packaged builds working."]}),"\n",(0,d.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,d.jsx)(n.h3,{id:"background",children:"Background"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["The Electron main process loads ",(0,d.jsx)(n.code,{children:"dist/renderer/index.html"}),", which in turn loads ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," as an ES module."]}),"\n",(0,d.jsxs)(n.li,{children:["The renderer TS entrypoint is ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Today, that entrypoint imports renderer dependencies via deep relative paths into sibling package ",(0,d.jsx)(n.code,{children:"dist/"})," directories:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})," imports ",(0,d.jsx)(n.code,{children:"../../../renderer-contract/dist/index.js"})," and ",(0,d.jsx)(n.code,{children:"../../../renderer-webgpu/dist/index.js"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Packaging brittleness"}),": The runtime file layout for packaged Electron apps typically does not preserve monorepo sibling directories, so ",(0,d.jsx)(n.code,{children:"../../../renderer-webgpu/dist/index.js"})," is likely to break when the app is packaged or moved."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Stale dependency risk"}),": Because imports point directly at checked-in ",(0,d.jsx)(n.code,{children:"dist/"})," outputs, it is easy to run with stale compiled JS when upstream packages change but are not rebuilt."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"forces",children:"Forces"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"CSP"}),": ",(0,d.jsx)(n.code,{children:"index.html"})," uses ",(0,d.jsx)(n.code,{children:"script-src 'self'"}),"; the solution must keep scripts as local files (no remote fetching, no inline script injection)."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Keep current runtime shape"}),": ",(0,d.jsx)(n.code,{children:"main.ts"})," expects the renderer files at ",(0,d.jsx)(n.code,{children:"dist/renderer/*"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Minimal churn"}),": Prefer a targeted build pipeline change over a broad refactor of renderer packages."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,d.jsx)(n.h3,{id:"goals",children:"Goals"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Remove ",(0,d.jsx)(n.code,{children:"../../../*/dist/*"})," relative imports from the built renderer JS."]}),"\n",(0,d.jsxs)(n.li,{children:["Keep ",(0,d.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop run start"})," working for local development."]}),"\n",(0,d.jsx)(n.li,{children:"Ensure packaged builds can load the renderer without depending on a monorepo directory layout."}),"\n",(0,d.jsx)(n.li,{children:"Keep the renderer code deterministic and browser-compatible (no Node-only imports in the bundled output)."}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"non-goals",children:"Non-Goals"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Introducing a full Electron packaging pipeline (e.g., electron-builder) if it does not already exist."}),"\n",(0,d.jsxs)(n.li,{children:["Refactoring ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," or ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-contract"})," public APIs."]}),"\n",(0,d.jsx)(n.li,{children:"Changing renderer feature behavior (input handling, IPC wiring, WebGPU rendering)."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,d.jsx)(n.h3,{id:"primary-stakeholders",children:"Primary Stakeholders"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Desktop shell maintainers (Electron app)"}),"\n",(0,d.jsxs)(n.li,{children:["Renderer maintainers (",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"}),", ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-contract"}),")"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"agent-roles",children:"Agent Roles"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Docs Agent"}),": Maintain this design doc and follow-up docs if build steps change."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Runtime Implementation Agent"}),": Implement the bundling pipeline and update imports/tests."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Validation Agent"}),": Add/adjust CI checks and tests to prevent regressions."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"affected-packagesservices",children:"Affected Packages/Services"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"packages/shell-desktop"})," (renderer build and tests)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"packages/renderer-webgpu"})," (consumed by bundle)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"packages/renderer-contract"})," (consumed by bundle)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"tools/scripts/*"})," (optional: new bundling script)"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"compatibility-considerations",children:"Compatibility Considerations"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"The renderer output must remain compatible with Electron\u2019s renderer runtime (Chromium) and the existing CSP."}),"\n",(0,d.jsxs)(n.li,{children:["The Electron main/preload code should not need to change its URL/path assumptions for ",(0,d.jsx)(n.code,{children:"dist/renderer"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Renderer assets are served from ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/dist/renderer/"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Static assets are copied by ",(0,d.jsx)(n.code,{children:"tools/scripts/copy-renderer-assets.mjs"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["TypeScript emits ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," via ",(0,d.jsx)(n.code,{children:"tsc -p packages/shell-desktop/tsconfig.json"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})," imports sibling packages via deep relative paths into their ",(0,d.jsx)(n.code,{children:"dist/"})," folders, and ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})," mocks the same deep relative import."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,d.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,d.jsxs)(n.p,{children:["Bundle the renderer entrypoint (",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"}),") into a self-contained JS artifact located at ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/dist/renderer/index.js"}),". The bundle inlines (or otherwise localizes) dependencies like ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," and ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-contract"}),", removing the need for any runtime imports that traverse outside ",(0,d.jsx)(n.code,{children:"dist/renderer/"}),"."]}),"\n",(0,d.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,d.jsx)(n.h4,{id:"runtime-changes",children:"Runtime Changes"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["No runtime behavior changes are intended; the renderer continues to:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Use ",(0,d.jsx)(n.code,{children:"window.idleEngine"})," (from preload) for IPC."]}),"\n",(0,d.jsxs)(n.li,{children:["Render via ",(0,d.jsx)(n.code,{children:"createWebGpuRenderer"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Consume ",(0,d.jsx)(n.code,{children:"RenderCommandBuffer"})," frames and display status."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"data--schemas",children:"Data & Schemas"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"No schema changes."}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"apis--contracts",children:"APIs & Contracts"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Replace deep relative imports in ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})," with package imports:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"@idle-engine/renderer-contract"})}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["The bundler resolves those imports at build time and produces a browser-resolvable output (no bare specifiers in the final ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"}),")."]}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"tooling--automation",children:"Tooling & Automation"}),"\n",(0,d.jsxs)(n.p,{children:["Add a renderer bundling step to ",(0,d.jsx)(n.code,{children:"@idle-engine/shell-desktop"}),"\u2019s build:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Recommended"}),": ",(0,d.jsx)(n.code,{children:"esbuild"})," bundle invoked from a small Node script (either in ",(0,d.jsx)(n.code,{children:"tools/scripts/"})," or ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/scripts/"}),").","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Entry: ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["Output: ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/dist/renderer/index.js"})]}),"\n",(0,d.jsxs)(n.li,{children:["Settings: ",(0,d.jsx)(n.code,{children:"platform: 'browser'"}),", ",(0,d.jsx)(n.code,{children:"format: 'esm'"}),", ",(0,d.jsx)(n.code,{children:"bundle: true"}),", ",(0,d.jsx)(n.code,{children:"target: 'es2022'"})," (or the repo\u2019s standard target)"]}),"\n",(0,d.jsx)(n.li,{children:"Optional: generate sourcemaps in dev builds only."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Update ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/package.json"})," build script to run bundling after ",(0,d.jsx)(n.code,{children:"tsc"}),", and keep ",(0,d.jsx)(n.code,{children:"copy-renderer-assets.mjs"})," for ",(0,d.jsx)(n.code,{children:".html"}),"/",(0,d.jsx)(n.code,{children:".css"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Update ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})," mocks to match the new import paths (mock ",(0,d.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," instead of a deep relative ",(0,d.jsx)(n.code,{children:"dist/"})," import)."]}),"\n",(0,d.jsxs)(n.li,{children:["Add a small validation check (test or build-time assertion) that the bundled output does not contain ",(0,d.jsx)(n.code,{children:"../../../renderer-*/dist/"})," paths."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,d.jsx)(n.h4,{id:"deployment",children:"Deployment"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["No runtime deployment changes beyond producing a different ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," artifact."]}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"telemetry--observability",children:"Telemetry & Observability"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"No changes. (Optional follow-up: add a renderer \u201cbundle version\u201d string to status output for easier diagnostics.)"}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"security--compliance",children:"Security & Compliance"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Ensure bundling does not introduce CSP violations (no inline script, no remote fetches, avoid ",(0,d.jsx)(n.code,{children:"eval"}),"-based sourcemaps)."]}),"\n",(0,d.jsx)(n.li,{children:"Keep dependency surface small: bundle only what the renderer needs."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,d.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Issue Title"}),(0,d.jsx)(n.th,{children:"Scope Summary"}),(0,d.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,d.jsx)(n.th,{children:"Dependencies"}),(0,d.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"feat(shell-desktop): bundle renderer deps"}),(0,d.jsxs)(n.td,{children:["Add bundler step producing ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," and remove deep relative imports"]}),(0,d.jsx)(n.td,{children:"Runtime Implementation Agent"}),(0,d.jsx)(n.td,{children:"Design doc approved"}),(0,d.jsxs)(n.td,{children:["Renderer output has no ",(0,d.jsx)(n.code,{children:"../../../*/dist/*"})," imports; ",(0,d.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop run start"})," works"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"test(shell-desktop): update renderer mocks"}),(0,d.jsxs)(n.td,{children:["Update ",(0,d.jsx)(n.code,{children:"src/renderer/index.test.ts"})," to mock package imports and add regression check on bundle output"]}),(0,d.jsx)(n.td,{children:"Validation Agent"}),(0,d.jsx)(n.td,{children:"Bundler in place"}),(0,d.jsx)(n.td,{children:"Tests pass; bundle output assertion passes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"chore(shell-desktop): document build steps"}),(0,d.jsx)(n.td,{children:"Update package README/docs with how to build renderer bundle"}),(0,d.jsx)(n.td,{children:"Docs Agent"}),(0,d.jsx)(n.td,{children:"Bundler in place"}),(0,d.jsx)(n.td,{children:"Docs mention new build artifacts and troubleshooting"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Phase 1"}),": Implement bundling + update imports/tests; land build output change."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Phase 2"}),": Add stricter CI guardrails (bundle output validation) and optional sourcemap/minification tweaks."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Hand-off package:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/package.json"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"tools/scripts/copy-renderer-assets.mjs"})}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Validation commands (expected):","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop run build"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop run test"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Do not edit checked-in ",(0,d.jsx)(n.code,{children:"dist/"})," outputs by hand; change sources and build scripts only."]}),"\n",(0,d.jsxs)(n.li,{children:["Keep renderer output inside ",(0,d.jsx)(n.code,{children:"packages/shell-desktop/dist/renderer/"})," (or subfolders), so packaging can include a single directory."]}),"\n",(0,d.jsx)(n.li,{children:"Prefer a single-file bundle initially (simpler packaging), unless code-splitting is explicitly required."}),"\n",(0,d.jsxs)(n.li,{children:["Validation hooks:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Ensure ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," contains no ",(0,d.jsx)(n.code,{children:"../../../renderer-*/dist/"})," strings after build."]}),"\n",(0,d.jsx)(n.li,{children:"Ensure the renderer still loads under the existing CSP (no runtime errors on page load)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsxs)(n.strong,{children:["Vendor/copy dependencies into ",(0,d.jsx)(n.code,{children:"dist/renderer/"})]}),": Copy ",(0,d.jsx)(n.code,{children:"packages/renderer-*/dist/*"})," into ",(0,d.jsx)(n.code,{children:"dist/renderer/vendor/"})," and rewrite imports. This avoids bundler tooling but still duplicates compiled code and requires manual dependency graph maintenance."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Import maps"}),": Add an import map to ",(0,d.jsx)(n.code,{children:"index.html"})," to map ",(0,d.jsx)(n.code,{children:"@idle-engine/*"})," to relative file URLs. This keeps modules separate but complicates packaging (must ship and maintain the mapped paths) and still risks stale ",(0,d.jsx)(n.code,{children:"dist/"})," usage."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Enable Node-style resolution in renderer"}),": Not recommended; increases security risk and diverges from browser module semantics."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Update existing renderer unit tests (",(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"}),") to mock package imports."]}),"\n",(0,d.jsxs)(n.li,{children:["Add a regression test or build check that the bundled ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," has no ",(0,d.jsx)(n.code,{children:"dist/"}),"-relative imports outside ",(0,d.jsx)(n.code,{children:"dist/renderer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Manual QA"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Run ",(0,d.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop run start"})," and verify:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"The window loads without module resolution errors."}),"\n",(0,d.jsx)(n.li,{children:"IPC ping succeeds."}),"\n",(0,d.jsx)(n.li,{children:"WebGPU renderer initializes and frames render or fallback path is stable."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Packaging smoke"})," (if packaging workflow exists): verify the renderer loads from the packaged app without accessing sibling packages."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Bundler introduces new build dependency"}),": Mitigate by keeping the bundler script small and isolated to ",(0,d.jsx)(n.code,{children:"packages/shell-desktop"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"CSP / sourcemap issues"}),": Use external sourcemaps (or disable in production) and avoid eval-based dev tooling."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsxs)(n.strong,{children:["Output drift vs. ",(0,d.jsx)(n.code,{children:"tsc"})," emit"]}),": Make the bundling step authoritative for ",(0,d.jsx)(n.code,{children:"dist/renderer/index.js"})," and add a guard to prevent regressions."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Land bundling as part of ",(0,d.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," build."]}),"\n",(0,d.jsx)(n.li,{children:"Update tests and add bundle output guardrails in the same PR."}),"\n",(0,d.jsx)(n.li,{children:"(Optional) Add a follow-up to validate packaged mode once a packaging workflow is defined."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Should the renderer bundle be single-file only, or is code-splitting acceptable for this project\u2019s packaging goals?"}),"\n",(0,d.jsxs)(n.li,{children:["Should the bundler resolve workspace dependencies from source (",(0,d.jsx)(n.code,{children:"src/"}),") or from package exports (",(0,d.jsx)(n.code,{children:"dist/"}),"), and should ",(0,d.jsx)(n.code,{children:"shell-desktop"}),"\u2019s build depend on building renderer packages first?"]}),"\n",(0,d.jsxs)(n.li,{children:["Do we want production minification and/or sourcemaps, and what is the policy for shipping ",(0,d.jsx)(n.code,{children:".map"})," files?"]}),"\n",(0,d.jsx)(n.li,{children:"Is there an intended Electron packaging tool/workflow to validate \u201cpackaged mode\u201d in CI?"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Add a documented \u201cpackaged build\u201d workflow once the project selects an Electron packaging solution."}),"\n",(0,d.jsx)(n.li,{children:"Consider consolidating renderer build tooling across future shells (desktop/web) if more bundling needs emerge."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Issue: ",(0,d.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/810",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/810"})]}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.html"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/shell-desktop/package.json"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"tools/scripts/copy-renderer-assets.mjs"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/renderer-webgpu/package.json"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.code,{children:"packages/renderer-contract/package.json"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Renderer (Electron)"}),": The Chromium-based process that runs ",(0,d.jsx)(n.code,{children:"index.html"})," and Web APIs like WebGPU."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Bundle"}),": A build artifact where multiple modules are combined into a single (or a few) JS files for simpler loading."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"CSP"}),": Content Security Policy; rules restricting which scripts/styles may load and execute."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Date"}),(0,d.jsx)(n.th,{children:"Author"}),(0,d.jsx)(n.th,{children:"Change Summary"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2026-01-24"}),(0,d.jsx)(n.td,{children:"Ralph (AI agent)"}),(0,d.jsx)(n.td,{children:"Initial draft for issue-810"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);