"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[2473],{1763:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>t});const c=JSON.parse('{"id":"benchmark-output-schema","title":"Benchmark JSON Output Schema","description":"Core benchmarks under packages/core/benchmarks emit a trailing single-line JSON payload so CI and tooling can validate and diff results. The runtime workload harness under tools/runtime-sim uses the same envelope to feed the performance report. The JSON line must be the last non-empty line in the log output.","source":"@site/../../docs/benchmark-output-schema.md","sourceDirName":".","slug":"/benchmark-output-schema","permalink":"/Idle-Game-Engine/benchmark-output-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/benchmark-output-schema.md","tags":[],"version":"current","frontMatter":{}}');var r=s(5270),i=s(7678);const d={},l="Benchmark JSON Output Schema",o={},t=[{value:"Covered Benchmarks",id:"covered-benchmarks",level:2},{value:"Envelope (TypeScript-style)",id:"envelope-typescript-style",level:2},{value:"Notes",id:"notes",level:2},{value:"Per-benchmark results",id:"per-benchmark-results",level:2},{value:"event-frame-format",id:"event-frame-format",level:3},{value:"diagnostic-timeline-overhead",id:"diagnostic-timeline-overhead",level:3},{value:"state-sync-checksum",id:"state-sync-checksum",level:3},{value:"runtime-workload-sim",id:"runtime-workload-sim",level:3},{value:"Example",id:"example",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"benchmark-json-output-schema",children:"Benchmark JSON Output Schema"})}),"\n",(0,r.jsxs)(n.p,{children:["Core benchmarks under ",(0,r.jsx)(n.code,{children:"packages/core/benchmarks"})," emit a trailing single-line JSON payload so CI and tooling can validate and diff results. The runtime workload harness under ",(0,r.jsx)(n.code,{children:"tools/runtime-sim"})," uses the same envelope to feed the performance report. The JSON line must be the last non-empty line in the log output."]}),"\n",(0,r.jsx)(n.h2,{id:"covered-benchmarks",children:"Covered Benchmarks"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/core/benchmarks/event-frame-format.bench.mjs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/core/benchmarks/diagnostic-timeline-overhead.bench.mjs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/core/benchmarks/state-sync-checksum.bench.mjs"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tools/runtime-sim"})," (runtime workload scenarios)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"envelope-typescript-style",children:"Envelope (TypeScript-style)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"type BenchmarkRunEnd = {\n  event: 'benchmark_run_end';\n  schemaVersion: 1;\n  benchmark: {\n    name: string;\n  };\n  config: Record<string, unknown>;\n  results: Record<string, unknown>;\n  env: {\n    nodeVersion: string;\n    platform: string;\n    arch: string;\n    commitSha: string | null;\n  };\n};\n\ntype BenchmarkStats = {\n  meanMs: number | null;\n  medianMs: number | null;\n  stdDevMs: number | null;\n  minMs: number | null;\n  maxMs: number | null;\n  hz: number | null;\n  samples: number;\n  unit: 'ms';\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config"})," captures benchmark configuration and scenario parameters."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results"})," stores per-scenario/task stats and optional ratio fields to reduce CI noise."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"BenchmarkStats"})," uses 6 decimal places for ms fields and 3 for ",(0,r.jsx)(n.code,{children:"hz"}),"; ratio helpers default to 4 decimals."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"env.commitSha"})," is ",(0,r.jsx)(n.code,{children:"null"})," when no SHA is available in the environment or repository."]}),"\n",(0,r.jsxs)(n.li,{children:["The payload is validated with ",(0,r.jsx)(n.code,{children:"tools/scripts/assert-json-tail.mjs"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"per-benchmark-results",children:"Per-benchmark results"}),"\n",(0,r.jsx)(n.h3,{id:"event-frame-format",children:"event-frame-format"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results.scenarios[]"})," includes ",(0,r.jsx)(n.code,{children:"label"}),", ",(0,r.jsx)(n.code,{children:"eventsPerTick"}),", ",(0,r.jsx)(n.code,{children:"formats"}),", and ",(0,r.jsx)(n.code,{children:"ratios"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"formats"})," includes ",(0,r.jsx)(n.code,{children:"struct-of-arrays"})," and ",(0,r.jsx)(n.code,{children:"object-array"})," ",(0,r.jsx)(n.code,{children:"BenchmarkStats"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ratios"})," includes ",(0,r.jsx)(n.code,{children:"objectOverStructMean"})," and ",(0,r.jsx)(n.code,{children:"objectOverStructMedian"})," (",(0,r.jsx)(n.code,{children:"number | null"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"diagnostic-timeline-overhead",children:"diagnostic-timeline-overhead"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.stepSizeMs"})," sets the runtime step size in milliseconds."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.warmupTicks"})," and ",(0,r.jsx)(n.code,{children:"config.measureTicks"})," define the warmup and measured tick counts."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.commandsPerTick"}),", ",(0,r.jsx)(n.code,{children:"config.eventsPerTick"}),", ",(0,r.jsx)(n.code,{children:"config.commandIterations"}),", and ",(0,r.jsx)(n.code,{children:"config.heavySystemIterations"})," define the workload."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.bench"})," includes Tinybench settings: ",(0,r.jsx)(n.code,{children:"time"}),", ",(0,r.jsx)(n.code,{children:"iterations"}),", ",(0,r.jsx)(n.code,{children:"warmupTime"}),", and ",(0,r.jsx)(n.code,{children:"warmupIterations"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results.tasks[]"})," includes ",(0,r.jsx)(n.code,{children:"name"}),", ",(0,r.jsx)(n.code,{children:"diagnosticsEnabled"}),", and ",(0,r.jsx)(n.code,{children:"stats"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stats"})," extends ",(0,r.jsx)(n.code,{children:"BenchmarkStats"})," with ",(0,r.jsx)(n.code,{children:"rmePercent"})," (",(0,r.jsx)(n.code,{children:"number | null"}),") and a tinybench-reported ",(0,r.jsx)(n.code,{children:"hz"})," value."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results.ratios"})," includes ",(0,r.jsx)(n.code,{children:"enabledOverDisabledMean"})," and ",(0,r.jsx)(n.code,{children:"enabledOverDisabledMedian"})," (",(0,r.jsx)(n.code,{children:"number | null"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"state-sync-checksum",children:"state-sync-checksum"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results.scenarios[]"})," includes ",(0,r.jsx)(n.code,{children:"label"}),", ",(0,r.jsx)(n.code,{children:"shape"}),", ",(0,r.jsx)(n.code,{children:"stats"}),", ",(0,r.jsx)(n.code,{children:"meanOverTarget"}),", ",(0,r.jsx)(n.code,{children:"status"}),", ",(0,r.jsx)(n.code,{children:"targetUs"}),", and ",(0,r.jsx)(n.code,{children:"enforceTarget"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"shape"})," includes ",(0,r.jsx)(n.code,{children:"resources"}),", ",(0,r.jsx)(n.code,{children:"generators"}),", ",(0,r.jsx)(n.code,{children:"upgrades"}),", ",(0,r.jsx)(n.code,{children:"achievements"}),", ",(0,r.jsx)(n.code,{children:"automations"}),", ",(0,r.jsx)(n.code,{children:"transforms"}),", and ",(0,r.jsx)(n.code,{children:"commands"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"meanOverTarget"})," is the ratio of mean checksum time to ",(0,r.jsx)(n.code,{children:"targetUs"})," (",(0,r.jsx)(n.code,{children:"number | null"}),"); ",(0,r.jsx)(n.code,{children:"status"})," is ",(0,r.jsx)(n.code,{children:"OK"}),", ",(0,r.jsx)(n.code,{children:"ABOVE_TARGET"}),", or ",(0,r.jsx)(n.code,{children:"INFO"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"runtime-workload-sim",children:"runtime-workload-sim"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.stepSizeMs"}),", ",(0,r.jsx)(n.code,{children:"config.warmupTicks"}),", ",(0,r.jsx)(n.code,{children:"config.measureTicks"}),", and ",(0,r.jsx)(n.code,{children:"config.seed"})," describe the workload run."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.maxStepsPerFrame"})," is optional when the scenario overrides the runtime clamp."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.scenarios"})," lists the scenario IDs executed; ",(0,r.jsx)(n.code,{children:"config.includeMemory"})," toggles memory payloads."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"results.scenarios[]"})," includes ",(0,r.jsx)(n.code,{children:"label"}),", ",(0,r.jsx)(n.code,{children:"stats"}),", ",(0,r.jsx)(n.code,{children:"diagnostics"}),", ",(0,r.jsx)(n.code,{children:"snapshot"}),", and optional ",(0,r.jsx)(n.code,{children:"memory"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stats"})," follows ",(0,r.jsx)(n.code,{children:"BenchmarkStats"})," (mean/median/min/max/stddev/hz over per-tick durations)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"diagnostics"})," includes ",(0,r.jsx)(n.code,{children:"slowTickCount"}),", ",(0,r.jsx)(n.code,{children:"maxQueueBacklog"}),", ",(0,r.jsx)(n.code,{children:"maxTickDurationMs"}),", ",(0,r.jsx)(n.code,{children:"avgTickDurationMs"}),", and ",(0,r.jsx)(n.code,{children:"dropped"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"snapshot"})," includes ",(0,r.jsx)(n.code,{children:"bytes"})," and ",(0,r.jsx)(n.code,{children:"entries"})," for the diagnostics payload size."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"memory"})," (when present) includes ",(0,r.jsx)(n.code,{children:"rss"}),", ",(0,r.jsx)(n.code,{children:"heapTotal"}),", ",(0,r.jsx)(n.code,{children:"heapUsed"}),", ",(0,r.jsx)(n.code,{children:"external"}),", and ",(0,r.jsx)(n.code,{children:"arrayBuffers"})," in bytes."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "event": "benchmark_run_end",\n  "schemaVersion": 1,\n  "benchmark": {\n    "name": "event-frame-format"\n  },\n  "config": {\n    "iterations": 200,\n    "scenarios": [\n      {"label": "dense", "eventsPerTick": 200},\n      {"label": "sparse", "eventsPerTick": 8}\n    ]\n  },\n  "results": {\n    "scenarios": [\n      {\n        "label": "dense",\n        "eventsPerTick": 200,\n        "formats": {\n          "struct-of-arrays": {\n            "meanMs": 0.0421,\n            "medianMs": 0.0419,\n            "stdDevMs": 0.0025,\n            "minMs": 0.0397,\n            "maxMs": 0.0512,\n            "hz": 23756.76,\n            "samples": 200,\n            "unit": "ms"\n          },\n          "object-array": {\n            "meanMs": 0.0898,\n            "medianMs": 0.0884,\n            "stdDevMs": 0.0061,\n            "minMs": 0.0812,\n            "maxMs": 0.1043,\n            "hz": 11135.92,\n            "samples": 200,\n            "unit": "ms"\n          }\n        },\n        "ratios": {\n          "objectOverStructMean": 2.1333,\n          "objectOverStructMedian": 2.1098\n        }\n      }\n    ]\n  },\n  "env": {\n    "nodeVersion": "v20.11.1",\n    "platform": "linux",\n    "arch": "x64",\n    "commitSha": "a79b8714c1e2c0b4f2f0f2a5c4c2c1a9b8d7e6f5"\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var c=s(9430);const r={},i=c.createContext(r);function d(e){const n=c.useContext(i);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);