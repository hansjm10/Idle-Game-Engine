"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[437],{7678:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>d});var s=i(9430);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},8191:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"validation-primitives-design-issue-764","title":"Validation Primitives & String Semantics (Issue 764)","description":"Document Control","source":"@site/../../docs/validation-primitives-design-issue-764.md","sourceDirName":".","slug":"/validation-primitives-design-issue-764","permalink":"/Idle-Game-Engine/validation-primitives-design-issue-764","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/validation-primitives-design-issue-764.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Validation Primitives & String Semantics (Issue 764)","sidebar_position":6}}');var r=i(5270),t=i(7678);const l={title:"Validation Primitives & String Semantics (Issue 764)",sidebar_position:6},d="Validation Primitives & String Semantics (Issue 764)",a={},c=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"Shared predicate module",id:"shared-predicate-module",level:4},{value:"String semantics decision",id:"string-semantics-decision",level:4},{value:"Refactors (in-scope for issue 764)",id:"refactors-in-scope-for-issue-764",level:4},{value:"Optional follow-ups (out of scope for issue 764, but enabled by predicates)",id:"optional-follow-ups-out-of-scope-for-issue-764-but-enabled-by-predicates",level:4},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"validation-primitives--string-semantics-issue-764",children:"Validation Primitives & String Semantics (Issue 764)"})}),"\n",(0,r.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Title"}),": Standardize validation primitives and string semantics (Issue 764)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authors"}),": Codex (AI)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reviewers"}),": TODO (Owner: Runtime Core Maintainers)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-14"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Related Issues"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/764",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/764"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,r.jsxs)(n.p,{children:["Issue 764 standardizes primitive validation logic (string/number/integer/boolean predicates) across ",(0,r.jsx)(n.code,{children:"packages/core"})," and documents consistent string semantics (especially for identifiers). Runtime event validation is tightened to reject whitespace-only identifier and user-visible string fields while preserving each subsystem\u2019s policy (throw vs return error vs normalize) and existing telemetry contracts."]}),"\n",(0,r.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Background"}),": ",(0,r.jsx)(n.code,{children:"packages/core"})," contains several duplicated/near-duplicated validation and normalization helpers across event validation, command validation, transport parsing, and save/restore code paths."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": The same \u201cnon-empty string\u201d concept has inconsistent semantics across layers. For example, runtime event payload validation treats ",(0,r.jsx)(n.code,{children:"'   '"})," as non-empty via ",(0,r.jsx)(n.code,{children:"value.length > 0"})," (",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts:85"}),"), while command validation uses ",(0,r.jsx)(n.code,{children:"trim().length > 0"})," (",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:49"}),") and restore/parse paths do the same (",(0,r.jsx)(n.code,{children:"packages/core/src/transform-system.ts:167"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/progression-coordinator-save.ts:97"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forces"}),": Refactors must preserve determinism and subsystem behavior contracts (telemetry/error codes/messages) while reducing maintenance overhead and preventing accidental semantic drift."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Provide a single, shared set of pure predicate helpers for common primitives (string, finite number, non-negative integer, boolean)."}),"\n",(0,r.jsx)(n.li,{children:"Record a clear semantic decision for identifier strings and apply it consistently where identifiers are validated."}),"\n",(0,r.jsxs)(n.li,{children:["Refactor high-impact call sites (",(0,r.jsx)(n.code,{children:"runtime-event-catalog"})," and ",(0,r.jsx)(n.code,{children:"command-validation"}),") to use shared predicates while preserving existing error handling and telemetry behavior."]}),"\n",(0,r.jsx)(n.li,{children:"Ensure changes are unit-tested, including explicit coverage for whitespace-only strings."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rewrite all existing \u201cnormalize*\u201d helpers and parse pipelines in one PR."}),"\n",(0,r.jsx)(n.li,{children:"Harmonize all error message strings or error codes across subsystems."}),"\n",(0,r.jsx)(n.li,{children:"Introduce a new third-party schema validation library (e.g. Zod) as part of this issue."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Primary Stakeholders"}),": Runtime Core maintainers; downstream shell/transport maintainers; content pipeline maintainers (indirectly impacted via runtime surface expectations)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Roles"}),":"]}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Agent"}),(0,r.jsx)(n.th,{children:"Responsibilities"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Runtime Refactor Agent"}),(0,r.jsxs)(n.td,{children:["Add shared predicates; refactor ",(0,r.jsx)(n.code,{children:"runtime-event-catalog"})," and ",(0,r.jsx)(n.code,{children:"command-validation"}),"; preserve behavior/telemetry contracts."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Test Agent"}),(0,r.jsx)(n.td,{children:"Add/adjust unit tests for predicate semantics and whitespace cases; ensure suite remains deterministic."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Docs Agent"}),(0,r.jsx)(n.td,{children:"Ensure the string semantics decision is recorded and discoverable (this document + any follow-up guidelines)."})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Affected Packages/Services"}),": ",(0,r.jsx)(n.code,{children:"packages/core"})," (primary), with optional follow-ups in ",(0,r.jsx)(n.code,{children:"tools/"})," and other core modules that currently implement one-off validation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility Considerations"}),": Tightening identifier/user-visible string validation from \u201cnon-empty\u201d (length) to \u201cnon-blank\u201d (trim) may surface previously accepted invalid data (e.g. whitespace-only IDs) at runtime event boundaries; this must be treated as an intentional behavior change and covered by tests."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts"})," defines local \u201crequire*\u201d helpers and validates strings using ",(0,r.jsx)(n.code,{children:"value.length"})," (",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts:85"}),"), which accepts whitespace-only strings for identifiers and other string fields."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts"})," defines ",(0,r.jsx)(n.code,{children:"validateNonEmptyString"})," using ",(0,r.jsx)(n.code,{children:"value.trim().length > 0"})," (",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:49"}),") and has unit tests covering whitespace-only rejection (",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.test.ts:114"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Other core parsing/normalization paths re-implement similar checks (examples: ",(0,r.jsx)(n.code,{children:"parseNonEmptyString"})," in ",(0,r.jsx)(n.code,{children:"packages/core/src/transform-system.ts:167"}),", id checks in ",(0,r.jsx)(n.code,{children:"packages/core/src/progression-coordinator-save.ts:97"}),"), contributing to inconsistent semantics and duplicated logic."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Narrative"}),": Introduce a shared predicate module with small, pure helpers. Subsystems (events, commands, transport, save/restore) keep their own policy (throw vs return value vs normalize), but rely on the shared predicates to avoid semantic drift."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Diagram"}),": N/A (localized refactor; no new runtime components)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,r.jsx)(n.h4,{id:"shared-predicate-module",children:"Shared predicate module"}),"\n",(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"packages/core/src/validation/primitives.ts"})," exporting type-guard predicates:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isNonEmptyString(value: unknown): value is string"})," (length-based; no trim)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isNonBlankString(value: unknown): value is string"})," (",(0,r.jsx)(n.code,{children:"trim().length > 0"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isFiniteNumber(value: unknown): value is number"})," (",(0,r.jsx)(n.code,{children:"typeof === 'number' && Number.isFinite"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isNonNegativeInteger(value: unknown): value is number"})," (",(0,r.jsx)(n.code,{children:"Number.isInteger && >= 0"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isBoolean(value: unknown): value is boolean"})," (",(0,r.jsx)(n.code,{children:"typeof === 'boolean'"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Unit tests live alongside the module as ",(0,r.jsx)(n.code,{children:"packages/core/src/validation/primitives.test.ts"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This module is an internal engine utility and should not be exported from the stable ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})," entrypoint. If engine-contributor tooling needs access, export it via ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"string-semantics-decision",children:"String semantics decision"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Identifiers"}),": Treat identifiers as ",(0,r.jsx)(n.strong,{children:"non-blank"})," strings (must contain at least one non-whitespace character). This aligns with existing command validation (",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:49"}),") and restore/parse behavior (",(0,r.jsx)(n.code,{children:"packages/core/src/transform-system.ts:167"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/progression-coordinator-save.ts:97"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-identifier strings"}),": Default to non-blank unless a specific field explicitly allows whitespace-only content. If such fields exist, use ",(0,r.jsx)(n.code,{children:"isNonEmptyString"})," intentionally and document the exception at the call site."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User-visible strings"})," (e.g. ",(0,r.jsx)(n.code,{children:"prompt"}),", ",(0,r.jsx)(n.code,{children:"option.label"}),"): Treat as ",(0,r.jsx)(n.strong,{children:"non-blank"})," (whitespace-only strings rejected), but do not strip or normalize whitespace in the value."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Identifier formatting"}),": Treat \u201cno leading/trailing whitespace\u201d as a stricter transport boundary rule (e.g. ",(0,r.jsx)(n.code,{children:"packages/core/src/command-transport-server.ts:292"}),"). For Phase 1, core validators standardize only \u201cnon-blank\u201d; if we want trimmed identifiers everywhere, introduce an explicit predicate (e.g. ",(0,r.jsx)(n.code,{children:"isTrimmedNonBlankString"}),") and roll it out intentionally."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"refactors-in-scope-for-issue-764",children:"Refactors (in-scope for issue 764)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Update local \u201crequire*\u201d helpers to use shared predicates and explicitly apply ",(0,r.jsx)(n.strong,{children:"non-blank"})," semantics to:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Identifier-like fields: ",(0,r.jsx)(n.code,{children:"resourceId"}),", ",(0,r.jsx)(n.code,{children:"automationId"}),", ",(0,r.jsx)(n.code,{children:"transformId"}),", ",(0,r.jsx)(n.code,{children:"batchId"}),", ",(0,r.jsx)(n.code,{children:"stageId"}),", ",(0,r.jsx)(n.code,{children:"option.id"}),", ",(0,r.jsx)(n.code,{children:"optionId"}),", ",(0,r.jsx)(n.code,{children:"nextStageId"})," (when non-null), ",(0,r.jsx)(n.code,{children:"entityInstanceIds[*]"}),", ",(0,r.jsx)(n.code,{children:"output.resourceId"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["User-visible strings: ",(0,r.jsx)(n.code,{children:"prompt"}),", ",(0,r.jsx)(n.code,{children:"option.label"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Add/adjust tests in ",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.test.ts"})," to ensure whitespace-only strings are rejected for identifier and user-visible string fields."]}),"\n",(0,r.jsx)(n.li,{children:"Preserve error message text (e.g. \u201cmust be a non-empty string.\u201d) unless explicitly rewording is agreed upon."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Replace inline primitive checks with shared predicates while preserving public API and telemetry/error behavior."}),"\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:"validateNonEmptyString"})," name/behavior for compatibility (it already enforces \u201cnon-blank\u201d); optionally add ",(0,r.jsx)(n.code,{children:"validateNonBlankString"})," as an alias for clarity."]}),"\n",(0,r.jsx)(n.li,{children:"Keep existing tests as the contract, adding new predicate tests rather than duplicating validation tests unless needed."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"optional-follow-ups-out-of-scope-for-issue-764-but-enabled-by-predicates",children:"Optional follow-ups (out of scope for issue 764, but enabled by predicates)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Refactor ",(0,r.jsx)(n.code,{children:"packages/core/src/command-transport-server.ts"})," and its identifier normalization (",(0,r.jsx)(n.code,{children:"packages/core/src/command-transport-server.ts:292"}),") to reuse predicates where it improves clarity (while retaining stricter transport rules like \u201cno leading/trailing whitespace\u201d)."]}),"\n",(0,r.jsxs)(n.li,{children:["Consolidate one-off normalize/parse helpers in ",(0,r.jsx)(n.code,{children:"packages/core/src/transform-system.ts"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/progression-coordinator-save.ts"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/offline-progress-limits.ts"}),", and ",(0,r.jsx)(n.code,{children:"packages/core/src/internals.browser.ts"})," onto shared predicates where it reduces duplication without changing semantics."]}),"\n",(0,r.jsxs)(n.li,{children:["Update content-generated event validators (in ",(0,r.jsx)(n.code,{children:"CONTENT_EVENT_CHANNELS"}),") to use the same primitives to prevent semantic drift between generated and hand-written validators."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment"}),": N/A (library refactor in core; consumed at build time)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry & Observability"}),": Must preserve existing telemetry event names and payload structure in command validation (",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:13"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security & Compliance"}),": Improves input hygiene by rejecting whitespace-only identifiers earlier; no new PII handling."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,r.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Issue Title"}),(0,r.jsx)(n.th,{children:"Scope Summary"}),(0,r.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,r.jsx)(n.th,{children:"Dependencies"}),(0,r.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"feat(core): add validation predicate module"}),(0,r.jsxs)(n.td,{children:["Add ",(0,r.jsx)(n.code,{children:"validation/primitives.ts"})," + unit tests"]}),(0,r.jsx)(n.td,{children:"Runtime Refactor Agent + Test Agent"}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Predicates exist; unit tests cover trim vs length semantics; module remains internal (not exported from stable entrypoint)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"refactor(core): use shared predicates in runtime event catalog"}),(0,r.jsx)(n.td,{children:"Replace local primitive checks with shared predicates; add whitespace tests"}),(0,r.jsx)(n.td,{children:"Runtime Refactor Agent + Test Agent"}),(0,r.jsx)(n.td,{children:"Predicate module"}),(0,r.jsx)(n.td,{children:"Event catalog uses predicates; whitespace-only identifiers and user-visible strings rejected; tests updated."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"refactor(core): use shared predicates in command validation"}),(0,r.jsx)(n.td,{children:"Replace inline checks with predicates while preserving telemetry and return shapes"}),(0,r.jsx)(n.td,{children:"Runtime Refactor Agent + Test Agent"}),(0,r.jsx)(n.td,{children:"Predicate module"}),(0,r.jsx)(n.td,{children:"Command validation uses predicates; tests pass unchanged."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 1"}),": Add predicate module + tests; refactor ",(0,r.jsx)(n.code,{children:"runtime-event-catalog"})," and ",(0,r.jsx)(n.code,{children:"command-validation"}),"; run ",(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 2"}),": Optional follow-ups for transport/server and restore/parse paths (separate issues to avoid scope creep)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hand-off Package"}),": Key files: ",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/validation/primitives.ts"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication Cadence"}),": Single PR for Phase 1 with focused review from Runtime Core maintainers; follow-ups tracked as separate issues."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Context Packets"}),": Load issue 764, and review current validation semantics in ",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts:85"})," and ",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:49"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep new predicates pure and dependency-free."}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"import type"})," / ",(0,r.jsx)(n.code,{children:"export type"})," for type-only imports/exports as required by lint rules."]}),"\n",(0,r.jsx)(n.li,{children:"Preserve existing error messages/telemetry behavior unless explicitly changing and updating tests."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Do not silently broaden acceptance (e.g. treating ",(0,r.jsx)(n.code,{children:"NaN"})," as valid)."]}),"\n",(0,r.jsx)(n.li,{children:"Avoid large-scale refactors across unrelated modules in the same PR."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm lint"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status quo"}),": Keep duplicated helpers and accept semantic drift. Rejected due to inconsistent behavior and higher maintenance cost."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Centralize \u201cthrowing validators\u201d instead of predicates"}),": Would not fit subsystems that return structured errors or normalize values (e.g. command transport). Predicates keep policy decisions local."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Adopt a schema validation library"}),": Adds dependency and potentially larger refactor surface; not necessary for simple primitives."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"packages/core/src/validation/primitives.test.ts"})," covering:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"'': false"})," and ",(0,r.jsx)(n.code,{children:"'   ': false"})," for ",(0,r.jsx)(n.code,{children:"isNonBlankString"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"'   ': true"})," and ",(0,r.jsx)(n.code,{children:"'\\n': true"})," for ",(0,r.jsx)(n.code,{children:"isNonEmptyString"})]}),"\n",(0,r.jsx)(n.li,{children:"finite number and integer boundaries for numeric predicates"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.test.ts"})," to validate whitespace-only strings are rejected for identifier and user-visible string fields."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": N/A (micro-level predicates; no expected measurable impact)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling / A11y"}),": N/A."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk"}),": Tightened string validation breaks consumers that emit whitespace-only identifiers or user-visible strings.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigation"}),": Treat as bug fix; add explicit tests; ensure any failures surface early and with clear error messages."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk"}),": Overloading \u201cnon-empty\u201d terminology remains ambiguous.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigation"}),": Provide both ",(0,r.jsx)(n.code,{children:"isNonEmptyString"})," and ",(0,r.jsx)(n.code,{children:"isNonBlankString"})," to force explicit decisions; keep ",(0,r.jsx)(n.code,{children:"validateNonEmptyString"})," for compatibility but consider adding a ",(0,r.jsx)(n.code,{children:"validateNonBlankString"})," alias to reduce confusion at new call sites."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk"}),": Predicates accidentally change numeric edge-case behavior (e.g. ",(0,r.jsx)(n.code,{children:"Infinity"}),", ",(0,r.jsx)(n.code,{children:"NaN"}),").","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigation"}),": Unit tests for boundary values; preserve existing checks by routing through ",(0,r.jsx)(n.code,{children:"Number.isFinite"}),", ",(0,r.jsx)(n.code,{children:"Number.isInteger"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milestones"}),": Land Phase 1 in a small PR; optional follow-up PRs for other call sites."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Strategy"}),": No runtime migration; updates are internal refactors plus stricter validation at event boundaries."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication"}),": Note identifier semantics change in PR description and link this document; call out any discovered upstream emitters producing whitespace."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Are there any runtime event fields that intentionally allow whitespace-only strings? If yes, enumerate them and explicitly validate with ",(0,r.jsx)(n.code,{children:"isNonEmptyString"})," (documenting the exception)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Refactor ",(0,r.jsx)(n.code,{children:"packages/core/src/command-transport-server.ts"})," and other parsing/normalizer helpers to use shared predicates where appropriate."]}),"\n",(0,r.jsxs)(n.li,{children:["Update content-generated event validators (",(0,r.jsx)(n.code,{children:"CONTENT_EVENT_CHANNELS"}),") to reuse the shared primitives."]}),"\n",(0,r.jsxs)(n.li,{children:["Add a short \u201cvalidation semantics\u201d section to ",(0,r.jsx)(n.code,{children:"docs/testing-guidelines.md"})," or a dedicated runtime validation guideline doc."]}),"\n",(0,r.jsx)(n.li,{children:"Consider a lightweight lint rule or convention check to discourage new ad-hoc primitive validators."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Issue 764: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/764",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/764"})]}),"\n",(0,r.jsxs)(n.li,{children:["Event validation helpers: ",(0,r.jsx)(n.code,{children:"packages/core/src/events/runtime-event-catalog.ts:85"})]}),"\n",(0,r.jsxs)(n.li,{children:["Command validation helpers: ",(0,r.jsx)(n.code,{children:"packages/core/src/command-validation.ts:49"})]}),"\n",(0,r.jsxs)(n.li,{children:["Transport identifier normalization: ",(0,r.jsx)(n.code,{children:"packages/core/src/command-transport-server.ts:292"})]}),"\n",(0,r.jsxs)(n.li,{children:["Restore/parse examples: ",(0,r.jsx)(n.code,{children:"packages/core/src/transform-system.ts:167"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/progression-coordinator-save.ts:97"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Blank string"}),": A string whose ",(0,r.jsx)(n.code,{children:"trim()"})," is empty (e.g. ",(0,r.jsx)(n.code,{children:"'   '"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-empty string"}),": A string with ",(0,r.jsx)(n.code,{children:"length > 0"})," (may still be blank/whitespace-only)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-blank string"}),": A string with ",(0,r.jsx)(n.code,{children:"trim().length > 0"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Predicate"}),": A pure boolean check (preferably a TypeScript type guard) used to build validators/normalizers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validator"}),": Code that enforces correctness by throwing or returning structured errors."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Normalizer"}),": Code that coerces/repairs invalid inputs to defaults or a canonical form."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Date"}),(0,r.jsx)(n.th,{children:"Author"}),(0,r.jsx)(n.th,{children:"Change Summary"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2026-01-14"}),(0,r.jsx)(n.td,{children:"Codex (AI)"}),(0,r.jsx)(n.td,{children:"Initial draft for issue 764."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2026-01-14"}),(0,r.jsx)(n.td,{children:"Codex (AI)"}),(0,r.jsx)(n.td,{children:"Resolved open questions and clarified string semantics decisions."})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);