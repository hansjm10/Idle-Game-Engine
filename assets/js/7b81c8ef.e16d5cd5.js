"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[9061],{4649:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"diagnostic-timeline-design","title":"Diagnostic Timeline Instrumentation","description":"Issue: #9 \u2014 Runtime Core Workstream","source":"@site/../../docs/diagnostic-timeline-design.md","sourceDirName":".","slug":"/diagnostic-timeline-design","permalink":"/Idle-Game-Engine/diagnostic-timeline-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/diagnostic-timeline-design.md","tags":[],"version":"current","frontMatter":{},"sidebar":"developerSidebar","previous":{"title":"Resource State Storage Design","permalink":"/Idle-Game-Engine/resource-state-storage-design"},"next":{"title":"Content DSL Schema Design","permalink":"/Idle-Game-Engine/content-dsl-schema-design"}}');var r=t(5270),i=t(7678);const o={},a="Diagnostic Timeline Instrumentation",c={},l=[{value:"1. Problem Statement",id:"1-problem-statement",level:2},{value:"2. Goals",id:"2-goals",level:2},{value:"3. Non-Goals",id:"3-non-goals",level:2},{value:"4. Current State",id:"4-current-state",level:2},{value:"5. Proposed Solution",id:"5-proposed-solution",level:2},{value:"5.1 Data Model &amp; Storage",id:"51-data-model--storage",level:3},{value:"5.2 Clock Abstraction",id:"52-clock-abstraction",level:3},{value:"5.3 Runtime Integration",id:"53-runtime-integration",level:3},{value:"5.4 Snapshot &amp; API Surface",id:"54-snapshot--api-surface",level:3},{value:"5.5 Worker &amp; Transport Integration",id:"55-worker--transport-integration",level:3},{value:"5.6 Configuration &amp; Extensibility",id:"56-configuration--extensibility",level:3},{value:"6. Observability &amp; Tooling",id:"6-observability--tooling",level:2},{value:"7. Performance Considerations",id:"7-performance-considerations",level:2},{value:"8. Rollout Steps",id:"8-rollout-steps",level:2},{value:"9. Risks &amp; Mitigations",id:"9-risks--mitigations",level:2},{value:"10. Resolved Questions",id:"10-resolved-questions",level:2},{value:"11. Acceptance Criteria",id:"11-acceptance-criteria",level:2},{value:"12. References",id:"12-references",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"diagnostic-timeline-instrumentation",children:"Diagnostic Timeline Instrumentation"})}),"\n",(0,r.jsx)(n.p,{children:"Issue: #9 \u2014 Runtime Core Workstream"}),"\n",(0,r.jsx)(n.h2,{id:"1-problem-statement",children:"1. Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The runtime core lacks a structured view of per-tick execution time, queue pressure, and system-level latency, making it hard to diagnose scheduling regressions described in ",(0,r.jsx)(n.code,{children:"docs/idle-engine-design.md"})," \xa76.2."]}),"\n",(0,r.jsxs)(n.li,{children:["Current telemetry only records coarse counters (",(0,r.jsx)(n.code,{children:"telemetry.recordTick"}),", event back-pressure snapshots) and cannot explain why a tick exceeded its budget or which system introduced jitter."]}),"\n",(0,r.jsx)(n.li,{children:"Without a deterministic diagnostic timeline, downstream tooling (shell devtools overlay, automated profiling agents) cannot surface actionable insights when the engine stutters or falls behind real time."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-goals",children:"2. Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Capture high-resolution timing for each runtime tick, including queue drain, event dispatch, and system execution segments."}),"\n",(0,r.jsx)(n.li,{children:"Attribute time spent to individual systems so integrators can identify hotspots while preserving deterministic execution."}),"\n",(0,r.jsx)(n.li,{children:"Record queue depth, command throughput, and event bus counters alongside timing data to contextualize slow ticks."}),"\n",(0,r.jsxs)(n.li,{children:["Provide a structured-clone-safe ring buffer snapshot API usable from Workers (shell-web) and Node hosts without leaking mutable references.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-structured-clone",id:"user-content-fnref-structured-clone","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,r.jsx)(n.li,{children:"Emit guard-rail warnings (over-budget ticks, repeated slow systems) through the existing telemetry facade so production builds can trigger alerts without devtools attached."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-non-goals",children:"3. Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Shipping a visualization layer inside ",(0,r.jsx)(n.code,{children:"packages/shell-web"}),"; that devtools overlay remains a follow-up."]}),"\n",(0,r.jsx)(n.li,{children:"Persisting historical diagnostics beyond the in-memory ring buffer or streaming them to external observability stacks (Prometheus ingestion stays optional via telemetry)."}),"\n",(0,r.jsx)(n.li,{children:"Replacing the existing event bus diagnostics; the timeline consumes those snapshots but does not redefine their structure."}),"\n",(0,r.jsx)(n.li,{children:"Enforcing adaptive scheduling or auto-throttling based on timeline results; the scope ends at recording and surfacing metadata."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-current-state",children:"4. Current State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"IdleEngineRuntime.tick"})," (see ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts"}),") executes the fixed-step loop but only calls ",(0,r.jsx)(n.code,{children:"telemetry.recordTick()"})," and event back-pressure counters after each iteration. There is no instrumentation around command draining, per-system execution, or total wall time."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CommandQueue"})," records overflow warnings but does not expose queue depth trends or per-tick throughput."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"EventBus"})," exposes ",(0,r.jsx)(n.code,{children:"getBackPressureSnapshot()"})," and frame export diagnostics, yet the runtime only samples these at the end of the tick, leaving large gaps between dispatch phases."]}),"\n",(0,r.jsxs)(n.li,{children:["The design doc (",(0,r.jsx)(n.code,{children:"docs/implementation-plan.md"}),") tracks \u201cAdd DiagnosticTimeline to capture tick durations and system timings\u201d as a TODO, and no API surfaces a timeline to consumers today."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-proposed-solution",children:"5. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"51-data-model--storage",children:"5.1 Data Model & Storage"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Introduce ",(0,r.jsx)(n.code,{children:"DiagnosticTimeline"})," inside ",(0,r.jsx)(n.code,{children:"packages/core/src/diagnostics/"}),", backed by a fixed-capacity circular buffer (default 512 ticks, configurable)."]}),"\n",(0,r.jsxs)(n.li,{children:["Each ",(0,r.jsx)(n.code,{children:"DiagnosticTimelineEntry"})," records:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tick"}),": runtime step number."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stepBudgetMs"}),": fixed-step budget applied to that simulation iteration (mirrors the resolved ",(0,r.jsx)(n.code,{children:"stepSizeMs"})," so diagnostics stay deterministic across replays).",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-fixed-step",id:"user-content-fnref-fixed-step","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hostFrameMs"}),": raw wall-clock time supplied to the outer ",(0,r.jsx)(n.code,{children:"tick"})," invocation, kept separate from the deterministic step budget so tooling can spot long render frames that trigger catch-up processing."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"lagBeforeMs"})," / ",(0,r.jsx)(n.code,{children:"lagAfterMs"}),": accumulator backlog immediately before and after the step, exposing how far the runtime is behind real time when multiple fixed steps are executed in one host frame.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-fixed-step-lag",id:"user-content-fnref-fixed-step-lag","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"startedAtMs"})," / ",(0,r.jsx)(n.code,{children:"durationMs"}),": high-resolution start timestamp and total wall-clock duration (converted to milliseconds with microsecond precision)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"queue"}),": ",(0,r.jsx)(n.code,{children:"{ pendingBefore, drained, accepted, dropped, rejected }"})," captured via extended ",(0,r.jsx)(n.code,{children:"CommandQueue"})," instrumentation so the timeline mirrors the accepted/outstanding counters that queueing platforms expose for monitoring (incoming, completed, abandoned, dead-lettered). Each tick begins by reading the queue size into ",(0,r.jsx)(n.code,{children:"pendingBefore"}),"; enqueue/dequeue paths increment ",(0,r.jsx)(n.code,{children:"accepted"}),", ",(0,r.jsx)(n.code,{children:"rejected"}),", ",(0,r.jsx)(n.code,{children:"dropped"}),", and ",(0,r.jsx)(n.code,{children:"drained"}),"; and ",(0,r.jsx)(n.code,{children:"commandQueue.flushDiagnostics()"})," returns the delta snapshot while resetting counters so every entry reports per-tick throughput rather than monotonic totals.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-azure-service-bus-metrics",id:"user-content-fnref-azure-service-bus-metrics","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-otel-delta",id:"user-content-fnref-otel-delta","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"5"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"phases"}),": ordered segments (",(0,r.jsx)(n.code,{children:"commands"}),", ",(0,r.jsx)(n.code,{children:"eventDispatchBeforeSystems"}),", ",(0,r.jsx)(n.code,{children:"system:<id>"}),", ",(0,r.jsx)(n.code,{children:"eventDispatchAfterSystems"}),", ",(0,r.jsx)(n.code,{children:"publish"}),") with ",(0,r.jsx)(n.code,{children:"durationMs"})," and ",(0,r.jsx)(n.code,{children:"offsetMs"})," from tick start."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"systems"}),": normalized table capturing ",(0,r.jsx)(n.code,{children:"{ id, durationMs, slow: boolean, error?: ErrorLike }"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"events"}),": structured counters captured once before systems run and once at tick end (",(0,r.jsx)(n.code,{children:"before"}),", ",(0,r.jsx)(n.code,{children:"final"}),"), plus optional per-system delta records when event pressure crosses configured thresholds. Calm ticks avoid copying the full ",(0,r.jsx)(n.code,{children:"BackPressureSnapshot"})," payload multiple times, while spikes still surface enough detail for diagnosis.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-perfetto-interning",id:"user-content-fnref-perfetto-interning","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"6"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-otel-performance",id:"user-content-fnref-otel-performance","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"7"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"warnings"}),": bit flags (e.g., ",(0,r.jsx)(n.code,{children:"EXCEEDED_STEP_BUDGET"}),", ",(0,r.jsx)(n.code,{children:"SYSTEM_SLOW"}),", ",(0,r.jsx)(n.code,{children:"QUEUE_STARVATION"}),") derived from thresholds in options."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The buffer reuses a pooled set of mutable entry structs to avoid per-tick allocations, then clones and freezes plain-object copies on export. This follows the object-pool pattern for high-churn data while still handing immutable snapshots to consumers.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-object-pool",id:"user-content-fnref-object-pool","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"8"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-object-freeze",id:"user-content-fnref-object-freeze","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"9"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-structured-clone",id:"user-content-fnref-structured-clone-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,r.jsxs)(n.li,{children:["Define ",(0,r.jsx)(n.code,{children:"ErrorLike"})," as a plain object ",(0,r.jsx)(n.code,{children:"{ readonly name: string; readonly message: string; readonly stack?: string; readonly cause?: string }"})," so structured clones remain deterministic across Workers while preserving telemetry details browsers guarantee when serializing errors.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-mdn-structured-clone",id:"user-content-fnref-mdn-structured-clone","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"10"})})]}),"\n",(0,r.jsxs)(n.li,{children:["Split the instrumentation hooks from exported data by introducing a mutable ",(0,r.jsx)(n.code,{children:"DiagnosticTimelineRecorder"})," (exposing ",(0,r.jsx)(n.code,{children:"beginTick"}),", ",(0,r.jsx)(n.code,{children:"capturePhase"}),", ",(0,r.jsx)(n.code,{children:"captureSystem"}),", ",(0,r.jsx)(n.code,{children:"endTick"}),") that never crosses structured-clone boundaries, plus an immutable ",(0,r.jsx)(n.code,{children:"DiagnosticTimelineResult"})," returned by ",(0,r.jsx)(n.code,{children:"readDiagnosticsDelta"}),". This mirrors telemetry guidelines where instrumentation libraries depend only on an API while exporters and tooling consume serialized snapshots.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-otel-api-sdk",id:"user-content-fnref-otel-api-sdk","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"11"})})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"52-clock-abstraction",children:"5.2 Clock Abstraction"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Define ",(0,r.jsx)(n.code,{children:"HighResolutionClock"})," with ",(0,r.jsx)(n.code,{children:"now(): number"})," returning a monotonically increasing timestamp in milliseconds with microsecond precision."]}),"\n",(0,r.jsxs)(n.li,{children:["Default implementation wraps ",(0,r.jsx)(n.code,{children:"performance.now()"})," in browsers/Workers and ",(0,r.jsx)(n.code,{children:"performance.now()"})," (via ",(0,r.jsx)(n.code,{children:"import { performance } from 'node:perf_hooks'"}),") in Node; fallback to ",(0,r.jsx)(n.code,{children:"Date.now()"})," when unavailable."]}),"\n",(0,r.jsxs)(n.li,{children:["Allow dependency injection through ",(0,r.jsx)(n.code,{children:"IdleEngineRuntimeOptions.diagnostics?.clock"})," for deterministic testing (Vitest can supply a fake clock)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"53-runtime-integration",children:"5.3 Runtime Integration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"IdleEngineRuntimeOptions"})," with an optional ",(0,r.jsx)(n.code,{children:"diagnostics"})," block:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface DiagnosticTimelineOptions {\n  readonly enabled?: boolean; // default true in development, false otherwise\n  readonly capacity?: number; // default 512\n  readonly slowTickBudgetMs?: number; // defaults to current stepSizeMs (100)\n  readonly slowSystemThresholdMs?: number; // defaults to 25% of step budget\n  readonly clock?: HighResolutionClock;\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Maintain a lightweight controller inside ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," that forwards to either a real ",(0,r.jsx)(n.code,{children:"DiagnosticTimelineRecorder"})," or a noop implementation; diagnostics-disabled builds defer recorder allocation until explicitly enabled while keeping the hot path branchless."]}),"\n",(0,r.jsxs)(n.li,{children:["Instrument ",(0,r.jsx)(n.code,{children:"tick"})," as follows:","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Snapshot ",(0,r.jsx)(n.code,{children:"const accumulatorBefore = this.accumulator + deltaMs"})," before we clamp ",(0,r.jsx)(n.code,{children:"steps"}),", then keep a local ",(0,r.jsx)(n.code,{children:"remainingAccumulator"})," that we decrement inside the per-step loop. Each ",(0,r.jsx)(n.code,{children:"beginTick(tick, { hostFrameMs: deltaMs, lagBeforeMs, stepBudgetMs: this.stepSizeMs, queueSize })"})," call uses that running remainder (",(0,r.jsx)(n.code,{children:"lagBeforeMs = Math.max(0, remainingAccumulator - this.stepSizeMs)"}),") so the entry reflects the backlog still outstanding before the slice runs. After the step finishes subtract ",(0,r.jsx)(n.code,{children:"this.stepSizeMs"})," from ",(0,r.jsx)(n.code,{children:"remainingAccumulator"}),", compute ",(0,r.jsx)(n.code,{children:"lagAfterMs = Math.max(0, remainingAccumulator)"}),", and pass it to ",(0,r.jsx)(n.code,{children:"endTick(...)"})," so every entry records both the pre- and post-step accumulator in line with fixed-step accumulator guidance.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-fixed-step-lag",id:"user-content-fnref-fixed-step-lag-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-gaffer-accumulator",id:"user-content-fnref-gaffer-accumulator","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"12"})})]}),"\n",(0,r.jsxs)(n.li,{children:["On the first iteration call ",(0,r.jsx)(n.code,{children:"const queueDiagnostics = commandQueue.beginDiagnosticsTick()"})," (cheap view over the shared counters) so the recorder starts with ",(0,r.jsx)(n.code,{children:"pendingBefore = queueDiagnostics.pendingBefore"}),". As ",(0,r.jsx)(n.code,{children:"enqueue"})," and ",(0,r.jsx)(n.code,{children:"dequeue"})," operations occur they update the per-tick counters, and ",(0,r.jsx)(n.code,{children:"commandQueue.flushDiagnostics()"})," returns the delta structure used when sealing the entry."]}),"\n",(0,r.jsxs)(n.li,{children:["Wrap both command dequeuing and execution inside ",(0,r.jsx)(n.code,{children:"timeline.capturePhase('commands', () => { ... })"}),", using the enhanced dequeue helper to capture ",(0,r.jsx)(n.code,{children:"{ pendingBefore, drained, accepted, dropped, rejected }"})," in lockstep with the queue metrics we surface elsewhere. Nested slices per command type remain optional but provide richer traces when enabled.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-perfetto-track-events",id:"user-content-fnref-perfetto-track-events","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"13"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-azure-service-bus-metrics",id:"user-content-fnref-azure-service-bus-metrics-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})]}),"\n",(0,r.jsxs)(n.li,{children:["Bracket every call to ",(0,r.jsx)(n.code,{children:"eventBus.dispatch(...)"})," with ",(0,r.jsx)(n.code,{children:"timeline.capturePhase"})," blocks so dispatch costs appear in the phase array (",(0,r.jsx)(n.code,{children:"eventDispatchBeforeSystems"})," before any systems run, ",(0,r.jsx)(n.code,{children:"eventDispatchAfterSystems"})," between systems). A lightweight helper lets ",(0,r.jsx)(n.code,{children:"resource-publish-transport"})," (or any alternative exporter) call ",(0,r.jsx)(n.code,{children:"timeline.capturePhase('publish', ...)"})," around its own work so the timeline records publish costs without assuming the core runtime owns the transport call.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-perfetto-track-events",id:"user-content-fnref-perfetto-track-events-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"13"})})]}),"\n",(0,r.jsxs)(n.li,{children:["Before running systems, capture ",(0,r.jsx)(n.code,{children:"events.before = eventBus.getBackPressureSnapshot()"}),". During the system loop, only request a delta snapshot when utilization crosses configured thresholds; the recorder diffs that snapshot against the cached one so routine ticks avoid extra allocations while still logging the channels that spiked. After dispatch completes, capture a single ",(0,r.jsx)(n.code,{children:"events.final"})," snapshot for context."]}),"\n",(0,r.jsxs)(n.li,{children:["For each registered system, call ",(0,r.jsx)(n.code,{children:"timeline.captureSystem(system.id, () => system.tick(context))"}),". The helper measures duration, marks slow flags, annotates thrown errors on the entry using the serialized ",(0,r.jsx)(n.code,{children:"ErrorLike"}),", and rethrows so existing runtime telemetry (",(0,r.jsx)(n.code,{children:"SystemExecutionFailed"}),") continues to fire."]}),"\n",(0,r.jsxs)(n.li,{children:["After system iteration, finalize any active phase spans, collect ",(0,r.jsx)(n.code,{children:"const queue = commandQueue.flushDiagnostics()"}),", compute the merged warning set, and call ",(0,r.jsx)(n.code,{children:"endTick({ backPressure, queue, warnings, lagAfterMs })"})," to seal the entry and write it into the ring buffer."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Telemetry integration:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Emit ",(0,r.jsx)(n.code,{children:"telemetry.recordWarning('TickOverBudget', { tick, durationMs, budgetMs })"})," when ",(0,r.jsx)(n.code,{children:"durationMs > slowTickBudgetMs"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Emit ",(0,r.jsx)(n.code,{children:"telemetry.recordWarning('SystemSlow', { systemId, durationMs, thresholdMs, tick })"})," when a system\u2019s own execution history shows repeated slow samples\u2014track a per-system ring buffer of the last ",(0,r.jsx)(n.code,{children:"windowSize"})," executions so infrequent systems still surface regressions without being hidden by globally sparse tick windows.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-datadog-multi-alert",id:"user-content-fnref-datadog-multi-alert","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"14"})})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"54-snapshot--api-surface",children:"5.4 Snapshot & API Surface"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime.readDiagnosticsDelta(sinceHead?: number): DiagnosticTimelineResult"})," exposing:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface DiagnosticTimelineResult {\n  readonly entries: readonly DiagnosticTimelineEntry[];\n  readonly head: number; // incrementing sequence for delta consumers\n  readonly configuration: Readonly<ResolvedDiagnosticTimelineOptions>;\n  readonly dropped: number;\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["When ",(0,r.jsx)(n.code,{children:"sinceHead"})," is omitted the recorder exports the full buffer contents; otherwise it returns only the new entries since that head. The export path deep-clones the pooled structs, freezes the resulting plain objects, and hands back structured-clone-safe data without leaking mutable references."]}),"\n",(0,r.jsxs)(n.li,{children:["The recorder stores ",(0,r.jsx)(n.code,{children:"head"})," as a monotonic counter so clients can request only new entries and determine when the ring buffer overwrote older samples without juggling separate snapshot and delta APIs.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-otel-delta",id:"user-content-fnref-otel-delta-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"5"})})]}),"\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"CommandRecorder"})," replay context to optionally attach timeline entries when present, enabling deterministic replay comparisons."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"55-worker--transport-integration",children:"5.5 Worker & Transport Integration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"packages/core/src/resource-publish-transport.ts"})," to accept two optional diagnostics fields: ",(0,r.jsx)(n.code,{children:"diagnosticsRecorder?: DiagnosticTimelineRecorder"})," for wrapping ",(0,r.jsx)(n.code,{children:"capturePhase('publish', ...)"})," around build/release work, and ",(0,r.jsx)(n.code,{children:"diagnosticsPayload?: DiagnosticTimelineResult"})," so call-sites can attach immutable timeline slices to the transport without smuggling recorder methods through structured-clone boundaries. The runtime hands the recorder directly to the transport, while the worker receives only the serialized payload."]}),"\n",(0,r.jsxs)(n.li,{children:["The worker bridge (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts"}),") can request diagnostics by:","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Storing the last seen ",(0,r.jsx)(n.code,{children:"head"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Calling ",(0,r.jsx)(n.code,{children:"runtime.readDiagnosticsDelta(lastHead)"})," after each resource publish or on a polling cadence."]}),"\n",(0,r.jsx)(n.li,{children:"Forwarding only new entries to the UI devtools overlay."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Timeline entries remain optional; publishing code should skip them when diagnostics are disabled to avoid extra bytes on production channels."}),"\n",(0,r.jsxs)(n.li,{children:["Devtools must explicitly opt in before the worker starts emitting timeline buffers. The UI posts a ",(0,r.jsx)(n.code,{children:"DIAGNOSTICS_SUBSCRIBE"})," envelope via ",(0,r.jsx)(n.code,{children:"WorkerBridge.enableDiagnostics()"}),", the worker enables the runtime timeline, resets its delta cursor, and immediately returns a baseline ",(0,r.jsx)(n.code,{children:"DIAGNOSTICS_UPDATE"})," so tooling learns the configuration before streaming increments. Because ",(0,r.jsx)(n.code,{children:"postMessage()"})," copies data by default,",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-postmessage-copy",id:"user-content-fnref-postmessage-copy","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"15"})})," follow-up deltas are sent over the dedicated ",(0,r.jsx)(n.code,{children:"DIAGNOSTICS_UPDATE"})," envelope only while the overlay is listening. Regular state updates stay slim, while the diagnostics envelope can transfer typed buffers once the overlay requests high-volume samples.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-transferable-zero-copy",id:"user-content-fnref-transferable-zero-copy","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"16"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WorkerBridge.onDiagnosticsUpdate"})," forwards those ",(0,r.jsx)(n.code,{children:"DIAGNOSTICS_UPDATE"})," payloads to devtools so the overlay can render timeline entries alongside existing state updates."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"56-configuration--extensibility",children:"5.6 Configuration & Extensibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Expose ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime.enableDiagnostics(options)"})," to toggle recording at runtime (useful for automated test harnesses). The controller resolves defaults during construction, keeps a noop recorder active when disabled, and allocates the real recorder on demand without disrupting in-flight ticks."]}),"\n",(0,r.jsxs)(n.li,{children:["Allow future hooks to append additional phases (e.g., persistence flush, social sync) by offering ",(0,r.jsx)(n.code,{children:"diagnostics.addPhase(name, durationMs)"})," APIs outside of ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Store thresholds in the resolved configuration so downstream systems (e.g., shell overlay) know which budget triggered warnings."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-observability--tooling",children:"6. Observability & Tooling"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prometheus adapter (",(0,r.jsx)(n.code,{children:"telemetry-prometheus.ts"}),") increments new counters (",(0,r.jsx)(n.code,{children:"runtime_ticks_over_budget_total"}),", ",(0,r.jsx)(n.code,{children:"runtime_system_slow_total"}),") when warnings fire, gated by explicit label registration."]}),"\n",(0,r.jsxs)(n.li,{children:["Provide a small helper in ",(0,r.jsx)(n.code,{children:"packages/core/src/devtools/diagnostics.ts"})," that formats the latest ",(0,r.jsx)(n.code,{children:"DiagnosticTimelineEntry"})," for human-readable console output, mirroring the existing console telemetry scheme."]}),"\n",(0,r.jsxs)(n.li,{children:["Document the timeline API in ",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md"})," follow-up so implementation notes stay in sync with the design."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-performance-considerations",children:"7. Performance Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timeline recording adds ~5 object allocations per tick (entry + phase arrays). The ring buffer reuses arrays via preallocation to avoid garbage churn."}),"\n",(0,r.jsx)(n.li,{children:"High-resolution timestamps rely on monotonic clocks; fallbacks degrade precision but remain deterministic because start/end are still measured within the same clock."}),"\n",(0,r.jsx)(n.li,{children:"Instrumentation branches are minimized by caching the recorder (either real or noop) and inline guards for disabled configuration."}),"\n",(0,r.jsx)(n.li,{children:"Export snapshots clone arrays at most once per request; by freezing entries on write, consumers can reuse references safely."}),"\n",(0,r.jsxs)(n.li,{children:["A dedicated micro-benchmark (",(0,r.jsx)(n.code,{children:"packages/core/benchmarks/diagnostic-timeline-overhead.bench.mjs"}),") exercises multiple systems and high queue churn. On Node.js v22.20.0 running under WSL2, ",(0,r.jsx)(n.code,{children:"pnpm --filter @idle-engine/core run benchmark:diagnostics"})," reported a mean +10.8 ms cost per 320 ticks (about 10.1% overhead) with a median delta of +9.0 ms."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-rollout-steps",children:"8. Rollout Steps"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Scaffold ",(0,r.jsx)(n.code,{children:"packages/core/src/diagnostics/diagnostic-timeline.ts"})," with recorder, data model, and tests covering ring-buffer rollover, slow-tick detection, and noop mode."]}),"\n",(0,r.jsxs)(n.li,{children:["Wire the recorder into ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," constructor and tick loop; add integration tests (",(0,r.jsx)(n.code,{children:"packages/core/src/index.test.ts"}),") capturing synthetic ticks with fake clocks."]}),"\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"telemetry-prometheus.ts"})," to record new counters and verify via tests."]}),"\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"resource-publish-transport.ts"})," (and worker bridge) to optionally include timeline deltas; cover with unit tests ensuring serialization safety."]}),"\n",(0,r.jsxs)(n.li,{children:["Add developer documentation (",(0,r.jsx)(n.code,{children:"README.md"})," or ",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md"}),") describing how to enable diagnostics in local builds."]}),"\n",(0,r.jsx)(n.li,{children:"Validate instrumentation overhead with a micro-benchmark and document observed cost in the PR summary."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-risks--mitigations",children:"9. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clock precision variance across environments"}),": Provide explicit clock injection and unit tests using deterministic timers; fall back to ",(0,r.jsx)(n.code,{children:"Date.now()"})," only when necessary."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timeline flood in production builds"}),": Keep diagnostics opt-in (",(0,r.jsx)(n.code,{children:"enabled: false"})," by default outside development) and ensure publish paths check configuration before attaching data."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry noise from transient spikes"}),": Use dampening thresholds (e.g., require two slow samples within the last three ticks) before emitting warnings; expose configuration knobs so integrators can tune sensitivity."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-resolved-questions",children:"10. Resolved Questions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shell diagnostics transport"}),": Provide a subscription handshake from the devtools overlay and stream timeline deltas only through a dedicated diagnostics message once listeners are active. Default state updates remain lean, minimizing structured-clone churn, and the diagnostics envelope can switch to transferable typed arrays for larger batches where supported.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-postmessage-copy",id:"user-content-fnref-postmessage-copy-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"15"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-transferable-zero-copy",id:"user-content-fnref-transferable-zero-copy-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"16"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GC visibility"}),": Detect long GC pauses indirectly by observing ",(0,r.jsx)(n.code,{children:"longtask"})," entries via ",(0,r.jsx)(n.code,{children:"PerformanceObserver"}),", which surfaces 50ms+ main-thread stalls regardless of source.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-longtasks",id:"user-content-fnref-longtasks","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"17"})})," First-phase scope stops there; direct heap snapshots use ",(0,r.jsx)(n.code,{children:"performance.measureUserAgentSpecificMemory()"})," only when shell builds opt into cross-origin isolation, because the legacy ",(0,r.jsx)(n.code,{children:"performance.memory"})," API is deprecated, Chromium-only, and unreliable for multi-context captures.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-perf-memory",id:"user-content-fnref-perf-memory","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"18"})}),(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-measure-uasm",id:"user-content-fnref-measure-uasm","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"19"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timeline buffer depth"}),": Set the default ring buffer to 512 entries (~51 seconds at 100ms steps) so tooling can inspect a minute of history without triggering drops. This mirrors guidance from the Performance Timeline that buffers silently drop entries once full; exposing capacity controls and the dropped-entry count keeps the channel deterministic for observers.",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-performanceobserver-buffer",id:"user-content-fnref-performanceobserver-buffer","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"20"})})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event counter snapshots"}),": Cache the ",(0,r.jsx)(n.code,{children:"BackPressureSnapshot"})," once before system execution and reuse it to compute diff payloads only when channel utilization breaches configured thresholds, keeping the steady-state payload small while still reusing the existing event bus diagnostic shape (",(0,r.jsx)(n.code,{children:"packages/core/src/events/event-bus.ts"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"System error handling"}),": ",(0,r.jsx)(n.code,{children:"timeline.captureSystem()"})," annotates thrown errors but rethrows them so the existing ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," catch block continues to emit ",(0,r.jsx)(n.code,{children:"SystemExecutionFailed"})," telemetry and keeps later systems running (",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:198"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/index.test.ts:250"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-acceptance-criteria",children:"11. Acceptance Criteria"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Runtime exposes a documented ",(0,r.jsx)(n.code,{children:"DiagnosticTimeline"})," API that records tick phases, per-system durations, and queue/event metrics."]}),"\n",(0,r.jsx)(n.li,{children:"Telemetry warnings fire when ticks exceed configured budgets, and Prometheus integration reflects the new counters."}),"\n",(0,r.jsx)(n.li,{children:"Resource publish transport (or equivalent channel) can surface timeline deltas to the Worker bridge without breaking existing consumers when diagnostics are disabled."}),"\n",(0,r.jsx)(n.li,{children:"Unit tests cover timeline recording, slow-tick detection, and disabled/noop scenarios."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-references",children:"12. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n",(0,r.jsx)(n.li,{}),"\n"]}),"\n","\n",(0,r.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,r.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{id:"user-content-fn-structured-clone",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cStructured clone creates a copy of most types of objects, and the original object is not transferred.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Structured clone algorithm"}),", MDN Web Docs. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm",children:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-structured-clone","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-structured-clone-2","data-footnote-backref":"","aria-label":"Back to reference 1-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-fixed-step",children:["\n",(0,r.jsxs)(n.p,{children:["Glenn Fiedler, \u201cFix Your Timestep!\u201d, ",(0,r.jsx)(n.em,{children:"Gaffer On Games"}),". Highlights maintaining a constant simulation ",(0,r.jsx)(n.code,{children:"dt"})," per step for deterministic behavior. ",(0,r.jsx)(n.a,{href:"https://gafferongames.com/post/fix_your_timestep/",children:"https://gafferongames.com/post/fix_your_timestep/"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-fixed-step","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-fixed-step-lag",children:["\n",(0,r.jsxs)(n.p,{children:["Glenn Fiedler, \u201cFix Your Timestep!\u201d, ",(0,r.jsx)(n.em,{children:"Gaffer On Games"}),". Discusses accumulating frame deltas, executing multiple fixed steps during catch-up, and retaining the remainder in an accumulator to reflect real-time lag. ",(0,r.jsx)(n.a,{href:"https://gafferongames.com/post/fix_your_timestep/",children:"https://gafferongames.com/post/fix_your_timestep/"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-fixed-step-lag","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-fixed-step-lag-2","data-footnote-backref":"","aria-label":"Back to reference 3-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-azure-service-bus-metrics",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cMonitoring data reference for Azure Service Bus,\u201d Microsoft Learn. Documents per-queue metrics such as incoming, completed, abandoned, and dead-lettered messages used to track throughput and loss. ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-metrics-azure-monitor",children:"https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-metrics-azure-monitor"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-azure-service-bus-metrics","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-azure-service-bus-metrics-2","data-footnote-backref":"","aria-label":"Back to reference 4-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-otel-delta",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cMetrics that are input and output with Delta temporality unburden the client from keeping high-cardinality state\u2026 The use of deltas allows downstream services to bear the cost of conversion into cumulative timeseries.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Metrics Data Model"}),", OpenTelemetry Specification. ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/metrics/data-model.md",children:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/metrics/data-model.md"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-otel-delta","data-footnote-backref":"","aria-label":"Back to reference 5",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-otel-delta-2","data-footnote-backref":"","aria-label":"Back to reference 5-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-perfetto-interning",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cInterning can be used to avoid repeating the same constant data (e.g., event names) throughout the trace.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Track events (Tracing SDK)"}),", Perfetto Docs. ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/google/perfetto/master/docs/instrumentation/track-events.md",children:"https://raw.githubusercontent.com/google/perfetto/master/docs/instrumentation/track-events.md"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-perfetto-interning","data-footnote-backref":"","aria-label":"Back to reference 6",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-otel-performance",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cLibrary should not consume unbounded memory resource\u2026 API should not degrade the end-user application as possible.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Performance and Blocking of OpenTelemetry API"}),", OpenTelemetry Specification. ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/performance.md",children:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/performance.md"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-otel-performance","data-footnote-backref":"","aria-label":"Back to reference 7",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-object-pool",children:["\n",(0,r.jsxs)(n.p,{children:["Robert Nystrom, ",(0,r.jsx)(n.em,{children:"Game Programming Patterns: Object Pool"}),", on reusing preallocated objects to avoid allocation spikes in high-churn systems. ",(0,r.jsx)(n.a,{href:"https://gameprogrammingpatterns.com/object-pool.html",children:"https://gameprogrammingpatterns.com/object-pool.html"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-object-pool","data-footnote-backref":"","aria-label":"Back to reference 8",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-object-freeze",children:["\n",(0,r.jsxs)(n.p,{children:["MDN Web Docs, \u201cObject.freeze()\u201d, noting that frozen objects cannot be modified or extended. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze",children:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-object-freeze","data-footnote-backref":"","aria-label":"Back to reference 9",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-mdn-structured-clone",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cBrowsers must serialize the properties ",(0,r.jsx)(n.code,{children:"name"})," and ",(0,r.jsx)(n.code,{children:"message"}),", and are expected to serialize other \u2018interesting\u2019 properties of the errors such as ",(0,r.jsx)(n.code,{children:"stack"}),"...\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Structured clone algorithm"}),", MDN content repository. ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/mdn/content/main/files/en-us/web/api/web_workers_api/structured_clone_algorithm/index.md",children:"https://raw.githubusercontent.com/mdn/content/main/files/en-us/web/api/web_workers_api/structured_clone_algorithm/index.md"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-mdn-structured-clone","data-footnote-backref":"","aria-label":"Back to reference 10",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-otel-api-sdk",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"OpenTelemetry Client Design Principles"}),", OpenTelemetry Specification. Highlights keeping the API (instrumentation) separate from the SDK/exporters so libraries depend only on stable hooks. ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/library-guidelines.md",children:"https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/library-guidelines.md"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-otel-api-sdk","data-footnote-backref":"","aria-label":"Back to reference 11",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-gaffer-accumulator",children:["\n",(0,r.jsxs)(n.p,{children:["Glenn Fiedler, \u201cFix Your Timestep!\u201d, ",(0,r.jsx)(n.em,{children:"Gaffer On Games"}),". Notes that the accumulator remainder directly expresses how far the simulation is between fixed steps, making it a reliable backlog signal. ",(0,r.jsx)(n.a,{href:"https://gafferongames.com/post/fix_your_timestep/",children:"https://gafferongames.com/post/fix_your_timestep/"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-gaffer-accumulator","data-footnote-backref":"","aria-label":"Back to reference 12",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-perfetto-track-events",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cTracing SDK - Perfetto Tracing Docs\u201d, describing time-bounded track events via ",(0,r.jsx)(n.code,{children:"TRACE_EVENT"})," spans to attribute work in profiling traces. ",(0,r.jsx)(n.a,{href:"https://perfetto.dev/docs/instrumentation/tracing-sdk",children:"https://perfetto.dev/docs/instrumentation/tracing-sdk"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-perfetto-track-events","data-footnote-backref":"","aria-label":"Back to reference 13",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-perfetto-track-events-2","data-footnote-backref":"","aria-label":"Back to reference 13-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-datadog-multi-alert",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cMulti Alert mode,\u201d ",(0,r.jsx)(n.em,{children:"Datadog Monitors Configuration"}),". Highlights emitting one notification per group (dimension) so thresholds evaluate per entity instead of across aggregated series. ",(0,r.jsx)(n.a,{href:"https://docs.datadoghq.com/monitors/configuration/?tab=multi-alert",children:"https://docs.datadoghq.com/monitors/configuration/?tab=multi-alert"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-datadog-multi-alert","data-footnote-backref":"","aria-label":"Back to reference 14",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-postmessage-copy",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cData is sent between workers and the main thread via a system of messages\u2026 The data is copied rather than shared.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Using Web Workers"}),", MDN Web Docs. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers",children:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-postmessage-copy","data-footnote-backref":"","aria-label":"Back to reference 15",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-postmessage-copy-2","data-footnote-backref":"","aria-label":"Back to reference 15-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-transferable-zero-copy",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cTransferable objects are transferred\u2026 with a zero-copy operation, which results in a vast performance improvement when sending large data sets.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Using Web Workers"}),", MDN Web Docs. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers",children:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-transferable-zero-copy","data-footnote-backref":"","aria-label":"Back to reference 16",className:"data-footnote-backref",children:"\u21a9"})," ",(0,r.jsxs)(n.a,{href:"#user-content-fnref-transferable-zero-copy-2","data-footnote-backref":"","aria-label":"Back to reference 16-2",className:"data-footnote-backref",children:["\u21a9",(0,r.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-longtasks",children:["\n",(0,r.jsxs)(n.p,{children:["Long Tasks API introduction describing 50ms+ main-thread stalls and their impact on responsiveness. ",(0,r.jsx)(n.a,{href:"https://w3c.github.io/longtasks/",children:"https://w3c.github.io/longtasks/"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-longtasks","data-footnote-backref":"","aria-label":"Back to reference 17",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-perf-memory",children:["\n",(0,r.jsxs)(n.p,{children:["\u201cperformance.memory\u2026 Deprecated\u2026 Non-standard\u2026 API is only available in Chromium-based browsers.\u201d \u2014 ",(0,r.jsx)(n.em,{children:"Performance: memory property"}),", MDN Web Docs. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Performance/memory",children:"https://developer.mozilla.org/en-US/docs/Web/API/Performance/memory"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-perf-memory","data-footnote-backref":"","aria-label":"Back to reference 18",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-measure-uasm",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"Monitor your web page's total memory usage with measureUserAgentSpecificMemory()"})," \u2014 highlights cross-origin isolation requirements and sampling guidance. ",(0,r.jsx)(n.a,{href:"https://web.dev/articles/monitor-total-page-memory-usage",children:"https://web.dev/articles/monitor-total-page-memory-usage"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-measure-uasm","data-footnote-backref":"","aria-label":"Back to reference 19",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-performanceobserver-buffer",children:["\n",(0,r.jsxs)(n.p,{children:["PerformanceObserver constructor docs noting dropped entries when the internal buffer fills and recommending explicit buffer sizing. ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver/PerformanceObserver",children:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver/PerformanceObserver"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-performanceobserver-buffer","data-footnote-backref":"","aria-label":"Back to reference 20",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7678:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(9430);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);