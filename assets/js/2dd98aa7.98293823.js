"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[9317],{7455:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"validation-performance-benchmarks-caching-design","title":"Validation Performance Benchmarks and Caching","description":"Document Control","source":"@site/../../docs/validation-performance-benchmarks-caching-design.md","sourceDirName":".","slug":"/validation-performance-benchmarks-caching-design","permalink":"/Idle-Game-Engine/validation-performance-benchmarks-caching-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/validation-performance-benchmarks-caching-design.md","tags":[],"version":"current","frontMatter":{}}');var r=i(5270),t=i(7678);const c={},l="Validation Performance Benchmarks and Caching",a={},d=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"Goals",id:"goals",level:3},{value:"Non-Goals",id:"non-goals",level:3},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"Validation Pipeline (<code>packages/content-schema/src/pack/</code>)",id:"validation-pipeline-packagescontent-schemasrcpack",level:3},{value:"Current Gaps",id:"current-gaps",level:3},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.2.1 Cache Module",id:"621-cache-module",level:4},{value:"6.2.2 Early Digest Computation",id:"622-early-digest-computation",level:4},{value:"6.2.3 Validator Integration",id:"623-validator-integration",level:4},{value:"6.2.4 Benchmark Suite",id:"624-benchmark-suite",level:4},{value:"6.2.5 Synthetic Pack Generator",id:"625-synthetic-pack-generator",level:4},{value:"6.2.6 Baseline and Regression Detection",id:"626-baseline-and-regression-detection",level:4},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"validation-performance-benchmarks-and-caching",children:"Validation Performance Benchmarks and Caching"})}),"\n",(0,r.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Title"}),": Add validation performance benchmarks and caching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authors"}),": Claude Code"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reviewers"}),": Repository maintainers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-02"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Related Issues"}),": #158 (this issue), #11 (Content DSL Schema parent), #137 (Content schema rollout)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,r.jsx)(n.p,{children:"This design introduces performance benchmarks and validation result caching for content pack validation. The solution addresses the risk of slow validation blocking authoring workflows on large content packs (500+ entities). Key deliverables include: an in-memory validation cache keyed by content digest, a synthetic pack generator for stress testing, a benchmark suite using tinybench with CI regression detection, and performance documentation for content authors."}),"\n",(0,r.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Background"}),": The content validation pipeline performs structural validation (Zod), cross-reference checks, cycle detection, balance validation, and normalization. Design docs recommend caching normalized results (content-dsl-schema-design.md \xa77), but no caching exists today. No performance benchmarks exist to establish baselines or catch regressions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Running complex validation on large content packs could be slow, blocking authoring workflows. Without benchmarks, we cannot measure performance or detect regressions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forces"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Target: ",(0,r.jsx)(n.code,{children:"<100ms"})," for 100-entity packs, ",(0,r.jsx)(n.code,{children:"<500ms"})," for 500-entity packs"]}),"\n",(0,r.jsx)(n.li,{children:"Caching must reduce repeat validation time by >90%"}),"\n",(0,r.jsx)(n.li,{children:"CI must catch performance regressions before merge"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,r.jsx)(n.h3,{id:"goals",children:"Goals"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Implement in-memory validation result caching with >90% speedup on repeat validations"}),"\n",(0,r.jsx)(n.li,{children:"Create performance benchmarks measuring validation stages (schema, cross-ref, cycles, normalization)"}),"\n",(0,r.jsx)(n.li,{children:"Generate synthetic large packs (500+ resources, 200+ generators) for stress testing"}),"\n",(0,r.jsx)(n.li,{children:"Establish CI regression detection with baseline comparison (fail on >25% regression)"}),"\n",(0,r.jsx)(n.li,{children:"Document performance characteristics for content authors"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"non-goals",children:"Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Worker-based validation (deferred unless main-thread blocking observed)"}),"\n",(0,r.jsx)(n.li,{children:"File-based persistent caching (in-memory sufficient for CLI workflows)"}),"\n",(0,r.jsx)(n.li,{children:"Balance validation optimization (separate concern)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Primary Stakeholders"}),": Content authors, CI/CD pipelines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Roles"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implementation Agent: Creates cache module, benchmarks, and CI integration"}),"\n",(0,r.jsx)(n.li,{children:"Docs Agent: Updates performance documentation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/content-schema"})," (cache, digest extraction, validator integration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:".github/workflows/quality-gate.yml"})," (benchmark step)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility Considerations"}),": Cache is opt-in via options; no breaking changes to existing API"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,r.jsxs)(n.h3,{id:"validation-pipeline-packagescontent-schemasrcpack",children:["Validation Pipeline (",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/"}),")"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Schema validation"})," (",(0,r.jsx)(n.code,{children:"schema.ts"}),"): Zod structural parsing with ",(0,r.jsx)(n.code,{children:"superRefine"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cross-reference validation"})," (",(0,r.jsx)(n.code,{children:"validate-cross-references.ts"}),", 1232 lines): Entity reference checks, formula tree walking"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cycle detection"})," (",(0,r.jsx)(n.code,{children:"validate-cycles.ts"}),", 588 lines): DFS graph traversal for unlock conditions and transforms"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Balance validation"})," (",(0,r.jsx)(n.code,{children:"balance.ts"}),", 1102 lines): Formula progression evaluation at sample levels"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Normalization"})," (",(0,r.jsx)(n.code,{children:"normalize.ts"}),", ~500 lines): Sorting, lookup map building, digest computation"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"current-gaps",children:"Current Gaps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No caching: Each validation run starts from scratch"}),"\n",(0,r.jsx)(n.li,{children:"No benchmarks: No visibility into performance characteristics"}),"\n",(0,r.jsx)(n.li,{children:"No large test packs: Sample pack has ~100 entities"}),"\n",(0,r.jsx)(n.li,{children:"Digest computed at end of normalization, preventing cache lookup early in pipeline"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Validation Pipeline                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Input Pack JSON                                            \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u2502\n\u2502  \u2502 Zod Parse    \u2502 \u2500\u2500\u2500 Structural validation                \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2502\n\u2502         \u2502                                                   \u2502\n\u2502         \u25bc                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502  \u2502Compute Digest\u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Cache Lookup   \u2502                  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502         \u2502                      \u2502                            \u2502\n\u2502         \u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502         \u2502            \u2502                   \u2502                  \u2502\n\u2502         \u2502         HIT\u2502                MISS\u2502                 \u2502\n\u2502         \u2502            \u25bc                   \u2502                  \u2502\n\u2502         \u2502     Return cached              \u2502                  \u2502\n\u2502         \u2502     NormalizedPack             \u2502                  \u2502\n\u2502         \u2502                                \u25bc                  \u2502\n\u2502         \u25bc                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502 Cross-ref checks   \u2502         \u2502\n\u2502  \u2502              \u2502           \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524         \u2502\n\u2502  \u2502              \u2502           \u2502 Cycle detection    \u2502         \u2502\n\u2502  \u2502              \u2502           \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524         \u2502\n\u2502  \u2502              \u2502           \u2502 Balance validation \u2502         \u2502\n\u2502  \u2502              \u2502           \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524         \u2502\n\u2502  \u2502              \u2502           \u2502 Normalization      \u2502         \u2502\n\u2502  \u2502              \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502  \u2502              \u2502                     \u2502                    \u2502\n\u2502  \u2502              \u2502                     \u25bc                    \u2502\n\u2502  \u2502              \u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u2502              \u2502           \u2502   Cache Store     \u2502         \u2502\n\u2502  \u2502              \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502  \u2502              \u2502                     \u2502                    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u25bc                    \u2502\n\u2502                              Return NormalizedPack          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,r.jsx)(n.h4,{id:"621-cache-module",children:"6.2.1 Cache Module"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/cache.ts"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export interface ValidationCache {\n  get(digest: string): CachedValidationResult | undefined;\n  set(digest: string, result: CachedValidationResult): void;\n  clear(): void;\n  readonly size: number;\n}\n\nexport interface CachedValidationResult {\n  pack: NormalizedContentPack;\n  warnings: readonly ValidationWarning[];\n  timestamp: number;\n}\n\nexport interface ValidationCacheOptions {\n  maxSize?: number;  // Default: 100, LRU eviction\n}\n\nexport function createValidationCache(options?: ValidationCacheOptions): ValidationCache;\n"})}),"\n",(0,r.jsx)(n.h4,{id:"622-early-digest-computation",children:"6.2.2 Early Digest Computation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/digest.ts"})]}),"\n",(0,r.jsx)(n.p,{children:"Extract digest computation from normalization to enable cache lookup after Zod parsing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export function computePackDigest(pack: ContentPack): PackDigest;\n\nexport interface PackDigest {\n  version: number;  // Digest algorithm version\n  hash: string;     // FNV-1a hex string\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"623-validator-integration",children:"6.2.3 Validator Integration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/index.ts"})]}),"\n",(0,r.jsxs)(n.p,{children:["Add cache option to ",(0,r.jsx)(n.code,{children:"ContentSchemaOptions"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface ContentSchemaOptions {\n  // ... existing options\n  cache?: ValidationCache;  // Optional cache instance\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Flow modification:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Parse with Zod schema"}),"\n",(0,r.jsx)(n.li,{children:"Compute digest from parsed pack"}),"\n",(0,r.jsx)(n.li,{children:"Check cache for digest \u2192 return cached result on hit"}),"\n",(0,r.jsx)(n.li,{children:"Run cross-reference, cycle, balance validation"}),"\n",(0,r.jsx)(n.li,{children:"Normalize (reuse pre-computed digest)"}),"\n",(0,r.jsx)(n.li,{children:"Store in cache"}),"\n",(0,r.jsx)(n.li,{children:"Return result"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"624-benchmark-suite",children:"6.2.4 Benchmark Suite"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/benchmarks/"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"benchmarks/\n\u251c\u2500\u2500 validation.bench.mjs      # Main benchmark suite\n\u251c\u2500\u2500 pack-generator.mjs        # Synthetic pack generator\n\u251c\u2500\u2500 baseline.json             # Performance baselines\n\u2514\u2500\u2500 run-benchmarks.mjs        # Runner with regression check\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Scenarios"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Scenario"}),(0,r.jsx)(n.th,{children:"Resources"}),(0,r.jsx)(n.th,{children:"Generators"}),(0,r.jsx)(n.th,{children:"Upgrades"}),(0,r.jsx)(n.th,{children:"Total Entities"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tiny-pack"}),(0,r.jsx)(n.td,{children:"20"}),(0,r.jsx)(n.td,{children:"10"}),(0,r.jsx)(n.td,{children:"10"}),(0,r.jsx)(n.td,{children:"~40"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"medium-pack"}),(0,r.jsx)(n.td,{children:"100"}),(0,r.jsx)(n.td,{children:"50"}),(0,r.jsx)(n.td,{children:"50"}),(0,r.jsx)(n.td,{children:"~200"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"large-pack"}),(0,r.jsx)(n.td,{children:"500"}),(0,r.jsx)(n.td,{children:"200"}),(0,r.jsx)(n.td,{children:"150"}),(0,r.jsx)(n.td,{children:"~850"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Metrics per scenario"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"validation_total_ms"})," - Full validation pipeline"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"schema_parse_ms"})," - Zod structural validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cross_ref_ms"})," - Cross-reference checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cycle_detection_ms"})," - Graph traversal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"normalization_ms"})," - Sorting + lookup map building"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cache_hit_ms"})," - Cached validation (repeat run)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"625-synthetic-pack-generator",children:"6.2.5 Synthetic Pack Generator"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/benchmarks/pack-generator.mjs"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface PackGeneratorOptions {\n  resources: number;\n  generators: number;\n  upgrades: number;\n  achievements?: number;  // defaults to resources / 10\n  automations?: number;   // defaults to generators / 10\n  seed?: number;          // For reproducible generation\n}\n\nfunction generateSyntheticPack(options: PackGeneratorOptions): ContentPack;\n"})}),"\n",(0,r.jsx)(n.p,{children:"Uses seeded mulberry32 PRNG for deterministic generation. Creates valid cross-references between entities."}),"\n",(0,r.jsx)(n.h4,{id:"626-baseline-and-regression-detection",children:"6.2.6 Baseline and Regression Detection"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/content-schema/benchmarks/baseline.json"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "version": 1,\n  "updatedAt": "2026-01-02T00:00:00Z",\n  "thresholdPercent": 25,\n  "scenarios": {\n    "tiny-pack": { "validation_total_ms": 15, "cache_hit_ms": 0.5 },\n    "medium-pack": { "validation_total_ms": 45, "cache_hit_ms": 0.8 },\n    "large-pack": { "validation_total_ms": 180, "cache_hit_ms": 1.2 }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Regression check: Fail if ",(0,r.jsx)(n.code,{children:"current > baseline * 1.25"})," for any metric."]}),"\n",(0,r.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment"}),": No runtime deployment; affects build-time validation only"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry"}),": Benchmark JSON output follows ",(0,r.jsx)(n.code,{children:"docs/benchmark-output-schema.md"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security"}),": No security implications; validation is read-only"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,r.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Issue Title"}),(0,r.jsx)(n.th,{children:"Scope Summary"}),(0,r.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,r.jsx)(n.th,{children:"Dependencies"}),(0,r.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Extract digest computation"}),(0,r.jsx)(n.td,{children:"Move digest from normalize.ts to digest.ts"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Unit tests pass, existing behavior unchanged"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Implement validation cache"}),(0,r.jsx)(n.td,{children:"Create cache.ts with LRU eviction"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"Digest extraction"}),(0,r.jsx)(n.td,{children:"Cache hit/miss tests pass"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Integrate cache with validator"}),(0,r.jsx)(n.td,{children:"Add cache option to createContentPackValidator"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"Cache module"}),(0,r.jsx)(n.td,{children:"Integration tests pass"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Create synthetic pack generator"}),(0,r.jsx)(n.td,{children:"Implement pack-generator.mjs"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Generates valid packs of configurable size"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Create benchmark suite"}),(0,r.jsx)(n.td,{children:"Implement validation.bench.mjs"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"Pack generator"}),(0,r.jsx)(n.td,{children:"Benchmarks run and output JSON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Add baseline and regression check"}),(0,r.jsx)(n.td,{children:"Implement run-benchmarks.mjs with baseline comparison"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"Benchmark suite"}),(0,r.jsx)(n.td,{children:"CI fails on >25% regression"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CI integration"}),(0,r.jsx)(n.td,{children:"Add benchmark step to quality-gate.yml"}),(0,r.jsx)(n.td,{children:"Implementation Agent"}),(0,r.jsx)(n.td,{children:"Regression check"}),(0,r.jsx)(n.td,{children:"Benchmarks run in CI"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Documentation"}),(0,r.jsx)(n.td,{children:"Create content-validation-performance.md"}),(0,r.jsx)(n.td,{children:"Docs Agent"}),(0,r.jsx)(n.td,{children:"All above"}),(0,r.jsx)(n.td,{children:"Doc covers usage and targets"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 1"}),": Core implementation (cache, digest, validator integration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 2"}),": Benchmarks and CI integration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 3"}),": Documentation and baseline tuning"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hand-off Package"}),": This design document, existing benchmark patterns in ",(0,r.jsx)(n.code,{children:"packages/core/benchmarks/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication Cadence"}),": Single PR with all changes; review before merge"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Context Packets"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa77 (performance requirements)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/benchmarks/"})," (existing benchmark patterns)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/benchmark-output-schema.md"})," (JSON output format)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use type-only imports per project convention"}),"\n",(0,r.jsx)(n.li,{children:"Follow existing benchmark patterns (tinybench, JSON output)"}),"\n",(0,r.jsxs)(n.li,{children:["Commit style: ",(0,r.jsx)(n.code,{children:"feat(content-schema): ..."})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Do not modify existing validation logic (only add caching layer)"}),"\n",(0,r.jsx)(n.li,{children:"Benchmarks must be deterministic (use seeded RNG)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pnpm test"})," must pass"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pnpm lint"})," must pass"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pnpm typecheck"})," must pass"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pnpm --filter @idle-engine/content-schema bench"})," must complete"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Alternative"}),(0,r.jsx)(n.th,{children:"Reason Rejected"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Cache in content-compiler"}),(0,r.jsx)(n.td,{children:"Less reusable; validation is the expensive operation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Composite cache key (id+version+digest)"}),(0,r.jsx)(n.td,{children:"Digest-only is simpler and content-addressable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Vitest bench mode"}),(0,r.jsx)(n.td,{children:"Less control over output format; existing pattern uses tinybench"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Static large JSON fixtures"}),(0,r.jsx)(n.td,{children:"Bloats repo; programmatic generation is more flexible"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Hard CI performance gates"}),(0,r.jsx)(n.td,{children:"Environment variance causes flaky failures; relative regression is more robust"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"File-based persistent caching"}),(0,r.jsx)(n.td,{children:"In-memory sufficient for CLI workflows; adds complexity"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit Tests"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache module: hit/miss/eviction/clear tests"}),"\n",(0,r.jsx)(n.li,{children:"Digest extraction: matches existing normalization output"}),"\n",(0,r.jsx)(n.li,{children:"Pack generator: produces valid packs of specified sizes"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration Tests"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cached validation returns same result as uncached"}),"\n",(0,r.jsx)(n.li,{children:"Cache hit is significantly faster than miss (>90% speedup)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Benchmark suite measures all validation stages"}),"\n",(0,r.jsx)(n.li,{children:"CI regression detection with 25% threshold"}),"\n",(0,r.jsxs)(n.li,{children:["Target: ",(0,r.jsx)(n.code,{children:"<100ms"})," for 100 entities, ",(0,r.jsx)(n.code,{children:"<500ms"})," for 500 entities"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Risk"}),(0,r.jsx)(n.th,{children:"Impact"}),(0,r.jsx)(n.th,{children:"Mitigation"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CI environment variance causes false failures"}),(0,r.jsx)(n.td,{children:"Flaky builds"}),(0,r.jsx)(n.td,{children:"Use 25% threshold; median instead of mean"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Cache invalidation bugs cause stale results"}),(0,r.jsx)(n.td,{children:"Incorrect validation"}),(0,r.jsx)(n.td,{children:"Digest-based key ensures content changes invalidate cache"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Large pack generation is slow"}),(0,r.jsx)(n.td,{children:"Slow benchmarks"}),(0,r.jsx)(n.td,{children:"Cache generated packs; use reasonable sizes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Digest computation overhead"}),(0,r.jsx)(n.td,{children:"Slower validation"}),(0,r.jsx)(n.td,{children:"FNV-1a is fast; overhead is negligible"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milestones"}),": Single PR containing all changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Strategy"}),": Cache is opt-in; no migration needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication"}),": Update CLAUDE.md with ",(0,r.jsx)(n.code,{children:"pnpm bench"})," command"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,r.jsx)(n.p,{children:"None remaining after design discussion."}),"\n",(0,r.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Worker-based validation for very large packs (if main-thread blocking observed)"}),"\n",(0,r.jsx)(n.li,{children:"Persistent file-based caching for watch mode optimization"}),"\n",(0,r.jsxs)(n.li,{children:["Integration with ",(0,r.jsx)(n.code,{children:"pnpm generate"})," timing output"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa77 - Performance requirements"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/content-schema-rollout-decisions.md"})," \xa75.6 - Issue #143 mapping"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/index.ts"})," - Current validator"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"})," - Current digest computation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core/benchmarks/"})," - Existing benchmark patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/benchmark-output-schema.md"})," - JSON output specification"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Term"}),(0,r.jsx)(n.th,{children:"Definition"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Content Pack"}),(0,r.jsx)(n.td,{children:"JSON document defining game content (resources, generators, upgrades, etc.)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"NormalizedContentPack"}),(0,r.jsx)(n.td,{children:"Validated, frozen, lookup-indexed pack ready for runtime consumption"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Digest"}),(0,r.jsx)(n.td,{children:"FNV-1a hash of canonical pack representation for identity/caching"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Cross-reference validation"}),(0,r.jsx)(n.td,{children:"Checking that entity references (e.g., upgrade \u2192 resource) are valid"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Date"}),(0,r.jsx)(n.th,{children:"Author"}),(0,r.jsx)(n.th,{children:"Change Summary"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2026-01-02"}),(0,r.jsx)(n.td,{children:"Claude Code"}),(0,r.jsx)(n.td,{children:"Initial draft"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},7678:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var s=i(9430);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);