"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[3265],{7678:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>r});var i=s(9430);const t={},c=i.createContext(t);function d(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(c.Provider,{value:n},e.children)}},9506:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"entity-content-module-design-issue-587","title":"Entity Content Module Design (Issue 587)","description":"Document Control","source":"@site/../../docs/entity-content-module-design-issue-587.md","sourceDirName":".","slug":"/entity-content-module-design-issue-587","permalink":"/Idle-Game-Engine/entity-content-module-design-issue-587","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/entity-content-module-design-issue-587.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Entity Content Module Design (Issue 587)","sidebar_position":4}}');var t=s(5270),c=s(7678);const d={title:"Entity Content Module Design (Issue 587)",sidebar_position:4},r="Entity Content Module Design (Issue 587)",l={},a=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A - Glossary",id:"appendix-a---glossary",level:2},{value:"Appendix B - Change Log",id:"appendix-b---change-log",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"entity-content-module-design-issue-587",children:"Entity Content Module Design (Issue 587)"})}),"\n",(0,t.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Title"}),": Define entity content module schema for issue 587"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authors"}),": Design-Authoring Agent (AI)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reviewers"}),": TODO (Owner: Content Schema Maintainer)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-02"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Related Issues"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/587",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/587"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/735",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/735"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,t.jsxs)(n.p,{children:["For issue 587 on GitHub, this design defines the entity content module schema in ",(0,t.jsx)(n.code,{children:"@idle-engine/content-schema"}),", integrates it into the content pack contract, and establishes validation, normalization, and typing expectations so entity authoring is deterministic, safe, and ready for AI-led implementation."]}),"\n",(0,t.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Background (Issue 587)"}),": The content pack schema currently validates resources, generators, upgrades, metrics, achievements, automations, transforms, prestige layers, and runtime events in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"}),", but lacks an entity module despite upcoming entity-focused systems described in issue 587."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Problem (Issue 587)"}),": Content authors cannot express units, heroes, or NPCs with stats and progression in a validated pack, blocking authoring workflows and schema-level safety checks for issue 587."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Forces (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Preserve strict schema conventions and deterministic normalization established in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Maintain backward compatibility by defaulting new pack fields in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Keep validation aligned with existing cross-reference and formula validation in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/formulas.ts"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goals (Issue 587)"}),":","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Add an ",(0,t.jsx)(n.code,{children:"entities"})," content module schema with stat, progression, and visibility fields, exporting Zod schemas and TypeScript types."]}),"\n",(0,t.jsxs)(n.li,{children:["Integrate ",(0,t.jsx)(n.code,{children:"entities"})," into ",(0,t.jsx)(n.code,{children:"contentPackSchema"}),", normalization, lookup maps, and digest generation for issue 587."]}),"\n",(0,t.jsx)(n.li,{children:"Extend cross-reference validation to cover entity fields that reference resources, formulas, and conditions."}),"\n",(0,t.jsxs)(n.li,{children:["Add unit and integration tests that mirror existing patterns in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/__tests__/resources.test.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/__tests__/types.test.ts"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Non-Goals (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement entity runtime state, mission transforms, or progression logic in ",(0,t.jsx)(n.code,{children:"packages/core"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Introduce new condition kinds or formula reference types beyond current schemas in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/conditions.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/formulas.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Update ",(0,t.jsx)(n.code,{children:"packages/content-sample/content/pack.json"})," unless explicitly requested."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Primary Stakeholders (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Content schema maintainers."}),"\n",(0,t.jsx)(n.li,{children:"Content authors validating entity data."}),"\n",(0,t.jsx)(n.li,{children:"Runtime system designers preparing entity systems."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Agent Roles (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Schema Implementation Agent: implement ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/entities.ts"})," and exports."]}),"\n",(0,t.jsxs)(n.li,{children:["Validation Agent: update ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"})," for entity fields."]}),"\n",(0,t.jsxs)(n.li,{children:["Normalization Agent: extend ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"})," and pack types."]}),"\n",(0,t.jsxs)(n.li,{children:["Testing Agent: add ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/__tests__/entities.test.ts"})," and integration updates."]}),"\n",(0,t.jsxs)(n.li,{children:["Docs Agent: align schema documentation in ",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," if required."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Affected Packages/Services (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema"})," (module schema, pack schema, normalization, validation, digest)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/"})," (design doc and optional schema documentation)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compatibility Considerations (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Backward compatible with existing packs by defaulting ",(0,t.jsx)(n.code,{children:"entities"})," to ",(0,t.jsx)(n.code,{children:"[]"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Digest version stays the same but payload expands to include entities in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-helpers.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Feature gate version for entities is ",(0,t.jsx)(n.strong,{children:"0.5.0"})," (resolved in #738)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,t.jsxs)(n.p,{children:["For issue 587, the content schema validates pack modules in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"}),", normalizes localized text in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"}),", and performs cross-reference checks in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"}),". Entity-like concepts are not modeled, and there is no ",(0,t.jsx)(n.code,{children:"entities"})," entry in ",(0,t.jsx)(n.code,{children:"ParsedContentPack"})," or ",(0,t.jsx)(n.code,{children:"NormalizedContentPack"}),". Validation and ordering patterns for new modules should follow ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,t.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Narrative (Issue 587)"}),": Add a new ",(0,t.jsx)(n.code,{children:"entities"})," module under ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules"}),", integrate it into the pack schema, normalization pipeline, cross-reference validation, and digest calculation, and export types and factories from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/index.ts"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/factories.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Diagram (Issue 587)"}),": N/A. TODO(owner: Content Schema Maintainer) if a schema flow diagram is required."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Runtime Changes (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"None. This design affects schema validation only."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data & Schemas (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["New module: ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/entities.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Reuse base schemas:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"contentIdSchema"})," from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/ids.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"localizedTextSchema"})," and ",(0,t.jsx)(n.code,{children:"localizedSummarySchema"})," from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/localization.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"numericFormulaSchema"})," from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/formulas.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"conditionSchema"})," from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/conditions.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"positiveIntSchema"})," and ",(0,t.jsx)(n.code,{children:"integerSchema"})," from ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/numbers.ts"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Proposed entity stat schema:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"entityStatSchema"}),": ",(0,t.jsx)(n.code,{children:"{ id, name, baseValue, minValue?, maxValue? }"})," with ",(0,t.jsx)(n.code,{children:"id"})," normalized to lowercase and validated with a stat id regex, and ",(0,t.jsx)(n.code,{children:"name"})," as localized text."]}),"\n",(0,t.jsxs)(n.li,{children:["Enforce unique stat ids within each entity definition (same pattern as ",(0,t.jsx)(n.code,{children:"ensureUniqueResourceHandles"})," in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Proposed progression schema:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"entityProgressionSchema"}),": ",(0,t.jsx)(n.code,{children:"{ experienceResource?, levelFormula, maxLevel?, statGrowth }"})," with ",(0,t.jsx)(n.code,{children:"statGrowth"})," keyed by stat ids and validated against declared stats."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"experienceResource"})," must reference a resource id when set; validate via cross-reference checks."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Entity definition schema:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Fields aligned with issue 587: ",(0,t.jsx)(n.code,{children:"id"}),", ",(0,t.jsx)(n.code,{children:"name"}),", ",(0,t.jsx)(n.code,{children:"description"}),", ",(0,t.jsx)(n.code,{children:"stats"}),", ",(0,t.jsx)(n.code,{children:"maxCount"}),", ",(0,t.jsx)(n.code,{children:"startCount"}),", ",(0,t.jsx)(n.code,{children:"trackInstances"}),", ",(0,t.jsx)(n.code,{children:"progression"}),", ",(0,t.jsx)(n.code,{children:"unlockCondition"}),", ",(0,t.jsx)(n.code,{children:"visibilityCondition"}),", ",(0,t.jsx)(n.code,{children:"unlocked"}),", ",(0,t.jsx)(n.code,{children:"visible"}),", ",(0,t.jsx)(n.code,{children:"tags"}),", ",(0,t.jsx)(n.code,{children:"order"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"startCount"})," should be a non-negative integer; use the ",(0,t.jsx)(n.code,{children:"integerSchema"})," pattern in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tags"})," follow the existing normalization pattern in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"})," and are deduped + lowercased."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Collection schema:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"entityCollectionSchema"})," should enforce unique entity ids and deterministic ordering by ",(0,t.jsx)(n.code,{children:"order"})," then ",(0,t.jsx)(n.code,{children:"id"}),", consistent with ",(0,t.jsx)(n.code,{children:"resourceCollectionSchema"})," and ",(0,t.jsx)(n.code,{children:"generatorCollectionSchema"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"APIs & Contracts (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"}),": add ",(0,t.jsx)(n.code,{children:"entities: entityCollectionSchema.default([])"})," and update ",(0,t.jsx)(n.code,{children:"ParsedContentPack"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/types.ts"}),": add ",(0,t.jsx)(n.code,{children:"NormalizedEntity"}),", update lookup maps and ",(0,t.jsx)(n.code,{children:"serializedLookup"})," with entities."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-helpers.ts"}),": include entities in ",(0,t.jsx)(n.code,{children:"ContentPackDigestModules"})," and the digest payload."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/index.ts"}),": export new schemas and types."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/factories.ts"}),": add ",(0,t.jsx)(n.code,{children:"createEntity"})," and ",(0,t.jsx)(n.code,{children:"EntityInput"})," for ergonomic authoring."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tooling & Automation (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Extend tests under ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/__tests__"})," and ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/__tests__"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Run ",(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-schema"})," and update coverage via ",(0,t.jsx)(n.code,{children:"pnpm coverage:md"})," if required."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deployment (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Publish updated ",(0,t.jsx)(n.code,{children:"@idle-engine/content-schema"})," after merge."]}),"\n",(0,t.jsx)(n.li,{children:"No runtime deployment changes are required."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Telemetry & Observability (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Not applicable for schema-only work."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Security & Compliance (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No PII or new security surfaces introduced."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,t.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,t.jsx)(n.p,{children:"Populate the table as the canonical source for downstream GitHub issues for issue 587."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Issue Title"}),(0,t.jsx)(n.th,{children:"Scope Summary"}),(0,t.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,t.jsx)(n.th,{children:"Dependencies"}),(0,t.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"feat(content-schema): add entity module schemas (issue-587)"}),(0,t.jsxs)(n.td,{children:["Implement ",(0,t.jsx)(n.code,{children:"entities.ts"})," schemas, defaults, and ordering"]}),(0,t.jsx)(n.td,{children:"Schema Implementation Agent"}),(0,t.jsx)(n.td,{children:"Design approval"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"entityDefinitionSchema"})," and ",(0,t.jsx)(n.code,{children:"entityCollectionSchema"})," exported; stats normalized and unique"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"feat(content-schema): integrate entities into pack schema (issue-587)"}),(0,t.jsxs)(n.td,{children:["Update ",(0,t.jsx)(n.code,{children:"pack/schema.ts"}),", ",(0,t.jsx)(n.code,{children:"pack/types.ts"}),", ",(0,t.jsx)(n.code,{children:"pack/normalize.ts"})]}),(0,t.jsx)(n.td,{children:"Normalization Agent"}),(0,t.jsx)(n.td,{children:"Module schema"}),(0,t.jsxs)(n.td,{children:["Pack parses ",(0,t.jsx)(n.code,{children:"entities"}),", normalized pack includes entities, lookups updated"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"feat(content-schema): extend validation for entity references (issue-587)"}),(0,t.jsx)(n.td,{children:"Add cross-reference validation for entity formulas and experienceResource"}),(0,t.jsx)(n.td,{children:"Validation Agent"}),(0,t.jsx)(n.td,{children:"Pack integration"}),(0,t.jsxs)(n.td,{children:["Invalid references fail; formulas checked with ",(0,t.jsx)(n.code,{children:"collectFormulaEntityReferences"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"test(content-schema): add entity schema tests (issue-587)"}),(0,t.jsx)(n.td,{children:"Add unit and integration tests, update type assertions"}),(0,t.jsx)(n.td,{children:"Testing Agent"}),(0,t.jsx)(n.td,{children:"Schema + integration"}),(0,t.jsxs)(n.td,{children:["Tests added, ",(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-schema"})," passes"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"docs(content-schema): document entity module (issue-587)"}),(0,t.jsx)(n.td,{children:"Update schema documentation and quick reference"}),(0,t.jsx)(n.td,{children:"Docs Agent"}),(0,t.jsx)(n.td,{children:"Schema merged"}),(0,t.jsx)(n.td,{children:"Docs reflect entity module fields and examples"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Phase 1 (Issue 587)"}),": Land schema, pack integration, and normalization updates."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Phase 2 (Issue 587)"}),": Land cross-reference validation, tests, and documentation updates."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hand-off Package (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-helpers.ts"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Communication Cadence (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Async daily updates in issue 587; review checkpoints after each issue-map row."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context Packets (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"docs/design-document-template.md"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/formulas.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/conditions.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prompting & Constraints (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"import type"})," and ",(0,t.jsx)(n.code,{children:"export type"})," for type-only symbols (eslint enforced)."]}),"\n",(0,t.jsxs)(n.li,{children:["Follow existing tag normalization and ordering conventions in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Keep schema strict with ",(0,t.jsx)(n.code,{children:".strict()"})," and provide defaults for optional fields."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Safety Rails (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Do not edit generated ",(0,t.jsx)(n.code,{children:"dist/"})," outputs."]}),"\n",(0,t.jsx)(n.li,{children:"Do not reset git history or remove unrelated changes."}),"\n",(0,t.jsxs)(n.li,{children:["Avoid console output that could corrupt the ",(0,t.jsx)(n.code,{children:"vitest-llm-reporter"})," JSON payload."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validation Hooks (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-schema"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm lint"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pnpm coverage:md"})," if coverage changes"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Alternative (Issue 587)"}),": Reuse ",(0,t.jsx)(n.code,{children:"resources"})," as entities. Rejected because resources lack stat, progression, and per-entity semantics."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Alternative (Issue 587)"}),": Allow untyped JSON blobs for entities. Rejected due to loss of validation, normalization, and type safety."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Alternative (Issue 587)"}),": Defer entity schema until mission transforms land. Rejected because issue 587 requires entity authoring now."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unit / Integration (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/__tests__/entities.test.ts"})," mirroring patterns in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/__tests__/resources.test.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Update ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/__tests__/types.test.ts"})," to assert entity types in ",(0,t.jsx)(n.code,{children:"NormalizedContentPack"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Extend integration fixtures in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/__fixtures__/integration-packs.ts"})," if needed."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No new benchmarks required; keep validation cost consistent with existing pack validation."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tooling / A11y (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Not applicable for schema-only work."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Risk (Issue 587)"}),": Digest cache fails to update when entities change.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mitigation (Issue 587)"}),": Add entities to digest payload in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-helpers.ts"})," and cover with tests."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Risk (Issue 587)"}),": Stat growth keys drift from declared stats.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mitigation (Issue 587)"}),": Validate ",(0,t.jsx)(n.code,{children:"statGrowth"})," keys against ",(0,t.jsx)(n.code,{children:"stats"})," ids in the entity schema."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Risk (Issue 587)"}),": Feature gate version for entities remains undefined.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mitigation (Issue 587)"}),": Decide and add a new gate entry in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"})," if required."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Milestones (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Merge schema and pack integration changes."}),"\n",(0,t.jsx)(n.li,{children:"Merge validation and tests."}),"\n",(0,t.jsxs)(n.li,{children:["Publish updated ",(0,t.jsx)(n.code,{children:"@idle-engine/content-schema"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Migration Strategy (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Maintain backward compatibility by defaulting ",(0,t.jsx)(n.code,{children:"entities"})," to ",(0,t.jsx)(n.code,{children:"[]"})," in ",(0,t.jsx)(n.code,{children:"contentPackSchema"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Update downstream TypeScript types and integration points to include entities."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Communication (Issue 587)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Announce schema update in release notes and link to this design doc."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Content Schema Maintainer) Should stat ids reuse ",(0,t.jsx)(n.code,{children:"contentIdSchema"})," or remain a stricter snake_case pattern?"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": Resolved in #738: Entities require runtime >=0.5.0 (",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Content Design Lead) Should ",(0,t.jsx)(n.code,{children:"statGrowth"})," be required when ",(0,t.jsx)(n.code,{children:"progression"})," is present?"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Systems Designer) Should ",(0,t.jsx)(n.code,{children:"minValue"})," and ",(0,t.jsx)(n.code,{children:"maxValue"})," enforce constant-formula bounds at schema time?"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Docs Agent) Update ",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," and ",(0,t.jsx)(n.code,{children:"docs/content-quick-reference.md"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Content Team) Add entity examples to ",(0,t.jsx)(n.code,{children:"packages/content-sample/content/pack.json"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue 587"}),": TODO(owner: Runtime Agent) Implement entity runtime systems in ",(0,t.jsx)(n.code,{children:"packages/core"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"docs/design-document-template.md"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/normalize.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/validate-cross-references.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-helpers.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/resources.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/generators.ts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/587",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/587"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"appendix-a---glossary",children:"Appendix A - Glossary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Entity (Issue 587)"}),": A content-defined unit, hero, or NPC with stats, progression, and visibility controls."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Entity Stat (Issue 587)"}),": A named numeric attribute within an entity definition."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Progression (Issue 587)"}),": Leveling rules that govern XP requirements and stat growth."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"trackInstances (Issue 587)"}),": Flag indicating whether entities are tracked individually rather than as counts."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"appendix-b---change-log",children:"Appendix B - Change Log"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Date"}),(0,t.jsx)(n.th,{children:"Author"}),(0,t.jsx)(n.th,{children:"Change Summary"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2026-01-02"}),(0,t.jsx)(n.td,{children:"Design-Authoring Agent (AI)"}),(0,t.jsx)(n.td,{children:"Initial draft for issue 587"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);