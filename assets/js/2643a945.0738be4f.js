"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[615],{7437:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"runtime-wiring-helper-design-issue-525","title":"Runtime Wiring Helper \u2014 Standard Runtime Integration (issue-525)","description":"Document Control","source":"@site/../../docs/runtime-wiring-helper-design-issue-525.md","sourceDirName":".","slug":"/runtime-wiring-helper-design-issue-525","permalink":"/Idle-Game-Engine/runtime-wiring-helper-design-issue-525","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/runtime-wiring-helper-design-issue-525.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Runtime Wiring Helper \u2014 Standard Runtime Integration (issue-525)","sidebar_position":4}}');var r=s(5270),t=s(7678);const d={title:"Runtime Wiring Helper \u2014 Standard Runtime Integration (issue-525)",sidebar_position:4},o=void 0,l={},c=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"Example snippets (for review)",id:"example-snippets-for-review",level:4},{value:"Use the helper",id:"use-the-helper",level:5},{value:"Manual wiring reference",id:"manual-wiring-reference",level:5},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Title"}),": Provide a standard runtime wiring helper (issue-525)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authors"}),": Idle Engine Design-Authoring Agent (AI)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reviewers"}),": Core Runtime Maintainers; Shell-Web Maintainers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-12-18"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Related Issues"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/525",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/525"}),", ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/560",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/560"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,r.jsxs)(n.p,{children:["This design document addresses GitHub issue ",(0,r.jsx)(n.strong,{children:"#525"})," by introducing a first-class helper in ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})," that wires ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," to ",(0,r.jsx)(n.code,{children:"ProgressionCoordinator"}),", ",(0,r.jsx)(n.code,{children:"ProductionSystem"}),", ",(0,r.jsx)(n.code,{children:"AutomationSystem"}),", and standard command handlers in a deterministic, tested, and documented order. The helper reduces shell-specific glue code and prevents order-sensitive integration bugs by providing a canonical system sequence (including optional finalize/apply semantics) plus a reference manual wiring snippet for advanced shells that opt out."]}),"\n",(0,r.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Background"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Shells currently wire runtime subsystems manually, including command queue/dispatcher, the progression coordinator, automation system, and per-step coordinator updates (example: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"IdleEngineRuntime.tick()"})," executes commands for ",(0,r.jsx)(n.code,{children:"currentStep"}),", then runs added systems in registration order (",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:273"}),"), making system ordering a correctness constraint."]}),"\n",(0,r.jsxs)(n.li,{children:["Production can be integrated via ",(0,r.jsx)(n.code,{children:"createProductionSystem"}),", including an opt-in finalize/apply mode (",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick"}),") that requires ",(0,r.jsx)(n.code,{children:"ResourceState.finalizeTick"})," ordering correctness (",(0,r.jsx)(n.code,{children:"packages/core/src/production-system.ts:309"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Problem"})," (issue-525):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A typical game loop needs to connect:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Runtime step lifecycle (",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Progression updates aligned with runtime steps (",(0,r.jsx)(n.code,{children:"ProgressionCoordinator.updateForStep"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Production execution order (especially when using finalize/apply semantics)"}),"\n",(0,r.jsx)(n.li,{children:"Automation execution order and unlock wiring (upgrade-granted automation ids)"}),"\n",(0,r.jsx)(n.li,{children:"Registration of standard command handlers (resource/generator/upgrade/prestige, plus automation control)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Today this wiring is order-sensitive and re-implemented per shell/harness, which is easy to get wrong and hard to review consistently (examples: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/offline-catchup-command-handlers.test.ts:79"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forces"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Determinism"}),": Wiring must preserve deterministic step stamping and timestamps (see ",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md:1"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": The helper must not impose per-step O(N) overhead beyond existing system work; it must be safe for offline catch-up and backlog processing."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API stability"}),": The helper must be optional and additive; manual wiring remains supported (issue-525)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Correctness under backlog"}),": ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime.tick()"})," may process multiple steps per invocation (",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:282"}),"), so order-sensitive logic must remain correct under multi-step processing."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goals"}),":","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Implement issue-525 by adding a core-owned helper that produces a working, standard-wired runtime with minimal glue code."}),"\n",(0,r.jsxs)(n.li,{children:["Provide a ",(0,r.jsx)(n.strong,{children:"canonical, documented system ordering"})," for: progression updates, production, automation, and (when enabled) finalize/apply semantics."]}),"\n",(0,r.jsx)(n.li,{children:"Register standard command handlers as part of the wiring helper, including resource/generator/upgrade/prestige handlers and automation toggle handlers."}),"\n",(0,r.jsx)(n.li,{children:"Add a unit test that asserts the helper\u2019s system ordering and step-update semantics (issue-525 acceptance criteria)."}),"\n",(0,r.jsx)(n.li,{children:"Add documentation that includes a manual reference wiring snippet and diagram (issue-525 acceptance criteria)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replacing or rewriting ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"}),"\u2019s tick loop semantics (out of scope for issue-525; only a helper/reference implementation is required)."]}),"\n",(0,r.jsx)(n.li,{children:"Refactoring ProductionSystem to a command-only model (documented in older notes; not required to satisfy issue-525)."}),"\n",(0,r.jsx)(n.li,{children:"Building new shell-web UI panels or changing worker-bridge message schemas; only wiring simplification is in scope."}),"\n",(0,r.jsxs)(n.li,{children:["Standardizing tick scheduling, snapshot publication, or transport buffering; shells/harnesses remain responsible for publishing state (e.g., via ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"}),") and choosing a publish cadence."]}),"\n",(0,r.jsx)(n.li,{children:"Enforcing a single \u201cone true\u201d game loop for all shells; advanced shells may keep manual wiring (issue-525)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Primary Stakeholders"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Core Runtime Maintainers (API surface, determinism guarantees)"}),"\n",(0,r.jsx)(n.li,{children:"Shell-Web Maintainers (worker wiring, state publication cadence)"}),"\n",(0,r.jsx)(n.li,{children:"Content Authors (indirectly: fewer integration bugs in production/automation unlock flows)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Roles"})," (AI-led execution):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime Implementation Agent"}),": implement helper API in ",(0,r.jsx)(n.code,{children:"packages/core"}),", ensure exports across Node/browser entrypoints."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test & Determinism Agent"}),": add unit/integration tests that assert system order and step-update semantics under multi-step ",(0,r.jsx)(n.code,{children:"runtime.tick"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docs Agent"}),": write manual wiring reference and ordering diagram; cross-link to relevant existing docs and code."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shell Integration Agent"}),": adopt the helper in ",(0,r.jsx)(n.code,{children:"packages/shell-web"})," worker wiring (optional but recommended), ensuring no behavior regressions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core"})," (new helper + tests + documentation references)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/shell-web"})," (optional adoption; reduced wiring code)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/"})," (new/updated documentation for standard wiring)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility Considerations"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The helper is additive; existing manual wiring remains valid."}),"\n",(0,r.jsx)(n.li,{children:"System IDs introduced by the helper must be stable and documented so tests, telemetry, and diagnostics timelines remain readable."}),"\n",(0,r.jsxs)(n.li,{children:["The helper must preserve existing step-stamping semantics (",(0,r.jsx)(n.code,{children:"runtime.getNextExecutableStep()"})," and ",(0,r.jsx)(n.code,{children:"context.step + 1"})," patterns)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime step lifecycle and system ordering"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Commands for ",(0,r.jsx)(n.code,{children:"currentStep"})," execute before systems, and systems run in the order added (",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:309"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:373"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Multi-step processing can occur in a single ",(0,r.jsx)(n.code,{children:"tick(deltaMs)"})," call (",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:282"}),"), so per-step wiring must be correct under backlog."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shell-web wiring today (manual, order-sensitive)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Worker constructs queue/dispatcher/runtime, creates a progression coordinator, registers resource command handlers, wires automation system, and adds a coordinator update system that calls ",(0,r.jsx)(n.code,{children:"updateForStep(step + 1, { events })"})," (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"}),", ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:208"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Production is not wired in the worker today, so other harnesses re-implement production ordering (example test harness: ",(0,r.jsx)(n.code,{children:"packages/core/src/offline-catchup-command-handlers.test.ts:79"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Finalize/apply semantics are opt-in and integration-dependent"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createProductionSystem"})," supports ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick"})," which requires ",(0,r.jsx)(n.code,{children:"resourceState.finalizeTick(deltaMs)"})," for balances to update (",(0,r.jsx)(n.code,{children:"packages/core/src/production-system.ts:309"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ResourceState.applyIncome/applyExpense"})," are additive per tick and therefore require a publish/reset once per tick after ",(0,r.jsx)(n.code,{children:"snapshot({ mode: 'publish' })"})," (",(0,r.jsx)(n.code,{children:"docs/resource-state-storage-design.md:455"}),", ",(0,r.jsx)(n.code,{children:"packages/core/src/resource-state.ts:951"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"})," currently calls ",(0,r.jsx)(n.code,{children:"ResourceState.snapshot({ mode: 'publish' })"})," and then ",(0,r.jsx)(n.code,{children:"resetPerTickAccumulators()"})," as a side-effect (",(0,r.jsx)(n.code,{children:"packages/core/src/progression.ts:234"}),"), which is convenient but can be misapplied when steps are processed in batches."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Narrative"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Implement issue-525 by adding a ",(0,r.jsx)(n.strong,{children:"standard runtime wiring helper"})," in ",(0,r.jsx)(n.code,{children:"packages/core"})," that:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["creates or wires ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," + ",(0,r.jsx)(n.code,{children:"ProgressionCoordinator"})]}),"\n",(0,r.jsxs)(n.li,{children:["creates standard systems (",(0,r.jsx)(n.code,{children:"ProductionSystem"}),", ",(0,r.jsx)(n.code,{children:"AutomationSystem"}),", coordinator update system)"]}),"\n",(0,r.jsx)(n.li,{children:"registers standard command handlers"}),"\n",(0,r.jsx)(n.li,{children:"returns a small, inspectable wiring object that exposes the instantiated systems in canonical order"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"The helper is optional; manual wiring remains supported and documented."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Diagram"})," (logical ordering; finalize/apply system is conditional):","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"flowchart TD\n  A[IdleEngineRuntime.tick step N] --\x3e B[Execute commands @ step N]\n  B --\x3e C[System: ProductionSystem]\n  C --\x3e D{applyViaFinalizeTick?}\n  D -- yes --\x3e E[System: ResourceFinalizeSystem]\n  D -- no --\x3e F[System: AutomationSystem]\n  E --\x3e F[System: AutomationSystem]\n  F --\x3e G[System: ProgressionCoordinatorUpdateSystem<br/>updateForStep(step+1)]\n  G --\x3e H[Runtime increments currentStep to N+1]\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"New Core API surface (issue-525)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"createGameRuntime(options)"})," as the primary API for standard runtime integration (issue-525)."]}),"\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"wireGameRuntime(options)"})," as a lower-level primitive for shells that already constructed a runtime/coordinator but want canonical system wiring."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createGameRuntime"})," constructs ",(0,r.jsx)(n.code,{children:"CommandQueue"}),", ",(0,r.jsx)(n.code,{children:"CommandDispatcher"}),", ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"}),", and ",(0,r.jsx)(n.code,{children:"ProgressionCoordinator"}),", then delegates to ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," for system wiring + handler registration."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"wireGameRuntime"})," only wires systems + handlers; it does not own tick scheduling, worker messaging, or save/restore flows."]}),"\n",(0,r.jsxs)(n.li,{children:["Step size alignment (determinism): ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," MUST use a single ",(0,r.jsx)(n.code,{children:"stepSizeMs"})," value for both ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," and ",(0,r.jsx)(n.code,{children:"ProgressionCoordinator"})," (",(0,r.jsx)(n.code,{children:"stepDurationMs"}),"). ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," MUST validate alignment (or require the caller to pass the shared step size explicitly)."]}),"\n",(0,r.jsxs)(n.li,{children:["Provisional options (enough to satisfy issue-525 without over-scoping):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"content: NormalizedContentPack"})," (required)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stepSizeMs?: number"})," (default: ",(0,r.jsx)(n.code,{children:"100"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"maxStepsPerFrame?: number"})," (default: ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," default; when ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: true"})," and production is enabled, default becomes ",(0,r.jsx)(n.code,{children:"1"})," unless explicitly set; see Section 13)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialProgressionState?: ProgressionAuthoritativeState"})," (optional; passed to ",(0,r.jsx)(n.code,{children:"createProgressionCoordinator"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enableProduction?: boolean"})," (default: ",(0,r.jsx)(n.code,{children:"content.generators.length > 0"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enableAutomation?: boolean"})," (default: ",(0,r.jsx)(n.code,{children:"content.automations.length > 0"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enableTransforms?: boolean"})," (default: ",(0,r.jsx)(n.code,{children:"content.transforms.length > 0"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"production?: { applyViaFinalizeTick?: boolean }"})," (default: ",(0,r.jsx)(n.code,{children:"true"})," for ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),"; ",(0,r.jsx)(n.code,{children:"false"})," for ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),"; see finalize/apply notes below)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"registerOfflineCatchup?: boolean"})," (default: ",(0,r.jsx)(n.code,{children:"true"}),"; see Section 13)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Return a ",(0,r.jsx)(n.code,{children:"GameRuntimeWiring"})," object that includes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"runtime: IdleEngineRuntime"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"coordinator: ProgressionCoordinator"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"productionSystem?: ProductionSystem"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"automationSystem?: ReturnType<typeof createAutomationSystem>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transformSystem?: ReturnType<typeof createTransformSystem>"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"systems: readonly System[]"})," (the exact system instances in the order added; used by tests and diagnostics)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"commandQueue: CommandQueue"})," and ",(0,r.jsx)(n.code,{children:"commandDispatcher: CommandDispatcher"})," (or references via runtime getters)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Canonical system IDs and ordering"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The helper MUST add systems in a fixed, documented order matching the diagram above:","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Production (if content has generators, and production is enabled)"}),"\n",(0,r.jsxs)(n.li,{children:["Resource finalize (only when production is configured with ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: true"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Automation (if content has automations, and automation is enabled)"}),"\n",(0,r.jsx)(n.li,{children:"Transforms (if content has transforms, and transforms are enabled)"}),"\n",(0,r.jsx)(n.li,{children:"Progression coordinator update system (always; provides step alignment)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Ordering rationale:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Production runs before automation so resource mutations (or queued rates) are visible when automation evaluates thresholds."}),"\n",(0,r.jsxs)(n.li,{children:["When enabled, ",(0,r.jsx)(n.code,{children:"resourceState.finalizeTick(deltaMs)"})," runs immediately after production so balances are applied before automation reads amounts."]}),"\n",(0,r.jsx)(n.li,{children:"Transform runs after automation to mirror shell-web wiring and ensure automation toggles/commands land before transform evaluation."}),"\n",(0,r.jsxs)(n.li,{children:["The coordinator update system runs last and uses ",(0,r.jsx)(n.code,{children:"updateForStep(step + 1)"})," so achievement-derived unlocks/rewards (which are evaluated inside ",(0,r.jsx)(n.code,{children:"updateForStep"}),") become visible starting the next tick, avoiding \u201cunlock-and-fire\u201d chains within the same step while preserving immediate command-side effects."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Canonical system IDs (defaults; used by tests and diagnostics):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Production: ",(0,r.jsx)(n.code,{children:"production"})," (default id from ",(0,r.jsx)(n.code,{children:"createProductionSystem"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Resource finalize: ",(0,r.jsx)(n.code,{children:"resource-finalize"})," (new system owned by the helper)"]}),"\n",(0,r.jsxs)(n.li,{children:["Automation: ",(0,r.jsx)(n.code,{children:"automation-system"})," (id from ",(0,r.jsx)(n.code,{children:"createAutomationSystem"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Transform: ",(0,r.jsx)(n.code,{children:"transform-system"})," (id from ",(0,r.jsx)(n.code,{children:"createTransformSystem"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Coordinator update: ",(0,r.jsx)(n.code,{children:"progression-coordinator"})," (matches ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:209"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The coordinator update system MUST call ",(0,r.jsx)(n.code,{children:"coordinator.updateForStep(context.step + 1, { events: context.events })"})," to keep coordinator state aligned with the runtime\u2019s ",(0,r.jsx)(n.code,{children:"currentStep"})," after the tick completes (existing pattern: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:208"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard system wiring details"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Production: wire ",(0,r.jsx)(n.code,{children:"createProductionSystem"})," against coordinator generator state by mapping coordinator generators into ",(0,r.jsx)(n.code,{children:"GeneratorProductionState"})," (notably: ensure ",(0,r.jsx)(n.code,{children:"produces"}),"/",(0,r.jsx)(n.code,{children:"consumes"})," are always arrays; see snippet below) and ",(0,r.jsx)(n.code,{children:"coordinator.resourceState"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Automation: wire ",(0,r.jsx)(n.code,{children:"createAutomationSystem"})," using ",(0,r.jsx)(n.code,{children:"commandQueue: runtime.getCommandQueue()"}),", ",(0,r.jsx)(n.code,{children:"resourceState: createResourceStateAdapter(coordinator.resourceState)"}),", ",(0,r.jsx)(n.code,{children:"conditionContext: coordinator.getConditionContext()"}),", and ",(0,r.jsx)(n.code,{children:"isAutomationUnlocked: (id) => coordinator.getGrantedAutomationIds().has(id)"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Transforms: wire ",(0,r.jsx)(n.code,{children:"createTransformSystem"})," using ",(0,r.jsx)(n.code,{children:"transforms: content.transforms"}),", ",(0,r.jsx)(n.code,{children:"resourceState: createResourceStateAdapter(coordinator.resourceState)"}),", ",(0,r.jsx)(n.code,{children:"conditionContext: coordinator.getConditionContext()"}),", and ",(0,r.jsx)(n.code,{children:"stepDurationMs"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Finalize/apply semantics wiring"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: true"}),", insert a ",(0,r.jsx)(n.code,{children:"ResourceFinalizeSystem"})," immediately after production and before automation so that:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["production can queue per-second rates (",(0,r.jsx)(n.code,{children:"applyIncome/applyExpense"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"resourceState.finalizeTick(context.deltaMs)"})," applies balances before automation evaluates resource thresholds"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["When ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: false"}),", do not add finalize system (avoid per-step O(resourceCount) finalize loops)."]}),"\n",(0,r.jsxs)(n.li,{children:["UI rate display note: when using the core ",(0,r.jsx)(n.code,{children:"ResourceState"})," (supports ",(0,r.jsx)(n.code,{children:"finalizeTick"}),"), direct-apply production updates balances but does not populate ",(0,r.jsx)(n.code,{children:"incomePerSecond"})," / ",(0,r.jsx)(n.code,{children:"expensePerSecond"})," / ",(0,r.jsx)(n.code,{children:"netPerSecond"}),", so ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot(...).resources[].perTick"})," will remain ",(0,r.jsx)(n.code,{children:"0"})," unless finalize/apply semantics (or alternative rate tracking) are used. ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," defaults ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick"})," to ",(0,r.jsx)(n.code,{children:"true"})," to avoid this; ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," keeps explicit opt-in for advanced wiring."]}),"\n",(0,r.jsxs)(n.li,{children:["Multi-step tick constraint: per-second rate fields are additive and must be cleared once per tick after a ",(0,r.jsx)(n.code,{children:"snapshot({ mode: 'publish' })"})," + ",(0,r.jsx)(n.code,{children:"resetPerTickAccumulators()"})," boundary (",(0,r.jsx)(n.code,{children:"docs/resource-state-storage-design.md:455"}),"). When ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: true"}),", the integration MUST ensure that boundary occurs once per processed step; the simplest safe default is to keep ",(0,r.jsx)(n.code,{children:"maxStepsPerFrame: 1"})," (or otherwise ensure only one step runs between resource publish/resets). Offline/backlog fast-forward can still run by looping ticks and publishing/resetting per step, forwarding only the final snapshot to the UI."]}),"\n",(0,r.jsxs)(n.li,{children:["Documentation MUST explicitly state that per-second rate accumulators are additive and require a publish/reset per tick (",(0,r.jsx)(n.code,{children:"packages/core/src/resource-state.ts:951"}),"), and link to ",(0,r.jsx)(n.code,{children:"docs/resource-state-storage-design.md:455"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard command handler registration"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The helper MUST register:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"registerResourceCommandHandlers"})," with coordinator-derived evaluators (generator purchases + toggles, plus optional upgrade/prestige evaluators when present) (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:170"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"registerAutomationCommandHandlers"})," when automation is enabled (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:215"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"registerTransformCommandHandlers"})," when transforms are enabled (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:225"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The helper SHOULD register ",(0,r.jsx)(n.code,{children:"registerOfflineCatchupCommandHandler"})," by default (",(0,r.jsx)(n.code,{children:"registerOfflineCatchup: true"}),") and allow opting out for shells that manage offline reconciliation externally (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:188"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation deliverable (issue-525)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This design doc MUST include:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A \u201cuse the helper\u201d snippet"}),"\n",(0,r.jsx)(n.li,{children:"A \u201cmanual wiring reference\u201d snippet showing the same ordering and required calls"}),"\n",(0,r.jsxs)(n.li,{children:["A diagram of tick ordering and the ",(0,r.jsx)(n.code,{children:"updateForStep(step + 1)"})," rationale"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["This page MUST cross-link to existing lifecycle notes (",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md:1"}),") and the worker as a concrete example (",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-snippets-for-review",children:"Example snippets (for review)"}),"\n",(0,r.jsx)(n.h5,{id:"use-the-helper",children:"Use the helper"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { buildProgressionSnapshot, createGameRuntime } from '@idle-engine/core';\nimport type { NormalizedContentPack } from '@idle-engine/content-schema';\n\nexport function createWorkerRuntime(content: NormalizedContentPack) {\n  const wiring = createGameRuntime({\n    content,\n    stepSizeMs: 100,\n    registerOfflineCatchup: true,\n    // production: { applyViaFinalizeTick: false }, // opt out of rate tracking\n    // maxStepsPerFrame: 1, // defaults to 1 when applyViaFinalizeTick is true\n  });\n\n  const { runtime, coordinator } = wiring;\n\n  return {\n    runtime,\n    coordinator,\n    tick(deltaMs: number, publishedAt: number) {\n      const processedSteps = runtime.tick(deltaMs);\n      if (processedSteps === 0) {\n        return undefined;\n      }\n\n      // Coordinator state is already step-aligned by the update system.\n      return buildProgressionSnapshot(\n        runtime.getCurrentStep(),\n        publishedAt,\n        coordinator.state,\n      );\n    },\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h5,{id:"manual-wiring-reference",children:"Manual wiring reference"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {\n  CommandDispatcher,\n  CommandQueue,\n  IdleEngineRuntime,\n  createAutomationSystem,\n  createProductionSystem,\n  createProgressionCoordinator,\n  createResourceStateAdapter,\n  registerAutomationCommandHandlers,\n  registerOfflineCatchupCommandHandler,\n  registerResourceCommandHandlers,\n} from '@idle-engine/core';\nimport type { NormalizedContentPack } from '@idle-engine/content-schema';\n\nconst STEP_SIZE_MS = 100;\n\nexport function wireRuntimeManually(content: NormalizedContentPack) {\n  const applyViaFinalizeTick = true;\n\n  const commandQueue = new CommandQueue();\n  const commandDispatcher = new CommandDispatcher();\n  const runtime = new IdleEngineRuntime({\n    commandQueue,\n    commandDispatcher,\n    stepSizeMs: STEP_SIZE_MS,\n    ...(applyViaFinalizeTick ? { maxStepsPerFrame: 1 } : {}),\n  });\n\n  const coordinator = createProgressionCoordinator({\n    content,\n    stepDurationMs: STEP_SIZE_MS,\n  });\n\n  registerResourceCommandHandlers({\n    dispatcher: runtime.getCommandDispatcher(),\n    resources: coordinator.resourceState,\n    generatorPurchases: coordinator.generatorEvaluator,\n    generatorToggles: coordinator,\n    ...(coordinator.upgradeEvaluator\n      ? { upgradePurchases: coordinator.upgradeEvaluator }\n      : {}),\n    ...(coordinator.prestigeEvaluator\n      ? { prestigeSystem: coordinator.prestigeEvaluator }\n      : {}),\n  });\n\n  registerOfflineCatchupCommandHandler({\n    dispatcher: runtime.getCommandDispatcher(),\n    coordinator,\n    runtime,\n  });\n\n  const productionSystem = createProductionSystem({\n    applyViaFinalizeTick,\n    generators: () =>\n      (coordinator.state.generators ?? []).map((generator) => ({\n        id: generator.id,\n        owned: generator.owned,\n        enabled: generator.enabled,\n        produces: generator.produces ?? [],\n        consumes: generator.consumes ?? [],\n      })),\n    resourceState: coordinator.resourceState,\n  });\n  runtime.addSystem(productionSystem);\n\n  if (applyViaFinalizeTick) {\n    runtime.addSystem({\n      id: 'resource-finalize',\n      tick: ({ deltaMs }) => coordinator.resourceState.finalizeTick(deltaMs),\n    });\n  }\n\n  const automationSystem = createAutomationSystem({\n    automations: content.automations,\n    commandQueue: runtime.getCommandQueue(),\n    resourceState: createResourceStateAdapter(coordinator.resourceState),\n    stepDurationMs: STEP_SIZE_MS,\n    conditionContext: coordinator.getConditionContext(),\n    isAutomationUnlocked: (automationId) =>\n      coordinator.getGrantedAutomationIds().has(automationId),\n  });\n  runtime.addSystem(automationSystem);\n\n  runtime.addSystem({\n    id: 'progression-coordinator',\n    tick: ({ step, events }) => {\n      coordinator.updateForStep(step + 1, { events });\n    },\n  });\n\n  registerAutomationCommandHandlers({\n    dispatcher: runtime.getCommandDispatcher(),\n    automationSystem,\n  });\n\n  return { runtime, coordinator };\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment"}),": No runtime deployment changes; this is a library-level additive helper in ",(0,r.jsx)(n.code,{children:"packages/core"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry & Observability"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["System IDs provided by the helper should be stable to keep diagnostics readable (see ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," diagnostics timeline integration in ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:294"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Helper-generated wiring should not introduce new nondeterministic timestamps; continue using deterministic timestamps for automation enqueues as implemented (",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md:44"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security & Compliance"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No new PII surface; the helper only composes existing runtime components."}),"\n",(0,r.jsxs)(n.li,{children:["The helper must not relax command authorization rules (command authorization remains enforced by ",(0,r.jsx)(n.code,{children:"CommandDispatcher"}),"/authorizers; out of scope for issue-525)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,r.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Issue Title"}),(0,r.jsx)(n.th,{children:"Scope Summary"}),(0,r.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,r.jsx)(n.th,{children:"Dependencies"}),(0,r.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"feat(core): add createGameRuntime wiring helper (issue-525)"})}),(0,r.jsxs)(n.td,{children:["Implement ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," + ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),", canonical system IDs/order, and standard handler registration."]}),(0,r.jsx)(n.td,{children:"Runtime Implementation Agent"}),(0,r.jsx)(n.td,{children:"Design approved"}),(0,r.jsxs)(n.td,{children:["Helper exported from both Node and browser entrypoints; ",(0,r.jsx)(n.code,{children:"systems"})," list exposes canonical order; manual wiring remains possible."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"test(core): assert runtime wiring helper order + step semantics (issue-525)"})}),(0,r.jsxs)(n.td,{children:["Add unit test(s) verifying ",(0,r.jsx)(n.code,{children:"systems"})," order and ",(0,r.jsx)(n.code,{children:"updateForStep(step+1)"})," alignment with ",(0,r.jsx)(n.code,{children:"runtime.getCurrentStep()"}),"."]}),(0,r.jsx)(n.td,{children:"Test & Determinism Agent"}),(0,r.jsx)(n.td,{children:"Helper implementation"}),(0,r.jsxs)(n.td,{children:["Tests pass under multi-step ",(0,r.jsx)(n.code,{children:"runtime.tick"})," backlog; no flaky wall-clock dependence."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docs: add runtime wiring helper reference + manual snippet (issue-525)"})}),(0,r.jsx)(n.td,{children:"New docs page with diagram/snippets; update cross-links from lifecycle docs if needed."}),(0,r.jsx)(n.td,{children:"Docs Agent"}),(0,r.jsx)(n.td,{children:"Helper API shape finalized"}),(0,r.jsx)(n.td,{children:"Docs include helper snippet + manual wiring reference + ordering diagram; links to core code paths."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"chore(shell-web): adopt core wiring helper in runtime.worker (issue-525)"})}),(0,r.jsx)(n.td,{children:"Replace manual worker wiring with helper (optional but recommended)."}),(0,r.jsx)(n.td,{children:"Shell Integration Agent"}),(0,r.jsx)(n.td,{children:"Helper + docs"}),(0,r.jsx)(n.td,{children:"Worker compiles; behavior parity for automation and coordinator updates; no change to bridge schema."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 1 (Core API + tests)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Deliver ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),"/",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),", register handlers, and add unit tests proving order + step semantics."]}),"\n",(0,r.jsx)(n.li,{children:"Gate: reviewers approve API naming and canonical system ordering."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 2 (Docs + reference adoption)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Publish docs page with diagram and manual wiring snippet."}),"\n",(0,r.jsxs)(n.li,{children:["Optionally adopt in ",(0,r.jsx)(n.code,{children:"packages/shell-web"})," worker for dogfooding."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hand-off Package"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Issue scope: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/525",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/525"})]}),"\n",(0,r.jsxs)(n.li,{children:["Reference wiring: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"})]}),"\n",(0,r.jsxs)(n.li,{children:["Runtime ordering: ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:309"})]}),"\n",(0,r.jsxs)(n.li,{children:["Finalize/apply semantics: ",(0,r.jsx)(n.code,{children:"packages/core/src/production-system.ts:309"})]}),"\n",(0,r.jsxs)(n.li,{children:["Publish/reset requirement: ",(0,r.jsx)(n.code,{children:"packages/core/src/resource-state.ts:951"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication Cadence"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Daily async updates in PR thread; request review once tests + docs are included."}),"\n",(0,r.jsx)(n.li,{children:"Escalate any proposed changes to the defaults in Section 13 before merging."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Context Packets"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Load issue text via ",(0,r.jsx)(n.code,{children:"gh issue view 525 --repo hansjm10/Idle-Game-Engine"})," (source of truth)."]}),"\n",(0,r.jsxs)(n.li,{children:["Read worker wiring reference: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Read runtime step ordering: ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:273"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Read per-tick accumulator rules: ",(0,r.jsx)(n.code,{children:"docs/resource-state-storage-design.md:455"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use TypeScript ES modules; follow ",(0,r.jsx)(n.code,{children:"@typescript-eslint/consistent-type-imports"})," and type-only exports (",(0,r.jsx)(n.code,{children:"AGENTS.md"})," repo root)."]}),"\n",(0,r.jsx)(n.li,{children:"Keep helper optional and additive; do not remove manual wiring pathways."}),"\n",(0,r.jsxs)(n.li,{children:["Keep system order a single source of truth (returned ",(0,r.jsx)(n.code,{children:"systems"})," list must match actual registration order)."]}),"\n",(0,r.jsx)(n.li,{children:"Avoid nondeterministic timestamps in tests; prefer step-based values."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Do not edit checked-in generated ",(0,r.jsx)(n.code,{children:"dist/"})," outputs (repo guideline)."]}),"\n",(0,r.jsx)(n.li,{children:"Do not add console logging in tests (Vitest reporter expects clean output)."}),"\n",(0,r.jsx)(n.li,{children:"Do not change command type names or authorization policies as part of issue-525."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm lint"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pnpm test --filter shell-web"})," (only if worker wiring changes land)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status quo (manual wiring in each shell)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rejected: repeats order-sensitive logic and fails issue-525\u2019s \u201cminimal glue code\u201d goal."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docs-only reference without helper"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rejected: improves guidance but does not prevent incorrect wiring; issue-525 explicitly requests a helper and a unit test."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Make ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"})," auto-wire progression/production/automation internally"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rejected: too opinionated and risks breaking advanced shells; helper must remain optional (issue-525)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Place helper in ",(0,r.jsx)(n.code,{children:"packages/shell-web"})," instead of ",(0,r.jsx)(n.code,{children:"packages/core"})]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rejected: core should own canonical wiring to keep multiple shells/harnesses consistent."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add unit tests in ",(0,r.jsx)(n.code,{children:"packages/core"})," that:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["assert ",(0,r.jsx)(n.code,{children:"systems.map((s) => s.id)"})," matches canonical order (issue-525 acceptance criteria)"]}),"\n",(0,r.jsxs)(n.li,{children:["assert ",(0,r.jsx)(n.code,{children:"coordinator.getLastUpdatedStep()"})," aligns with ",(0,r.jsx)(n.code,{children:"runtime.getCurrentStep()"})," after ticking (step-update semantics)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Add at least one test case that exercises ",(0,r.jsx)(n.code,{children:"runtime.tick"})," processing >1 step per call (to catch ordering regressions under backlog)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No new hot-loop allocations beyond existing wiring; avoid per-step O(N) work in helper itself."}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick"})," is enabled (default in ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),"), document the cost and make opt-out explicit; keep ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," opt-in."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling / A11y"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Not applicable to issue-525 unless ",(0,r.jsx)(n.code,{children:"shell-web"})," UI flows change."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk: Incorrect canonical ordering causes subtle simulation drift"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mitigation: unit tests asserting system order + step-update semantics; document order with diagram and code references."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk: Helper becomes too opinionated and blocks advanced shells"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: keep helper optional; provide ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," for partial adoption; document manual wiring."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk: Browser/Node entrypoint export drift"})," (",(0,r.jsx)(n.code,{children:"index.ts"})," vs ",(0,r.jsx)(n.code,{children:"index.browser.ts"}),").","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mitigation: add export tests or a single source module imported by both entrypoints (implementation detail to be decided by Runtime Implementation Agent)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Risk: Performance regressions in backlog/offline catchup"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: keep finalize/apply opt-in for ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),", clamp ",(0,r.jsx)(n.code,{children:"maxStepsPerFrame"})," to ",(0,r.jsx)(n.code,{children:"1"})," by default when rate tracking is enabled in ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),", and avoid per-step snapshot publication inside the helper."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milestones"}),":","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Land helper + tests in ",(0,r.jsx)(n.code,{children:"packages/core"})," (issue-525 Phase 1)."]}),"\n",(0,r.jsx)(n.li,{children:"Publish docs page with helper + manual reference wiring (issue-525 Phase 2)."}),"\n",(0,r.jsxs)(n.li,{children:["Optionally migrate ",(0,r.jsx)(n.code,{children:"packages/shell-web"})," worker to helper for dogfooding."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Strategy"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No data migrations; API is additive."}),"\n",(0,r.jsx)(n.li,{children:"Shells can migrate incrementally: adopt helper in new shells first; optionally refactor existing worker wiring."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Announce the helper in ",(0,r.jsx)(n.code,{children:"docs/automation-authoring-guide.md"})," or a runtime integration guide as follow-up (see Section 14)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,r.jsxs)(n.p,{children:["The following items are treated as ",(0,r.jsx)(n.strong,{children:"resolved decisions"})," for the issue-525 implementation."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API naming"}),": Use ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," + ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Matches issue-525 wording (\u201chelper like ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),"\u201d), aligns with existing ",(0,r.jsx)(n.code,{children:"create*"})," factory naming (",(0,r.jsx)(n.code,{children:"createVerificationRuntime"}),"), and keeps one high-level entrypoint plus one composition-friendly primitive."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automation ordering semantics"}),": Keep ",(0,r.jsx)(n.code,{children:"AutomationSystem"})," ",(0,r.jsx)(n.strong,{children:"before"})," the coordinator update system, and keep the coordinator update system ",(0,r.jsx)(n.strong,{children:"last"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Matches existing shell-web wiring, keeps step alignment invariant (",(0,r.jsx)(n.code,{children:"coordinator.getLastUpdatedStep() === runtime.getCurrentStep()"})," after a tick), and avoids same-step \u201cachievement unlock \u2192 automation fires\u201d chains."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Offline catchup default"}),": Default ",(0,r.jsx)(n.code,{children:"registerOfflineCatchup: true"}),", with an opt-out.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Matches shell-web, and command authorization already blocks ",(0,r.jsx)(n.code,{children:"OFFLINE_CATCHUP"})," from ",(0,r.jsx)(n.code,{children:"PLAYER"})," priority, keeping the handler safe-by-default."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Production default mode"}),": Default ",(0,r.jsx)(n.code,{children:"production.applyViaFinalizeTick: true"})," in ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),"; keep ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," opt-in (",(0,r.jsx)(n.code,{children:"false"}),").","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Most shells want live rate display, and enabling finalize/apply avoids the confusing ",(0,r.jsx)(n.code,{children:"perTick = 0"})," default. The helper clamps ",(0,r.jsx)(n.code,{children:"maxStepsPerFrame"})," to ",(0,r.jsx)(n.code,{children:"1"})," when production is enabled to preserve accumulator safety; advanced shells can opt out via ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," or by setting ",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick: false"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Finalize/apply safety default"}),": When ",(0,r.jsx)(n.code,{children:"production.applyViaFinalizeTick: true"})," and ",(0,r.jsx)(n.code,{children:"maxStepsPerFrame"})," is not provided, set ",(0,r.jsx)(n.code,{children:"maxStepsPerFrame = 1"})," (when production is enabled).","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Prevents a subtle but severe drift bug when ",(0,r.jsx)(n.code,{children:"runtime.tick()"})," processes multiple steps per call while per-second rate buffers are additive and only reset on publish/reset boundaries."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transforms"}),": Wire ",(0,r.jsx)(n.code,{children:"TransformSystem"})," in the helper when transforms are present (issue-598).","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Rationale: Matches shell-web wiring, keeps save/load access to transform state, and remains opt-in via ",(0,r.jsx)(n.code,{children:"enableTransforms"})," or empty ",(0,r.jsx)(n.code,{children:"content.transforms"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add an \u201cintegration guide\u201d page that consolidates runtime wiring helper usage, state publication patterns, and common pitfalls (Owner: Docs Agent)."}),"\n",(0,r.jsxs)(n.li,{children:["Provide a ",(0,r.jsx)(n.code,{children:"wireGameRuntime"})," example in ",(0,r.jsx)(n.code,{children:"tools/"})," or ",(0,r.jsx)(n.code,{children:"packages/content-sample"})," for headless simulation harnesses (Owner: Runtime Implementation Agent)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["GitHub issue #525: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/525",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/525"})]}),"\n",(0,r.jsxs)(n.li,{children:["Worker manual wiring example: ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:127"})]}),"\n",(0,r.jsxs)(n.li,{children:["Coordinator update semantics (step + 1): ",(0,r.jsx)(n.code,{children:"packages/shell-web/src/runtime.worker.ts:208"})]}),"\n",(0,r.jsxs)(n.li,{children:["Runtime tick ordering (commands then systems): ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:309"})]}),"\n",(0,r.jsxs)(n.li,{children:["Production finalize/apply option: ",(0,r.jsx)(n.code,{children:"packages/core/src/production-system.ts:309"})]}),"\n",(0,r.jsxs)(n.li,{children:["Per-tick accumulator reset guard: ",(0,r.jsx)(n.code,{children:"packages/core/src/resource-state.ts:951"})]}),"\n",(0,r.jsxs)(n.li,{children:["Snapshot builder resets accumulators: ",(0,r.jsx)(n.code,{children:"packages/core/src/progression.ts:234"})]}),"\n",(0,r.jsxs)(n.li,{children:["Backlog/multi-step processing behavior: ",(0,r.jsx)(n.code,{children:"packages/core/src/index.ts:282"})]}),"\n",(0,r.jsxs)(n.li,{children:["Resource publish/reset design rationale: ",(0,r.jsx)(n.code,{children:"docs/resource-state-storage-design.md:455"})]}),"\n",(0,r.jsxs)(n.li,{children:["Step stamping overview: ",(0,r.jsx)(n.code,{children:"docs/runtime-step-lifecycle.md:1"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue-525"}),": GitHub issue \u201cenhancement(core): provide standard runtime wiring helper\u201d defining the scope for this initiative."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wiring helper"}),": A core-provided function that constructs and/or wires runtime subsystems in a canonical order and registers handlers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Coordinator update system"}),": A runtime system that calls ",(0,r.jsx)(n.code,{children:"ProgressionCoordinator.updateForStep(step + 1)"})," so coordinator-derived state aligns with ",(0,r.jsx)(n.code,{children:"IdleEngineRuntime.getCurrentStep()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Finalize/apply semantics"}),": Production mode (",(0,r.jsx)(n.code,{children:"applyViaFinalizeTick"}),") where systems queue per-second rates and ",(0,r.jsx)(n.code,{children:"ResourceState.finalizeTick(deltaMs)"})," applies balances."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Per-tick accumulators"}),": ",(0,r.jsx)(n.code,{children:"ResourceState"})," fields (",(0,r.jsx)(n.code,{children:"incomePerSecond"}),", ",(0,r.jsx)(n.code,{children:"expensePerSecond"}),", ",(0,r.jsx)(n.code,{children:"netPerSecond"}),", ",(0,r.jsx)(n.code,{children:"tickDelta"}),") that must be reset once per tick after publishing."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Date"}),(0,r.jsx)(n.th,{children:"Author"}),(0,r.jsx)(n.th,{children:"Change Summary"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2025-12-17"}),(0,r.jsx)(n.td,{children:"Idle Engine Design-Authoring Agent (AI)"}),(0,r.jsx)(n.td,{children:"Initial draft for issue-525: standard runtime wiring helper proposal, canonical ordering, tests, docs, and AI-led work plan."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2025-12-18"}),(0,r.jsx)(n.td,{children:"Codex CLI (AI)"}),(0,r.jsx)(n.td,{children:"Resolve issue-525 defaults (API naming, ordering, offline catchup, production mode, finalize safety, transforms scope) and align the doc wording with existing runtime/worker behavior."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2025-12-21"}),(0,r.jsx)(n.td,{children:"Codex CLI (AI)"}),(0,r.jsx)(n.td,{children:"Document transform wiring in the helper (issue-598) and update canonical ordering + handler registration notes."})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>o});var i=s(9430);const r={},t=i.createContext(r);function d(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);