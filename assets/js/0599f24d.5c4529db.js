"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[580],{5603:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"accessibility-smoke-tests-design","title":"Automated Accessibility Smoke Tests","description":"Issue: #5 &mdash; Tooling & QA Workstream","source":"@site/../../docs/accessibility-smoke-tests-design.md","sourceDirName":".","slug":"/accessibility-smoke-tests-design","permalink":"/Idle-Game-Engine/accessibility-smoke-tests-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/accessibility-smoke-tests-design.md","tags":[],"version":"current","frontMatter":{},"sidebar":"developerSidebar","previous":{"title":"Content Validation CLI Design Document","permalink":"/Idle-Game-Engine/content-validation-cli-design"},"next":{"title":"Worker Bridge Extension Tutorial","permalink":"/Idle-Game-Engine/worker-bridge-extension-tutorial"}}');var t=s(5270),l=s(7678);const r={},o="Automated Accessibility Smoke Tests",c={},d=[{value:"1. Problem Statement",id:"1-problem-statement",level:2},{value:"2. Goals",id:"2-goals",level:2},{value:"3. Non-Goals",id:"3-non-goals",level:2},{value:"4. Current State",id:"4-current-state",level:2},{value:"5. Proposed Solution",id:"5-proposed-solution",level:2},{value:"5.1 Tooling Selection",id:"51-tooling-selection",level:3},{value:"5.2 Workspace &amp; Layout",id:"52-workspace--layout",level:3},{value:"5.3 Test Flow",id:"53-test-flow",level:3},{value:"5.4 CI &amp; Local Workflow Integration",id:"54-ci--local-workflow-integration",level:3},{value:"5.5 Reporting &amp; Observability",id:"55-reporting--observability",level:3},{value:"6. Rollout Steps",id:"6-rollout-steps",level:2},{value:"7. Risks &amp; Mitigations",id:"7-risks--mitigations",level:2},{value:"8. Open Questions",id:"8-open-questions",level:2},{value:"9. Acceptance Criteria",id:"9-acceptance-criteria",level:2}];function a(e){const i={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"automated-accessibility-smoke-tests",children:"Automated Accessibility Smoke Tests"})}),"\n",(0,t.jsx)(i.p,{children:"Issue: #5 \u2014 Tooling & QA Workstream"}),"\n",(0,t.jsx)(i.h2,{id:"1-problem-statement",children:"1. Problem Statement"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The web shell (",(0,t.jsx)(i.code,{children:"@idle-engine/shell-web"}),") currently has no automated accessibility coverage."]}),"\n",(0,t.jsx)(i.li,{children:"Manual audits are easy to defer and become stale as UI surfaces evolve."}),"\n",(0,t.jsx)(i.li,{children:"Without early a11y feedback, regressions can ship unnoticed and cause downstream rework."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"2-goals",children:"2. Goals"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Provide a repeatable smoke test that blocks obvious WCAG 2.1 A/AA violations on the primary shell experience."}),"\n",(0,t.jsx)(i.li,{children:"Keep feedback loops under one minute so the test can run locally and in continuous integration."}),"\n",(0,t.jsx)(i.li,{children:"Produce machine-readable reports so failures are actionable (selectors, rule IDs, details)."}),"\n",(0,t.jsx)(i.li,{children:"Establish a structure that scales to additional UI surfaces (future pages, modals, overlays)."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"3-non-goals",children:"3. Non-Goals"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Performing exhaustive accessibility audits or visual regression testing."}),"\n",(0,t.jsx)(i.li,{children:"Covering service backends or non-web clients."}),"\n",(0,t.jsx)(i.li,{children:"Enforcing design token-level contrast compliance (handled separately by design system)."}),"\n",(0,t.jsx)(i.li,{children:"Replacing component-level unit tests run under Vitest."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"4-current-state",children:"4. Current State"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The React/Vite shell renders a single landing view (",(0,t.jsx)(i.code,{children:"packages/shell-web/src/modules/App.tsx"}),") without automated browser tests."]}),"\n",(0,t.jsxs)(i.li,{children:["The monorepo relies on ",(0,t.jsx)(i.code,{children:"pnpm"}),", with ",(0,t.jsx)(i.code,{children:"lefthook"})," wired to run ",(0,t.jsx)(i.code,{children:"pnpm lint"}),", ",(0,t.jsx)(i.code,{children:"pnpm test:ci"}),", and ",(0,t.jsx)(i.code,{children:"pnpm build"}),", but no package defines an integration or end-to-end test script yet."]}),"\n",(0,t.jsxs)(i.li,{children:["A GitHub Actions CI workflow (",(0,t.jsx)(i.code,{children:".github/workflows/ci.yml"}),") already enforces lint, test, and build gates; this effort should extend that pipeline's ",(0,t.jsx)(i.code,{children:"pnpm test:ci"})," phase with accessibility coverage."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"5-proposed-solution",children:"5. Proposed Solution"}),"\n",(0,t.jsx)(i.h3,{id:"51-tooling-selection",children:"5.1 Tooling Selection"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Use ",(0,t.jsx)(i.strong,{children:"Playwright"})," for browser automation: lightweight, headless by default, first-class TypeScript support, and built-in server lifecycle helpers."]}),"\n",(0,t.jsxs)(i.li,{children:["Use ",(0,t.jsx)(i.strong,{children:"@axe-core/playwright"})," for WCAG rules. Axe provides rich metadata for violations and integrates cleanly with Playwright's ",(0,t.jsx)(i.code,{children:"Page"})," API."]}),"\n",(0,t.jsx)(i.li,{children:"Store Playwright code in TypeScript to keep parity with the rest of the repo and enable IDE assistance."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"52-workspace--layout",children:"5.2 Workspace & Layout"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Add a new workspace package ",(0,t.jsx)(i.code,{children:"tools/a11y-smoke-tests"})," (referenced by ",(0,t.jsx)(i.code,{children:"pnpm-workspace.yaml"}),"):","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"package.json"})," scripts:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"build"})," (noop placeholder for consistency)."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"test"})," \u2192 ",(0,t.jsx)(i.code,{children:"node ./scripts/run-playwright.cjs"}),", which forwards flags to ",(0,t.jsx)(i.code,{children:"playwright test"})," while rejecting the ",(0,t.jsx)(i.code,{children:"--ui"})," inspector mode."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"test:ci"})," \u2192 ",(0,t.jsx)(i.code,{children:"cross-env CI=1 playwright test --reporter=line"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"postinstall"})," \u2192 ",(0,t.jsx)(i.code,{children:"node ./scripts/install-playwright.cjs"}),", which skips work when cached browsers already exist and otherwise invokes ",(0,t.jsx)(i.code,{children:"pnpm exec playwright install"}),", adding ",(0,t.jsx)(i.code,{children:"--with-deps"})," only when running on Linux CI so cross-platform local installs stay compatible. The script should detect ",(0,t.jsx)(i.code,{children:"PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1"})," (or similar) and short-circuit cleanly so offline or air-gapped environments do not fail installs."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Dependencies: ",(0,t.jsx)(i.code,{children:"@playwright/test"}),", ",(0,t.jsx)(i.code,{children:"@axe-core/playwright"}),", ",(0,t.jsx)(i.code,{children:"cross-env"}),", ",(0,t.jsx)(i.code,{children:"typescript"}),", ",(0,t.jsx)(i.code,{children:"ts-node"})," (for config), and shared ESLint config if linting is enabled later."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"playwright.config.ts"})," with:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"webServer"})," invoking ",(0,t.jsx)(i.code,{children:"pnpm --filter @idle-engine/core run build && pnpm --filter @idle-engine/shell-web run build && pnpm --filter @idle-engine/shell-web run preview -- --host 127.0.0.1 --port 4173 --strictPort"})," so dependent packages emit their bundles before the preview server starts, avoiding missing-module failures on fresh clones, and the preview fails fast if the port is occupied."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"port: 4173"})," (or ",(0,t.jsx)(i.code,{children:"url: 'http://127.0.0.1:4173'"}),") so Playwright waits for the preview server to become ready instead of racing Vite boot times."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"timeout"})," tuned for CI (suggest 60s per test) and ",(0,t.jsx)(i.code,{children:"reuseExistingServer"})," when not in CI for faster local runs."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"use"})," block setting ",(0,t.jsx)(i.code,{children:"baseURL: 'http://127.0.0.1:4173'"})," so the smoke test can navigate with relative paths like ",(0,t.jsx)(i.code,{children:"/"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["Single browser project (",(0,t.jsx)(i.code,{children:"chromium"}),") for now to keep runtime small; other browsers can be added later."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"tests/landing-page.a11y.spec.ts"})," as the initial suite."]}),"\n",(0,t.jsxs)(i.li,{children:["Update the repo ",(0,t.jsx)(i.code,{children:".gitignore"})," to exclude Playwright output directories (",(0,t.jsx)(i.code,{children:"playwright-report/"}),", ",(0,t.jsx)(i.code,{children:"test-results/"}),", ",(0,t.jsx)(i.code,{children:"blob-report/"}),") and the optional Axe artifact path (",(0,t.jsx)(i.code,{children:"artifacts/accessibility/"}),") so local runs do not introduce noisy untracked files."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"53-test-flow",children:"5.3 Test Flow"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Let Playwright's ",(0,t.jsx)(i.code,{children:"webServer"})," command build ",(0,t.jsx)(i.code,{children:"@idle-engine/core"})," and then the shell (",(0,t.jsx)(i.code,{children:"pnpm --filter @idle-engine/core run build && pnpm --filter @idle-engine/shell-web run build"}),") before launching ",(0,t.jsx)(i.code,{children:"vite preview"}),", ensuring the test always exercises the production bundle and that workspace dependencies ship compiled artifacts."]}),"\n",(0,t.jsxs)(i.li,{children:["Launch the preview server via the same ",(0,t.jsx)(i.code,{children:"webServer"})," configuration."]}),"\n",(0,t.jsxs)(i.li,{children:["Navigate to ",(0,t.jsx)(i.code,{children:"/"})," and wait for the ",(0,t.jsx)(i.code,{children:"<main>"})," landmark."]}),"\n",(0,t.jsxs)(i.li,{children:["Execute Axe analysis with tags ",(0,t.jsx)(i.code,{children:"wcag2a"})," and ",(0,t.jsx)(i.code,{children:"wcag2aa"}),"."]}),"\n",(0,t.jsx)(i.li,{children:"Assert the violation list is empty; on failure, emit the violation summaries to stdout for quick triage."}),"\n",(0,t.jsx)(i.li,{children:"(Future) Expand coverage to UI overlays once they exist (resource panels, upgrade modals, social components) by adding selectors and navigation steps."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"54-ci--local-workflow-integration",children:"5.4 CI & Local Workflow Integration"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Update root scripts:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Add ",(0,t.jsx)(i.code,{children:'"test:a11y": "pnpm --filter ./tools/a11y-smoke-tests run test"'})," (or use the package name once defined)."]}),"\n",(0,t.jsxs)(i.li,{children:["Ensure ",(0,t.jsx)(i.code,{children:'"test:ci"'})," runs unit suites and the smoke test without double-invoking Playwright (e.g., leave the root script as ",(0,t.jsx)(i.code,{children:"pnpm -r run test:ci"})," so each workspace contributes once, or orchestrate the phases via a small Node helper script if sequential execution is preferred)."]}),"\n",(0,t.jsxs)(i.li,{children:["Document the expected runtime impact before enabling the pre-commit hook so contributors understand how to temporarily opt out (",(0,t.jsx)(i.code,{children:"LEFTHOOK=0"}),") if the smoke suite blocks urgent commits; adjust the plan after collecting timing data from the first implementation pass."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["In the existing GitHub Actions pipeline (",(0,t.jsx)(i.code,{children:".github/workflows/ci.yml"}),"), keep the current ",(0,t.jsx)(i.code,{children:"pnpm test:ci"})," step so unit tests and the smoke suite run together (the new workspace's ",(0,t.jsx)(i.code,{children:"test:ci"})," script will execute automatically). If additional visibility is desired, add a follow-up step that invokes ",(0,t.jsx)(i.code,{children:"pnpm test:a11y"})," explicitly.","\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"pnpm install --frozen-lockfile"})," (already present in the workflow)."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"pnpm test:ci"})," (the recursive run covers unit tests and the accessibility suite once the new package lands)."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.em,{children:"(Optional)"})," ",(0,t.jsx)(i.code,{children:"pnpm test:a11y"})," for a dedicated accessibility report; Playwright's ",(0,t.jsx)(i.code,{children:"webServer"})," configuration handles building ",(0,t.jsx)(i.code,{children:"@idle-engine/core"})," and ",(0,t.jsx)(i.code,{children:"@idle-engine/shell-web"})," before launching the preview server, avoiding redundant work."]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Cache Playwright browsers between runs (",(0,t.jsx)(i.code,{children:"~/.cache/ms-playwright"}),") to reduce install time."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Evaluate ",(0,t.jsx)(i.code,{children:"lefthook.yml"})," after implementation:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Option A (default): keep the ",(0,t.jsx)(i.code,{children:"pnpm lint"}),", ",(0,t.jsx)(i.code,{children:"pnpm test:ci"}),", and ",(0,t.jsx)(i.code,{children:"pnpm build"})," hooks; the a11y test should complete in ~20\u201330s after initial browser download."]}),"\n",(0,t.jsxs)(i.li,{children:["Option B: introduce a lighter ",(0,t.jsx)(i.code,{children:"test:fast"})," hook for commits if the team finds the smoke test too heavy; CI will still run ",(0,t.jsx)(i.code,{children:"test:ci"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"55-reporting--observability",children:"5.5 Reporting & Observability"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Configure Playwright reporter to emit concise violation summaries."}),"\n",(0,t.jsxs)(i.li,{children:["Store raw Axe JSON under ",(0,t.jsx)(i.code,{children:"artifacts/accessibility/"})," when ",(0,t.jsx)(i.code,{children:"CI=1"})," (optional follow-up) so PRs can surface diffs."]}),"\n",(0,t.jsx)(i.li,{children:"Consider future integration with GitHub PR annotations via Playwright's GitHub reporter if violations occur."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"6-rollout-steps",children:"6. Rollout Steps"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Scaffold ",(0,t.jsx)(i.code,{children:"tools/a11y-smoke-tests"})," workspace with dependencies and config."]}),"\n",(0,t.jsxs)(i.li,{children:["Update ",(0,t.jsx)(i.code,{children:"pnpm-workspace.yaml"})," and root scripts (",(0,t.jsx)(i.code,{children:"package.json"}),", ",(0,t.jsx)(i.code,{children:"lefthook.yml"})," if required)."]}),"\n",(0,t.jsx)(i.li,{children:"Implement the landing-page smoke test and ensure it passes locally."}),"\n",(0,t.jsxs)(i.li,{children:["Document usage in ",(0,t.jsx)(i.code,{children:"packages/shell-web/README.md"})," (or repo root README) for developers."]}),"\n",(0,t.jsx)(i.li,{children:"Wire into the future CI workflow; verify headless run on Linux."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"7-risks--mitigations",children:"7. Risks & Mitigations"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Initial browser download increases install time"}),": Cache the Playwright directory so subsequent installs short-circuit through the ",(0,t.jsx)(i.code,{children:"install-playwright.cjs"})," guard."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Flaky server start-up"}),": Use Playwright's ",(0,t.jsx)(i.code,{children:"webServer"})," retry/backoff and increase ",(0,t.jsx)(i.code,{children:"timeout"})," to absorb slower cold builds."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"False positives from Axe on dynamic content"}),": Wait for UI stabilization (loading indicators) before analysis; selectively exclude animations if needed."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Pre-commit friction"}),": Monitor hook duration; if average exceeds acceptable limits, fall back to running the smoke test in CI only."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"8-open-questions",children:"8. Open Questions"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Should future social-service UI routes receive separate smoke tests with authenticated flows?"}),"\n",(0,t.jsx)(i.li,{children:"Do we want to publish Axe violation artifacts as CI attachments from day one, or defer to a later tooling story?"}),"\n",(0,t.jsx)(i.li,{children:"Will additional shells (native/Tauri) need analogous tests, and if so should they share the same Playwright workspace?"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"9-acceptance-criteria",children:"9. Acceptance Criteria"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Repeatable ",(0,t.jsx)(i.code,{children:"pnpm test:a11y"})," command that fails on Axe violations."]}),"\n",(0,t.jsx)(i.li,{children:"Smoke test executes in under 1 minute locally after browsers are installed."}),"\n",(0,t.jsx)(i.li,{children:"Documentation updated so contributors know how to run and debug the suite."}),"\n",(0,t.jsxs)(i.li,{children:["Root ",(0,t.jsx)(i.code,{children:"pnpm test:ci"})," exercises the smoke test, enabling easy CI adoption once the pipeline is live."]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},7678:(e,i,s)=>{s.d(i,{R:()=>r,x:()=>o});var n=s(9430);const t={},l=n.createContext(t);function r(e){const i=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(l.Provider,{value:i},e.children)}}}]);