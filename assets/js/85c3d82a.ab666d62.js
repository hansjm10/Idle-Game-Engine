"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[6071],{2001:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"content-validation-performance","title":"Content Validation Performance","description":"This document describes the performance characteristics of content pack validation and how to use validation caching effectively.","source":"@site/../../docs/content-validation-performance.md","sourceDirName":".","slug":"/content-validation-performance","permalink":"/Idle-Game-Engine/content-validation-performance","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/content-validation-performance.md","tags":[],"version":"current","frontMatter":{}}');var t=i(5270),c=i(7678);const s={},r="Content Validation Performance",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Performance Characteristics",id:"performance-characteristics",level:2},{value:"Validation Time by Pack Size",id:"validation-time-by-pack-size",level:3},{value:"Time Distribution",id:"time-distribution",level:3},{value:"Validation Caching",id:"validation-caching",level:2},{value:"Using the Cache",id:"using-the-cache",level:3},{value:"Cache Configuration",id:"cache-configuration",level:3},{value:"Cache Behavior",id:"cache-behavior",level:3},{value:"Expected Speedup",id:"expected-speedup",level:3},{value:"Running Benchmarks",id:"running-benchmarks",level:2},{value:"Benchmark Output",id:"benchmark-output",level:3},{value:"CI Integration",id:"ci-integration",level:2},{value:"Optimization Tips",id:"optimization-tips",level:2},{value:"For Content Authors",id:"for-content-authors",level:3},{value:"For Engine Developers",id:"for-engine-developers",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"createValidationCache",id:"createvalidationcache",level:3},{value:"ValidationCache",id:"validationcache",level:3},{value:"Cache with Validator",id:"cache-with-validator",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"content-validation-performance",children:"Content Validation Performance"})}),"\n",(0,t.jsx)(n.p,{children:"This document describes the performance characteristics of content pack validation and how to use validation caching effectively."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Content pack validation involves several stages:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Structural Validation (Zod)"})," - Parse and validate the raw JSON structure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cross-Reference Validation"})," - Verify entity references are valid"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cycle Detection"})," - Check for circular dependencies in transforms and unlock conditions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Normalization"})," - Convert parsed data to normalized format with lookups"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Balance Validation"})," - Run economic balance checks (optional)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,t.jsx)(n.h3,{id:"validation-time-by-pack-size",children:"Validation Time by Pack Size"}),"\n",(0,t.jsx)(n.p,{children:"Based on benchmarks with synthetic packs:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Pack Size"}),(0,t.jsx)(n.th,{children:"Entities"}),(0,t.jsx)(n.th,{children:"Typical Validation Time"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Tiny"}),(0,t.jsx)(n.td,{children:"~40"}),(0,t.jsx)(n.td,{children:"10-15ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Medium"}),(0,t.jsx)(n.td,{children:"~200"}),(0,t.jsx)(n.td,{children:"50-60ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Large"}),(0,t.jsx)(n.td,{children:"~850"}),(0,t.jsx)(n.td,{children:"190-220ms"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Targets:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<30ms"})," for tiny packs (~40 entities)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<100ms"})," for medium packs (~200 entities)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<500ms"})," for large packs (~850 entities)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"time-distribution",children:"Time Distribution"}),"\n",(0,t.jsx)(n.p,{children:"For a typical medium-sized pack, validation time is distributed roughly as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zod structural parsing: ~80-90%"}),"\n",(0,t.jsx)(n.li,{children:"Cross-reference validation: ~5%"}),"\n",(0,t.jsx)(n.li,{children:"Normalization: ~5%"}),"\n",(0,t.jsx)(n.li,{children:"Cycle detection: ~1%"}),"\n",(0,t.jsx)(n.li,{children:"Balance validation: varies (disabled in benchmarks)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"validation-caching",children:"Validation Caching"}),"\n",(0,t.jsx)(n.p,{children:"The validation cache stores normalized results keyed by pack content digest. This allows skipping the expensive refinement, normalization, and balance validation stages on repeat validations of the same content."}),"\n",(0,t.jsx)(n.h3,{id:"using-the-cache",children:"Using the Cache"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import {\n  createContentPackValidator,\n  createValidationCache,\n} from '@idle-engine/content-schema';\n\n// Create a shared cache instance\nconst cache = createValidationCache();\n\n// Create validator with cache\nconst validator = createContentPackValidator({\n  cache,\n  balance: { enabled: false }, // Optional: disable balance checks\n});\n\n// First validation (cache miss) - full validation\nconst result1 = validator.parse(packData);\n\n// Second validation (cache hit) - returns cached result\nconst result2 = validator.parse(packData);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cache-configuration",children:"Cache Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const cache = createValidationCache({\n  maxSize: 100, // Default: 100 entries\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"The cache uses LRU (Least Recently Used) eviction when the maximum size is exceeded."}),"\n",(0,t.jsx)(n.h3,{id:"cache-behavior",children:"Cache Behavior"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache Key"}),": Based on pack content digest (FNV-1a hash)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache Hit"}),": Returns cached normalized pack and warnings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache Miss"}),": Runs full validation, caches result"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Invalidation"}),": Automatic when pack content changes (different digest)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"expected-speedup",children:"Expected Speedup"}),"\n",(0,t.jsx)(n.p,{children:"The cache provides modest speedup (~5-15%) because Zod structural parsing still runs on every validation. The real benefit is:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Avoiding expensive cross-reference validation on repeats"}),"\n",(0,t.jsx)(n.li,{children:"Skipping normalization and lookup table construction"}),"\n",(0,t.jsx)(n.li,{children:"Reusing balance validation results"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For workflows that repeatedly validate the same content (e.g., IDE integrations), caching reduces repeated work."}),"\n",(0,t.jsx)(n.h2,{id:"running-benchmarks",children:"Running Benchmarks"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Run benchmarks\npnpm --filter @idle-engine/content-schema bench\n\n# Run with regression check against baseline\npnpm --filter @idle-engine/content-schema bench:check\n\n# Update baseline (after intentional changes)\npnpm --filter @idle-engine/content-schema bench:update-baseline\n"})}),"\n",(0,t.jsx)(n.h3,{id:"benchmark-output",children:"Benchmark Output"}),"\n",(0,t.jsx)(n.p,{children:"The benchmark produces JSON output with detailed statistics:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "event": "benchmark_run_end",\n  "results": {\n    "uncached": [\n      {\n        "label": "uncached-medium",\n        "stats": {\n          "meanMs": 55.0,\n          "medianMs": 54.5,\n          "stdDevMs": 2.0\n        }\n      }\n    ],\n    "cached": [\n      {\n        "label": "cached-medium",\n        "hitStats": { "meanMs": 50.0 },\n        "missStats": { "meanMs": 55.0 },\n        "speedup": 0.09\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"ci-integration",children:"CI Integration"}),"\n",(0,t.jsx)(n.p,{children:"The CI pipeline runs benchmark regression checks on every PR. If validation time regresses by more than 25% compared to the baseline, the build fails."}),"\n",(0,t.jsx)(n.p,{children:"To update the baseline after intentional changes (e.g., adding new validation rules):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'pnpm --filter @idle-engine/content-schema bench:update-baseline\ngit add packages/content-schema/benchmarks/baseline.json\ngit commit -m "chore: update validation benchmark baseline"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,t.jsx)(n.h3,{id:"for-content-authors",children:"For Content Authors"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep packs focused"}),": Smaller packs validate faster"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Minimize cross-references"}),": Each reference requires lookup validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use caching in hot paths"}),": Pass a shared cache to validators in repeated validation scenarios"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"for-engine-developers",children:"For Engine Developers"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reuse cache instances"}),": Create one cache per application context"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consider cache size"}),": Increase ",(0,t.jsx)(n.code,{children:"maxSize"})," if validating many different packs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Profile before optimizing"}),": Use the benchmark suite to identify bottlenecks"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.h3,{id:"createvalidationcache",children:"createValidationCache"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function createValidationCache(options?: {\n  maxSize?: number; // Default: 100\n}): ValidationCache;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"validationcache",children:"ValidationCache"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface ValidationCache {\n  get(key: string): CachedValidationResult | undefined;\n  set(key: string, result: CachedValidationResult): void;\n  clear(): void;\n  delete(key: string): boolean;\n  readonly size: number;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cache-with-validator",children:"Cache with Validator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface ContentSchemaOptions {\n  cache?: ValidationCache;\n  // ... other options\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},7678:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>r});var a=i(9430);const t={},c=a.createContext(t);function s(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);