"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[6902],{4858:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"issue-821-design","title":"content-schema: add generator-count achievement track kind (Issue 821)","description":"Document Control","source":"@site/../../docs/issue-821-design.md","sourceDirName":".","slug":"/issue-821-design","permalink":"/Idle-Game-Engine/issue-821-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-821-design.md","tags":[],"version":"current","sidebarPosition":99,"frontMatter":{"title":"content-schema: add generator-count achievement track kind (Issue 821)","sidebar_position":99}}');var r=s(5270),c=s(7678);const t={title:"content-schema: add generator-count achievement track kind (Issue 821)",sidebar_position:99},l="content-schema: add generator-count achievement track kind (Issue 821)",d={},o=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"content-schema-add-generator-count-achievement-track-kind-issue-821",children:"content-schema: add generator-count achievement track kind (Issue 821)"})}),"\n",(0,r.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Title"}),": Add ",(0,r.jsx)(n.code,{children:"generator-count"})," achievement track kind for aggregate generator ownership"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authors"}),": Ralph (AI agent)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reviewers"}),": @hansjm10"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-25"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Related Issues"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/821",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/821"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,r.jsxs)(n.p,{children:["Add a new achievement track kind, ",(0,r.jsx)(n.code,{children:"generator-count"}),", that measures total generator ownership by summing generator \u201clevels\u201d (owned counts) across all generators (or an explicit subset). This makes \u201cOwn N total generators (of any type)\u201d achievable purely in content definitions, without requiring the ",(0,r.jsx)(n.code,{children:"custom-metric"})," workaround and a runtime ",(0,r.jsx)(n.code,{children:"getCustomMetricValue"})," callback."]}),"\n",(0,r.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Background"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The achievement ",(0,r.jsx)(n.code,{children:"track"})," discriminated union in ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/modules/achievements.ts"})," currently supports ",(0,r.jsx)(n.code,{children:"resource"}),", ",(0,r.jsx)(n.code,{children:"generator-level"}),", ",(0,r.jsx)(n.code,{children:"upgrade-owned"}),", ",(0,r.jsx)(n.code,{children:"flag"}),", ",(0,r.jsx)(n.code,{children:"script"}),", and ",(0,r.jsx)(n.code,{children:"custom-metric"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"generator-level"})," tracks the owned count for a ",(0,r.jsx)(n.em,{children:"single"})," generator id."]}),"\n",(0,r.jsxs)(n.li,{children:["Runtime evaluation lives in ",(0,r.jsx)(n.code,{children:"packages/core/src/progression/achievement-tracker.ts"})," via ",(0,r.jsx)(n.code,{children:"getAchievementTrackValue(...)"}),", using a ",(0,r.jsx)(n.code,{children:"ConditionContext"})," backed by the ",(0,r.jsx)(n.code,{children:"ProgressionFacade"})," (",(0,r.jsx)(n.code,{children:"packages/core/src/progression/progression-facade.ts"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Content authors cannot define aggregate ownership achievements like \u201cOwn 10 generators total\u201d across all generator types."}),"\n",(0,r.jsxs)(n.li,{children:["The current workaround (",(0,r.jsx)(n.code,{children:"custom-metric"}),") requires code integration (",(0,r.jsx)(n.code,{children:"getCustomMetricValue"}),") and therefore cannot be solved purely in content packs."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forces"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep the achievement system deterministic and content-first (avoid requiring callbacks for common progression patterns)."}),"\n",(0,r.jsxs)(n.li,{children:["Minimise surface-area changes to ",(0,r.jsx)(n.code,{children:"ConditionContext"})," (used broadly for unlock/visibility/automation evaluation)."]}),"\n",(0,r.jsx)(n.li,{children:"Avoid introducing per-step cost that scales poorly with large numbers of generators/achievements."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goals"}),":","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Support aggregate generator ownership achievements in content via a first-class track kind."}),"\n",(0,r.jsx)(n.li,{children:"Allow \u201call generators\u201d by default, with an optional filter to specific generator ids."}),"\n",(0,r.jsx)(n.li,{children:"Keep behaviour deterministic and consistent with existing achievement progress semantics."}),"\n",(0,r.jsx)(n.li,{children:"Update schema validation, runtime evaluation, tests, and schema reference docs."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tracking other aggregates (e.g., total generator production rate) as part of this change."}),"\n",(0,r.jsxs)(n.li,{children:["Replacing or deprecating ",(0,r.jsx)(n.code,{children:"custom-metric"})," (it remains the escape hatch for bespoke logic)."]}),"\n",(0,r.jsx)(n.li,{children:"Redesigning achievement progress modes (oneShot/incremental/repeatable)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Primary Stakeholders"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Content authors / pack maintainers"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/content-schema"})," maintainers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/core"})," progression maintainers"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Roles"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Schema Agent"}),": Add ",(0,r.jsx)(n.code,{children:"generator-count"})," to the content schema and cross-reference validators."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime Agent"}),": Implement ",(0,r.jsx)(n.code,{children:"generator-count"})," evaluation in the achievement tracker."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docs Agent"}),": Document the new track kind in ",(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Agent"}),": Add/extend Vitest coverage for schema + runtime behaviour."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/content-schema"})," (track schema + pack validator + tests)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core"})," (achievement tracker + coordinator wiring + tests)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"})," (documentation)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility Considerations"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This is an additive schema/runtime change; existing packs remain valid."}),"\n",(0,r.jsxs)(n.li,{children:["Packs that previously attempted to use a non-existent ",(0,r.jsx)(n.code,{children:"generatorCount"})," kind will still fail until they migrate to ",(0,r.jsx)(n.code,{children:"generator-count"})," (see Open Questions re: aliases)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Content schema defines achievement track kinds in ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/modules/achievements.ts"})," (see ",(0,r.jsx)(n.code,{children:"trackSchema"})," around line 46)."]}),"\n",(0,r.jsxs)(n.li,{children:["Cross-reference validation checks track references in ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/validators/achievements.ts"})," (e.g., verifying ",(0,r.jsx)(n.code,{children:"generator-level.generatorId"})," exists)."]}),"\n",(0,r.jsxs)(n.li,{children:["Runtime measurement uses ",(0,r.jsx)(n.code,{children:"AchievementTracker.getAchievementTrackValue(...)"})," in ",(0,r.jsx)(n.code,{children:"packages/core/src/progression/achievement-tracker.ts"})," (see switch around line 457):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"generator-level"})," delegates to ",(0,r.jsx)(n.code,{children:"conditionContext.getGeneratorLevel(generatorId)"})," which resolves to generator owned counts in ",(0,r.jsx)(n.code,{children:"ProgressionFacade"})," (see ",(0,r.jsx)(n.code,{children:"conditionContext"})," wiring around line 112 in ",(0,r.jsx)(n.code,{children:"packages/core/src/progression/progression-facade.ts"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["No runtime or schema support exists for summing across multiple generators without ",(0,r.jsx)(n.code,{children:"custom-metric"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Introduce a new achievement track kind: ",(0,r.jsx)(n.code,{children:"generator-count"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The runtime calculates the track\u2019s measurement as:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sum(getGeneratorLevel(id))"})," over ",(0,r.jsx)(n.code,{children:"generatorIds"})," if specified, otherwise"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sum(getGeneratorLevel(id))"})," over all generator ids in the loaded content pack."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Completion uses a comparator against the computed achievement target:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Default comparator: ",(0,r.jsx)(n.code,{children:"gte"})," (consistent with existing comparator defaults)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime Changes"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"AchievementTracker"})," to support a ",(0,r.jsx)(n.code,{children:"generator-count"})," case in ",(0,r.jsx)(n.code,{children:"getAchievementTrackValue(...)"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Provide ",(0,r.jsx)(n.code,{children:"AchievementTracker"})," access to \u201call generator ids\u201d (via ",(0,r.jsx)(n.code,{children:"ProgressionFacade"}),", since it already receives ",(0,r.jsx)(n.code,{children:"options.content.generators"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Update track completion logic so ",(0,r.jsx)(n.code,{children:"generator-count"})," can use its ",(0,r.jsx)(n.code,{children:"comparator"})," (similar to ",(0,r.jsx)(n.code,{children:"resource"})," tracks)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data & Schemas"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"trackSchema"})," in ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/modules/achievements.ts"})," with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"kind: 'generator-count'"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"threshold: numericFormulaSchema"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"comparator: comparatorSchema"})," (defaulting to ",(0,r.jsx)(n.code,{children:"gte"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"generatorIds?: string[]"})," (content ids, intended to reference generators)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Extend the achievements pack cross-reference validator (",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/validators/achievements.ts"}),") to:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["validate all ",(0,r.jsx)(n.code,{children:"generatorIds"})," (if present) exist in the generator index"]}),"\n",(0,r.jsxs)(n.li,{children:["validate ",(0,r.jsx)(n.code,{children:"threshold"})," formula references (like ",(0,r.jsx)(n.code,{children:"resource"})," / ",(0,r.jsx)(n.code,{children:"custom-metric"})," do)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"APIs & Contracts"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["No public API changes are required if ",(0,r.jsx)(n.code,{children:"generator-count"})," measurement is computed using existing ",(0,r.jsx)(n.code,{children:"ConditionContext.getGeneratorLevel(...)"})," plus a generator id list passed into ",(0,r.jsx)(n.code,{children:"AchievementTracker"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Content shape change is additive: old packs remain valid; new packs can opt into ",(0,r.jsx)(n.code,{children:"generator-count"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling & Automation"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"})," to list ",(0,r.jsx)(n.code,{children:"generator-count"}),", required fields, and examples."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Example achievement definition:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "achievement.ten-generators",\n  "name": { "default": "Generator Collector" },\n  "description": { "default": "Own 10 generators of any type" },\n  "category": "progression",\n  "tier": "bronze",\n  "track": {\n    "kind": "generator-count",\n    "threshold": { "kind": "constant", "value": 10 },\n    "comparator": "gte"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Example filtered definition (subset of generators):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "track": {\n    "kind": "generator-count",\n    "generatorIds": ["generator.cursor", "generator.grandma"],\n    "threshold": { "kind": "constant", "value": 25 },\n    "comparator": "gte"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Standard workspace flow: ",(0,r.jsx)(n.code,{children:"pnpm lint"})," and ",(0,r.jsx)(n.code,{children:"pnpm test"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["If tests/coverage change, regenerate ",(0,r.jsx)(n.code,{children:"docs/coverage/index.md"})," via ",(0,r.jsx)(n.code,{children:"pnpm coverage:md"})," (per repo guidelines)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry & Observability"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Not applicable (no runtime telemetry added)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security & Compliance"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Not applicable (no new external inputs or permissions)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,r.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Issue Title"}),(0,r.jsx)(n.th,{children:"Scope Summary"}),(0,r.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,r.jsx)(n.th,{children:"Dependencies"}),(0,r.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"feat(content-schema): add generator-count achievement track"})}),(0,r.jsxs)(n.td,{children:["Add ",(0,r.jsx)(n.code,{children:"generator-count"})," to ",(0,r.jsx)(n.code,{children:"trackSchema"})," + cross-reference validation + schema tests"]}),(0,r.jsx)(n.td,{children:"Schema Agent"}),(0,r.jsx)(n.td,{children:"Design doc approved"}),(0,r.jsxs)(n.td,{children:["Pack validates ",(0,r.jsx)(n.code,{children:"generator-count"}),"; bad generator ids rejected; tests added"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"feat(core): evaluate generator-count achievement tracks"})}),(0,r.jsxs)(n.td,{children:["Sum generator owned counts for ",(0,r.jsx)(n.code,{children:"generator-count"})," and respect comparator"]}),(0,r.jsx)(n.td,{children:"Runtime Agent"}),(0,r.jsx)(n.td,{children:"Schema merged"}),(0,r.jsx)(n.td,{children:"Unit tests cover track value + completion semantics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docs: document generator-count achievement tracks"})}),(0,r.jsx)(n.td,{children:"Update schema reference doc and add examples"}),(0,r.jsx)(n.td,{children:"Docs Agent"}),(0,r.jsx)(n.td,{children:"Schema merged"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"})," includes new kind + example"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 1"}),": Ship schema + runtime support + tests + docs for ",(0,r.jsx)(n.code,{children:"generator-count"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 2"}),": Optional follow-ups (alias support, sample pack additions, performance caching) if needed."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hand-off Package"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Issue context: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/821",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/821"})]}),"\n",(0,r.jsxs)(n.li,{children:["Relevant schema/runtime entry points:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/content-schema/src/modules/achievements.ts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/validators/achievements.ts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/core/src/progression/achievement-tracker.ts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"packages/core/src/progression/progression-facade.ts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication Cadence"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One implementation PR is sufficient; review checkpoint after tests + docs update."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Context Packets"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Load Issue 821 and inspect the track schema + runtime tracker implementation before coding."}),"\n",(0,r.jsxs)(n.li,{children:["Compare to existing track behaviour (",(0,r.jsx)(n.code,{children:"resource"}),", ",(0,r.jsx)(n.code,{children:"generator-level"}),", ",(0,r.jsx)(n.code,{children:"custom-metric"}),") for consistency."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Follow workspace TypeScript conventions: ES modules, 2-space indent, type-only imports/exports."}),"\n",(0,r.jsxs)(n.li,{children:["Do not edit checked-in ",(0,r.jsx)(n.code,{children:"dist/"})," outputs by hand."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Avoid adding noisy console output during Vitest runs (the LLM reporter expects clean JSON end-of-run output)."}),"\n",(0,r.jsx)(n.li,{children:"Keep achievement evaluation deterministic (no access to wall-clock time or randomness)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-schema"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm lint"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Continue using ",(0,r.jsx)(n.code,{children:"custom-metric"})]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pros: no schema/runtime changes."}),"\n",(0,r.jsx)(n.li,{children:"Cons: requires runtime integration, preventing content-only packs from expressing a common achievement pattern."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Require explicit ",(0,r.jsx)(n.code,{children:"generatorIds"})," (no \u201call generators\u201d default)"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pros: avoids needing runtime access to generator lists."}),"\n",(0,r.jsx)(n.li,{children:"Cons: burdens content authors and makes \u201call generators\u201d difficult/verbose."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Extend ",(0,r.jsx)(n.code,{children:"ConditionContext"})," with a \u201ctotal generator count\u201d API"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pros: avoids ",(0,r.jsx)(n.code,{children:"AchievementTracker"})," needing generator ids."]}),"\n",(0,r.jsx)(n.li,{children:"Cons: broadens a shared interface and requires more widespread wiring/migration."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/content-schema"}),": add schema tests for ",(0,r.jsx)(n.code,{children:"generator-count"})," (parsing, default progress target derivation) and validator tests for ",(0,r.jsx)(n.code,{children:"generatorIds"})," references."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core"}),": add unit tests validating measurement and completion with ",(0,r.jsx)(n.code,{children:"generator-count"})," using a small content pack fixture."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Validate that summing across generator ids is acceptable for typical pack sizes; consider caching if necessary."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling / A11y"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Not applicable."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance overhead with many generators/achievements"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: keep ",(0,r.jsx)(n.code,{children:"generatorIds"})," optional for narrowing; add caching later if benchmarks show need."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ambiguity (\u201clevel\u201d vs \u201ccount\u201d)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: document clearly that generator \u201clevel\u201d equals owned count; ",(0,r.jsx)(n.code,{children:"generator-count"})," sums owned counts."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Early adopters using ",(0,r.jsx)(n.code,{children:"generatorCount"})," (camelCase) in content"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: document the correct kind (",(0,r.jsx)(n.code,{children:"generator-count"}),"); optionally add an alias if that becomes a recurring pain point."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milestones"}),":","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Merge schema + validator changes."}),"\n",(0,r.jsx)(n.li,{children:"Merge core runtime support + tests."}),"\n",(0,r.jsx)(n.li,{children:"Update docs."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Strategy"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Packs using the ",(0,r.jsx)(n.code,{children:"custom-metric"})," workaround can migrate to ",(0,r.jsx)(n.code,{children:"generator-count"})," to become content-only."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Note in release/PR description: \u201cNew achievement track kind: ",(0,r.jsx)(n.code,{children:"generator-count"})," (total generators owned).\u201d"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Should we accept ",(0,r.jsx)(n.code,{children:"generatorCount"})," as an alias for ",(0,r.jsx)(n.code,{children:"generator-count"})," to reduce schema mismatch footguns?"]}),"\n",(0,r.jsxs)(n.li,{children:["Should ",(0,r.jsx)(n.code,{children:"generatorIds"})," (when present) be required to be non-empty and de-duplicated/normalized?"]}),"\n",(0,r.jsxs)(n.li,{children:["Do we need step-level caching in ",(0,r.jsx)(n.code,{children:"AchievementTracker"})," for ",(0,r.jsx)(n.code,{children:"generator-count"}),", or is naive summation sufficient for expected pack sizes?"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a sample-pack achievement demonstrating ",(0,r.jsx)(n.code,{children:"generator-count"})," once the kind is available (optional)."]}),"\n",(0,r.jsx)(n.li,{children:"Consider additional aggregate track kinds if content author feedback suggests a pattern (e.g., \u201ctotal upgrades purchased\u201d)."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Issue 821: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/821",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/821"})]}),"\n",(0,r.jsxs)(n.li,{children:["Track schema: ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/modules/achievements.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Pack achievement validator: ",(0,r.jsx)(n.code,{children:"packages/content-schema/src/pack/validators/achievements.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Achievement runtime evaluation: ",(0,r.jsx)(n.code,{children:"packages/core/src/progression/achievement-tracker.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Condition context wiring: ",(0,r.jsx)(n.code,{children:"packages/core/src/progression/progression-facade.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Schema reference docs: ",(0,r.jsx)(n.code,{children:"docs/content-schema-reference.md"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generator level"}),": The owned count of a specific generator id (",(0,r.jsx)(n.code,{children:"ConditionContext.getGeneratorLevel(...)"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"generator-count"}),": Proposed achievement track kind that sums generator levels across multiple generator ids."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"custom-metric"}),": Existing escape hatch track kind whose measurement is provided by a runtime callback."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Date"}),(0,r.jsx)(n.th,{children:"Author"}),(0,r.jsx)(n.th,{children:"Change Summary"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2026-01-25"}),(0,r.jsx)(n.td,{children:"Ralph (AI agent)"}),(0,r.jsx)(n.td,{children:"Initial draft for Issue 821"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(9430);const r={},c=i.createContext(r);function t(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);