"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[9230],{4787:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"issue-845-design","title":"renderer: improve bitmap font asset pipeline for production use (Issue 845)","description":"Document Control","source":"@site/../../docs/issue-845-design.md","sourceDirName":".","slug":"/issue-845-design","permalink":"/Idle-Game-Engine/issue-845-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-845-design.md","tags":[],"version":"current","sidebarPosition":99,"frontMatter":{"title":"renderer: improve bitmap font asset pipeline for production use (Issue 845)","sidebar_position":99}}');var t=s(5270),r=s(7678);const l={title:"renderer: improve bitmap font asset pipeline for production use (Issue 845)",sidebar_position:99},d="renderer: improve bitmap font asset pipeline for production use (Issue 845)",c={},a=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"renderer-improve-bitmap-font-asset-pipeline-for-production-use-issue-845",children:"renderer: improve bitmap font asset pipeline for production use (Issue 845)"})}),"\n",(0,t.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Title"}),": Introduce build-time (MSDF) font atlas generation + renderer support for production-quality text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authors"}),": Ralph (AI agent)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reviewers"}),": @hansjm10"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-25"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Related Issues"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/845",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/845"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,t.jsxs)(n.p,{children:["Standardize a production-ready font pipeline by moving font atlas generation from runtime into a deterministic build step, driven by a content-pack font specification. The build step generates per-font atlas images + glyph metrics (prefer MSDF for crisp scaling), while ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," gains MSDF shader support and ",(0,t.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," loads the prebuilt font assets (keeping the current runtime generation as an explicit dev fallback)."]}),"\n",(0,t.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Background"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The renderer contract supports ",(0,t.jsx)(n.code,{children:"AssetManifest"})," entries of kind ",(0,t.jsx)(n.code,{children:"font"})," (",(0,t.jsx)(n.code,{children:"packages/renderer-contract/src/types.ts"}),"), but does not define how fonts are produced or stored."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," renders ",(0,t.jsx)(n.code,{children:"text"})," draws using bitmap fonts supplied by the host via ",(0,t.jsx)(n.code,{children:"assets.loadFont(...)"})," (",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"}),"). A font is currently modeled as an image plus glyph rectangles/metrics (",(0,t.jsx)(n.code,{children:"WebGpuBitmapFont"})," / ",(0,t.jsx)(n.code,{children:"WebGpuBitmapFontGlyph"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Issue 845 references a PR that rasterizes fonts at runtime (using ",(0,t.jsx)(n.code,{children:"OffscreenCanvas"}),") as a quick fix for ",(0,t.jsx)(n.code,{children:"shell-desktop"}),", but this is not an adequate long-term production approach."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Problem"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Runtime rasterization increases startup time, adds platform constraints (renderer-process APIs, font availability), and risks non-determinism (OS font differences, hinting/kerning differences, etc.)."}),"\n",(0,t.jsx)(n.li,{children:"Plain bitmap atlases do not scale well across UI zoom levels; crisp text typically requires distance-field rendering (SDF/MSDF) or multiple baked sizes."}),"\n",(0,t.jsx)(n.li,{children:"There is no canonical content-pack schema or build artifact format for fonts, so hosts must implement bespoke loaders and ad hoc hashing/manifest wiring."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Forces"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Determinism and replay friendliness: text layout and glyph metrics must be stable across machines."}),"\n",(0,t.jsx)(n.li,{children:"Cross-platform build and CI: font generation must be reproducible and not require fragile manual setup."}),"\n",(0,t.jsxs)(n.li,{children:["Renderer simplicity: avoid large API churn in ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-contract"})," and keep ",(0,t.jsx)(n.code,{children:"RenderCommandBuffer"})," unchanged."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goals"}),":","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Define a content-pack font specification that can drive build-time font atlas generation (glyph set, sizing, technique)."}),"\n",(0,t.jsxs)(n.li,{children:["Add a build step (invoked via ",(0,t.jsx)(n.code,{children:"pnpm generate"})," / content compilation flow) that emits deterministic font atlas artifacts:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"atlas image (e.g., PNG),"}),"\n",(0,t.jsx)(n.li,{children:"glyph metrics metadata (JSON),"}),"\n",(0,t.jsxs)(n.li,{children:["stable ",(0,t.jsx)(n.code,{children:"contentHash"})," inputs for ",(0,t.jsx)(n.code,{children:"AssetManifest"})," entries."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Add MSDF text rendering support to ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," while preserving existing bitmap font behavior."]}),"\n",(0,t.jsxs)(n.li,{children:["Update ",(0,t.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," to load prebuilt font assets and only use runtime generation as a dev/debug fallback."]}),"\n",(0,t.jsx)(n.li,{children:"Add tests and docs so the pipeline is maintainable and hard to misuse."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Full text shaping/kerning/bi-di layout (the renderer currently iterates code points and lays out sequentially)."}),"\n",(0,t.jsx)(n.li,{children:"A complete \u201call assets\u201d pipeline (sprite sheets, shaders, etc.) beyond what is necessary to support fonts."}),"\n",(0,t.jsx)(n.li,{children:"Runtime remote font downloads or OS font fallback."}),"\n",(0,t.jsx)(n.li,{children:"Shipping a full-featured font editor UI."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Primary Stakeholders"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Renderer maintainers (",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu"}),", ",(0,t.jsx)(n.code,{children:"packages/renderer-contract"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Content pipeline maintainers (",(0,t.jsx)(n.code,{children:"packages/content-schema"}),", ",(0,t.jsx)(n.code,{children:"packages/content-compiler"}),", ",(0,t.jsx)(n.code,{children:"tools/"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Shell maintainers (",(0,t.jsx)(n.code,{children:"packages/shell-desktop"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Content authors (need a simple, predictable way to declare fonts + glyph coverage)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Agent Roles"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema Agent"}),": Add/validate the font asset schema for content packs."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Font Pipeline Agent"}),": Implement build-time font atlas generation and artifact emission."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Renderer Agent"}),": Implement MSDF shader path in ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Shell Agent"}),": Load font artifacts and wire ",(0,t.jsx)(n.code,{children:"assets.loadFont(...)"})," + ",(0,t.jsx)(n.code,{children:"AssetManifest"})," plumbing."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Docs/Test Agent"}),": Update docs and add regression tests."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema"})," (new schema for font specs; validation)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-compiler"})," (invoke font pipeline + emit artifacts)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/renderer-webgpu"})," (MSDF shader support; font technique support)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/shell-desktop"})," (asset loader + runtime fallback behavior)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tools/"})," (new font compiler wrapper or embedded generator tooling)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compatibility Considerations"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Keep renderer contract stable: no changes to ",(0,t.jsx)(n.code,{children:"RenderCommandBuffer"})," are required."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"WebGpuBitmapFont"})," changes (if any) must be additive (e.g., optional ",(0,t.jsx)(n.code,{children:"technique"}),"), so existing hosts remain compatible."]}),"\n",(0,t.jsx)(n.li,{children:"Packs without font declarations must continue to compile and run unchanged."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Renderer contract types:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"AssetManifest"})," supports ",(0,t.jsx)(n.code,{children:"AssetKind = 'image' | 'font' | 'spriteSheet' | 'shader'"})," (",(0,t.jsx)(n.code,{children:"packages/renderer-contract/src/types.ts"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["WebGPU renderer text pipeline:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Hosts supply fonts through ",(0,t.jsx)(n.code,{children:"WebGpuRendererAssets.loadFont(...)"})," as ",(0,t.jsx)(n.code,{children:"{ image, baseFontSizePx, lineHeightPx, glyphs, fallbackCodePoint? }"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The renderer packs the font image into the global atlas, then computes per-glyph UVs by combining the packed atlas rect with glyph sub-rects (",(0,t.jsx)(n.code,{children:"buildBitmapFontRuntimeGlyph(...)"})," in ",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"text"})," draws render as instanced quads using the same pipeline as sprites (",(0,t.jsx)(n.code,{children:"#handleTextDraw(...)"})," calls ",(0,t.jsx)(n.code,{children:"appendBitmapTextInstances(...)"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"There is no MSDF/SDF shader path; text is effectively \u201calpha bitmap tinted by draw color\u201d."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Content pipeline:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema"})," pack schema is strict and does not define fonts/assets today (",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," explicitly scoped asset bundling/binary assets out of the initial compiler milestone."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,t.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Narrative"}),":","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Content packs declare fonts (source TTF/OTF, glyph ranges, base size, technique)."}),"\n",(0,t.jsxs)(n.li,{children:["A build-time tool generates deterministic font artifacts per declared font:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MSDF atlas image + glyph metrics JSON (preferred), or"}),"\n",(0,t.jsx)(n.li,{children:"classic bitmap alpha atlas image + glyph metrics JSON (fallback option)."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The build step also produces a stable ",(0,t.jsx)(n.code,{children:"AssetManifest"})," fragment (or a pack-local assets manifest) that includes ",(0,t.jsx)(n.code,{children:"font"})," entries with ",(0,t.jsx)(n.code,{children:"contentHash"})," derived from artifact content (e.g., SHA-256 of bytes)."]}),"\n",(0,t.jsxs)(n.li,{children:["Hosts (starting with ",(0,t.jsx)(n.code,{children:"shell-desktop"}),") load the assets manifest and implement ",(0,t.jsx)(n.code,{children:"assets.loadFont(...)"})," by reading the generated font metadata + decoding the atlas image."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," renders bitmap fonts as today, and renders MSDF fonts via a dedicated MSDF text pipeline/shader."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Diagram"}),": TBD"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Runtime Changes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Extend the in-memory font model returned by ",(0,t.jsx)(n.code,{children:"assets.loadFont(...)"})," to support MSDF metadata in an additive way. Proposed shape:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"technique?: 'bitmap' | 'msdf'"})," (default: ",(0,t.jsx)(n.code,{children:"'bitmap'"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"msdf?: { pxRange: number }"})," (required when ",(0,t.jsx)(n.code,{children:"technique === 'msdf'"}),")"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Add a new MSDF render pipeline in ",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["A WGSL fragment shader that samples the atlas (RGB MSDF), computes signed distance via ",(0,t.jsx)(n.code,{children:"median(r, g, b)"}),", and derives alpha using ",(0,t.jsx)(n.code,{children:"fwidth"}),"-based smoothing."]}),"\n",(0,t.jsxs)(n.li,{children:["Batching rule: MSDF text draws must not be batched with sprite/image draws unless the pipeline/shader is the same. Introduce a separate batch kind (e.g., ",(0,t.jsx)(n.code,{children:"msdfText"}),") or flush on technique boundaries."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Keep the existing bitmap path unchanged for hosts that supply bitmap atlases."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data & Schemas"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add a font declaration schema for content packs. Minimal proposed authoring schema (exact location TBD):","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "fonts": [\n    {\n      "id": "game.ui-font",\n      "source": "fonts/inter.ttf",\n      "baseSizePx": 32,\n      "lineHeightPx": 40,\n      "codePointRanges": [[32, 126], [8192, 8303]],\n      "technique": "msdf",\n      "fallbackCodePoint": 65533\n    }\n  ]\n}\n'})}),"\n","Notes:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"})," becomes the renderer ",(0,t.jsx)(n.code,{children:"AssetId"})," for ",(0,t.jsx)(n.code,{children:"AssetManifest"})," (",(0,t.jsx)(n.code,{children:"kind: 'font'"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"codePointRanges"})," must be normalized and validated (ascending, non-overlapping, within Unicode range)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"lineHeightPx"})," can be explicit or derived by the generator (TBD; see Open Questions)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Define a compiled font artifact format that is easy for hosts to load. Proposed:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"*.font.json"})," containing:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"baseFontSizePx"}),", ",(0,t.jsx)(n.code,{children:"lineHeightPx"}),", ",(0,t.jsx)(n.code,{children:"glyphs[]"}),", ",(0,t.jsx)(n.code,{children:"fallbackCodePoint?"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"technique"})," + technique-specific fields (e.g., ",(0,t.jsx)(n.code,{children:"msdf.pxRange"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"imageFile"})," (relative path) or a convention-based filename."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"*.png"})," (or ",(0,t.jsx)(n.code,{children:".webp"}),") atlas image emitted by the generator."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"APIs & Contracts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Keep ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-contract"})," unchanged."]}),"\n",(0,t.jsxs)(n.li,{children:["Update ",(0,t.jsx)(n.code,{children:"@idle-engine/renderer-webgpu"})," public types (",(0,t.jsx)(n.code,{children:"WebGpuBitmapFont"}),") additively if MSDF metadata is carried there."]}),"\n",(0,t.jsx)(n.li,{children:"Document the \u201cbitmap font artifact\u201d contract clearly (JSON schema + examples)."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tooling & Automation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement a new build step invoked from the content pipeline:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Option A (preferred): integrate into ",(0,t.jsx)(n.code,{children:"packages/content-compiler"})," as an additional artifact stage (\u201cassets\u201d) alongside JSON/module emission."]}),"\n",(0,t.jsxs)(n.li,{children:["Option B: introduce a dedicated CLI under ",(0,t.jsx)(n.code,{children:"tools/"})," (e.g., ",(0,t.jsx)(n.code,{children:"tools/font-atlas-cli"}),") that ",(0,t.jsx)(n.code,{children:"content-compiler"})," invokes."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Use a dedicated MSDF generator (candidates: ",(0,t.jsx)(n.code,{children:"msdfgen"}),", ",(0,t.jsx)(n.code,{children:"msdf-atlas-gen"}),") pinned to a known version and configured to avoid non-deterministic outputs (TBD)."]}),"\n",(0,t.jsxs)(n.li,{children:["Emit stable hashes for ",(0,t.jsx)(n.code,{children:"AssetManifest"})," entries by hashing artifact bytes (image + metadata)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deployment"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["CI must run the font generation step as part of ",(0,t.jsx)(n.code,{children:"pnpm generate"})," (or equivalent) so generated artifacts are always present for packaging."]}),"\n",(0,t.jsx)(n.li,{children:"Decide whether generated font artifacts are committed (like other compiled content outputs) or generated in CI only (TBD; align with existing \u201cgenerated artifacts checked in\u201d pattern)."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Telemetry & Observability"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log structured build-step events only (no noisy console output in tests); runtime telemetry is out of scope."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Security & Compliance"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Treat font compilation as local file IO only; do not fetch remote assets during build."}),"\n",(0,t.jsxs)(n.li,{children:["Ensure the tool does not execute arbitrary paths from untrusted packs when run in CI (validate ",(0,t.jsx)(n.code,{children:"source"})," paths resolve within the pack root)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,t.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Issue Title"}),(0,t.jsx)(n.th,{children:"Scope Summary"}),(0,t.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,t.jsx)(n.th,{children:"Dependencies"}),(0,t.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spike(fonts): research MSDF tooling"})}),(0,t.jsxs)(n.td,{children:["Evaluate ",(0,t.jsx)(n.code,{children:"msdfgen"})," vs ",(0,t.jsx)(n.code,{children:"msdf-atlas-gen"})," (quality, determinism, packaging)"]}),(0,t.jsx)(n.td,{children:"Font Pipeline Agent"}),(0,t.jsx)(n.td,{children:"None"}),(0,t.jsx)(n.td,{children:"Recommendation + pinned tool/version + example output checked"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"feat(content-schema): add font asset spec"})}),(0,t.jsx)(n.td,{children:"Add schema + validation for font declarations in content packs"}),(0,t.jsx)(n.td,{children:"Schema Agent"}),(0,t.jsx)(n.td,{children:"Tooling decision"}),(0,t.jsx)(n.td,{children:"Packs validate; docs updated; tests added"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"feat(content-compiler): generate font atlas artifacts"})}),(0,t.jsx)(n.td,{children:"Implement build-time generation + deterministic artifacts (image + JSON)"}),(0,t.jsx)(n.td,{children:"Font Pipeline Agent"}),(0,t.jsx)(n.td,{children:"Schema"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"pnpm generate"})," emits artifacts; deterministic in ",(0,t.jsx)(n.code,{children:"--check"})," mode"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"feat(renderer-webgpu): MSDF text shader"})}),(0,t.jsx)(n.td,{children:"Add MSDF pipeline and technique-based dispatch for text draws"}),(0,t.jsx)(n.td,{children:"Renderer Agent"}),(0,t.jsx)(n.td,{children:"Tooling decision"}),(0,t.jsx)(n.td,{children:"MSDF text renders; bitmap fonts unchanged; tests pass"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"feat(shell-desktop): load prebuilt font assets"})}),(0,t.jsxs)(n.td,{children:["Implement font asset loader and wire ",(0,t.jsx)(n.code,{children:"assets.loadFont(...)"})]}),(0,t.jsx)(n.td,{children:"Shell Agent"}),(0,t.jsx)(n.td,{children:"Compiler artifacts"}),(0,t.jsx)(n.td,{children:"Shell loads font assets; runtime generation is fallback only"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"docs: document font pipeline + authoring"})}),(0,t.jsx)(n.td,{children:"Document schema, artifact format, and usage guidance"}),(0,t.jsx)(n.td,{children:"Docs/Test Agent"}),(0,t.jsx)(n.td,{children:"Schema + tooling"}),(0,t.jsx)(n.td,{children:"Docs added; example pack updated (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"chore: deprecate runtime font generation"})}),(0,t.jsx)(n.td,{children:"Mark runtime font generation as deprecated (dev fallback)"}),(0,t.jsx)(n.td,{children:"Shell Agent"}),(0,t.jsx)(n.td,{children:"Shell loading"}),(0,t.jsx)(n.td,{children:"Deprecated path gated + documented"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Phase 1"}),": Tooling decision + content schema for font declarations."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Phase 2"}),": Build-time atlas generation + emitted artifacts + manifest hashing."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Phase 3"}),": Renderer MSDF pipeline + shell asset loading + docs."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hand-off Package"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Issue 845 body (requirements and target files)."}),"\n",(0,t.jsxs)(n.li,{children:["Renderer font contracts: ",(0,t.jsx)(n.code,{children:"packages/renderer-contract/src/types.ts"}),", ",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"})]}),"\n",(0,t.jsxs)(n.li,{children:["Content pack schema entrypoint: ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})]}),"\n",(0,t.jsxs)(n.li,{children:["Content compiler scope constraints: ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (revisit non-goals for assets)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Communication Cadence"}),": Single reviewer checkpoint at the end of each phase; keep Issue 845 updated with decision notes."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context Packets"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Read Issue 845 and ",(0,t.jsx)(n.code,{children:"docs/desktop-shell-webgpu-renderer-replay-design-issue-778.md"})," for determinism constraints."]}),"\n",(0,t.jsxs)(n.li,{children:["Inspect ",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"})," text batching (",(0,t.jsx)(n.code,{children:"#handleTextDraw"}),", ",(0,t.jsx)(n.code,{children:"appendBitmapTextInstances"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Inspect ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})," to understand current strict pack schema."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer additive API changes; keep ",(0,t.jsx)(n.code,{children:"RenderCommandBuffer"})," stable."]}),"\n",(0,t.jsx)(n.li,{children:"Keep outputs deterministic: stable glyph ordering, stable atlas packing, stable JSON serialization."}),"\n",(0,t.jsxs)(n.li,{children:["Do not edit checked-in ",(0,t.jsx)(n.code,{children:"dist/**"})," by hand."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Validate that font ",(0,t.jsx)(n.code,{children:"source"})," paths resolve inside the pack directory."]}),"\n",(0,t.jsx)(n.li,{children:"Impose sane caps (max glyph count, atlas size) and fail with actionable errors."}),"\n",(0,t.jsx)(n.li,{children:"Avoid shipping OS-font dependent runtime paths as the default."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/renderer-webgpu"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-schema"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm test --filter @idle-engine/content-compiler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"pnpm lint"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pnpm generate --check"})," (once the font step is wired into the generate pipeline)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep runtime font atlas generation (OffscreenCanvas)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Pros: no build tooling; quick iteration."}),"\n",(0,t.jsx)(n.li,{children:"Cons: startup cost, platform dependence, weaker determinism; rejected for production."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use DOM/CSS text rendering"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Rejected: undermines determinism and replay goals; mismatched across environments (see Issue 778)."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prebaked bitmap atlases only (no MSDF)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Viable fallback, but scaling quality is poor; could be Phase 1 while MSDF lands."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Single-channel SDF instead of MSDF"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Lower memory and simpler shader, but worse corner fidelity; keep as an option if MSDF tooling proves brittle."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Content schema tests: validate font declarations (range normalization, duplicate IDs, invalid paths)."}),"\n",(0,t.jsxs)(n.li,{children:["Content compiler tests: ensure generated artifacts are deterministic (byte-identical) under ",(0,t.jsx)(n.code,{children:"--check"})," and stable ordering rules."]}),"\n",(0,t.jsxs)(n.li,{children:["Renderer tests: add WebGPU-stub tests that:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"validate MSDF technique selects the MSDF pipeline,"}),"\n",(0,t.jsx)(n.li,{children:"validate bitmap fonts remain on the existing sprite pipeline,"}),"\n",(0,t.jsxs)(n.li,{children:["validate technique metadata validation (e.g., missing ",(0,t.jsx)(n.code,{children:"msdf.pxRange"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Measure build-time font generation cost on CI and keep a baseline (TBD thresholds)."}),"\n",(0,t.jsx)(n.li,{children:"Ensure runtime startup is improved vs runtime generation by removing font rasterization work."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tooling / A11y"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Manual smoke test in ",(0,t.jsx)(n.code,{children:"shell-desktop"}),": render sample UI text at multiple ",(0,t.jsx)(n.code,{children:"fontSizePx"})," values and validate crispness and stability under zoom."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MSDF tooling availability and cross-platform support"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mitigation: pin versions; prefer distributable binaries or WASM; add CI checks that fail with actionable install instructions."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Non-deterministic atlas output across OS/architectures"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mitigation: lock tool version and flags; ensure glyph ordering is explicit; consider generating artifacts only in CI and committing results (TBD)."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Renderer complexity / batching regressions"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mitigation: keep bitmap path unchanged; isolate MSDF pipeline; add regression tests around batching boundaries."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Atlas size explosion for large code point ranges"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mitigation: enforce caps; encourage authoring narrow ranges; support multi-page output as follow-up if needed."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Milestones"}),":","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Land schema + tooling decision (no runtime changes yet)."}),"\n",(0,t.jsx)(n.li,{children:"Land build-time font generation + artifact format + manifest hashing."}),"\n",(0,t.jsx)(n.li,{children:"Land renderer MSDF shader support."}),"\n",(0,t.jsx)(n.li,{children:"Land shell-desktop asset loading and deprecate runtime generation by default."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Migration Strategy"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Existing hosts that provide bitmap fonts remain supported."}),"\n",(0,t.jsxs)(n.li,{children:["Packs can adopt the new ",(0,t.jsx)(n.code,{children:"fonts"})," spec incrementally; missing fonts should produce clear errors when text draws reference absent ",(0,t.jsx)(n.code,{children:"fontAssetId"}),"s."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Communication"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Update Issue 845 with the chosen generator tool/version and an example artifact output snapshot."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Where should font declarations live: extend ",(0,t.jsx)(n.code,{children:"pack.json"})," (new ",(0,t.jsx)(n.code,{children:"fonts"})," field) vs a dedicated ",(0,t.jsx)(n.code,{children:"assets.json"})," file within each pack?"]}),"\n",(0,t.jsxs)(n.li,{children:["Which generator tool is preferred (",(0,t.jsx)(n.code,{children:"msdfgen"}),", ",(0,t.jsx)(n.code,{children:"msdf-atlas-gen"}),", or another), and how do we package it for CI + contributors?"]}),"\n",(0,t.jsxs)(n.li,{children:["Should ",(0,t.jsx)(n.code,{children:"lineHeightPx"})," be authored, derived from font metrics, or both (authored override)?"]}),"\n",(0,t.jsxs)(n.li,{children:["Do we need per-font MSDF parameters beyond ",(0,t.jsx)(n.code,{children:"pxRange"})," (e.g., edge threshold), and if so how are they surfaced to the shader deterministically?"]}),"\n",(0,t.jsxs)(n.li,{children:["Should the build step emit an ",(0,t.jsx)(n.code,{children:"AssetManifest"})," for all assets or a \u201cfonts-only\u201d manifest initially?"]}),"\n",(0,t.jsx)(n.li,{children:"Are generated font artifacts committed to the repo (like other compiler outputs) or generated in CI/packaging only?"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Extend the asset pipeline beyond fonts (images/sprite sheets/shaders) once the basic \u201cassets manifest + hashing\u201d approach is proven."}),"\n",(0,t.jsx)(n.li,{children:"Add advanced text features (kerning/shaping, fallback fonts) if required by localization goals."}),"\n",(0,t.jsx)(n.li,{children:"Add a replay/inspection harness that can validate text rendering determinism using packed fonts and known RCB fixtures."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Issue 845: ",(0,t.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/845",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/845"})]}),"\n",(0,t.jsxs)(n.li,{children:["Renderer contract asset kinds: ",(0,t.jsx)(n.code,{children:"packages/renderer-contract/src/types.ts"})]}),"\n",(0,t.jsxs)(n.li,{children:["WebGPU renderer font + text handling: ",(0,t.jsx)(n.code,{children:"packages/renderer-webgpu/src/webgpu-renderer.ts"})]}),"\n",(0,t.jsxs)(n.li,{children:["Determinism constraints (text + assets): ",(0,t.jsx)(n.code,{children:"docs/desktop-shell-webgpu-renderer-replay-design-issue-778.md"})]}),"\n",(0,t.jsxs)(n.li,{children:["Content pack schema entrypoint: ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack/schema.ts"})]}),"\n",(0,t.jsxs)(n.li,{children:["Content compiler design scope: ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Atlas"}),": A single packed texture containing multiple images (and font atlas images) used for batching and fewer texture binds."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bitmap font"}),": A font rendered to pixels ahead of time; scaling up typically blurs or pixelates."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SDF/MSDF"}),": Signed Distance Field / Multi-channel Signed Distance Field. Encodes distance to glyph edges so text can scale crisply in a shader."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"pxRange"})}),": The pixel distance range encoded into an SDF/MSDF atlas; required to convert sampled values into coverage."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Date"}),(0,t.jsx)(n.th,{children:"Author"}),(0,t.jsx)(n.th,{children:"Change Summary"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2026-01-25"}),(0,t.jsx)(n.td,{children:"Ralph (AI agent)"}),(0,t.jsx)(n.td,{children:"Initial draft for Issue 845"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(9430);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);