"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[1552],{228:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"shell-desktop-mcp","title":"Shell Desktop MCP Guide","description":"Enable and use the embedded MCP server shipped with @idle-engine/shell-desktop","source":"@site/../../docs/shell-desktop-mcp.md","sourceDirName":".","slug":"/shell-desktop-mcp","permalink":"/Idle-Game-Engine/shell-desktop-mcp","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/shell-desktop-mcp.md","tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"title":"Shell Desktop MCP Guide","description":"Enable and use the embedded MCP server shipped with @idle-engine/shell-desktop","sidebar_position":25},"sidebar":"developerSidebar","previous":{"title":"Desktop Shell + WebGPU Renderer + Replay (Issue 778)","permalink":"/Idle-Game-Engine/desktop-shell-webgpu-renderer-replay-design-issue-778"},"next":{"title":"Runtime Event Pub/Sub Design","permalink":"/Idle-Game-Engine/runtime-event-pubsub-design"}}');var d=n(5270),r=n(7678);const i={title:"Shell Desktop MCP Guide",description:"Enable and use the embedded MCP server shipped with @idle-engine/shell-desktop",sidebar_position:25},t="Shell Desktop MCP Guide",o={},c=[{value:"Quickstart",id:"quickstart",level:2},{value:"Headless Linux (xpra)",id:"headless-linux-xpra",level:3},{value:"Fast GPU checks",id:"fast-gpu-checks",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Always-On Gateway (Codex-friendly)",id:"always-on-gateway-codex-friendly",level:2},{value:"Tool surface (MVP)",id:"tool-surface-mvp",level:2},{value:"Client setup",id:"client-setup",level:2},{value:"Cursor",id:"cursor",level:3},{value:"Claude Desktop",id:"claude-desktop",level:3},{value:"Example workflows",id:"example-workflows",level:2},{value:"Regression testing",id:"regression-testing",level:3},{value:"Debugging",id:"debugging",level:3},{value:"Diagnostics triage",id:"diagnostics-triage",level:3},{value:"Content iteration",id:"content-iteration",level:3}];function a(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.header,{children:(0,d.jsx)(s.h1,{id:"shell-desktop-mcp-guide",children:"Shell Desktop MCP Guide"})}),"\n",(0,d.jsxs)(s.p,{children:["The Electron desktop shell (",(0,d.jsx)(s.code,{children:"@idle-engine/shell-desktop"}),") ships an embedded ",(0,d.jsx)(s.a,{href:"https://modelcontextprotocol.io/",children:"Model Context Protocol (MCP)"})," server for local, developer-only automation."]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Disabled by default."}),"\n",(0,d.jsxs)(s.li,{children:["Binds to ",(0,d.jsx)(s.code,{children:"127.0.0.1"})," only."]}),"\n",(0,d.jsx)(s.li,{children:"Uses SSE (Server-Sent Events) over HTTP."}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"quickstart",children:"Quickstart"}),"\n",(0,d.jsx)(s.p,{children:"Start the desktop shell with MCP enabled:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"IDLE_ENGINE_ENABLE_MCP_SERVER=1 pnpm --filter @idle-engine/shell-desktop run start\n"})}),"\n",(0,d.jsxs)(s.p,{children:["By default the server listens on port ",(0,d.jsx)(s.code,{children:"8570"})," and prints a line like:"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-text",children:"[shell-desktop] MCP server listening at http://127.0.0.1:8570/mcp/sse\n"})}),"\n",(0,d.jsxs)(s.p,{children:["If port ",(0,d.jsx)(s.code,{children:"8570"})," is already taken and you did not explicitly set ",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_PORT"}),"/",(0,d.jsx)(s.code,{children:"--mcp-port"}),", the shell auto-falls back to ",(0,d.jsx)(s.code,{children:"8571"}),"."]}),"\n",(0,d.jsx)(s.h3,{id:"headless-linux-xpra",children:"Headless Linux (xpra)"}),"\n",(0,d.jsx)(s.p,{children:"For remote/headless hosts, use the workspace launcher:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:headless\n"})}),"\n",(0,d.jsx)(s.p,{children:"This launcher:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["starts or reuses an xpra display (",(0,d.jsx)(s.code,{children:":121"})," by default),"]}),"\n",(0,d.jsxs)(s.li,{children:["uses an Xorg-backed xpra server by default (",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_XPRA_BACKEND=xorg"}),") so Linux hosts can use hardware GL instead of llvmpipe,"]}),"\n",(0,d.jsxs)(s.li,{children:["runs Electron with ",(0,d.jsx)(s.code,{children:"--no-sandbox"})," (needed on many rootless hosts),"]}),"\n",(0,d.jsxs)(s.li,{children:["enables the Chromium Vulkan feature (",(0,d.jsx)(s.code,{children:"--enable-features=Vulkan"}),") for Linux WebGPU adapter bring-up,"]}),"\n",(0,d.jsxs)(s.li,{children:["enables MCP by default (",(0,d.jsx)(s.code,{children:"http://127.0.0.1:8570/mcp/sse"}),")."]}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"Smoke-test the MCP server from the same host:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:mcp:smoke\n"})}),"\n",(0,d.jsx)(s.p,{children:"Stop the xpra session:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:headless:stop\n"})}),"\n",(0,d.jsx)(s.h3,{id:"fast-gpu-checks",children:"Fast GPU checks"}),"\n",(0,d.jsx)(s.p,{children:"Use these after launch to confirm hardware bring-up:"}),"\n",(0,d.jsx)(s.p,{children:"Inside Electron DevTools:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-js",children:"navigator.gpu\nconst a = await navigator.gpu.requestAdapter(); a?.name\n"})}),"\n",(0,d.jsx)(s.p,{children:"On the host CLI:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"vulkaninfo --summary\n"})}),"\n",(0,d.jsxs)(s.p,{children:["Expected host signal: ",(0,d.jsx)(s.code,{children:"GPU0"})," should report ",(0,d.jsx)(s.code,{children:"Intel(R) Arc(tm) A310 Graphics (DG2)"}),"."]}),"\n",(0,d.jsx)(s.h3,{id:"configuration",children:"Configuration"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Enablement:","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Env var: ",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_ENABLE_MCP_SERVER=1"})]}),"\n",(0,d.jsxs)(s.li,{children:["Arg: ",(0,d.jsx)(s.code,{children:"--enable-mcp-server"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["Port override:","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Env var: ",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_PORT=8571"})]}),"\n",(0,d.jsxs)(s.li,{children:["Arg: ",(0,d.jsx)(s.code,{children:"--mcp-port=8571"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["Asset root override (for non-sample games):","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Env var: ",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_COMPILED_ASSETS_ROOT=/abs/path/to/your/content/compiled"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["Headless gateway mode:","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Env var: ",(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_GATEWAY_MODE=1"})," (defaults shell-desktop MCP port to ",(0,d.jsx)(s.code,{children:"8571"})," when not explicitly set)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.p,{children:["The endpoint is ",(0,d.jsx)(s.code,{children:"/mcp/sse"})," (with ",(0,d.jsx)(s.code,{children:"/mcp"})," accepted as an alias for streamable-HTTP clients)."]}),"\n",(0,d.jsx)(s.h2,{id:"always-on-gateway-codex-friendly",children:"Always-On Gateway (Codex-friendly)"}),"\n",(0,d.jsxs)(s.p,{children:["If you want Codex/Cursor MCP startup to succeed even before shell-desktop is running, run the MCP gateway on ",(0,d.jsx)(s.code,{children:"8570"})," and let shell-desktop use ",(0,d.jsx)(s.code,{children:"8571"}),"."]}),"\n",(0,d.jsx)(s.p,{children:"Terminal A (keep running):"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:mcp:gateway\n"})}),"\n",(0,d.jsx)(s.p,{children:"Background daemon mode (recommended for frequent Codex usage):"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:mcp:gateway:daemon:start\npnpm shell:desktop:mcp:gateway:daemon:status\npnpm shell:desktop:mcp:gateway:daemon:stop\n"})}),"\n",(0,d.jsx)(s.p,{children:"The daemon stores state in:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["PID file: ",(0,d.jsx)(s.code,{children:"/tmp/idle-engine-shell-desktop-mcp-gateway.pid"})]}),"\n",(0,d.jsxs)(s.li,{children:["Log file: ",(0,d.jsx)(s.code,{children:"/tmp/idle-engine-shell-desktop-mcp-gateway.log"})]}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"Optional overrides for the gateway:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_PORT"})," (gateway listen port, default ",(0,d.jsx)(s.code,{children:"8570"}),")"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_BACKEND_PORT"})," (shell-desktop backend port, default ",(0,d.jsx)(s.code,{children:"8571"}),")"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"IDLE_ENGINE_MCP_BACKEND_URL"})," (full backend URL, overrides backend port; must use ",(0,d.jsx)(s.code,{children:"http://"})," loopback)"]}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"Terminal B (start shell-desktop later, backend on 8571):"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"pnpm shell:desktop:headless:gateway-backend\n"})}),"\n",(0,d.jsx)(s.p,{children:"Behavior:"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Gateway on ",(0,d.jsx)(s.code,{children:"8570"})," is always reachable."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"health"})," returns ",(0,d.jsx)(s.code,{children:"ok: false"})," while shell-desktop backend is down."]}),"\n",(0,d.jsxs)(s.li,{children:["Once shell-desktop comes up on ",(0,d.jsx)(s.code,{children:"8571"}),", the gateway proxies all MCP calls and ",(0,d.jsx)(s.code,{children:"health"})," returns backend ",(0,d.jsx)(s.code,{children:"ok: true"}),"."]}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"tool-surface-mvp",children:"Tool surface (MVP)"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"health"}),": basic health/capabilities snapshot."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"sim"}),": ",(0,d.jsx)(s.code,{children:"sim.status"}),", ",(0,d.jsx)(s.code,{children:"sim.start"}),", ",(0,d.jsx)(s.code,{children:"sim.stop"}),", ",(0,d.jsx)(s.code,{children:"sim.pause"}),", ",(0,d.jsx)(s.code,{children:"sim.resume"}),", ",(0,d.jsx)(s.code,{children:"sim.step"}),", ",(0,d.jsx)(s.code,{children:"sim.enqueue"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"renderer"}),": ",(0,d.jsx)(s.code,{children:"renderer.status"})," (returns ",(0,d.jsx)(s.code,{children:"#output"})," text, optional error banner text, and renderer state snapshot)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"logs"}),": ",(0,d.jsx)(s.code,{children:"logs.tail"}),", ",(0,d.jsx)(s.code,{children:"logs.since"})," (structured logs with ",(0,d.jsx)(s.code,{children:"source"}),", ",(0,d.jsx)(s.code,{children:"subsystem"}),", and ",(0,d.jsx)(s.code,{children:"severity"})," filters)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"probe"}),": ",(0,d.jsx)(s.code,{children:"probe.webgpuHealth"})," (machine-readable WebGPU status, last loss reason, and event timestamp)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"window"}),": ",(0,d.jsx)(s.code,{children:"window.info"}),", ",(0,d.jsx)(s.code,{children:"window.resize"}),", ",(0,d.jsx)(s.code,{children:"window.devtools"}),", ",(0,d.jsx)(s.code,{children:"window.screenshot"})," (bounded, returns base64 PNG)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"input"}),": ",(0,d.jsx)(s.code,{children:"input.controlEvent"})," (reuses ",(0,d.jsx)(s.code,{children:"ShellControlEvent"})," semantics)."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"asset"}),": ",(0,d.jsx)(s.code,{children:"asset.list"}),", ",(0,d.jsx)(s.code,{children:"asset.read"})," (scoped to compiled assets root with traversal protection)."]}),"\n"]}),"\n",(0,d.jsxs)(s.p,{children:["Naming note: issue discussions may use underscore examples (",(0,d.jsx)(s.code,{children:"renderer_status"}),", ",(0,d.jsx)(s.code,{children:"logs_since"}),", ",(0,d.jsx)(s.code,{children:"probe_webgpu_health"}),"), but the shell-desktop MCP uses dotted namespaces consistently (",(0,d.jsx)(s.code,{children:"renderer.status"}),", ",(0,d.jsx)(s.code,{children:"logs.since"}),", ",(0,d.jsx)(s.code,{children:"probe.webgpuHealth"}),")."]}),"\n",(0,d.jsx)(s.h2,{id:"client-setup",children:"Client setup"}),"\n",(0,d.jsx)(s.h3,{id:"cursor",children:"Cursor"}),"\n",(0,d.jsxs)(s.p,{children:["Create ",(0,d.jsx)(s.code,{children:".cursor/mcp.json"})," (repo-local) and point it at the SSE URL:"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "idle-engine-shell-desktop": {\n      "url": "http://127.0.0.1:8570/mcp/sse"\n    }\n  }\n}\n'})}),"\n",(0,d.jsx)(s.p,{children:"Restart Cursor (or reload MCP servers) after editing the file."}),"\n",(0,d.jsx)(s.h3,{id:"claude-desktop",children:"Claude Desktop"}),"\n",(0,d.jsx)(s.p,{children:"Claude Desktop configures remote MCP servers via its UI (Settings \u2192 Connectors). Add a custom MCP server that points at:"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-text",children:"http://127.0.0.1:8570/mcp/sse\n"})}),"\n",(0,d.jsxs)(s.p,{children:["If your Claude Desktop build does not support remote MCP servers (or refuses ",(0,d.jsx)(s.code,{children:"http://localhost"})," URLs), use Cursor or an SSE\u2192stdio bridge tool and then configure the bridge as a local stdio MCP server in Claude Desktop."]}),"\n",(0,d.jsx)(s.h2,{id:"example-workflows",children:"Example workflows"}),"\n",(0,d.jsx)(s.h3,{id:"regression-testing",children:"Regression testing"}),"\n",(0,d.jsx)(s.p,{children:"Prompt template:"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsxs)(s.p,{children:["Start the sim, pause it, step 120 frames, take a screenshot, and report ",(0,d.jsx)(s.code,{children:"sim.status"})," plus the screenshot bytes count."]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"debugging",children:"Debugging"}),"\n",(0,d.jsx)(s.p,{children:"Prompt template:"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsxs)(s.p,{children:["Call ",(0,d.jsx)(s.code,{children:"window.info"}),", open devtools via ",(0,d.jsx)(s.code,{children:"window.devtools"}),", then ",(0,d.jsx)(s.code,{children:"sim.status"}),". If the sim is running, pause it and step 1 frame. Summarize what changed."]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"diagnostics-triage",children:"Diagnostics triage"}),"\n",(0,d.jsx)(s.p,{children:"Prompt template:"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsxs)(s.p,{children:["Call ",(0,d.jsx)(s.code,{children:"renderer.status"}),", then ",(0,d.jsx)(s.code,{children:"logs.tail"})," filtered to ",(0,d.jsx)(s.code,{children:'{ "source": "renderer", "subsystem": "webgpu", "severity": "error" }'}),", then ",(0,d.jsx)(s.code,{children:"probe.webgpuHealth"}),". Report whether WebGPU is ",(0,d.jsx)(s.code,{children:"ok"}),", ",(0,d.jsx)(s.code,{children:"lost"}),", or ",(0,d.jsx)(s.code,{children:"recovered"})," and include the last loss reason."]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"content-iteration",children:"Content iteration"}),"\n",(0,d.jsx)(s.p,{children:"Prompt template:"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsx)(s.p,{children:"List assets under the compiled assets root (limit to the top 25 entries). If you find any JSON content, read one file (max 50KB) and summarize what knobs it exposes. Then enqueue a command that would exercise the change, and step 10 frames."}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},7678:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>t});var l=n(9430);const d={},r=l.createContext(d);function i(e){const s=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),l.createElement(r.Provider,{value:s},e.children)}}}]);