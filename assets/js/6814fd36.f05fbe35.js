"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[2179],{6635:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"content-dsl-usage-guidelines","title":"Content DSL Usage Guidelines","description":"Prescriptive workflow for building, validating, and shipping Idle Engine content packs.","source":"@site/../../docs/content-dsl-usage-guidelines.md","sourceDirName":".","slug":"/content-dsl-usage-guidelines","permalink":"/Idle-Game-Engine/content-dsl-usage-guidelines","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/content-dsl-usage-guidelines.md","tags":[],"version":"current","frontMatter":{"title":"Content DSL Usage Guidelines","description":"Prescriptive workflow for building, validating, and shipping Idle Engine content packs."},"sidebar":"developerSidebar","previous":{"title":"Content DSL Schema Design","permalink":"/Idle-Game-Engine/content-dsl-schema-design"},"next":{"title":"Content Compiler Design Document","permalink":"/Idle-Game-Engine/content-compiler-design"}}');var t=s(5270),r=s(7678);const c={title:"Content DSL Usage Guidelines",description:"Prescriptive workflow for building, validating, and shipping Idle Engine content packs."},a=void 0,d={},o=[{value:"Pipeline Overview",id:"pipeline-overview",level:2},{value:"Pack Scaffolding",id:"pack-scaffolding",level:2},{value:"Author checklist",id:"author-checklist",level:3},{value:"Sample pack (prestige + balance) reference",id:"sample-pack-prestige--balance-reference",level:3},{value:"Prestige gating conditions",id:"prestige-gating-conditions",level:3},{value:"Naming Conventions",id:"naming-conventions",level:2},{value:"Naming checklist",id:"naming-checklist",level:3},{value:"Declaring Dependencies",id:"declaring-dependencies",level:2},{value:"Dependency checklist",id:"dependency-checklist",level:3},{value:"Dependency compatibility matrix",id:"dependency-compatibility-matrix",level:3},{value:"Versioning &amp; Release Cadence",id:"versioning--release-cadence",level:2},{value:"Versioning checklist",id:"versioning-checklist",level:3},{value:"Compatibility Triage",id:"compatibility-triage",level:2},{value:"Compatibility checklist",id:"compatibility-checklist",level:3},{value:"Migration matrix",id:"migration-matrix",level:3},{value:"Transform Patterns &amp; Cycle Detection",id:"transform-patterns--cycle-detection",level:2},{value:"What Constitutes a Cycle",id:"what-constitutes-a-cycle",level:3},{value:"Safe Transform Patterns",id:"safe-transform-patterns",level:3},{value:"\u2705 Linear transformation chains",id:"-linear-transformation-chains",level:4},{value:"\u2705 Resource sinks (consumables)",id:"-resource-sinks-consumables",level:4},{value:"\u2705 Convergent production trees",id:"-convergent-production-trees",level:4},{value:"\u274c Circular transform chains",id:"-circular-transform-chains",level:4},{value:"Safe Unlock Condition Patterns",id:"safe-unlock-condition-patterns",level:3},{value:"\u2705 Self-threshold (unlock after first production)",id:"-self-threshold-unlock-after-first-production",level:4},{value:"\u2705 Progressive unlocks",id:"-progressive-unlocks",level:4},{value:"\u274c Circular unlock dependencies",id:"-circular-unlock-dependencies",level:4},{value:"Transform Cycle Detection Checklist",id:"transform-cycle-detection-checklist",level:3},{value:"Migrating Existing Content with Cycles",id:"migrating-existing-content-with-cycles",level:3},{value:"Safety Guardrails",id:"safety-guardrails",level:3},{value:"Reference Examples &amp; Tooling",id:"reference-examples--tooling",level:2},{value:"Balance validation defaults &amp; commands",id:"balance-validation-defaults--commands",level:2},{value:"Verification Runbook",id:"verification-runbook",level:2},{value:"See Also",id:"see-also",level:2},{value:"Formula Invariants &amp; Cost Semantics",id:"formula-invariants--cost-semantics",level:2},{value:"Exponential Cost Curve Formula",id:"exponential-cost-curve-formula",level:3},{value:"Snapshot Determinism (Progression Views)",id:"snapshot-determinism-progression-views",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["This guide turns the Content DSL specification into a step-by-step workflow for\nauthors and automation agents. It maps back to\n",(0,t.jsx)(n.code,{children:"docs/content-dsl-usage-guidelines-design.md"})," and the schema behaviour in\n",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack.ts"}),", so every directive stays tied to a\ncontract."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Need deeper rationale? Read\n",(0,t.jsx)(n.a,{href:"/Idle-Game-Engine/content-dsl-schema-design",children:(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})}),",\n",(0,t.jsx)(n.a,{href:"/Idle-Game-Engine/content-compiler-design",children:(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})}),", and inspect\nthe canonical examples in ",(0,t.jsx)(n.code,{children:"packages/content-sample"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"pipeline-overview",children:"Pipeline Overview"}),"\n",(0,t.jsx)(n.p,{children:"Authoring flows follow the same control points that the compiler and CLI\nenforce:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mermaid",children:'flowchart LR\n  Author["Content author or agent"]\n  Guide["This usage guide"]\n  Schema["@idle-engine/content-schema"]\n  Compiler["pnpm generate\\n(content compiler)"]\n  Runtime["@idle-engine/core\\nconsumers"]\n\n  Author --\x3e Guide --\x3e Schema --\x3e Compiler --\x3e Runtime\n'})}),"\n",(0,t.jsx)(n.p,{children:"The rest of this document walks the pipeline stage-by-stage with checklists,\nexamples, and validation hooks."}),"\n",(0,t.jsx)(n.h2,{id:"pack-scaffolding",children:"Pack Scaffolding"}),"\n",(0,t.jsxs)(n.p,{children:["Start from the structure maintained in ",(0,t.jsx)(n.code,{children:"packages/content-sample"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Authoring sources live in ",(0,t.jsx)(n.code,{children:"content/pack.json"})," (or ",(0,t.jsx)(n.code,{children:".json5"})," when comments help)."]}),"\n",(0,t.jsxs)(n.li,{children:["Compiler outputs land in ",(0,t.jsx)(n.code,{children:"content/compiled/"})," and ",(0,t.jsx)(n.code,{children:"src/generated/"})," via\n",(0,t.jsx)(n.code,{children:"pnpm generate"})," and ",(0,t.jsx)(n.code,{children:"tools/content-schema-cli/src/generate.js"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Runtime-facing re-exports live in ",(0,t.jsx)(n.code,{children:"src/index.ts"}),", mirroring\n",(0,t.jsx)(n.code,{children:"packages/content-sample/src/index.ts"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"author-checklist",children:"Author checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create a new workspace package (for example ",(0,t.jsx)(n.code,{children:"packages/<pack-slug>"}),") with a\n",(0,t.jsx)(n.code,{children:"content/"})," directory that mirrors the layout in\n",(0,t.jsx)(n.code,{children:"packages/content-sample/README.md"}),"."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Copy the latest ",(0,t.jsx)(n.code,{children:"pnpm"})," scripts and TypeScript config from the sample pack\nso ",(0,t.jsx)(n.code,{children:"pnpm generate"}),", ",(0,t.jsx)(n.code,{children:"pnpm lint"}),", and tests stay aligned."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Treat ",(0,t.jsx)(n.code,{children:"content/compiled/"})," and ",(0,t.jsx)(n.code,{children:"src/generated/"})," as generated outputs\u2014never\nhand-edit them; always re-run ",(0,t.jsx)(n.code,{children:"pnpm generate"})," after source edits."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Commit the generated artifacts alongside ",(0,t.jsx)(n.code,{children:"content/pack.json"})," so consumers\nnever regenerate during install."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"sample-pack-prestige--balance-reference",children:"Sample pack (prestige + balance) reference"}),"\n",(0,t.jsxs)(n.p,{children:["The reference pack in ",(0,t.jsx)(n.code,{children:"packages/content-sample/content/pack.json"})," embodies the\nexpanded economy and prestige layer described in\n",(0,t.jsx)(n.a,{href:"/Idle-Game-Engine/sample-pack-balance-validation-design-issue-420",children:(0,t.jsx)(n.code,{children:"docs/sample-pack-balance-validation-design-issue-420.md"})}),".\nUse it as a template when authoring or validating new packs:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Resources"}),": Energy (starts at 10), Crystal (hard currency, unlocks at\nEnergy \u2265 25), Alloy (tier 2, unlocks at Crystal \u2265 50), Data Core (tier 2,\nunlocks at Alloy \u2265 40), and Prestige Flux (prestige-only, hidden until the\nprestige layer unlocks)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Generators"}),": Reactor (Energy), Crystal Harvester (consumes Energy), Forge\n(consumes Energy + Crystal \u2192 Alloy, linear cost: base 75, slope 12), Research\nLab (consumes Energy + Alloy \u2192 Data Core, exponential cost: base 120,\ngrowth 1.12), and Gate Reactor (consumes Data Core \u2192 Prestige Flux; only\nvisible/unlocked after prestige)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Upgrades"}),": Multi-tier reactor line (Insulation \u2192 Overclock \u2192 Phase\nCooling), harvester line with repeatable Quantum Sieve, forge cost/rate tuning\n(Heat Shield, Auto-Feed), lab rate boosts (Insight Boost + repeatable\nSimulation Stack gated on Prestige Flux), and the prestige-centric Ascension\nSurge multiplier."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prestige layer"}),": ",(0,t.jsx)(n.code,{children:"sample-pack.ascension-alpha"})," unlocks at Data Core \u2265 500\nand Reactor level \u2265 10, resets base resources/generators/upgrades, and grants\nPrestige Flux via a clamped reward formula\n(",(0,t.jsx)(n.code,{children:"floor((energy + crystal + 2 * data-core) / 750)"})," capped to 1\u20135000). A\nminimum of 1 Prestige Flux is retained after each reset."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"prestige-gating-conditions",children:"Prestige gating conditions"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"prestigeUnlocked"}),' is easy to misread as "post-prestige". In the engine it means\n"the prestige layer is currently available/unlocked" (i.e., the reset action is\navailable right now).']}),"\n",(0,t.jsxs)(n.p,{children:['For "post-prestige only" content ("the player has prestiged at least once"),\nuse ',(0,t.jsx)(n.code,{children:"prestigeCompleted"}),", which evaluates against the ",(0,t.jsx)(n.code,{children:"{layerId}-prestige-count"}),"\nresource internally (so you don't need magic-string resource IDs)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "kind": "prestigeCompleted",\n  "prestigeLayerId": "sample-pack.ascension-alpha"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:['If you need a higher threshold (for example "after 5 prestiges"), use\n',(0,t.jsx)(n.code,{children:"prestigeCountThreshold"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "kind": "prestigeCountThreshold",\n  "prestigeLayerId": "sample-pack.ascension-alpha",\n  "comparator": "gte",\n  "count": 5\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"naming-conventions",children:"Naming Conventions"}),"\n",(0,t.jsxs)(n.p,{children:["The schema enforces naming through ",(0,t.jsx)(n.code,{children:"packSlugSchema"}),", ",(0,t.jsx)(n.code,{children:"contentIdSchema"}),", and\nrelated validators (see ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack.ts"}),"). Keep these rules\nin mind before you run validation:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata.id"}),": lowercase slug (",(0,t.jsx)(n.code,{children:"a-z0-9-"}),"), \u226432 chars, and stable after publish\n(",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa75.5)."]}),"\n",(0,t.jsxs)(n.li,{children:["Content IDs: reuse the slug casing from ",(0,t.jsx)(n.code,{children:"contentIdSchema"})," and prefix with the\npack slug to avoid collisions (",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack.ts"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata.title"})," / ",(0,t.jsx)(n.code,{children:"summary"}),": provide ",(0,t.jsx)(n.code,{children:"default"})," copy and locale variants; keep\n",(0,t.jsx)(n.code,{children:"summary"})," \u2264512 chars (",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa75.5)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata.tags"}),": slug list (\u226424 chars) with no spaces or uppercase characters\n(",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa75.5)."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"naming-checklist",children:"Naming checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pick a pack slug that matches the directory name and stays unique across\n",(0,t.jsx)(n.code,{children:"packages/*"})," (collisions surface via ",(0,t.jsx)(n.code,{children:"ContentSchemaOptions.knownPacks"})," in\n",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack.ts"}),")."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Reserve a namespace prefix for content IDs before authoring modules and\napply it consistently."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Populate localized titles and summaries while setting ",(0,t.jsx)(n.code,{children:"defaultLocale"})," and\n",(0,t.jsx)(n.code,{children:"supportedLocales"})," to avoid churn later."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Document non-obvious tags or visibility flags in the package README so\nreviewers capture intent."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"declaring-dependencies",children:"Declaring Dependencies"}),"\n",(0,t.jsxs)(n.p,{children:["Model relationships through ",(0,t.jsx)(n.code,{children:"metadata.dependencies"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"requires"}),": hard dependencies that must be installed and activated first."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"optional"}),": soft integrations flagged as warnings when missing (requires\n",(0,t.jsx)(n.code,{children:"ContentSchemaOptions.activePackIds"})," during validation)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"conflicts"}),": mutually exclusive packs that should never load together."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"provides"}),": capability slugs that downstream tooling can query."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Normalization deduplicates entries, sorts them, and blocks self-references (see\n",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \xa75.5 and\n",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/dependencies.ts"}),")."]}),"\n",(0,t.jsx)(n.h3,{id:"dependency-checklist",children:"Dependency checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","List every runtime prerequisite under ",(0,t.jsx)(n.code,{children:"metadata.dependencies.requires"}),"\nwith a SemVer range that matches the dependency\u2019s ",(0,t.jsx)(n.code,{children:"metadata.version"}),"."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mark optional integrations only when the pack functions without them and\nadd contextual ",(0,t.jsx)(n.code,{children:"message"})," fields for conflicts so tooling can explain why."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Update team installation manifests (if any) whenever you add a new hard\ndependency so validation inputs stay aligned."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Re-run ",(0,t.jsx)(n.code,{children:"pnpm generate"})," and confirm the CLI logs omit\n",(0,t.jsx)(n.code,{children:"content_pack.dependency_cycle"})," warnings."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"dependency-compatibility-matrix",children:"Dependency compatibility matrix"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Policy"}),(0,t.jsx)(n.th,{children:"Applies When"}),(0,t.jsx)(n.th,{children:"Enforcement"}),(0,t.jsx)(n.th,{children:"References"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"requires"})}),(0,t.jsx)(n.td,{children:"Pack cannot function without another pack"}),(0,t.jsx)(n.td,{children:"Validation fails on missing packs; compiler blocks compilation"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.6)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"optional"})}),(0,t.jsx)(n.td,{children:"Integration enhances behaviour but is not mandatory"}),(0,t.jsxs)(n.td,{children:["Emits warnings when absent if ",(0,t.jsx)(n.code,{children:"ContentSchemaOptions.activePackIds"})," supplies the install graph"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5), ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/dependencies.ts"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"conflicts"})}),(0,t.jsx)(n.td,{children:"Packs must never load together"}),(0,t.jsx)(n.td,{children:"Validation errors guard against self-dependency; compiler logs failure with the conflicting slug"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.6)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"provides"})}),(0,t.jsx)(n.td,{children:"Pack exposes capabilities for discovery tooling"}),(0,t.jsx)(n.td,{children:"Normalisation deduplicates entries; workspace summary records capability digests"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.4)"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"versioning--release-cadence",children:"Versioning & Release Cadence"}),"\n",(0,t.jsx)(n.p,{children:"Content packs carry both a pack version and a runtime compatibility range:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata.version"})," must follow ",(0,t.jsx)(n.a,{href:"https://semver.org/",children:"Semantic Versioning"})," and\nincrements whenever pack behaviour or data changes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata.engine"})," expresses supported engine versions; validation uses\n",(0,t.jsx)(n.code,{children:"semver.satisfies()"})," and the feature gates in\n",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Compiler summaries (",(0,t.jsx)(n.code,{children:"src/generated/*summary*"})," in the sample pack) surface the\nslug, version, and warning count at import time\n(",(0,t.jsx)(n.code,{children:"packages/content-sample/src/index.ts:23-44"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"versioning-checklist",children:"Versioning checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Bump ",(0,t.jsx)(n.code,{children:"metadata.version"})," for every committed change that alters gameplay,\ndata tables, or compatibility metadata."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Align ",(0,t.jsx)(n.code,{children:"metadata.engine"})," with the runtime tested locally (for example\n",(0,t.jsx)(n.code,{children:">=0.4.0 <0.6.0"}),"); widen ranges only after validating against newer runtimes."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Capture notable changes in your package README or release notes so other\nauthors can plan migrations."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Inspect the generated summary module to confirm the digest and artifact\nhash changed when expected; unexpected stability often means missing source\ndiffs."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"compatibility-triage",children:"Compatibility Triage"}),"\n",(0,t.jsxs)(n.p,{children:["Feature gates keep packs aligned with runtime capabilities. The current baseline\nlives in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Module"}),(0,t.jsx)(n.th,{children:"Introduced in"}),(0,t.jsx)(n.th,{children:"Documentation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"automations"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.2.0"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/idle-engine-design.md"})," (\xa76.2)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"transforms"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.3.0"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/idle-engine-design.md"})," (\xa76.2)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"runtimeEvents"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.3.0"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"docs/runtime-event-pubsub-design.md"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"prestigeLayers"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.4.0"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/idle-engine-design.md"})," (\xa76.2)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"guildPerks"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.5.0"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/idle-engine-design.md"})," (\xa76.2)"]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"metadata.engine"})," omits or predates the required version, validation pushes\nstructured ",(0,t.jsx)(n.code,{children:"FeatureViolation"})," errors or warnings (see\n",(0,t.jsx)(n.code,{children:"resolveFeatureViolations"})," in ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),")."]}),"\n",(0,t.jsx)(n.h3,{id:"compatibility-checklist",children:"Compatibility checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set ",(0,t.jsx)(n.code,{children:"metadata.engine"})," before authoring gated modules so compatibility\nerrors appear during ",(0,t.jsx)(n.code,{children:"pnpm generate"}),"."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Treat feature-gate warnings (",(0,t.jsx)(n.code,{children:"severity: warning"}),") as TODOs\u2014either upgrade\nthe runtime target or trim gated modules before shipping."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Include CLI logs from ",(0,t.jsx)(n.code,{children:"pnpm generate"})," in review artifacts whenever\ncompatibility adjustments are part of the change."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","If runtime contracts evolve, update this table and the pack metadata in\nthe same pull request to avoid drift."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"migration-matrix",children:"Migration matrix"}),"\n",(0,t.jsx)(n.p,{children:"Use this matrix to plan schema evolution and pack migrations in lockstep with\nthe compiler and runtime guardrails described in the design docs."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scenario"}),(0,t.jsx)(n.th,{children:"Expected action"}),(0,t.jsx)(n.th,{children:"References"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Schema fields added or behaviour changes"}),(0,t.jsxs)(n.td,{children:["Run ",(0,t.jsx)(n.code,{children:"pnpm generate"})," and revalidate packs; document the change in package README and update ",(0,t.jsx)(n.code,{children:"metadata.version"})," to track the migration"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa71, \xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.5)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Dependency graph updates (new ",(0,t.jsx)(n.code,{children:"requires"})," / ",(0,t.jsx)(n.code,{children:"optional"})," edges)"]}),(0,t.jsxs)(n.td,{children:["Refresh installation manifests, rerun validation with updated ",(0,t.jsx)(n.code,{children:"knownPacks"}),", and capture any new warnings in CLI logs"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.6)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Runtime feature gates evolve"}),(0,t.jsxs)(n.td,{children:["Synchronise this guide\u2019s tables with ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),", adjust ",(0,t.jsx)(n.code,{children:"metadata.engine"}),", and rerun schema tests to confirm compatibility"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"packages/content-schema/src/runtime-compat.ts"}),", ",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Compiler format version or digest rules change"}),(0,t.jsx)(n.td,{children:"Rebuild generated artifacts, inspect workspace summary digests, and note migration requirements in release notes"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," (\xa75.4-\xa75.5), ",(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (\xa75.5)"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"transform-patterns--cycle-detection",children:"Transform Patterns & Cycle Detection"}),"\n",(0,t.jsxs)(n.p,{children:["The content schema validates transform chains and unlock conditions for cycles\nat ",(0,t.jsx)(n.strong,{children:"build time"})," (during ",(0,t.jsx)(n.code,{children:"pnpm generate"}),") to prevent content packs that would\ncause runaway production loops or deadlocked progression at runtime.\nUnderstanding these validation rules helps authors design safe and functional\ntransform networks."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Important"}),": Cycle detection is a ",(0,t.jsx)(n.strong,{children:"build-time safety check"})," that runs\nduring content pack validation. Content packs containing cycles will be\nrejected before they can be loaded into the game engine, ensuring problematic\nconfigurations never reach runtime."]}),"\n",(0,t.jsx)(n.h3,{id:"what-constitutes-a-cycle",children:"What Constitutes a Cycle"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"transform cycle"})," exists when transforms form a closed loop through their\nresource dependencies:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Direct cycle (A \u2192 B \u2192 A)"}),": Transform A produces a resource that Transform B\nconsumes, and Transform B produces a resource that Transform A consumes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Indirect cycle (A \u2192 B \u2192 C \u2192 A)"}),": A chain of transforms that eventually\nfeeds back to the starting transform through intermediate resources."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multi-resource cycle"}),": Transforms with multiple inputs/outputs that create\ncircular dependencies (for example Transform A consumes X + Y and produces Z,\nwhile Transforms B and C consume Z to produce X and Y respectively)."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["An ",(0,t.jsx)(n.strong,{children:"unlock condition cycle"})," exists when entities have circular unlock\ndependencies:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Resource A unlocks when Resource B \u2265 threshold"}),"\n",(0,t.jsx)(n.li,{children:"Resource B unlocks when Resource A \u2265 threshold"}),"\n",(0,t.jsxs)(n.li,{children:["Similar patterns exist for generators, upgrades, achievements, and other\nentities with ",(0,t.jsx)(n.code,{children:"unlockCondition"})," fields"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Both types of cycles are ",(0,t.jsx)(n.strong,{children:"detected automatically"})," during validation and will\ncause ",(0,t.jsx)(n.code,{children:"pnpm generate"})," to fail with detailed error messages showing the cycle\npath."]}),"\n",(0,t.jsx)(n.h3,{id:"safe-transform-patterns",children:"Safe Transform Patterns"}),"\n",(0,t.jsx)(n.p,{children:"Design transforms using these patterns to avoid cycles:"}),"\n",(0,t.jsx)(n.h4,{id:"-linear-transformation-chains",children:"\u2705 Linear transformation chains"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "transforms": [\n    {\n      "id": "raw-to-refined",\n      "inputs": [{ "resourceId": "raw-ore", "amount": { "kind": "constant", "value": 1 } }],\n      "outputs": [{ "resourceId": "refined-metal", "amount": { "kind": "constant", "value": 1 } }]\n    },\n    {\n      "id": "refined-to-alloy",\n      "inputs": [{ "resourceId": "refined-metal", "amount": { "kind": "constant", "value": 2 } }],\n      "outputs": [{ "resourceId": "alloy", "amount": { "kind": "constant", "value": 1 } }]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This creates a one-way progression: raw-ore \u2192 refined-metal \u2192 alloy."}),"\n",(0,t.jsx)(n.h4,{id:"-resource-sinks-consumables",children:"\u2705 Resource sinks (consumables)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "transforms": [\n    {\n      "id": "craft-boost",\n      "inputs": [\n        { "resourceId": "mana", "amount": { "kind": "constant", "value": 100 } },\n        { "resourceId": "essence", "amount": { "kind": "constant", "value": 10 } }\n      ],\n      "outputs": [{ "resourceId": "boost-item", "amount": { "kind": "constant", "value": 1 } }]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Resources are consumed but not regenerated through transforms, creating a\none-way flow."}),"\n",(0,t.jsx)(n.h4,{id:"-convergent-production-trees",children:"\u2705 Convergent production trees"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "transforms": [\n    {\n      "id": "wood-to-planks",\n      "inputs": [{ "resourceId": "wood", "amount": { "kind": "constant", "value": 1 } }],\n      "outputs": [{ "resourceId": "planks", "amount": { "kind": "constant", "value": 4 } }]\n    },\n    {\n      "id": "stone-to-bricks",\n      "inputs": [{ "resourceId": "stone", "amount": { "kind": "constant", "value": 1 } }],\n      "outputs": [{ "resourceId": "bricks", "amount": { "kind": "constant", "value": 2 } }]\n    },\n    {\n      "id": "build-house",\n      "inputs": [\n        { "resourceId": "planks", "amount": { "kind": "constant", "value": 20 } },\n        { "resourceId": "bricks", "amount": { "kind": "constant", "value": 10 } }\n      ],\n      "outputs": [{ "resourceId": "house", "amount": { "kind": "constant", "value": 1 } }]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Multiple resource streams converge but never loop back to their sources."}),"\n",(0,t.jsx)(n.h4,{id:"-circular-transform-chains",children:"\u274c Circular transform chains"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "transforms": [\n    {\n      "id": "water-to-steam",\n      "inputs": [{ "resourceId": "water", "amount": { "kind": "constant", "value": 1 } }],\n      "outputs": [{ "resourceId": "steam", "amount": { "kind": "constant", "value": 1 } }]\n    },\n    {\n      "id": "steam-to-water",\n      "inputs": [{ "resourceId": "steam", "amount": { "kind": "constant", "value": 1 } }],\n      "outputs": [{ "resourceId": "water", "amount": { "kind": "constant", "value": 1 } }]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Validation error"}),": ",(0,t.jsx)(n.code,{children:"Transform cycle detected: water-to-steam \u2192 steam-to-water \u2192 water-to-steam"})]}),"\n",(0,t.jsx)(n.h3,{id:"safe-unlock-condition-patterns",children:"Safe Unlock Condition Patterns"}),"\n",(0,t.jsx)(n.p,{children:"Design unlock conditions that form directed acyclic graphs (DAGs):"}),"\n",(0,t.jsx)(n.h4,{id:"-self-threshold-unlock-after-first-production",children:"\u2705 Self-threshold (unlock after first production)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "resources": [\n    {\n      "id": "ore",\n      "visible": false,\n      "unlocked": false,\n      "unlockCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "ore",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 1 }\n      },\n      "visibilityCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "ore",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 1 }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This pattern is supported for resources and does not introduce an unlock-cycle edge. Ensure the resource can still be produced (for example by a generator or transform) while hidden/locked."}),"\n",(0,t.jsx)(n.h4,{id:"-progressive-unlocks",children:"\u2705 Progressive unlocks"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "resources": [\n    { "id": "tier-1-resource" },\n    {\n      "id": "tier-2-resource",\n      "unlockCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "tier-1-resource",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 100 }\n      }\n    },\n    {\n      "id": "tier-3-resource",\n      "unlockCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "tier-2-resource",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 50 }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Clear one-way progression through tiers."}),"\n",(0,t.jsx)(n.h4,{id:"-circular-unlock-dependencies",children:"\u274c Circular unlock dependencies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "resources": [\n    {\n      "id": "resource-a",\n      "unlockCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "resource-b",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 10 }\n      }\n    },\n    {\n      "id": "resource-b",\n      "unlockCondition": {\n        "kind": "resourceThreshold",\n        "resourceId": "resource-a",\n        "comparator": "gte",\n        "amount": { "kind": "constant", "value": 10 }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Validation error"}),": ",(0,t.jsx)(n.code,{children:"Unlock condition cycle detected: resource-a \u2192 resource-b \u2192 resource-a"})]}),"\n",(0,t.jsx)(n.h3,{id:"transform-cycle-detection-checklist",children:"Transform Cycle Detection Checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Map out resource flow graphs on paper before implementing complex\ntransform networks"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ",'Ensure all transform chains have clear "source" resources (from generators\nor initial grants) and "sink" resources (consumed but not regenerated)']}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Avoid bidirectional transforms between the same pair of resources unless\nmediated by additional resources or conditions"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Run ",(0,t.jsx)(n.code,{children:"pnpm generate"})," after adding transforms and address any cycle\ndetection errors immediately"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test unlock progressions manually to confirm resources become available in\nthe expected order"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"migrating-existing-content-with-cycles",children:"Migrating Existing Content with Cycles"}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"pnpm generate"})," fails with cycle detection errors after upgrading:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Identify the cycle"}),": Read the error message carefully. It shows the\ncomplete cycle path (e.g., ",(0,t.jsx)(n.code,{children:"transform-a \u2192 transform-b \u2192 transform-a"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Understand the dependencies"}),": Map out which resources each transform\nconsumes and produces. Draw a diagram if helpful."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Break the cycle"})," using one of these strategies:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add source resources"}),": Introduce generators or initial grants to provide\nresources from outside the cycle"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Convert to linear chain"}),": Redesign bidirectional transforms as one-way\nprogression (A \u2192 B \u2192 C instead of A \u21c4 B)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add intermediate resources"}),": Insert new resources in the chain to create\na clear flow direction"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Remove problematic transforms"}),": If a transform creates an unwanted loop,\nconsider removing it or replacing it with a different game mechanic"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"For unlock condition cycles"}),": Similar approach applies. If Resource A\nrequires Resource B to unlock, and Resource B requires Resource A, redesign\nthe unlock progression to be hierarchical (introduce a Resource C that both\ndepend on, or remove one unlock condition)."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Re-run validation"}),": After making changes, run ",(0,t.jsx)(n.code,{children:"pnpm generate"})," again to\nverify all cycles are resolved."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Implementation details"}),": Cycle detection is implemented in\n",(0,t.jsx)(n.code,{children:"packages/content-schema/src/pack.ts"})," via ",(0,t.jsx)(n.code,{children:"validateTransformCycles()"})," and\n",(0,t.jsx)(n.code,{children:"validateUnlockConditionCycles()"})," functions, using depth-first search with path\ntracking to provide detailed error messages."]}),"\n",(0,t.jsx)(n.h3,{id:"safety-guardrails",children:"Safety Guardrails"}),"\n",(0,t.jsx)(n.p,{children:"In addition to cycle detection, transforms include runtime safety limits defined\nin the transform schema:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"maxRunsPerTick"}),": Caps executions per simulation step (default and max values\nenforced)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"maxOutstandingBatches"}),": Limits queued batch transforms (prevents unbounded\nqueue growth)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["These guards complement cycle detection by preventing runaway transforms even in\nedge cases. See ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/modules/transforms.ts"})," for\nenforcement details."]}),"\n",(0,t.jsx)(n.h2,{id:"reference-examples--tooling",children:"Reference Examples & Tooling"}),"\n",(0,t.jsx)(n.p,{children:"Use the sample pack as a living reference:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-sample/content/pack.json"})," illustrates metadata layout,\ndependency declarations, and module IDs."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-sample/src/generated/@idle-engine/sample-pack.generated.ts"})," shows the\ncompiler outputs that should accompany every content change."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-sample/src/index.ts"})," demonstrates import-time guards that\nthrow when compiler warnings slip through."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The CLI in ",(0,t.jsx)(n.code,{children:"tools/content-schema-cli/src/generate.js"})," orchestrates validation,\nmanifest regeneration, and compilation. It emits structured\n",(0,t.jsx)(n.code,{children:"content_pack.*"})," log lines\u2014treat any new warning or error as a release blocker."]}),"\n",(0,t.jsx)(n.h2,{id:"balance-validation-defaults--commands",children:"Balance validation defaults & commands"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pnpm generate"})," (or ",(0,t.jsx)(n.code,{children:"pnpm generate --check"}),") runs schema + balance validation\nand logs ",(0,t.jsx)(n.code,{children:"content_pack.balance_warning"})," / ",(0,t.jsx)(n.code,{children:"content_pack.balance_failed"})," when\ninvariants break; balance errors fail the run."]}),"\n",(0,t.jsxs)(n.li,{children:["Defaults for ",(0,t.jsx)(n.code,{children:"ContentSchemaOptions.balance"}),": enabled, ",(0,t.jsx)(n.code,{children:"sampleSize"})," = 100\npurchase indices (levels 0\u2013100), ",(0,t.jsx)(n.code,{children:"maxGrowth"})," = 20\xd7 between adjacent\npurchases, ",(0,t.jsx)(n.code,{children:"warnOnly"})," = false. Use ",(0,t.jsx)(n.code,{children:"warnOnly"})," only for local exploration;\ntreat any warning as a regression before shipping."]}),"\n",(0,t.jsx)(n.li,{children:"Checks cover non-negative rates, non-decreasing costs for generators/upgrades\n(including repeatables) and prestige rewards, growth-cap enforcement, and\nunlock ordering so consumed resources unlock no later than their dependents."}),"\n",(0,t.jsxs)(n.li,{children:["Validation is deterministic; property suites that guard balance and formulas\nare seeded (e.g., fast-check seeds in the 422000 range) to keep\n",(0,t.jsx)(n.code,{children:"vitest-llm-reporter"})," output stable. Keep seeds unchanged unless debugging."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"verification-runbook",children:"Verification Runbook"}),"\n",(0,t.jsx)(n.p,{children:"Run these commands before requesting review:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm generate\npnpm exec markdownlint docs/content-dsl-usage-guidelines.md\npnpm lint --filter @idle-engine/content-schema\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you modify shell UI flows or runtime contracts in parallel, extend the\nchecklist with the relevant test suites (for example ",(0,t.jsx)(n.code,{children:"pnpm test --filter core"}),")."]}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-usage-guidelines-design.md"})," \u2014 rationale, scope, and\nacceptance criteria for this guide."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," \u2014 field-level reference for the DSL."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/content-compiler-design.md"})," \u2014 details on generated artifacts and\nsummary modules."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/content-sample/README.md"})," \u2014 regeneration workflow and runtime\nmanifest integration."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"formula-invariants--cost-semantics",children:"Formula Invariants & Cost Semantics"}),"\n",(0,t.jsxs)(n.p,{children:["Content formulas must evaluate to finite, non-negative numbers across deterministic contexts. The schema and CLI suites enforce this via property-based tests (see ",(0,t.jsx)(n.code,{children:"packages/content-schema/src/base/formulas.property.test.ts"})," and ",(0,t.jsx)(n.code,{children:"tools/content-schema-cli/src/__tests__/validation.property.test.ts"}),"). Authors should follow these rules when declaring rates and costs:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Generator rates and consumption values: use ",(0,t.jsx)(n.code,{children:"NumericFormula"})," that remain \u2265 0. Prefer clamping via ",(0,t.jsx)(n.code,{children:"max(0, \u2026)"})," or the ",(0,t.jsx)(n.code,{children:"abs"}),"/",(0,t.jsx)(n.code,{children:"sqrt"})," helpers when composing expressions."]}),"\n",(0,t.jsxs)(n.li,{children:["Purchase cost calculation: cost = ",(0,t.jsx)(n.code,{children:"baseCost \xd7 evaluate(costCurve, level)"})," where ",(0,t.jsx)(n.code,{children:"level"})," is the current purchase index (owned count). For upgrades, if ",(0,t.jsx)(n.code,{children:"repeatable.costCurve"})," is present, multiply that in as well. See ",(0,t.jsx)(n.code,{children:"docs/progression-coordinator-design.md"})," \xa76.2.7."]}),"\n",(0,t.jsxs)(n.li,{children:["Avoid NaN/Infinity: inputs are validated (",(0,t.jsx)(n.code,{children:"finiteNumberSchema"}),"), and formulas with impossible evaluations are rejected."]}),"\n",(0,t.jsxs)(n.li,{children:["Piecewise: ensure strictly increasing ",(0,t.jsx)(n.code,{children:"untilLevel"})," thresholds and a final catch-all segment."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"exponential-cost-curve-formula",children:"Exponential Cost Curve Formula"}),"\n",(0,t.jsxs)(n.p,{children:["The exponential formula evaluates as: ",(0,t.jsx)(n.code,{children:"base \xd7 growth^level + offset"})]}),"\n",(0,t.jsxs)(n.p,{children:["When used as a ",(0,t.jsx)(n.code,{children:"costCurve"}),", this combines with ",(0,t.jsx)(n.code,{children:"baseCost"})," to produce:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"totalCost = baseCost \xd7 (base \xd7 growth^level + offset)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Important"}),": The ",(0,t.jsx)(n.code,{children:"base"})," parameter defaults to ",(0,t.jsx)(n.code,{children:"1"}),". For the standard idle game cost curve where ",(0,t.jsx)(n.code,{children:"baseCost"})," alone represents the level-0 cost, simply omit ",(0,t.jsx)(n.code,{children:"base"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "baseCost": 120,\n  "costCurve": { "kind": "exponential", "growth": 1.15 }\n}\n// At level 0: 120 \xd7 1 \xd7 1.15^0 = 120\n// At level 1: 120 \xd7 1 \xd7 1.15^1 = 138\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Common mistake"}),": Setting ",(0,t.jsx)(n.code,{children:"base"})," equal to ",(0,t.jsx)(n.code,{children:"baseCost"})," doubles the multiplier:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "baseCost": 50,\n  "costCurve": { "kind": "exponential", "base": 50, "growth": 1.15 }\n}\n// At level 0: 50 \xd7 50 \xd7 1.15^0 = 2500 (not 50!)\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Use a non-default ",(0,t.jsx)(n.code,{children:"base"})," only when you need an additional scaling factor independent of ",(0,t.jsx)(n.code,{children:"baseCost"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Automation authoring guidance:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resourceCost.rate"})," represents units per second; keep bounds realistic for your economy to avoid runaway drains."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cooldown"})," must be finite (milliseconds). Prefer \u2265 0. Extremely small values can lead to noisy behavior during testing."]}),"\n",(0,t.jsxs)(n.li,{children:["Keep ",(0,t.jsx)(n.code,{children:"generate --check"})," warning-free for shipping packs. The sample pack is treated as the reference baseline."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"snapshot-determinism-progression-views",children:"Snapshot Determinism (Progression Views)"}),"\n",(0,t.jsxs)(n.p,{children:["The progression view (",(0,t.jsx)(n.code,{children:"buildProgressionSnapshot"}),") must be deterministic so that UI/state diffs remain stable when content changes. Tests in ",(0,t.jsx)(n.code,{children:"@idle-engine/content-sample"})," generate a golden snapshot for the sample pack\u2019s generators and upgrades and compare it during CI."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Fields covered: generator ",(0,t.jsx)(n.code,{children:"costs"}),", ",(0,t.jsx)(n.code,{children:"produces"}),"/",(0,t.jsx)(n.code,{children:"consumes"})," rates, visibility/unlock flags, and upgrade ",(0,t.jsx)(n.code,{children:"status"})," + ",(0,t.jsx)(n.code,{children:"costs"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Authors changing content should expect golden updates when business logic changes intentionally; otherwise treat diffs as regressions."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"References:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/build-resource-generator-upgrade-ui-components-design.md"})," (cost examples)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/content-dsl-schema-design.md"})," (schema contracts)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"packages/core/src/progression.ts"})," (snapshot construction)"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var i=s(9430);const t={},r=i.createContext(t);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);