"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[4477],{4074:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>a,frontMatter:()=>t,metadata:()=>d,toc:()=>o});const d=JSON.parse('{"id":"issue-850-design","title":"Design: First-Class Input Events for Desktop Shell Controls","description":"Issue: #850","source":"@site/../../docs/issue-850-design.md","sourceDirName":".","slug":"/issue-850-design","permalink":"/Idle-Game-Engine/issue-850-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-850-design.md","tags":[],"version":"current","frontMatter":{}}');var i=s(5270),r=s(7678);const t={},c="Design: First-Class Input Events for Desktop Shell Controls",l={},o=[{value:"1. Scope",id:"1-scope",level:2},{value:"Problem",id:"problem",level:3},{value:"Goals",id:"goals",level:3},{value:"Pointer/UI Preservation (Concrete Rules)",id:"pointerui-preservation-concrete-rules",level:3},{value:"Non-Goals",id:"non-goals",level:3},{value:"Boundaries",id:"boundaries",level:3},{value:"2. Workflow",id:"2-workflow",level:2},{value:"States",id:"states",level:3},{value:"Transitions",id:"transitions",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Crash Recovery",id:"crash-recovery",level:3},{value:"Subprocesses (if applicable)",id:"subprocesses-if-applicable",level:3},{value:"3. Interfaces",id:"3-interfaces",level:2},{value:"Endpoints",id:"endpoints",level:3},{value:"CLI Commands (if applicable)",id:"cli-commands-if-applicable",level:3},{value:"Events (if applicable)",id:"events-if-applicable",level:3},{value:"Runtime Commands",id:"runtime-commands",level:3},{value:"Validation Rules",id:"validation-rules",level:3},{value:"UI Interactions (if applicable)",id:"ui-interactions-if-applicable",level:3},{value:"Contract gates",id:"contract-gates",level:4},{value:"Main-produced <code>INPUT_EVENT</code> command fields",id:"main-produced-input_event-command-fields",level:4},{value:"Type contracts (wire-level)",id:"type-contracts-wire-level",level:4},{value:"4. Data",id:"4-data",level:2},{value:"Schema Changes",id:"schema-changes",level:3},{value:"Command Authorization (<code>COMMAND_AUTHORIZATIONS</code>)",id:"command-authorization-command_authorizations",level:3},{value:"Version Validation (<code>schemaVersion</code>)",id:"version-validation-schemaversion",level:3},{value:"Field Definitions",id:"field-definitions",level:3},{value:"Migrations",id:"migrations",level:3},{value:"Artifacts",id:"artifacts",level:3},{value:"Artifact Lifecycle",id:"artifact-lifecycle",level:3},{value:"5. Tasks",id:"5-tasks",level:2},{value:"Decomposition Gates",id:"decomposition-gates",level:3},{value:"Ordering Gates",id:"ordering-gates",level:3},{value:"Infrastructure Gates",id:"infrastructure-gates",level:3},{value:"Task Dependency Graph",id:"task-dependency-graph",level:3},{value:"Task Breakdown",id:"task-breakdown",level:3},{value:"Task Details",id:"task-details",level:3},{value:"6. Validation",id:"6-validation",level:2},{value:"Pre-Implementation Checks",id:"pre-implementation-checks",level:3},{value:"Post-Implementation Checks",id:"post-implementation-checks",level:3},{value:"Manual Verification (desktop shell)",id:"manual-verification-desktop-shell",level:3}];function h(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"design-first-class-input-events-for-desktop-shell-controls",children:"Design: First-Class Input Events for Desktop Shell Controls"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": #850\n",(0,i.jsx)(n.strong,{children:"Status"}),": Draft - Classification Complete\n",(0,i.jsx)(n.strong,{children:"Feature Types"}),": Primary: API, Secondary: Workflow, Data Model"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-scope",children:"1. Scope"}),"\n",(0,i.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,i.jsxs)(n.p,{children:["The desktop shell currently forwards unmatched control/pointer events as an ad-hoc ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," runtime command with untyped metadata. This makes input handling harder to reason about, serialize, and replay deterministically."]}),"\n",(0,i.jsx)(n.h3,{id:"goals",children:"Goals"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Remove the implicit passthrough behavior and ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," usage from the desktop shell input pipeline."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Keep pointer-driven UI interactions working in the test-game desktop shell."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Define a well-typed, serializable payload shape for forwarded input events (including pointer events)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pointerui-preservation-concrete-rules",children:"Pointer/UI Preservation (Concrete Rules)"}),"\n",(0,i.jsx)(n.p,{children:"To preserve existing pointer-driven UI behavior while removing implicit passthrough:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The renderer sends typed input events for canvas pointer + wheel interactions on ",(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The main process validates and ",(0,i.jsx)(n.strong,{children:"always"})," enqueues exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime command per valid pointer/wheel input event (no control-scheme binding required)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"idle-engine:control-event"})," remains for non-pointer controls (e.g., Space \u2192 ",(0,i.jsx)(n.code,{children:"collect"}),") and is mapped via ",(0,i.jsx)(n.code,{children:"@idle-engine/controls"})," bindings; there is no passthrough fallback."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Intent mapping (kept stable):"})," existing ",(0,i.jsx)(n.code,{children:"mouse-*"})," intent strings are preserved as-is in the new typed schema:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mouse-down"})," \u2192 ",(0,i.jsx)(n.code,{children:"InputEvent.kind:'pointer'"}),", ",(0,i.jsx)(n.code,{children:"intent:'mouse-down'"}),", ",(0,i.jsx)(n.code,{children:"phase:'start'"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mouse-move"})," \u2192 ",(0,i.jsx)(n.code,{children:"InputEvent.kind:'pointer'"}),", ",(0,i.jsx)(n.code,{children:"intent:'mouse-move'"}),", ",(0,i.jsx)(n.code,{children:"phase:'repeat'"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mouse-up"})," \u2192 ",(0,i.jsx)(n.code,{children:"InputEvent.kind:'pointer'"}),", ",(0,i.jsx)(n.code,{children:"intent:'mouse-up'"}),", ",(0,i.jsx)(n.code,{children:"phase:'end'"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mouse-wheel"})," \u2192 ",(0,i.jsx)(n.code,{children:"InputEvent.kind:'wheel'"}),", ",(0,i.jsx)(n.code,{children:"intent:'mouse-wheel'"}),", ",(0,i.jsx)(n.code,{children:"phase:'repeat'"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Implementation touchpoints (exact files):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"}),", ",(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"}),", ",(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/preload.cts"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"}),", ",(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"non-goals",children:"Non-Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add support for every possible input device/event type (gamepad, multi-touch gestures, etc.) beyond what is needed to preserve existing pointer UI behavior."}),"\n",(0,i.jsx)(n.li,{children:"Redesign the renderer/UI system or change unrelated runtime command queue semantics."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"boundaries",children:"Boundaries"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In scope"}),": ",(0,i.jsx)(n.code,{children:"packages/shell-desktop"})," input capture and IPC flow, ",(0,i.jsx)(n.code,{children:"@idle-engine/controls"})," event\u2192command mapping behavior as needed, and any core/controls contracts required to represent input events deterministically."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Out of scope"}),": Replay file/container format changes, renderer contract changes, or new UI widgets/interaction patterns beyond maintaining current behavior."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-workflow",children:"2. Workflow"}),"\n",(0,i.jsxs)(n.p,{children:["This feature changes the ",(0,i.jsx)(n.strong,{children:"input event workflow"})," so that pointer/UI interactions are preserved via ",(0,i.jsx)(n.strong,{children:"explicit, typed input-event commands"})," (not implicit ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," forwarding and not ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"State gates (explicit)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Initial state"}),": ",(0,i.jsx)(n.code,{children:"shell.booting"})," (entered when ",(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.ts"})," is evaluated)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Terminal states"}),": ",(0,i.jsx)(n.code,{children:"shell.startup_failed"})," (process exits) and ",(0,i.jsx)(n.code,{children:"sim.terminated"})," (controller is disposed and owns no worker)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Halted states"}),": ",(0,i.jsx)(n.code,{children:"sim.stopped"})," and ",(0,i.jsx)(n.code,{children:"sim.crashed"})," accept no input and require an explicit restart transition to re-enter ",(0,i.jsx)(n.code,{children:"sim.initializing"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reversibility"}),": No transition is reversible in-place; recovery is via ",(0,i.jsx)(n.strong,{children:"explicit restart"})," (",(0,i.jsx)(n.code,{children:"sim.* -> sim.initializing"}),") which creates a new sim worker controller and resets nested input state to ",(0,i.jsx)(n.code,{children:"sim.running.input.idle"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"states",children:"States"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Entry Condition"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.booting"}),(0,i.jsx)(n.td,{children:"Electron main process module is loading; window/IPC may not exist yet."}),(0,i.jsxs)(n.td,{children:["Node/Electron loads ",(0,i.jsx)(n.code,{children:"main.ts"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.startup_failed"}),(0,i.jsx)(n.td,{children:"App failed during startup and exits with a non-zero code; no further transitions."}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"app.whenReady()"})," rejects (startup exception)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Sim worker is spawned; init message sent; waiting for ",(0,i.jsx)(n.code,{children:"ready"}),". Input events are ignored."]}),(0,i.jsx)(n.td,{children:"App is ready and sim worker controller is created (or restarted)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Sim tick loop is active; no pending input work."}),(0,i.jsxs)(n.td,{children:["Worker sends ",(0,i.jsx)(n.code,{children:"ready"}),"; tick loop starts; nested input state initialized."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.pointer_move_coalescing"}),(0,i.jsx)(n.td,{children:"Renderer is coalescing pointer-move events to one per animation frame."}),(0,i.jsx)(n.td,{children:"Renderer receives pointer-move and schedules a RAF flush."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Main process is validating an input message and preparing runtime command(s)."}),(0,i.jsx)(n.td,{children:"Main receives a candidate input message from renderer IPC."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.enqueued"}),(0,i.jsx)(n.td,{children:"Command(s) were accepted for delivery to the sim worker."}),(0,i.jsxs)(n.td,{children:["For ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"}),": a valid pointer/wheel envelope produced exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," and ",(0,i.jsx)(n.code,{children:"worker.postMessage({ kind: 'enqueueCommands' ... })"})," succeeds. For ",(0,i.jsx)(n.code,{children:"idle-engine:control-event"}),": mapping produced \u22651 command and ",(0,i.jsx)(n.code,{children:"postMessage"})," succeeds."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.dropped"}),(0,i.jsx)(n.td,{children:"Control event was valid but produced no commands (unbound)."}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"idle-engine:control-event"})," mapping produced 0 commands for the event."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.rejected"}),(0,i.jsx)(n.td,{children:"Input event was invalid and is not processed."}),(0,i.jsx)(n.td,{children:"Input event fails schema/shape validation at IPC boundary."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.disposing"}),(0,i.jsx)(n.td,{children:"Sim worker controller is shutting down; tick loop stopped; no further input accepted."}),(0,i.jsx)(n.td,{children:"Window reload/close, or app shutdown triggers controller dispose."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.terminated"}),(0,i.jsx)(n.td,{children:"Sim worker controller is fully disposed; no worker thread is owned."}),(0,i.jsx)(n.td,{children:"Worker is terminated/closed and controller resources are released."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsx)(n.td,{children:"Sim worker exited cleanly (code 0); no further input accepted until restart."}),(0,i.jsxs)(n.td,{children:["Worker emits ",(0,i.jsx)(n.code,{children:"exit"})," with code ",(0,i.jsx)(n.code,{children:"0"})," while not disposing."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsx)(n.td,{children:"Sim worker or IPC bridge failed; no further input accepted until restart."}),(0,i.jsxs)(n.td,{children:["Worker emits ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"}),", sends ",(0,i.jsx)(n.code,{children:"kind:'error'"}),", or exits non-zero while not disposing."]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"transitions",children:"Transitions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"From"}),(0,i.jsx)(n.th,{children:"Event/Condition"}),(0,i.jsx)(n.th,{children:"To"}),(0,i.jsx)(n.th,{children:"Side Effects"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.booting"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"app.whenReady()"})," resolves."]}),(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Register IPC handlers; create window; spawn sim worker; send worker ",(0,i.jsx)(n.code,{children:"init"}),"; (renderer may begin loading independently)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.booting"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"app.whenReady()"})," rejects."]}),(0,i.jsx)(n.td,{children:"shell.startup_failed"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"console.error(error)"}),"; ",(0,i.jsx)(n.code,{children:"app.exit(1)"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Worker sends ",(0,i.jsx)(n.code,{children:"kind:'ready'"}),"."]}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsxs)(n.td,{children:["Persist ",(0,i.jsx)(n.code,{children:"stepSizeMs"})," + ",(0,i.jsx)(n.code,{children:"nextStep"}),"; start tick interval; begin accepting input events."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Worker sends ",(0,i.jsx)(n.code,{children:"kind:'error'"})," OR emits ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"})," OR exits non-zero."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Stop tick interval; log failure; notify renderer via ",(0,i.jsx)(n.code,{children:"simStatus"})," IPC; terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Renderer sends a non-coalesced input message (pointer-down/up, wheel, key)."}),(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsxs)(n.td,{children:["Snapshot current ",(0,i.jsx)(n.code,{children:"nextStep"}),"/",(0,i.jsx)(n.code,{children:"stepSizeMs"}),"; begin validation and command preparation."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Renderer sends pointer-move; renderer schedules RAF coalescing."}),(0,i.jsx)(n.td,{children:"sim.running.input.pointer_move_coalescing"}),(0,i.jsx)(n.td,{children:"Store latest pointer-move; overwrite older move; ensure exactly one RAF is scheduled."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.pointer_move_coalescing"}),(0,i.jsx)(n.td,{children:"RAF flush runs with a pending pointer-move."}),(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Emit exactly one pointer-move input event for the latest pending move; begin validation and command preparation."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.pointer_move_coalescing"}),(0,i.jsx)(n.td,{children:"RAF flush runs with no pending pointer-move."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"No-op (state returns to idle)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Input event fails IPC validation / schema checks."}),(0,i.jsx)(n.td,{children:"sim.running.input.rejected"}),(0,i.jsx)(n.td,{children:"Drop event; optionally log (dev-only); do not enqueue commands."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Control event is valid; mapping produces 0 commands (unbound)."}),(0,i.jsx)(n.td,{children:"sim.running.input.dropped"}),(0,i.jsx)(n.td,{children:"Drop event; do not enqueue commands."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsxs)(n.td,{children:["Input-event envelope is valid (pointer/wheel) and ",(0,i.jsx)(n.code,{children:"postMessage"})," succeeds."]}),(0,i.jsx)(n.td,{children:"sim.running.input.enqueued"}),(0,i.jsxs)(n.td,{children:["Enqueue exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command for the validated event; no acknowledgment is required."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsxs)(n.td,{children:["Control event is valid; mapping produces \u22651 command and ",(0,i.jsx)(n.code,{children:"postMessage"})," succeeds."]}),(0,i.jsx)(n.td,{children:"sim.running.input.enqueued"}),(0,i.jsxs)(n.td,{children:["Send ",(0,i.jsx)(n.code,{children:"enqueueCommands"})," to worker; no acknowledgment is required."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsxs)(n.td,{children:["Handler/mapping throws OR ",(0,i.jsx)(n.code,{children:"postMessage"})," throws."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Treat as fatal bridge failure: stop tick interval; log error; notify renderer via ",(0,i.jsx)(n.code,{children:"simStatus"}),"; terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.enqueued"}),(0,i.jsxs)(n.td,{children:["After ",(0,i.jsx)(n.code,{children:"postMessage"})," returns."]}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Clear per-event temporary state; await next input."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.dropped"}),(0,i.jsx)(n.td,{children:"Immediately after dropping."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Clear per-event temporary state; await next input."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.rejected"}),(0,i.jsx)(n.td,{children:"Immediately after rejecting."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Clear per-event temporary state; await next input."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsx)(n.td,{children:"Tick interval fires."}),(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"postMessage({ kind:'tick', deltaMs })"}),"; no state change for input pipeline."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker sends ",(0,i.jsx)(n.code,{children:"kind:'frame'"}),"."]}),(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Update ",(0,i.jsx)(n.code,{children:"nextStep"}),"; forward latest frame to renderer via ",(0,i.jsx)(n.code,{children:"frame"})," IPC; ignore if ",(0,i.jsx)(n.code,{children:"frame"})," is absent."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker exits with code ",(0,i.jsx)(n.code,{children:"0"})," while not disposing."]}),(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsxs)(n.td,{children:["Stop tick interval; log stop; notify renderer via ",(0,i.jsx)(n.code,{children:"simStatus"}),"; terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker emits ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"})," OR sends ",(0,i.jsx)(n.code,{children:"kind:'error'"})," OR exits non-zero while not disposing."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Stop tick interval; log crash; notify renderer via ",(0,i.jsx)(n.code,{children:"simStatus"}),"; terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Dispose requested (window reload/close) before ",(0,i.jsx)(n.code,{children:"ready"}),"."]}),(0,i.jsx)(n.td,{children:"sim.disposing"}),(0,i.jsx)(n.td,{children:"Stop tick interval (if started); mark controller disposing; terminate worker."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsx)(n.td,{children:"Dispose requested (window reload/close)."}),(0,i.jsx)(n.td,{children:"sim.disposing"}),(0,i.jsx)(n.td,{children:"Stop tick interval; terminate worker; ignore subsequent input/worker messages."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.disposing"}),(0,i.jsx)(n.td,{children:"Worker terminates/closes."}),(0,i.jsx)(n.td,{children:"sim.terminated"}),(0,i.jsx)(n.td,{children:"Release controller references; future input is ignored until a new controller is created."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsx)(n.td,{children:"Explicit restart requested (window reload / recreate controller)."}),(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Create a new sim worker controller; nested input state resets to ",(0,i.jsx)(n.code,{children:"sim.running.input.idle"})," after ",(0,i.jsx)(n.code,{children:"ready"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsx)(n.td,{children:"Explicit restart requested (window reload / recreate controller)."}),(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Create a new sim worker controller; nested input state resets to ",(0,i.jsx)(n.code,{children:"sim.running.input.idle"})," after ",(0,i.jsx)(n.code,{children:"ready"}),"."]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Handlers"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Global worker/bridge failure handler"}),": any worker error condition funnels into a single \u201cfail closed\u201d action (stop tick loop, log, send ",(0,i.jsx)(n.code,{children:"simStatus"}),", terminate worker, ignore future input) and transitions to ",(0,i.jsx)(n.code,{children:"sim.crashed"}),"/",(0,i.jsx)(n.code,{children:"sim.stopped"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per-input-event handling"}),": IPC payload validation and enqueue/mapping outcomes transition only within ",(0,i.jsx)(n.code,{children:"sim.running.input.*"})," (reject/drop/enqueue), unless a fatal bridge error occurs."]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"Error"}),(0,i.jsx)(n.th,{children:"Recovery State"}),(0,i.jsx)(n.th,{children:"Actions"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.booting"}),(0,i.jsx)(n.td,{children:"Startup promise rejects."}),(0,i.jsx)(n.td,{children:"shell.startup_failed"}),(0,i.jsxs)(n.td,{children:["Log error; exit process with code ",(0,i.jsx)(n.code,{children:"1"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"shell.startup_failed"}),(0,i.jsx)(n.td,{children:"None (process is exiting)."}),(0,i.jsx)(n.td,{children:"shell.startup_failed"}),(0,i.jsx)(n.td,{children:"No-op."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsx)(n.td,{children:"Worker thread fails to spawn or init message cannot be sent."}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Log error; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (crashed); terminate/abandon worker handle if present."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsx)(n.td,{children:"Invalid/unsupported worker protocol message."}),(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Ignore message; keep waiting for ",(0,i.jsx)(n.code,{children:"ready"})," (no retries are performed)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.initializing"}),(0,i.jsxs)(n.td,{children:["Worker reports ",(0,i.jsx)(n.code,{children:"kind:'error'"})," during init."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Log error; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (crashed); terminate worker; stop accepting inputs."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Renderer sends malformed input payload."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Drop event at IPC boundary (no state change); do not enqueue commands."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.pointer_move_coalescing"}),(0,i.jsx)(n.td,{children:"RAF is cancelled (e.g., renderer navigation) before flush."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"Drop pending pointer-move; do not enqueue commands."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"IPC payload is not a valid input event shape."}),(0,i.jsx)(n.td,{children:"sim.running.input.rejected"}),(0,i.jsx)(n.td,{children:"Drop event; optionally log in dev to aid diagnosis."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Control-event mapping produces 0 commands (unbound)."}),(0,i.jsx)(n.td,{children:"sim.running.input.dropped"}),(0,i.jsx)(n.td,{children:"Drop event silently (no implicit forwarding)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsx)(n.td,{children:"Handler/mapping throws (e.g., payload resolver throws)."}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Treat as fatal bridge failure; log error; stop tick; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (crashed); terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.processing"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"worker.postMessage"})," throws."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Treat as fatal bridge failure; log error; stop tick; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (crashed); terminate worker."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.enqueued"}),(0,i.jsx)(n.td,{children:"None (postMessage has no acknowledgment)."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"No-op."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.dropped"}),(0,i.jsx)(n.td,{children:"None (event already dropped)."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"No-op."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.rejected"}),(0,i.jsx)(n.td,{children:"None (event already rejected)."}),(0,i.jsx)(n.td,{children:"sim.running.input.idle"}),(0,i.jsx)(n.td,{children:"No-op."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsx)(n.td,{children:"`webContents.send(frame"}),(0,i.jsx)(n.td,{children:"simStatus)` throws (renderer not ready/crashed)."}),(0,i.jsx)(n.td,{children:"sim.running.input.*"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker becomes unresponsive (no ",(0,i.jsx)(n.code,{children:"frame"}),"/",(0,i.jsx)(n.code,{children:"ready"}),"/",(0,i.jsx)(n.code,{children:"error"})," messages arrive)."]}),(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsx)(n.td,{children:"No automatic transition; renderer appears stalled; operator recovery is explicit restart (reload)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker exits with code ",(0,i.jsx)(n.code,{children:"0"}),"."]}),(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsxs)(n.td,{children:["Log stop; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (stopped); terminate worker; ignore further input until restart."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.running.input.*"}),(0,i.jsxs)(n.td,{children:["Worker exits non-zero OR emits ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"})," OR sends ",(0,i.jsx)(n.code,{children:"kind:'error'"}),"."]}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsxs)(n.td,{children:["Log crash; send ",(0,i.jsx)(n.code,{children:"simStatus"})," (crashed); terminate worker; ignore further input until restart."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.disposing"}),(0,i.jsx)(n.td,{children:"Worker termination throws/rejects."}),(0,i.jsx)(n.td,{children:"sim.terminated"}),(0,i.jsx)(n.td,{children:"Log error; proceed as terminated (controller must be dead from caller perspective)."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.terminated"}),(0,i.jsx)(n.td,{children:"Any input/worker message arrives after dispose."}),(0,i.jsx)(n.td,{children:"sim.terminated"}),(0,i.jsx)(n.td,{children:"Ignore."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsx)(n.td,{children:"Any input event arrives before restart."}),(0,i.jsx)(n.td,{children:"sim.stopped"}),(0,i.jsx)(n.td,{children:"Ignore."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsx)(n.td,{children:"Any input event arrives before restart."}),(0,i.jsx)(n.td,{children:"sim.crashed"}),(0,i.jsx)(n.td,{children:"Ignore."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"crash-recovery",children:"Crash Recovery"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Detection"}),": Recovery is needed if the current controller is in ",(0,i.jsx)(n.code,{children:"sim.stopped"})," or ",(0,i.jsx)(n.code,{children:"sim.crashed"}),", if the renderer is reloaded (which disposes and recreates the controller), or if the sim appears stalled (no frames are observed and no crash/stop signal is received)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Recovery state"}),": ",(0,i.jsx)(n.code,{children:"sim.initializing"})," (a brand-new sim worker controller; nested input state resets)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleanup"}),": Stop tick interval; clear any pending pointer-move coalescing; terminate/close the previous worker; drop any in-flight input event (no buffering across restarts)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"subprocesses-if-applicable",children:"Subprocesses (if applicable)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Subprocess"}),(0,i.jsx)(n.th,{children:"Receives"}),(0,i.jsx)(n.th,{children:"Can Write"}),(0,i.jsx)(n.th,{children:"Failure Handling"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Electron renderer process"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"IdleEngineApi"})," bridge (send input events; receive frames and sim status)."]}),(0,i.jsx)(n.td,{children:"IPC messages: input events \u2192 main; UI output to DOM/canvas."}),(0,i.jsxs)(n.td,{children:["If renderer reloads/crashes: main may fail ",(0,i.jsx)(n.code,{children:"webContents.send"})," (logged); user reload restarts controller; no queued inputs are replayed."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Sim worker thread (Node ",(0,i.jsx)(n.code,{children:"Worker"}),")"]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"init"}),", ",(0,i.jsx)(n.code,{children:"tick"}),", ",(0,i.jsx)(n.code,{children:"enqueueCommands"}),", ",(0,i.jsx)(n.code,{children:"shutdown"})," messages; runtime config (",(0,i.jsx)(n.code,{children:"stepSizeMs"}),", ",(0,i.jsx)(n.code,{children:"maxStepsPerFrame"}),")."]}),(0,i.jsxs)(n.td,{children:["Outbound messages: ",(0,i.jsx)(n.code,{children:"ready"}),", ",(0,i.jsx)(n.code,{children:"frame"}),", ",(0,i.jsx)(n.code,{children:"error"})," back to main; no filesystem writes."]}),(0,i.jsxs)(n.td,{children:["On ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"}),"/non-zero exit: transition to ",(0,i.jsx)(n.code,{children:"sim.crashed"})," and terminate worker; on hang/unresponsiveness: no automatic transition, operator restarts via reload."]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"3-interfaces",children:"3. Interfaces"}),"\n",(0,i.jsxs)(n.p,{children:["This section defines the ",(0,i.jsx)(n.strong,{children:"contract surface"})," for input events across:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Electron renderer \u2194 Electron main (IPC)"}),"\n",(0,i.jsx)(n.li,{children:"Main \u2194 sim worker (postMessage)"}),"\n",(0,i.jsx)(n.li,{children:"Main input mapping \u2192 runtime command queue"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"endpoints",children:"Endpoints"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Path"}),(0,i.jsx)(n.th,{children:"Input"}),(0,i.jsx)(n.th,{children:"Success"}),(0,i.jsx)(n.th,{children:"Errors"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC invoke"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:ping"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ message: string }"})}),(0,i.jsxs)(n.td,{children:["resolves ",(0,i.jsx)(n.code,{children:"{ message: string }"})]}),(0,i.jsxs)(n.td,{children:["rejects if ",(0,i.jsx)(n.code,{children:"message"})," is not a string"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC invoke"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:read-asset"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ url: string }"})}),(0,i.jsxs)(n.td,{children:["resolves ",(0,i.jsx)(n.code,{children:"ArrayBuffer"})]}),(0,i.jsxs)(n.td,{children:["rejects if url is invalid, non-",(0,i.jsx)(n.code,{children:"file:"}),", or escapes compiled asset root"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC send"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:input-event"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})}),(0,i.jsx)(n.td,{children:"none (fire-and-forget)"}),(0,i.jsxs)(n.td,{children:["dropped if payload is invalid or sim is not running; enqueues exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," per valid pointer/wheel event; ",(0,i.jsx)(n.strong,{children:"fatal"})," if handler throws or worker delivery throws"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC send"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:control-event"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellControlEvent"})}),(0,i.jsx)(n.td,{children:"none (fire-and-forget)"}),(0,i.jsxs)(n.td,{children:["dropped if payload is invalid, sim is not running, or mapping produces 0 commands; ",(0,i.jsx)(n.strong,{children:"fatal"})," if mapping throws or worker delivery throws; ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," has no effect"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC event"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:frame"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellFramePayload"})}),(0,i.jsx)(n.td,{children:"pushed to listeners"}),(0,i.jsx)(n.td,{children:"delivery may fail if renderer is not ready (main logs and continues)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC event"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:sim-status"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellSimStatusPayload"})}),(0,i.jsx)(n.td,{children:"pushed to listeners"}),(0,i.jsx)(n.td,{children:"delivery may fail if renderer is not ready (main logs and continues)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Worker postMessage"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SimWorkerInboundMessage.kind=enqueueCommands"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ kind:'enqueueCommands', commands: Command[] }"})}),(0,i.jsx)(n.td,{children:"enqueued for future ticks"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"fatal"})," if ",(0,i.jsx)(n.code,{children:"postMessage"})," throws \u2192 transition to ",(0,i.jsx)(n.code,{children:"sim.crashed"})," and stop accepting input"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Worker event"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SimWorkerOutboundMessage.kind=ready/frame/error"})}),(0,i.jsxs)(n.td,{children:["see ",(0,i.jsx)(n.code,{children:"SimWorkerOutboundMessage"})]}),(0,i.jsx)(n.td,{children:"updates main state"}),(0,i.jsxs)(n.td,{children:["invalid protocol messages are ignored during init; ",(0,i.jsx)(n.code,{children:"error"})," is ",(0,i.jsx)(n.strong,{children:"fatal"})," (crash)"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"cli-commands-if-applicable",children:"CLI Commands (if applicable)"}),"\n",(0,i.jsx)(n.p,{children:"N/A"}),"\n",(0,i.jsx)(n.h3,{id:"events-if-applicable",children:"Events (if applicable)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Event"}),(0,i.jsx)(n.th,{children:"Trigger"}),(0,i.jsx)(n.th,{children:"Payload"}),(0,i.jsx)(n.th,{children:"Consumers"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:frame"})}),(0,i.jsxs)(n.td,{children:["Sim worker sends ",(0,i.jsx)(n.code,{children:"kind:'frame'"})," and main forwards the frame."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RenderCommandBuffer"})}),(0,i.jsxs)(n.td,{children:["Electron renderer (",(0,i.jsx)(n.code,{children:"IdleEngineApi.onFrame"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle-engine:sim-status"})}),(0,i.jsxs)(n.td,{children:["Main enters ",(0,i.jsx)(n.code,{children:"starting"}),", ",(0,i.jsx)(n.code,{children:"running"}),", ",(0,i.jsx)(n.code,{children:"stopped"}),", or ",(0,i.jsx)(n.code,{children:"crashed"}),"."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellSimStatusPayload"})}),(0,i.jsxs)(n.td,{children:["Electron renderer (",(0,i.jsx)(n.code,{children:"IdleEngineApi.onSimStatus"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sim-worker:ready"})}),(0,i.jsxs)(n.td,{children:["Sim worker sends ",(0,i.jsx)(n.code,{children:"kind:'ready'"}),"."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ kind:'ready', stepSizeMs:number, nextStep:number }"})}),(0,i.jsx)(n.td,{children:"Electron main controller"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sim-worker:frame"})}),(0,i.jsxs)(n.td,{children:["Sim worker sends ",(0,i.jsx)(n.code,{children:"kind:'frame'"}),"."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ kind:'frame', frame?:RenderCommandBuffer, droppedFrames:number, nextStep:number }"})}),(0,i.jsx)(n.td,{children:"Electron main controller"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sim-worker:error"})}),(0,i.jsxs)(n.td,{children:["Sim worker sends ",(0,i.jsx)(n.code,{children:"kind:'error'"})," or worker emits ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"messageerror"}),"/non-zero exit."]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"{ kind:'error', error:string }"})," plus worker error/exit metadata"]}),(0,i.jsxs)(n.td,{children:["Electron main controller (transitions to ",(0,i.jsx)(n.code,{children:"sim.crashed"}),"/",(0,i.jsx)(n.code,{children:"sim.stopped"}),")"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"runtime-commands",children:"Runtime Commands"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Command Type"}),(0,i.jsx)(n.th,{children:"Payload"}),(0,i.jsx)(n.th,{children:"Producer"}),(0,i.jsx)(n.th,{children:"Consumers"}),(0,i.jsx)(n.th,{children:"Errors"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," (new)"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload"})}),(0,i.jsxs)(n.td,{children:["Electron main process (",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})," handler; 1:1 for valid pointer/wheel events)"]}),(0,i.jsx)(n.td,{children:"UI/controls systems inside sim runtime"}),(0,i.jsxs)(n.td,{children:["command is produced for every valid pointer/wheel input-event; handler/worker errors are ",(0,i.jsx)(n.strong,{children:"fatal"})," (see workflow)"]})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,i.jsxs)(n.p,{children:["All renderer-provided validation is ",(0,i.jsx)(n.strong,{children:"synchronous"})," at the IPC boundary (main process). When validation fails:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["IPC invoke endpoints reject with a thrown ",(0,i.jsx)(n.code,{children:"TypeError"})," (Promise rejects in renderer)."]}),"\n",(0,i.jsx)(n.li,{children:"IPC send endpoints are dropped (no acknowledgment); main may log in dev builds."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Separately, the sim-side ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command handler validates ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload.schemaVersion"})," for commands originating from restores/replays; non-",(0,i.jsx)(n.code,{children:"1"})," is treated as a fatal incompatibility (crash)."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Constraints"}),(0,i.jsx)(n.th,{children:"Error"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingRequest.message"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'TypeError("Invalid ping request: expected { message: string }")'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReadAssetRequest.url"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required, non-empty; must parse as URL; must be ",(0,i.jsx)(n.code,{children:"file:"}),"; must resolve inside compiled assets root"]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'TypeError("Invalid read asset request: expected { url: string }")'}),", ",(0,i.jsx)(n.code,{children:'TypeError("Invalid asset url: expected a file:// URL.")'}),", ",(0,i.jsx)(n.code,{children:'TypeError("Invalid asset url: path must be inside compiled assets.")'}),", or URL parse ",(0,i.jsx)(n.code,{children:"TypeError"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellControlEvent.intent"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"required; non-empty after trim"}),(0,i.jsx)(n.td,{children:"drop control event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellControlEvent.phase"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required; one of ",(0,i.jsx)(n.code,{children:"start"}),", ",(0,i.jsx)(n.code,{children:"repeat"}),", ",(0,i.jsx)(n.code,{children:"end"})]}),(0,i.jsx)(n.td,{children:"drop control event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellControlEvent.value"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsx)(n.td,{children:"optional; if present must be finite"}),(0,i.jsx)(n.td,{children:"drop control event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellControlEvent.metadata"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsxs)(n.td,{children:["optional; if present must be a non-null object and not an array; keys are not validated; ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," is ignored"]}),(0,i.jsx)(n.td,{children:"drop control event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.schemaVersion"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required; must equal ",(0,i.jsx)(n.code,{children:"1"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.event"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.kind"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required; one of ",(0,i.jsx)(n.code,{children:"pointer"}),", ",(0,i.jsx)(n.code,{children:"wheel"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.intent"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required; if ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),": one of ",(0,i.jsx)(n.code,{children:"mouse-down"}),", ",(0,i.jsx)(n.code,{children:"mouse-up"}),", ",(0,i.jsx)(n.code,{children:"mouse-move"}),"; if ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),": must equal ",(0,i.jsx)(n.code,{children:"mouse-wheel"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.phase"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required; if ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),": must match intent (",(0,i.jsx)(n.code,{children:"mouse-down \u2192 start"}),", ",(0,i.jsx)(n.code,{children:"mouse-move \u2192 repeat"}),", ",(0,i.jsx)(n.code,{children:"mouse-up \u2192 end"}),"); if ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),": must equal ",(0,i.jsx)(n.code,{children:"repeat"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.x/y"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required; finite; canvas-relative CSS pixel coordinates derived as ",(0,i.jsx)(n.code,{children:"clientX/Y - canvas.getBoundingClientRect().left/top"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.button"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required when ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),"; integer; range ",(0,i.jsx)(n.code,{children:"-1..32"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.buttons"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required when ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),"; integer; range ",(0,i.jsx)(n.code,{children:"0..0xFFFF"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.pointerType"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["required when ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),"; one of ",(0,i.jsx)(n.code,{children:"mouse"}),", ",(0,i.jsx)(n.code,{children:"pen"}),", ",(0,i.jsx)(n.code,{children:"touch"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsxs)(n.td,{children:["required; ",(0,i.jsx)(n.code,{children:"{ alt, ctrl, meta, shift }"})," booleans"]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaX/Y/Z"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required when ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),"; finite"]}),(0,i.jsx)(n.td,{children:"drop input event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaMode"})}),(0,i.jsx)(n.td,{children:"number"}),(0,i.jsxs)(n.td,{children:["required when ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),"; one of ",(0,i.jsx)(n.code,{children:"0"}),", ",(0,i.jsx)(n.code,{children:"1"}),", ",(0,i.jsx)(n.code,{children:"2"})]}),(0,i.jsx)(n.td,{children:"drop input event"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"ui-interactions-if-applicable",children:"UI Interactions (if applicable)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Action"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Loading State"}),(0,i.jsx)(n.th,{children:"Success"}),(0,i.jsx)(n.th,{children:"Error"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Press Space (demo \u201ccollect\u201d)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"IPC send idle-engine:control-event"})}),(0,i.jsx)(n.td,{children:"none"}),(0,i.jsxs)(n.td,{children:["Sim enqueues ",(0,i.jsx)(n.code,{children:"COLLECT_RESOURCE"})," and UI updates on next frame"]}),(0,i.jsx)(n.td,{children:"if sim is stopped/crashed: input is ignored; status text indicates \u201cReload to restart\u201d"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Pointer down/up/move on canvas"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"IPC send idle-engine:input-event"})," (",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),")"]}),(0,i.jsx)(n.td,{children:"none"}),(0,i.jsxs)(n.td,{children:["Main enqueues exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command per valid pointer event; UI responds deterministically at tick boundaries"]}),(0,i.jsxs)(n.td,{children:["invalid payload is dropped; if handler/bridge crashes, renderer receives ",(0,i.jsx)(n.code,{children:"sim-status: crashed"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Mouse wheel on canvas"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"IPC send idle-engine:input-event"})," (",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),")"]}),(0,i.jsx)(n.td,{children:"none"}),(0,i.jsxs)(n.td,{children:["Main enqueues exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command per valid wheel event"]}),(0,i.jsx)(n.td,{children:"same as above"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"contract-gates",children:"Contract gates"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Breaking change"}),": Yes, behaviorally. ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," no longer causes implicit forwarding, and ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," commands are no longer emitted."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Migration"}),": Pointer/wheel inputs are forwarded by the desktop shell as a 1:1 ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime command (",(0,i.jsx)(n.code,{children:"InputEventCommandPayload.event"}),"). Any system that previously consumed ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT.payload.event.metadata"})," must consume ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload.event"})," instead. ",(0,i.jsx)(n.code,{children:"idle-engine:control-event"})," remains binding-driven; unbound control intents remain dropped (no passthrough)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Versioning"}),": ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.schemaVersion"})," starts at ",(0,i.jsx)(n.code,{children:"1"}),". Main must reject unknown versions (drop) and may support ",(0,i.jsx)(n.code,{children:"N-1"})," during migrations. ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," payload is versioned via ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload.schemaVersion"})," (also ",(0,i.jsx)(n.code,{children:"1"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"main-produced-input_event-command-fields",children:["Main-produced ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command fields"]}),"\n",(0,i.jsxs)(n.p,{children:["When Electron main receives a valid ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"}),", it enqueues exactly one runtime command with the following fields:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"priority"}),": ",(0,i.jsx)(n.code,{children:"CommandPriority.PLAYER"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"step"}),": snapshot of the controller\u2019s current ",(0,i.jsx)(n.code,{children:"nextStep"})," when the IPC message is processed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timestamp"}),": ",(0,i.jsx)(n.code,{children:"step * stepSizeMs"})," (aligned to sim tick time; not wall-clock time)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"payload"}),": ",(0,i.jsx)(n.code,{children:"{ schemaVersion: 1, event }"})," where ",(0,i.jsx)(n.code,{children:"event"})," is the validated ",(0,i.jsx)(n.code,{children:"InputEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"requestId"}),": not set (left ",(0,i.jsx)(n.code,{children:"undefined"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"type-contracts-wire-level",children:"Type contracts (wire-level)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Canonical input-event types (InputEvent, InputEventCommandPayload) live in @idle-engine/core.\n// ShellControlEvent remains a shell-desktop-only IPC contract in packages/shell-desktop/src/ipc.ts.\nexport type ShellControlEvent = Readonly<{\n  intent: string;\n  phase: 'start' | 'repeat' | 'end';\n  value?: number;\n  /**\n   * Optional extra event data passed through the IPC boundary.\n   *\n   * The main process validates only that `metadata` is a plain object when present\n   * (non-null, non-array) and does not validate keys.\n   *\n   * Reserved keys:\n   * - `passthrough`: ignored and has no effect.\n   */\n  metadata?: Readonly<Record<string, unknown>>;\n}>;\n\nexport type InputEvent =\n  | Readonly<{\n      kind: 'pointer';\n      intent: 'mouse-down' | 'mouse-up' | 'mouse-move';\n      phase: 'start' | 'repeat' | 'end';\n      x: number;\n      y: number;\n      button: number;\n      buttons: number;\n      pointerType: 'mouse' | 'pen' | 'touch';\n      modifiers: Readonly<{ alt: boolean; ctrl: boolean; meta: boolean; shift: boolean }>;\n    }>\n  | Readonly<{\n      kind: 'wheel';\n      intent: 'mouse-wheel';\n      phase: 'repeat';\n      x: number;\n      y: number;\n      deltaX: number;\n      deltaY: number;\n      deltaZ: number;\n      deltaMode: 0 | 1 | 2;\n      modifiers: Readonly<{ alt: boolean; ctrl: boolean; meta: boolean; shift: boolean }>;\n    }>;\n\n// IPC envelope lives in packages/shell-desktop but references the canonical InputEvent type.\nexport type ShellInputEventEnvelope = Readonly<{\n  schemaVersion: 1;\n  event: InputEvent;\n}>;\n\nexport type InputEventCommandPayload = Readonly<{\n  schemaVersion: 1;\n  event: InputEvent;\n}>;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-data",children:"4. Data"}),"\n",(0,i.jsxs)(n.p,{children:["This feature introduces a ",(0,i.jsx)(n.strong,{children:"typed, versioned input-event schema"})," for desktop-shell forwarded inputs and a ",(0,i.jsx)(n.strong,{children:"typed runtime command payload"})," for replayable input events. No new on-disk files are created; the only persisted surface area is via existing save/snapshot/replay mechanisms that already serialize command-queue entries as JSON."]}),"\n",(0,i.jsx)(n.h3,{id:"schema-changes",children:"Schema Changes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Location"}),(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Constraints"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["must equal ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.schemaVersion"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"1"})," (when encoding)"]}),(0,i.jsxs)(n.td,{children:["reject/drop if not exactly ",(0,i.jsx)(n.code,{children:"1"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.event"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"reject/drop if missing or not an object"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.kind"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"'pointer' | 'wheel'"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"must be one of the listed literals"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.intent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"'mouse-down' | 'mouse-up' | 'mouse-move' | 'mouse-wheel'"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["if ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),": must be one of ",(0,i.jsx)(n.code,{children:"mouse-down"}),"/",(0,i.jsx)(n.code,{children:"mouse-up"}),"/",(0,i.jsx)(n.code,{children:"mouse-move"}),"; if ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),": must equal ",(0,i.jsx)(n.code,{children:"mouse-wheel"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.phase"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"'start' | 'repeat' | 'end'"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["if ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),": must match intent (",(0,i.jsx)(n.code,{children:"mouse-down\u2192start"}),", ",(0,i.jsx)(n.code,{children:"mouse-move\u2192repeat"}),", ",(0,i.jsx)(n.code,{children:"mouse-up\u2192end"}),"); if ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),": must equal ",(0,i.jsx)(n.code,{children:"repeat"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.x"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["finite; canvas-relative CSS pixels (",(0,i.jsx)(n.code,{children:"clientX - canvas.getBoundingClientRect().left"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.y"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["finite; canvas-relative CSS pixels (",(0,i.jsx)(n.code,{children:"clientY - canvas.getBoundingClientRect().top"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.button"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":pointer",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["integer; range ",(0,i.jsx)(n.code,{children:"-1..32"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.buttons"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":pointer",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["integer; range ",(0,i.jsx)(n.code,{children:"0..0xFFFF"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.pointerType"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"'mouse' | 'pen' | 'touch'"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":pointer",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"must be one of the listed literals"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{ alt, ctrl, meta, shift }"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"object with all four boolean keys present"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers.alt"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers.ctrl"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers.meta"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.modifiers.shift"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaX"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":wheel",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"finite"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaY"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":wheel",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"finite"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaZ"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":wheel",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"finite"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent.deltaMode"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0 | 1 | 2"})}),(0,i.jsxs)(n.td,{children:["yes (kind",":wheel",")"]}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"must be one of the listed literals"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["must equal ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RuntimeCommandPayloads.INPUT_EVENT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsx)(n.td,{children:"payload must be JSON-serializable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload.schemaVersion"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"1"})," (when encoding)"]}),(0,i.jsxs)(n.td,{children:["validated by the sim-side ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," handler; unknown versions crash the sim worker"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload.event"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"InputEvent"})}),(0,i.jsx)(n.td,{children:"yes"}),(0,i.jsx)(n.td,{children:"n/a"}),(0,i.jsxs)(n.td,{children:["must satisfy the same variant constraints as IPC ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.event"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"ShellControlEvent.metadata"})," (legacy; passthrough ignored)"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Record<string, unknown>"})}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"undefined"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"metadata.passthrough"})," is ignored; pointer/wheel metadata must not be relied on"]})]})]})]}),"\n",(0,i.jsxs)(n.h3,{id:"command-authorization-command_authorizations",children:["Command Authorization (",(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command is only allowed in the player priority lane so that UI interactions cannot be synthesized by automation."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS[RUNTIME_COMMAND_TYPES.INPUT_EVENT].allowedPriorities"}),": ",(0,i.jsx)(n.code,{children:"[CommandPriority.PLAYER]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS[RUNTIME_COMMAND_TYPES.INPUT_EVENT].rationale"}),": Input events represent player-originated shell interactions; automation must not inject UI inputs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS[RUNTIME_COMMAND_TYPES.INPUT_EVENT].unauthorizedEvent"}),": ",(0,i.jsx)(n.code,{children:"UnauthorizedInputEventCommand"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"version-validation-schemaversion",children:["Version Validation (",(0,i.jsx)(n.code,{children:"schemaVersion"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IPC (wire-level)"}),": ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.schemaVersion"})," is validated in Electron main in the ",(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"})," handler. Non-",(0,i.jsx)(n.code,{children:"1"})," payloads are dropped (no worker enqueue)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Runtime (command payload)"}),": ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload.schemaVersion"})," is validated by the sim-side handler for ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"})," before reading ",(0,i.jsx)(n.code,{children:"payload.event"}),". If the version is not ",(0,i.jsx)(n.code,{children:"1"}),", the handler throws and the sim worker transitions to ",(0,i.jsx)(n.code,{children:"error"}),"/",(0,i.jsx)(n.code,{children:"crashed"})," (fail-fast for incompatible replays/snapshots)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"field-definitions",children:"Field Definitions"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Purpose: Stable channel name for sending typed input events across the Electron IPC boundary (renderer \u2192 main)."}),"\n",(0,i.jsxs)(n.li,{children:["Set by: ",(0,i.jsx)(n.code,{children:"packages/shell-desktop"})," IPC contract definition."]}),"\n",(0,i.jsx)(n.li,{children:"Read by: Renderer sender and main-process receiver."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.schemaVersion"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Purpose: Wire-level version gate for input-event payloads."}),"\n",(0,i.jsx)(n.li,{children:"Set by: Desktop renderer when emitting an input event."}),"\n",(0,i.jsx)(n.li,{children:"Read by: Desktop main process when validating inbound input events."}),"\n",(0,i.jsxs)(n.li,{children:["Derived: Constant ",(0,i.jsx)(n.code,{children:"1"})," for this feature\u2019s initial rollout."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.event"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Purpose: Carries the typed pointer/wheel input event across IPC."}),"\n",(0,i.jsx)(n.li,{children:"Set by: Desktop renderer input capture layer."}),"\n",(0,i.jsx)(n.li,{children:"Read by: Desktop main input handler (enqueues runtime commands)."}),"\n",(0,i.jsxs)(n.li,{children:["Type ownership: ",(0,i.jsx)(n.code,{children:"event"})," is the canonical ",(0,i.jsx)(n.code,{children:"InputEvent"})," type from ",(0,i.jsx)(n.code,{children:"@idle-engine/core"})," (core owns the variant definitions)."]}),"\n",(0,i.jsxs)(n.li,{children:["References: No foreign keys; ",(0,i.jsx)(n.code,{children:"intent"})," strings are matched against control/binding intent strings but are not strong references."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"InputEvent.*"})," (variants)"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Purpose: Lossless-but-minimal representation of the input needed for deterministic UI/control handling."}),"\n",(0,i.jsx)(n.li,{children:"Set by: Desktop renderer (source-of-truth is the browser/DOM event data)."}),"\n",(0,i.jsxs)(n.li,{children:["Read by: Desktop main mapper; optionally embedded into ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime commands for sim-side consumption."]}),"\n",(0,i.jsxs)(n.li,{children:["Derived fields:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),", ",(0,i.jsx)(n.code,{children:"phase"})," is derived from ",(0,i.jsx)(n.code,{children:"intent"})," (",(0,i.jsx)(n.code,{children:"mouse-down\u2192start"}),", ",(0,i.jsx)(n.code,{children:"mouse-move\u2192repeat"}),", ",(0,i.jsx)(n.code,{children:"mouse-up\u2192end"}),") and must remain consistent; mismatches are rejected."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"kind:'wheel'"}),", ",(0,i.jsx)(n.code,{children:"phase"})," is always ",(0,i.jsx)(n.code,{children:"repeat"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"x/y"})," are derived in the renderer in ",(0,i.jsx)(n.strong,{children:"CSS pixels"})," as ",(0,i.jsx)(n.code,{children:"clientX/Y - canvas.getBoundingClientRect().left/top"})," (no devicePixelRatio scaling)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Ordering dependencies: None stored in the payload; ordering is defined by IPC delivery order and the main-process enqueue policy (commands are scheduled at the runtime\u2019s next executable step)."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload.schemaVersion"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Purpose: Version gate for runtime command payload evolution independent of IPC evolution."}),"\n",(0,i.jsxs)(n.li,{children:["Set by: Desktop main process when producing an ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command."]}),"\n",(0,i.jsxs)(n.li,{children:["Read by: Sim-side command handler(s) that consume ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Derived: Constant ",(0,i.jsx)(n.code,{children:"1"})," for this feature\u2019s initial rollout."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"InputEventCommandPayload.event"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Purpose: The replayable input event attached to an ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime command."]}),"\n",(0,i.jsxs)(n.li,{children:["Set by: Desktop main process (copied from a validated ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope.event"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Read by: Sim-side controls/UI input system(s)."}),"\n",(0,i.jsxs)(n.li,{children:["References: No foreign keys; ",(0,i.jsx)(n.code,{children:"intent"})," is a semantic identifier only."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"ShellControlEvent.metadata"})," (legacy; passthrough ignored)"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Purpose: Extensibility hook for ",(0,i.jsx)(n.code,{children:"idle-engine:control-event"}),"; retained for backwards compatibility with existing control scheme resolvers that read arbitrary metadata."]}),"\n",(0,i.jsx)(n.li,{children:"Set by: Legacy control-event senders (renderer or other callers)."}),"\n",(0,i.jsxs)(n.li,{children:["Read by: Control scheme payload resolvers; desktop shell ignores ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," and does not forward raw pointer/wheel metadata via ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"migrations",children:"Migrations"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Change"}),(0,i.jsx)(n.th,{children:"Existing Data"}),(0,i.jsx)(n.th,{children:"Migration"}),(0,i.jsx)(n.th,{children:"Rollback"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Add IPC input-event envelope (",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"}),", ",(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"}),")"]}),(0,i.jsx)(n.td,{children:"No records exist; channel absent"}),(0,i.jsx)(n.td,{children:"Add new IPC channel and validate on receive; absence means no typed input events are sent"}),(0,i.jsx)(n.td,{children:"Remove channel; renderer falls back to legacy control events only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Add runtime command type ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," with ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload"})]}),(0,i.jsxs)(n.td,{children:["Existing command queues/snapshots contain no ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," entries"]}),(0,i.jsxs)(n.td,{children:["Add command handler(s) for ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"}),"; the desktop main process emits exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," per validated pointer/wheel input-event IPC message"]}),(0,i.jsxs)(n.td,{children:["Remove handler and stop emitting ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Deprecate passthrough forwarding and ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," production"]}),(0,i.jsxs)(n.td,{children:["Older saves/snapshots ",(0,i.jsx)(n.em,{children:"may"})," contain ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," entries"]}),(0,i.jsxs)(n.td,{children:["Do not emit ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," going forward. For compatibility, ",(0,i.jsxs)(n.strong,{children:["keep a no-op handler registered for ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," in the demo sim runtime"]})," so restores do not produce ",(0,i.jsx)(n.code,{children:"UnknownCommandType"})," errors (",(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/sim/sim-runtime.ts"}),")."]}),(0,i.jsxs)(n.td,{children:["Restore legacy behavior only by reintroducing passthrough forwarding and emitting ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," (not recommended)"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"artifacts",children:"Artifacts"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Artifact"}),(0,i.jsx)(n.th,{children:"Location"}),(0,i.jsx)(n.th,{children:"Created"}),(0,i.jsx)(n.th,{children:"Updated"}),(0,i.jsx)(n.th,{children:"Deleted"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPC input-event message"}),(0,i.jsxs)(n.td,{children:["Electron IPC message on ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})]}),(0,i.jsx)(n.td,{children:"When renderer captures input"}),(0,i.jsx)(n.td,{children:"Never (immutable)"}),(0,i.jsx)(n.td,{children:"After message delivery/GC (ephemeral)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command"]}),(0,i.jsx)(n.td,{children:"In-memory command queue entry"}),(0,i.jsxs)(n.td,{children:["When main maps a validated ",(0,i.jsx)(n.code,{children:"InputEvent"})," to ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})]}),(0,i.jsx)(n.td,{children:"Never (immutable)"}),(0,i.jsx)(n.td,{children:"When dequeued/executed or queue is cleared on restart"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Serialized ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," payload"]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"SerializedCommandQueueV1.entries[].payload"})," (inside ",(0,i.jsx)(n.code,{children:"GameStateSnapshot.commandQueue"}),")"]}),(0,i.jsx)(n.td,{children:"When a snapshot/save captures the command queue"}),(0,i.jsx)(n.td,{children:"Never (immutable)"}),(0,i.jsx)(n.td,{children:"When the snapshot/save is discarded by the caller"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"artifact-lifecycle",children:"Artifact Lifecycle"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Artifact Behavior"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Success"}),(0,i.jsxs)(n.td,{children:["For ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})," (pointer/wheel): IPC message is validated and exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command is created and enqueued; queued commands execute at tick boundaries and are then removed. For ",(0,i.jsx)(n.code,{children:"idle-engine:control-event"}),": 0..N commands may be created/enqueued depending on bindings."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Failure"}),(0,i.jsx)(n.td,{children:"Invalid IPC payloads are dropped (no commands created). Unbound control events (binding produces 0 commands) produce no artifacts beyond transient mapping work."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Crash recovery"}),(0,i.jsxs)(n.td,{children:["Renderer\u2192main IPC messages in flight are lost. Any ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," commands not yet dequeued are lost if the runtime/controller is restarted without persisting the queue; if a snapshot/save captured them, they persist only within that snapshot/save."]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"5-tasks",children:"5. Tasks"}),"\n",(0,i.jsx)(n.h3,{id:"decomposition-gates",children:"Decomposition Gates"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Smallest independently testable unit"}),": Add the ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime command type + its payload types in ",(0,i.jsx)(n.code,{children:"@idle-engine/core"})," (verifiable via ",(0,i.jsx)(n.code,{children:"@idle-engine/core"})," typecheck/tests)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dependencies"}),": Yes; shell-desktop IPC/types should depend on the core command/type additions, and main/renderer updates depend on the IPC surface existing."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Parallel work"}),": Yes; after the IPC surface exists, renderer capture (T3) and main mapping (T4) can proceed in parallel; sim-runtime wiring (T5) can proceed after core types land (T1)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ordering-gates",children:"Ordering Gates"}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Must be done first"}),": Define shared types + ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command type in ",(0,i.jsx)(n.code,{children:"@idle-engine/core"})," (T1)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Must be done last"}),": Integration checks + coverage/docs regeneration (T6)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Circular dependencies"}),": None in this breakdown; shared input-event types live in ",(0,i.jsx)(n.code,{children:"@idle-engine/core"})," to avoid core\u2194shell cycles."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"infrastructure-gates",children:"Infrastructure Gates"}),"\n",(0,i.jsxs)(n.ol,{start:"10",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Build/config changes"}),": None expected beyond updating TypeScript sources and checked-in ",(0,i.jsx)(n.code,{children:"dist/"})," outputs via existing ",(0,i.jsx)(n.code,{children:"pnpm build"})," scripts."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"New dependencies"}),": None."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Env vars/secrets"}),": None required; optional dev-only ",(0,i.jsx)(n.code,{children:"IDLE_ENGINE_ENABLE_UNSAFE_WEBGPU=1"})," remains unchanged."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"task-dependency-graph",children:"Task Dependency Graph"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"T1 (no deps)\nT2 \u2192 depends on T1\nT3 \u2192 depends on T2\nT4 \u2192 depends on T2\nT5 \u2192 depends on T1\nT6 \u2192 depends on T3, T4, T5\n"})}),"\n",(0,i.jsx)(n.h3,{id:"task-breakdown",children:"Task Breakdown"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"ID"}),(0,i.jsx)(n.th,{children:"Title"}),(0,i.jsx)(n.th,{children:"Summary"}),(0,i.jsx)(n.th,{children:"Files"}),(0,i.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T1"}),(0,i.jsxs)(n.td,{children:["Add ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," to core"]}),(0,i.jsxs)(n.td,{children:["Define shared typed input-event contracts and register ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," as a runtime command type."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})}),(0,i.jsxs)(n.td,{children:["Core exports ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"})," + typed payload; ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/core typecheck"})," passes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T2"}),(0,i.jsx)(n.td,{children:"Add IPC channel + API"}),(0,i.jsxs)(n.td,{children:["Introduce ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})," IPC channel and expose ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," on the preload bridge."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})}),(0,i.jsxs)(n.td,{children:["IPC channel + types exist; preload exposes ",(0,i.jsx)(n.code,{children:"sendInputEvent"}),"; shell-desktop IPC/preload tests pass."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T3"}),(0,i.jsx)(n.td,{children:"Send typed input events"}),(0,i.jsxs)(n.td,{children:["Update desktop renderer to send typed pointer/wheel events via ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," (with RAF coalescing for moves)."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})}),(0,i.jsxs)(n.td,{children:["Pointer/wheel events call ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," with schemaVersion ",(0,i.jsx)(n.code,{children:"1"}),"; renderer unit tests pass."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T4"}),(0,i.jsx)(n.td,{children:"Validate + enqueue input events"}),(0,i.jsxs)(n.td,{children:["Add main-process validation for ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," and enqueue ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," commands; remove passthrough + stop emitting ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"}),"."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.ts"})}),(0,i.jsxs)(n.td,{children:["Invalid input-event IPC payloads are dropped; valid pointer/wheel events enqueue ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"}),"; ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," is never enqueued; main tests pass."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T5"}),(0,i.jsxs)(n.td,{children:["Consume ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," for demo UI"]}),(0,i.jsxs)(n.td,{children:["Migrate demo pointer/UI handling from legacy ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," passthrough to ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," so canvas UI interactions remain functional; keep legacy compatibility explicit."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/sim/sim-runtime.ts"})}),(0,i.jsxs)(n.td,{children:["Sim consumes ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," for click-to-collect; sim-runtime tests pass."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"T6"}),(0,i.jsx)(n.td,{children:"Integrate + regenerate coverage"}),(0,i.jsxs)(n.td,{children:["Run workspace checks, update any remaining references, and regenerate ",(0,i.jsx)(n.code,{children:"docs/coverage/index.md"}),"."]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docs/coverage/index.md"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"pnpm typecheck/lint/test"})," pass and coverage markdown is regenerated."]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"task-details",children:"Task Details"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["T1: Add ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," to core"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Summary: Introduce shared ",(0,i.jsx)(n.code,{children:"InputEvent"})," types and the new ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," runtime command type with a versioned payload."]}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/command.ts"})," - add ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"}),", ",(0,i.jsx)(n.code,{children:"InputEventCommandPayload"}),", and wire into ",(0,i.jsx)(n.code,{children:"RuntimeCommandPayloads"})," + ",(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/input-event.ts"})," - define ",(0,i.jsx)(n.code,{children:"InputEvent"}),", ",(0,i.jsx)(n.code,{children:"InputEventModifiers"}),", and related literals used by both IPC and runtime payloads."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/index.browser.ts"})," - export the new input-event types and payload type for consumers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/input-event.test.ts"})," - add focused unit tests covering basic shape/serialization expectations (no IPC), if needed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@idle-engine/core"})," exports ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RuntimeCommandPayloads['INPUT_EVENT']"})," is strongly typed as ",(0,i.jsx)(n.code,{children:"{ schemaVersion: 1; event: InputEvent }"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"COMMAND_AUTHORIZATIONS[RUNTIME_COMMAND_TYPES.INPUT_EVENT].allowedPriorities"})," is exactly ",(0,i.jsx)(n.code,{children:"[CommandPriority.PLAYER]"})," (and ",(0,i.jsx)(n.code,{children:"unauthorizedEvent === 'UnauthorizedInputEventCommand'"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/core typecheck"})," passes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/core test"})," passes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: None"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/core test"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T2: Add IPC channel + API"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Summary: Add the new IPC channel constant and a typed renderer\u2192main send surface for input events."}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.ts"})," - add ",(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"})," and define ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," (schemaVersion ",(0,i.jsx)(n.code,{children:"1"}),") referencing ",(0,i.jsx)(n.code,{children:"InputEvent"})," from ",(0,i.jsx)(n.code,{children:"@idle-engine/core"}),"; add ",(0,i.jsx)(n.code,{children:"IdleEngineApi.sendInputEvent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.test.ts"})," - assert the new stable identifier (",(0,i.jsx)(n.code,{children:"idle-engine:input-event"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/preload.cts"})," - expose ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," and route it via ",(0,i.jsx)(n.code,{children:"ipcRenderer.send(IPC_CHANNELS.inputEvent, envelope)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/preload.test.ts"})," - verify ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," exists and forwards to ",(0,i.jsx)(n.code,{children:"ipcRenderer.send"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent === 'idle-engine:input-event'"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Preload exposes ",(0,i.jsx)(n.code,{children:"idleEngine.sendInputEvent(...)"})," and it calls ",(0,i.jsx)(n.code,{children:"ipcRenderer.send"})," on the correct channel."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/ipc.test.ts"})," passes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/preload.test.ts"})," passes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: T1"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/preload.test.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T3: Send typed input events"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Summary: Replace pointer/wheel \u201cpassthrough metadata\u201d forwarding with explicit typed input events."}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.ts"})," - build and send ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," for ",(0,i.jsx)(n.code,{children:"mouse-down"}),", ",(0,i.jsx)(n.code,{children:"mouse-up"}),", ",(0,i.jsx)(n.code,{children:"mouse-move"}),", and ",(0,i.jsx)(n.code,{children:"mouse-wheel"}),"; keep pointer-move RAF coalescing."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})," - update expectations to assert ",(0,i.jsx)(n.code,{children:"sendInputEvent"})," calls (not ",(0,i.jsx)(n.code,{children:"sendControlEvent"})," metadata passthrough)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Pointer down/up/move events produce ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," with ",(0,i.jsx)(n.code,{children:"schemaVersion: 1"})," and ",(0,i.jsx)(n.code,{children:"event.kind: 'pointer'"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Wheel events produce ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," with ",(0,i.jsx)(n.code,{children:"event.kind: 'wheel'"})," and finite deltas/deltaMode."]}),"\n",(0,i.jsx)(n.li,{children:"Pointer move events are still coalesced to one send per animation frame."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/renderer/index.test.ts"})," passes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: T2"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/renderer/index.test.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T4: Validate + enqueue input events"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Summary: Add a main-process handler for ",(0,i.jsx)(n.code,{children:"idle-engine:input-event"})," that validates and enqueues typed ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," commands; remove passthrough forwarding + ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," emission."]}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.ts"})," - add IPC receive handler for ",(0,i.jsx)(n.code,{children:"IPC_CHANNELS.inputEvent"}),"; implement synchronous shape validation; enqueue ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," commands on success; delete ",(0,i.jsx)(n.code,{children:"shouldPassthroughControlEvent"})," and the ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," enqueue path."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.test.ts"})," - update tests to assert ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," is enqueued and ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," is never produced, even if ",(0,i.jsx)(n.code,{children:"metadata.passthrough"})," is set."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Invalid ",(0,i.jsx)(n.code,{children:"ShellInputEventEnvelope"})," payloads are dropped (no worker messages posted)."]}),"\n",(0,i.jsxs)(n.li,{children:["When sim is not running (",(0,i.jsx)(n.code,{children:"sim.stopped"}),"/",(0,i.jsx)(n.code,{children:"sim.crashed"}),"/disposing), input events are ignored."]}),"\n",(0,i.jsxs)(n.li,{children:["Valid pointer/wheel input events enqueue exactly one ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command with ",(0,i.jsx)(n.code,{children:"payload.schemaVersion === 1"})," and the validated event copied into payload."]}),"\n",(0,i.jsxs)(n.li,{children:["Enqueued ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," commands have ",(0,i.jsx)(n.code,{children:"priority === CommandPriority.PLAYER"}),", ",(0,i.jsx)(n.code,{children:"step === nextStep"})," (snapshotted at receive time), ",(0,i.jsx)(n.code,{children:"timestamp === step * stepSizeMs"}),", and ",(0,i.jsx)(n.code,{children:"requestId === undefined"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["No code path enqueues ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," in response to renderer inputs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/main.test.ts"})," passes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: T2"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/main.test.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["T5: Consume ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," for demo UI"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Summary: Migrate demo pointer/UI interaction handling away from legacy passthrough (",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT.payload.event.metadata.*"}),") to ",(0,i.jsx)(n.code,{children:"INPUT_EVENT.payload.event.*"})," so canvas UI clicks continue to work deterministically. Keep ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," registered as a no-op to support restores of older snapshots without ",(0,i.jsx)(n.code,{children:"UnknownCommandType"})," errors."]}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/sim/sim-runtime.ts"})," - register a dispatcher handler for ",(0,i.jsx)(n.code,{children:"RUNTIME_COMMAND_TYPES.INPUT_EVENT"})," and implement demo hit-testing for pointer ",(0,i.jsx)(n.code,{children:"mouse-down"})," so clicking the on-canvas UI triggers ",(0,i.jsx)(n.code,{children:"COLLECT_RESOURCE"})," (same gameplay effect as Space/collect). Hit-test region is the existing UI panel rect: ",(0,i.jsx)(n.code,{children:"x=16, y=16, width=320, height=72"})," (matches ",(0,i.jsx)(n.code,{children:"buildFrame"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/sim/sim-runtime.test.ts"})," - assert ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," is registered and that an in-bounds ",(0,i.jsx)(n.code,{children:"mouse-down"})," ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," produces the same visible UI effect as ",(0,i.jsx)(n.code,{children:"COLLECT_RESOURCE"}),"; assert ",(0,i.jsx)(n.code,{children:"SHELL_CONTROL_EVENT"})," remains registered as a no-op for legacy restores."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"createSimRuntime().hasCommandHandler(RUNTIME_COMMAND_TYPES.INPUT_EVENT) === true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["An ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," with ",(0,i.jsx)(n.code,{children:"kind:'pointer'"}),", ",(0,i.jsx)(n.code,{children:"intent:'mouse-down'"}),", and ",(0,i.jsx)(n.code,{children:"x/y"})," inside the demo UI hit-test region triggers the same next-frame UI change as a ",(0,i.jsx)(n.code,{children:"COLLECT_RESOURCE"})," command (resource count increases)."]}),"\n",(0,i.jsxs)(n.li,{children:["An ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," outside the hit-test region does not trigger ",(0,i.jsx)(n.code,{children:"COLLECT_RESOURCE"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If an ",(0,i.jsx)(n.code,{children:"INPUT_EVENT"})," command payload has ",(0,i.jsx)(n.code,{children:"schemaVersion !== 1"}),", the handler throws (sim worker crashes; fail-fast for incompatible replays/snapshots)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"createSimRuntime().hasCommandHandler(SHELL_CONTROL_EVENT_COMMAND_TYPE) === true"})," (legacy restore compatibility)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/sim/sim-runtime.test.ts"})," passes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: T1"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/sim/sim-runtime.test.ts"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"T6: Integrate + regenerate coverage"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Summary: Ensure the workspace compiles, lints, tests pass, and documentation coverage is regenerated after updating tests."}),"\n",(0,i.jsxs)(n.li,{children:["Files:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docs/coverage/index.md"})," - regenerated via ",(0,i.jsx)(n.code,{children:"pnpm coverage:md"})," (do not edit manually)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Acceptance Criteria:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm typecheck"})," passes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm lint"})," passes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm test"})," passes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pnpm coverage:md"})," updates ",(0,i.jsx)(n.code,{children:"docs/coverage/index.md"})," and the file is committed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Dependencies: T3, T4, T5"}),"\n",(0,i.jsxs)(n.li,{children:["Verification: ",(0,i.jsx)(n.code,{children:"pnpm coverage:md"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-validation",children:"6. Validation"}),"\n",(0,i.jsx)(n.h3,{id:"pre-implementation-checks",children:"Pre-Implementation Checks"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All dependencies installed: ",(0,i.jsx)(n.code,{children:"pnpm install"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Types check: ",(0,i.jsx)(n.code,{children:"pnpm typecheck"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Existing tests pass: ",(0,i.jsx)(n.code,{children:"pnpm test"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"post-implementation-checks",children:"Post-Implementation Checks"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Types check: ",(0,i.jsx)(n.code,{children:"pnpm typecheck"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Lint passes: ",(0,i.jsx)(n.code,{children:"pnpm lint"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All tests pass: ",(0,i.jsx)(n.code,{children:"pnpm test"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","New/updated test files pass:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/core/src/input-event.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/ipc.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/preload.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/renderer/index.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/main.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"packages/shell-desktop/src/sim/sim-runtime.test.ts"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Targeted test runs (while iterating):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/core test -- src/input-event.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/ipc.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/preload.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/renderer/index.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/main.test.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop test -- src/sim/sim-runtime.test.ts"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Coverage markdown regenerated: ",(0,i.jsx)(n.code,{children:"pnpm coverage:md"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"manual-verification-desktop-shell",children:"Manual Verification (desktop shell)"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Run ",(0,i.jsx)(n.code,{children:"pnpm --filter @idle-engine/shell-desktop start"})," and verify:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pressing Space triggers the existing \u201ccollect\u201d behavior (resource count increases)."}),"\n",(0,i.jsx)(n.li,{children:"Clicking the on-canvas UI triggers the same \u201ccollect\u201d behavior (resource count increases)."}),"\n",(0,i.jsx)(n.li,{children:"Pointer down/move/up and wheel inputs do not crash the app (inputs are accepted or ignored deterministically depending on sim state)."}),"\n",(0,i.jsx)(n.li,{children:"Reloading the window restarts the sim controller (input ignored while initializing, then accepted once running)."}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var d=s(9430);const i={},r=d.createContext(i);function t(e){const n=d.useContext(r);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),d.createElement(r.Provider,{value:n},e.children)}}}]);