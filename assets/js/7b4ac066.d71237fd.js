"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[7756],{7678:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var i=s(9430);const r={},l=i.createContext(r);function d(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(l.Provider,{value:n},e.children)}},9289:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"issue-848-design","title":"shell-desktop: add supported runtime harness API (Issue 848)","description":"Document Control","source":"@site/../../docs/issue-848-design.md","sourceDirName":".","slug":"/issue-848-design","permalink":"/Idle-Game-Engine/issue-848-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-848-design.md","tags":[],"version":"current","sidebarPosition":99,"frontMatter":{"title":"shell-desktop: add supported runtime harness API (Issue 848)","sidebar_position":99}}');var r=s(5270),l=s(7678);const d={title:"shell-desktop: add supported runtime harness API (Issue 848)",sidebar_position:99},t="shell-desktop: add supported runtime harness API (Issue 848)",o={},c=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"shell-desktop-add-supported-runtime-harness-api-issue-848",children:"shell-desktop: add supported runtime harness API (Issue 848)"})}),"\n",(0,r.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Title"}),": Add a supported public runtime harness surface for shells/test runners"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authors"}),": Codex (AI)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reviewers"}),": @hansjm10"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-26"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Related Issues"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/848",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/848"})," (triggered by test-game shell work in #841)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," and other host/test harnesses sometimes need lower-level runtime wiring primitives (coordinator construction, deterministic snapshot building, and save parsing/hydration) that are currently only directly importable via ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),". This defeats the repository\u2019s ",(0,r.jsx)(n.code,{children:"restrictCoreInternals"})," guardrails and makes shells brittle to internal refactors. This design introduces a supported, explicit \u201charness\u201d entry point (",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"}),") that re-exports a small set of integration helpers (save format loader + snapshot builder, plus types), enabling shells to stop depending on ",(0,r.jsx)(n.code,{children:"core/internals"})," while keeping the stable ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})," surface intentionally small."]}),"\n",(0,r.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Background"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The engine exposes a stable entry point (",(0,r.jsx)(n.code,{children:"@idle-engine/core"}),") and an unstable internal entry point (",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"). ",(0,r.jsx)(n.code,{children:"@idle-engine/config-eslint"})," can enforce this split via ",(0,r.jsx)(n.code,{children:"restrictCoreInternals"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The high-level ",(0,r.jsx)(n.code,{children:"createGame(...)"})," fa\xe7ade already uses internal helpers like ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat(...)"})," and ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot(...)"})," (see ",(0,r.jsx)(n.code,{children:"packages/core/src/game.ts"}),"), but those helpers are not themselves part of the stable exports."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Shells and test harnesses that need:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["deterministic snapshot building (i.e., caller-supplied timestamps, not ",(0,r.jsx)(n.code,{children:"Date.now()"}),"),"]}),"\n",(0,r.jsx)(n.li,{children:"validation + migration for unknown save payloads (JSON loaded from disk/IndexedDB),"}),"\n",(0,r.jsxs)(n.li,{children:["or custom wiring around ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," / ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),"\nmust currently import helpers from ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," (or duplicate logic)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["This defeats ",(0,r.jsx)(n.code,{children:"no-restricted-imports"})," for app-facing packages and couples shells to internal module organization."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forces"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep the stable public API (",(0,r.jsx)(n.code,{children:"@idle-engine/core"}),") intentionally small (per ",(0,r.jsx)(n.code,{children:"packages/core/README.md"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Provide a supported path for hosts/shells without forcing them to opt into \u201cinternals\u201d (no stability guarantees)."}),"\n",(0,r.jsx)(n.li,{children:"Preserve deterministic simulation expectations (especially for CI + test harnesses)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Provide a supported public entry point for host/shell/test-harness integrations that need save parsing + deterministic snapshot helpers."}),"\n",(0,r.jsxs)(n.li,{children:["Enable ",(0,r.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," to avoid ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," and remove any eslint escape hatches."]}),"\n",(0,r.jsx)(n.li,{children:"Keep determinism-first workflows ergonomic (callers can supply timestamps derived from step/stepSizeMs)."}),"\n",(0,r.jsxs)(n.li,{children:["Keep the stable ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})," entry point small by making the harness surface explicit."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replacing ",(0,r.jsx)(n.code,{children:"createGame(...)"})," or redesigning the runtime wiring model."]}),"\n",(0,r.jsx)(n.li,{children:"Changing the save schema or migration system."}),"\n",(0,r.jsx)(n.li,{children:"Extracting a new package unless the subpath export approach proves insufficient."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Primary Stakeholders"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Runtime/core maintainers (",(0,r.jsx)(n.code,{children:"packages/core"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Shell maintainers (",(0,r.jsx)(n.code,{children:"packages/shell-desktop"}),", future shells)"]}),"\n",(0,r.jsxs)(n.li,{children:["Tooling maintainers (",(0,r.jsx)(n.code,{children:"tools/*"})," consumers that may also benefit from a supported harness surface)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Roles"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docs Agent"}),": Maintain this design doc and keep references current."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Core API Agent"}),": Implement ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," and ensure exports/types are correct for both browser + Node resolution."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shell Migration Agent"}),": Update ",(0,r.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," to use the supported harness API and remove eslint disables."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Agent"}),": Add focused unit tests that prevent the harness entry point from regressing."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/core"})," (new subpath export + source entrypoint)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"packages/shell-desktop"})," (import migration; remove eslint escape hatch)"]}),"\n",(0,r.jsxs)(n.li,{children:["(Optional) ",(0,r.jsx)(n.code,{children:"tools/runtime-sim"}),", ",(0,r.jsx)(n.code,{children:"tools/economy-verification"})," (follow-up migration away from ",(0,r.jsx)(n.code,{children:"core/internals"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility Considerations"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Additive change: new subpath export only; no breaking changes to existing entry points."}),"\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," semantics unchanged for engine contributors."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/core"})," exports runtime wiring (",(0,r.jsx)(n.code,{children:"IdleEngineRuntime"}),", ",(0,r.jsx)(n.code,{children:"createGameRuntime"}),", ",(0,r.jsx)(n.code,{children:"wireGameRuntime"}),") and the high-level ",(0,r.jsx)(n.code,{children:"createGame(...)"})," fa\xe7ade (",(0,r.jsx)(n.code,{children:"packages/core/src/index.browser.ts"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createGame(...)"})," implements:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hydrate(save: unknown)"})," by calling ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat(save)"})," (save validation + migration)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"getSnapshot()"})," by calling ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot(step, Date.now(), coordinator.state)"})," (non-deterministic timestamp).\nThese helpers live in ",(0,r.jsx)(n.code,{children:"packages/core/src/game-state-save.ts"})," and ",(0,r.jsx)(n.code,{children:"packages/core/src/progression.ts"})," but are not exposed on the stable entry point."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Consumers that need the same primitives (especially deterministic snapshot timestamps, or save parsing when using ",(0,r.jsx)(n.code,{children:"createGameRuntime"})," directly) have no supported import path besides ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,r.jsx)(n.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a new, browser-safe harness entry point: ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Export a minimal set of integration helpers that shells/test harnesses need:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Save parsing/validation + migration: ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"})," (and related types)"]}),"\n",(0,r.jsxs)(n.li,{children:["Deterministic snapshot building: ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"})," (and related types)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Keep the stable entry point (",(0,r.jsx)(n.code,{children:"@idle-engine/core"}),") unchanged; harness is an opt-in \u201cadvanced integration\u201d surface that remains supported and documented."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime Changes"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add new entrypoint modules under ",(0,r.jsx)(n.code,{children:"packages/core/src/"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"harness.browser.ts"}),": browser-safe exports"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"harness.ts"}),": Node entrypoint that re-exports ",(0,r.jsx)(n.code,{children:"harness.browser"})," (mirrors the existing ",(0,r.jsx)(n.code,{children:"internals.ts"})," pattern)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"packages/core/package.json"})," ",(0,r.jsx)(n.code,{children:"exports"})," map to include ",(0,r.jsx)(n.code,{children:"./harness"})," (both ",(0,r.jsx)(n.code,{children:"browser"})," and ",(0,r.jsx)(n.code,{children:"default"})," conditions), emitting ",(0,r.jsx)(n.code,{children:"dist/harness(.browser).js"})," and ",(0,r.jsx)(n.code,{children:".d.ts"})," via the existing ",(0,r.jsx)(n.code,{children:"tsc"})," build."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data & Schemas"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No save schema changes. The harness entry point exposes the existing save loader API that already supports schema migrations."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"APIs & Contracts"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," exports:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat(value, options?)"})," for validating + migrating unknown save payloads into ",(0,r.jsx)(n.code,{children:"GameStateSaveFormat"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"buildProgressionSnapshot(step, nowMs, state)"})," for deterministic snapshot materialization."]}),"\n",(0,r.jsx)(n.li,{children:"The narrow set of types needed by these helpers (type exports only)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Shells can then:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["parse a save from disk via ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat(JSON.parse(fileContents))"}),","]}),"\n",(0,r.jsxs)(n.li,{children:["hydrate the wired runtime via ",(0,r.jsx)(n.code,{children:"GameRuntimeWiring.hydrate(parsedSave, { currentStep: parsedSave.runtime.step })"}),","]}),"\n",(0,r.jsxs)(n.li,{children:["and build snapshots using a deterministic clock (e.g., ",(0,r.jsx)(n.code,{children:"nowMs = step * stepSizeMs"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling & Automation"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["No eslint rule changes required: ",(0,r.jsx)(n.code,{children:"@idle-engine/config-eslint"})," only restricts ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),", so ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," is automatically permitted."]}),"\n",(0,r.jsxs)(n.li,{children:["Add a small unit test in ",(0,r.jsx)(n.code,{children:"packages/core"})," that imports from ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," and smoke-checks the main exports (prevents export-map drift)."]}),"\n",(0,r.jsxs)(n.li,{children:["Update documentation (",(0,r.jsx)(n.code,{children:"packages/core/README.md"})," and/or ",(0,r.jsx)(n.code,{children:"docs/idle-engine-design.md"}),") to list and describe the harness entry point."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deployment"}),": Additive API surface; consumers can migrate incrementally."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry & Observability"}),": N/A."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security & Compliance"}),": No new data classes; harness exposes existing save validation and snapshot builders."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,r.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Issue Title"}),(0,r.jsx)(n.th,{children:"Scope Summary"}),(0,r.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,r.jsx)(n.th,{children:"Dependencies"}),(0,r.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"feat(core): add @idle-engine/core/harness entrypoint"})}),(0,r.jsxs)(n.td,{children:["Add new ",(0,r.jsx)(n.code,{children:"harness(.browser)"})," entrypoint(s) and export map wiring; re-export save loader + snapshot builder and required types."]}),(0,r.jsx)(n.td,{children:"Core API Agent"}),(0,r.jsx)(n.td,{children:"Doc approval"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," is importable (Node + browser conditions); exports include ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"})," and ",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"}),"; build passes without editing ",(0,r.jsx)(n.code,{children:"dist/**"})," by hand."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"refactor(shell-desktop): migrate runtime harness imports"})}),(0,r.jsxs)(n.td,{children:["Update shell/test harness code to use ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," (and/or stable ",(0,r.jsx)(n.code,{children:"@idle-engine/core"}),") instead of ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"; remove eslint disables."]}),(0,r.jsx)(n.td,{children:"Shell Migration Agent"}),(0,r.jsx)(n.td,{children:"Core harness entrypoint"}),(0,r.jsxs)(n.td,{children:["No ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," imports remain in ",(0,r.jsx)(n.code,{children:"packages/shell-desktop"}),"; any eslint escape hatches for ",(0,r.jsx)(n.code,{children:"no-restricted-imports"})," are removed; ",(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/shell-desktop"})," passes."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"test(core): add harness export smoke coverage"})}),(0,r.jsx)(n.td,{children:"Add a minimal Vitest suite that imports the harness entry point and verifies key exports exist and behave at a basic level."}),(0,r.jsx)(n.td,{children:"Test Agent"}),(0,r.jsx)(n.td,{children:"Core harness entrypoint"}),(0,r.jsx)(n.td,{children:"New test fails if the harness export map breaks; test runs deterministically with no console noise."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docs(core): document harness entrypoint"})}),(0,r.jsxs)(n.td,{children:["Document the new supported harness surface and when to use it vs ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})," vs ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"."]}),(0,r.jsx)(n.td,{children:"Docs Agent"}),(0,r.jsx)(n.td,{children:"Core harness entrypoint"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"packages/core/README.md"})," lists ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," and describes intended usage; design doc references stay current."]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 1"}),": Implement ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"}),", migrate ",(0,r.jsx)(n.code,{children:"shell-desktop"}),", add tests, and document the new entry point (single PR is preferred)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Phase 2"})," (optional): Migrate tooling that currently imports from ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," to ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," where appropriate; leave true contributor-only tooling on ",(0,r.jsx)(n.code,{children:"internals"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hand-off Package"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Issue 848 body for context and acceptance criteria."}),"\n",(0,r.jsxs)(n.li,{children:["Existing internal helpers:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Save loader: ",(0,r.jsx)(n.code,{children:"packages/core/src/game-state-save.ts"})," (",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Snapshot builder: ",(0,r.jsx)(n.code,{children:"packages/core/src/progression.ts"})," (",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Existing fa\xe7ade that already uses these helpers: ",(0,r.jsx)(n.code,{children:"packages/core/src/game.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Consumer package: ",(0,r.jsx)(n.code,{children:"packages/shell-desktop"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication Cadence"}),": One reviewer pass after the harness API is proposed; confirm naming + export set before finishing the migration."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Context Packets"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Review ",(0,r.jsx)(n.code,{children:"packages/core/README.md"})," and ",(0,r.jsx)(n.code,{children:"docs/idle-engine-design.md"})," entry point conventions (",(0,r.jsx)(n.code,{children:"core"})," vs ",(0,r.jsx)(n.code,{children:"core/internals"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Inspect ",(0,r.jsx)(n.code,{children:"packages/core/src/game.ts"})," to understand current save/snapshot behavior and determinism implications."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prompting & Constraints"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Do not edit checked-in ",(0,r.jsx)(n.code,{children:"dist/**"})," outputs by hand."]}),"\n",(0,r.jsx)(n.li,{children:"Keep exports minimal and \u201charness-focused\u201d to avoid growing an accidental second stable API."}),"\n",(0,r.jsxs)(n.li,{children:["Use type-only exports (",(0,r.jsx)(n.code,{children:"export type { ... }"}),") for types; the repo enforces ",(0,r.jsx)(n.code,{children:"consistent-type-imports/exports"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Avoid console output in tests (Vitest LLM reporter expects clean output)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safety Rails"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prefer additive exports over changing existing stable API behavior."}),"\n",(0,r.jsxs)(n.li,{children:["Avoid exporting broad internal modules (e.g., don\u2019t re-export ",(0,r.jsx)(n.code,{children:"internals"})," wholesale)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Hooks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm lint"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/shell-desktop"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Export the helpers directly from ",(0,r.jsx)(n.code,{children:"@idle-engine/core"})]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pros: simplest for consumers."}),"\n",(0,r.jsx)(n.li,{children:"Cons: grows the stable entry point and blurs the public vs advanced boundary."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Create a new package (e.g., ",(0,r.jsx)(n.code,{children:"@idle-engine/runtime-harness"}),")"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pros: clear dependency and stability boundary; avoids adding more subpath exports on core."}),"\n",(0,r.jsx)(n.li,{children:"Cons: more monorepo overhead (new package, build outputs, versioning) for what is primarily a curated re-export surface."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:"createGame(...)"})," everywhere"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pros: already stable; already performs save parsing and snapshot building."}),"\n",(0,r.jsxs)(n.li,{children:["Cons: ",(0,r.jsx)(n.code,{children:"createGame.getSnapshot()"})," currently uses ",(0,r.jsx)(n.code,{children:"Date.now()"})," and hides some knobs needed for deterministic shells/harnesses; also forces the higher-level command fa\xe7ade where lower-level wiring is desired."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit / Integration"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a new ",(0,r.jsx)(n.code,{children:"packages/core/src/harness.test.ts"})," (or colocated ",(0,r.jsx)(n.code,{children:"*.test.ts"}),") that imports from ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," and asserts:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"})," loads a minimal valid save (or throws on invalid shape)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"})," returns a snapshot with expected step/time fields for a small coordinator state fixture."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Run:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/core"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"pnpm test --filter @idle-engine/shell-desktop"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": N/A (exports only)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tooling / A11y"}),": N/A."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API creep"}),": Harness becomes a dumping ground of semi-public internals.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mitigation: Keep the export list narrowly focused on shell/test harness needs; document intended usage."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stability expectations"}),": Consumers might assume harness is as stable as the base entry point.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: Document stability expectations explicitly in ",(0,r.jsx)(n.code,{children:"packages/core/README.md"})," and JSDoc tags on ",(0,r.jsx)(n.code,{children:"harness"})," entrypoint(s)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Export map drift"}),": Subpath exports can break with build output or tooling changes.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Mitigation: Add an explicit unit test importing ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," to catch broken exports in CI."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milestones"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," entrypoint and document it."]}),"\n",(0,r.jsxs)(n.li,{children:["Migrate ",(0,r.jsx)(n.code,{children:"@idle-engine/shell-desktop"})," away from ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Optional: migrate additional shells/tools where appropriate."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Migration Strategy"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["No schema migrations required; existing save migration behavior is reused by exporting ",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:"@idle-engine/core/internals"})," available for engine contributors and true internal tooling."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communication"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Update Issue 848 with the final chosen entrypoint name and a short example snippet for shells (import paths + deterministic timestamp pattern)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Entry point name: ",(0,r.jsx)(n.code,{children:"@idle-engine/core/harness"})," vs ",(0,r.jsx)(n.code,{children:"@idle-engine/core/testing"})," vs ",(0,r.jsx)(n.code,{children:"@idle-engine/core/shell"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Export set: should the harness also export ",(0,r.jsx)(n.code,{children:"createProgressionCoordinator"})," (for custom wiring) or remain focused on save/snapshot helpers only?"]}),"\n",(0,r.jsxs)(n.li,{children:["Stability tag: should ",(0,r.jsx)(n.code,{children:"harness"})," be documented as ",(0,r.jsx)(n.code,{children:"stable"})," or ",(0,r.jsx)(n.code,{children:"experimental-but-supported"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Do we want to adjust ",(0,r.jsx)(n.code,{children:"createGame.getSnapshot()"})," to allow injecting a deterministic clock (follow-up), or keep determinism as a harness-only concern?"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Consider a small deterministic \u201cclock policy\u201d helper (e.g., ",(0,r.jsx)(n.code,{children:"stepToSimTimeMs(step, stepSizeMs)"}),") if multiple shells duplicate it."]}),"\n",(0,r.jsxs)(n.li,{children:["Migrate selected tooling (",(0,r.jsx)(n.code,{children:"tools/runtime-sim"}),", ",(0,r.jsx)(n.code,{children:"tools/economy-verification"}),") off ",(0,r.jsx)(n.code,{children:"core/internals"})," if they only use the harness subset."]}),"\n",(0,r.jsxs)(n.li,{children:["If the harness surface grows substantially, revisit extracting it into a dedicated ",(0,r.jsx)(n.code,{children:"@idle-engine/runtime-harness"})," package."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-references",children:"15. References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Issue 848: ",(0,r.jsx)(n.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/848",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/848"})]}),"\n",(0,r.jsxs)(n.li,{children:["Entry point conventions: ",(0,r.jsx)(n.code,{children:"packages/core/README.md"}),", ",(0,r.jsx)(n.code,{children:"docs/idle-engine-design.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["Save parsing + migrations: ",(0,r.jsx)(n.code,{children:"packages/core/src/game-state-save.ts"})," (",(0,r.jsx)(n.code,{children:"loadGameStateSaveFormat"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Snapshot building: ",(0,r.jsx)(n.code,{children:"packages/core/src/progression.ts"})," (",(0,r.jsx)(n.code,{children:"buildProgressionSnapshot"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Existing fa\xe7ade usage: ",(0,r.jsx)(n.code,{children:"packages/core/src/game.ts"})," (",(0,r.jsx)(n.code,{children:"hydrate"}),", ",(0,r.jsx)(n.code,{children:"getSnapshot"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["ESLint restriction: ",(0,r.jsx)(n.code,{children:"packages/config-eslint/index.js"})," (",(0,r.jsx)(n.code,{children:"restrictCoreInternals"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Harness"}),": A supported integration surface used by shells, simulations, and tests to wire runtimes, parse saves, and materialize snapshots without depending on unstable engine internals."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shell"}),": A host application (desktop/web) embedding the engine runtime and renderer."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deterministic time"}),": A clock model where \u201cnow\u201d is derived from simulation step/stepSizeMs, not wall clock (",(0,r.jsx)(n.code,{children:"Date.now()"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Date"}),(0,r.jsx)(n.th,{children:"Author"}),(0,r.jsx)(n.th,{children:"Change Summary"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2026-01-26"}),(0,r.jsx)(n.td,{children:"Codex (AI)"}),(0,r.jsx)(n.td,{children:"Initial draft for Issue 848."})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);