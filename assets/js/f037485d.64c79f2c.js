"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[2640],{7678:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>d});var i=n(9430);const l={},r=i.createContext(l);function t(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:s},e.children)}},9548:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"issue-857-design","title":"shell-desktop: embed MCP server for AI agent workflows (Issue 857)","description":"Document Control","source":"@site/../../docs/issue-857-design.md","sourceDirName":".","slug":"/issue-857-design","permalink":"/Idle-Game-Engine/issue-857-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-857-design.md","tags":[],"version":"current","sidebarPosition":99,"frontMatter":{"title":"shell-desktop: embed MCP server for AI agent workflows (Issue 857)","sidebar_position":99}}');var l=n(5270),r=n(7678);const t={title:"shell-desktop: embed MCP server for AI agent workflows (Issue 857)",sidebar_position:99},d="shell-desktop: embed MCP server for AI agent workflows (Issue 857)",o={},c=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Architecture Overview",id:"61-architecture-overview",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"7.3 Coordination Notes",id:"73-coordination-notes",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2},{value:"15. References",id:"15-references",level:2},{value:"Appendix A \u2014 Glossary",id:"appendix-a--glossary",level:2},{value:"Appendix B \u2014 Change Log",id:"appendix-b--change-log",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"shell-desktop-embed-mcp-server-for-ai-agent-workflows-issue-857",children:"shell-desktop: embed MCP server for AI agent workflows (Issue 857)"})}),"\n",(0,l.jsx)(s.h2,{id:"document-control",children:"Document Control"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Title"}),": Integrate an embedded MCP server into ",(0,l.jsx)(s.code,{children:"@idle-engine/shell-desktop"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Authors"}),": Ralph (AI)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Reviewers"}),": @hansjm10"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Status"}),": Draft"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Last Updated"}),": 2026-01-27"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Related Issues"}),": ",(0,l.jsx)(s.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/857",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/857"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,l.jsxs)(s.p,{children:["Add an embedded Model Context Protocol (MCP) server to the Electron desktop shell (",(0,l.jsx)(s.code,{children:"@idle-engine/shell-desktop"}),") so AI agents (Claude Desktop, Cursor, etc.) can programmatically control the simulation, inject inputs, inspect state/diagnostics, capture screenshots, and interact with replays/assets during development and testing. The MCP server runs in the Electron main process, is opt-in (dev-only by default), exposes a constrained tool surface, and bridges to the sim worker and ",(0,l.jsx)(s.code,{children:"BrowserWindow"})," APIs through typed handlers with unit test coverage."]}),"\n",(0,l.jsx)(s.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Background"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["The repo already has a first-party Electron shell and WebGPU renderer pathway (see ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.ts"})," and ",(0,l.jsx)(s.code,{children:"docs/desktop-shell-webgpu-renderer-replay-design-issue-778.md"}),")."]}),"\n",(0,l.jsxs)(s.li,{children:["The shell runs a sim worker (",(0,l.jsx)(s.code,{children:"node:worker_threads"}),") driven by a tick loop in the main process and forwards frames to the renderer via typed IPC (",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/ipc.ts"}),")."]}),"\n",(0,l.jsx)(s.li,{children:"The Model Context Protocol (MCP) is emerging as a standard for agent-to-tool integrations, with growing ecosystem support in agent UIs."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Problem"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["There is no supported, automation-friendly API for external tools/agents to control the shell or introspect runtime state, which limits:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"automated regression workflows (\u201cdrive sim \u2192 capture state/screenshot \u2192 assert\u201d),"}),"\n",(0,l.jsx)(s.li,{children:"interactive debug assistance (\u201cinspect live state when issue reported\u201d),"}),"\n",(0,l.jsx)(s.li,{children:"AI-assisted content iteration (\u201cpreview changes quickly with scripted steps\u201d)."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:"Existing \u201cElectron MCP servers\u201d typically rely on Chrome DevTools Protocol (CDP) and remote-debug flags, which do not provide direct access to the shell\u2019s typed IPC channels, sim worker messaging, or deterministic command queue."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Forces"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Preserve determinism: control APIs must not introduce nondeterministic side effects into simulation."}),"\n",(0,l.jsx)(s.li,{children:"Safety: the server must be local-only, opt-in, and constrained (no arbitrary file/process access)."}),"\n",(0,l.jsx)(s.li,{children:"Keep the integration maintainable: tool inputs/outputs should be validated and testable without launching a full Electron UI."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Goals"}),":","\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsx)(s.li,{children:"Provide an embedded MCP server in the Electron main process that can be enabled via flag/env var."}),"\n",(0,l.jsxs)(s.li,{children:["Expose a type-validated tool surface for:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"simulation lifecycle and stepping,"}),"\n",(0,l.jsx)(s.li,{children:"command enqueueing / control-event injection,"}),"\n",(0,l.jsx)(s.li,{children:"window inspection and screenshot capture,"}),"\n",(0,l.jsx)(s.li,{children:"asset listing/reading (compiled assets only),"}),"\n",(0,l.jsx)(s.li,{children:"(phase 2) replay IO and basic state inspection/query."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Ensure handlers are testable with existing ",(0,l.jsx)(s.code,{children:"vitest"})," mocking patterns (similar to ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.test.ts"}),")."]}),"\n",(0,l.jsx)(s.li,{children:"Document how to configure common agent clients (Claude Desktop, Cursor) to connect."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Non-Goals"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Exposing privileged OS automation (global keyboard/mouse, filesystem writes outside controlled directories, process spawning)."}),"\n",(0,l.jsx)(s.li,{children:"Running an always-on automation endpoint in production builds by default."}),"\n",(0,l.jsx)(s.li,{children:"Guaranteeing a stable \u201cfull game state schema\u201d immediately; state surfaces may start as a debug snapshot and evolve."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Primary Stakeholders"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Shell maintainers (",(0,l.jsx)(s.code,{children:"packages/shell-desktop"}),")"]}),"\n",(0,l.jsxs)(s.li,{children:["Runtime/core maintainers (",(0,l.jsx)(s.code,{children:"packages/core"}),") for command/replay/state abstractions"]}),"\n",(0,l.jsx)(s.li,{children:"Docs/tooling maintainers (agent integration docs; local dev workflows)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Agent Roles"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Runtime/Shell Agent"}),": Implement MCP server lifecycle + bridging to shell components."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tool Handler Agent"}),": Implement tool schemas + handlers (sim/window/input/state/replay/asset)."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Test Agent"}),": Add deterministic unit tests for handlers and transport plumbing."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Docs Agent"}),": Document setup for agent clients and provide example prompts/workflows."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Affected Packages/Services"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"packages/shell-desktop"})," (new MCP server module and integration wiring)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"packages/core"})," (potentially: expose additional replay/state helpers if needed)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"docs/"})," (new design doc + connection/setup instructions)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Compatibility Considerations"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["The server must be disabled by default and bound to ",(0,l.jsx)(s.code,{children:"localhost"})," when enabled."]}),"\n",(0,l.jsx)(s.li,{children:"Tool contracts should be versioned (server \u201ccapabilities\u201d include a version string) so clients can adapt."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.ts"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["creates a sandboxed ",(0,l.jsx)(s.code,{children:"BrowserWindow"})," and loads ",(0,l.jsx)(s.code,{children:"renderer/index.html"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["drives a ",(0,l.jsx)(s.code,{children:"Worker"})," (",(0,l.jsx)(s.code,{children:"./sim-worker.js"}),") via a main-process tick loop (",(0,l.jsx)(s.code,{children:"setInterval"}),"), forwarding ",(0,l.jsx)(s.code,{children:"RenderCommandBuffer"})," frames to the renderer over IPC."]}),"\n",(0,l.jsxs)(s.li,{children:["handles IPC:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ping"})," and ",(0,l.jsx)(s.code,{children:"readAsset"})," as invoke handlers,"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"controlEvent"})," as a fire-and-forget event mapped into runtime commands."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/sim-worker.ts"})," and ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/sim/sim-runtime.ts"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["implement a simple sim runtime (",(0,l.jsx)(s.code,{children:"IdleEngineRuntime"}),") and accept ",(0,l.jsx)(s.code,{children:"tick"})," + ",(0,l.jsx)(s.code,{children:"enqueueCommands"})," messages."]}),"\n",(0,l.jsx)(s.li,{children:"do not currently expose a request/response RPC for \u201cget status/state\u201d from the main process."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Tests exist for the main process behavior and IPC contracts (",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.test.ts"}),", ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/ipc.test.ts"}),") and demonstrate a mocking approach suitable for MCP tool handler tests."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,l.jsx)(s.h3,{id:"61-architecture-overview",children:"6.1 Architecture Overview"}),"\n",(0,l.jsx)(s.p,{children:"Embed an MCP server in the Electron main process and bridge its tools to existing shell primitives:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:"AI Client (Claude/Cursor)\n  \u2502  MCP (SSE/HTTP on localhost)\n  \u25bc\nElectron main process\n  - MCP server + tool handlers\n  - BrowserWindow control (screenshot/devtools/resize)\n  - Sim worker controller (pause/resume/step/enqueue)\n  \u2502\n  \u25bc\nSim worker (node:worker_threads)\n  - Sim runtime (IdleEngineRuntime)\n  - Optional debug/state RPC\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Transport (current implementation): ",(0,l.jsx)(s.strong,{children:"SSE/HTTP on localhost"})," (recommended for \u201cattach to a running app\u201d workflows). Stdio is not implemented yet."]}),"\n",(0,l.jsx)(s.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Runtime Changes"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Introduce a new module in ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/mcp/"})," that:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["constructs an MCP server using ",(0,l.jsx)(s.code,{children:"@modelcontextprotocol/sdk"}),","]}),"\n",(0,l.jsx)(s.li,{children:"registers tools and their input/output schemas,"}),"\n",(0,l.jsx)(s.li,{children:"binds handlers to a \u201cshell context\u201d object (main window + sim controller)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Extend the existing sim worker controller to support:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"pause"}),"/",(0,l.jsx)(s.code,{children:"resume"})," by stopping/restarting the main-process tick loop,"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"step(n)"})," while paused by sending ",(0,l.jsx)(s.code,{children:"tick"})," messages with deterministic ",(0,l.jsx)(s.code,{children:"deltaMs"})," (",(0,l.jsx)(s.code,{children:"stepSizeMs * n"})," or repeated single-step ticks),"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"start"}),"/",(0,l.jsx)(s.code,{children:"stop"})," by creating/terminating the sim worker and emitting sim status updates."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Add a minimal request/response RPC between main process and sim worker for debug/state queries:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"getStatus"})," \u2192 ",(0,l.jsx)(s.code,{children:"{ stepSizeMs, nextStep, running, paused }"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"getDebugState"})," \u2192 JSON-friendly snapshot (initially demo-only, expandable)."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Data & Schemas"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Define tool inputs/outputs as JSON-serializable shapes; treat \u201cstate snapshots\u201d as debug-only payloads and avoid leaking internal object graphs."}),"\n",(0,l.jsxs)(s.li,{children:["Add a server \u201ccapabilities\u201d response (or tool) that includes:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"serverVersion"}),","]}),"\n",(0,l.jsx)(s.li,{children:"supported tool list,"}),"\n",(0,l.jsx)(s.li,{children:"feature flags (e.g., replay support enabled)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"APIs & Contracts"})," (initial tool set; names stable, schemas versioned):","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"sim/status"}),": current sim status + step/stepSizeMs."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"sim/start"})," / ",(0,l.jsx)(s.code,{children:"sim/stop"}),": worker lifecycle control (dev only)."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"sim/pause"})," / ",(0,l.jsx)(s.code,{children:"sim/resume"})," / ",(0,l.jsx)(s.code,{children:"sim/step"}),": deterministic control of the tick loop."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"sim/enqueue"}),": enqueue runtime commands (validated + normalized similarly to ",(0,l.jsx)(s.code,{children:"normalizeCommand"})," in ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/sim/sim-runtime.ts"}),")."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"input/controlEvent"}),": send a ",(0,l.jsx)(s.code,{children:"ShellControlEvent"})," through the same path as IPC (",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/ipc.ts"}),"), ensuring parity with UI events."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"window/info"})," / ",(0,l.jsx)(s.code,{children:"window/resize"})," / ",(0,l.jsx)(s.code,{children:"window/devtools"})," / ",(0,l.jsx)(s.code,{children:"window/screenshot"}),": wrap ",(0,l.jsx)(s.code,{children:"BrowserWindow"})," operations (screenshot returns bounded base64 PNG)."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"asset/list"})," / ",(0,l.jsx)(s.code,{children:"asset/read"}),": list/read assets limited to the compiled assets root (reuse the path traversal checks in ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.ts"}),"\u2019s ",(0,l.jsx)(s.code,{children:"readAsset"})," handler logic)."]}),"\n",(0,l.jsxs)(s.li,{children:["(Phase 2) ",(0,l.jsx)(s.code,{children:"state/get"})," / ",(0,l.jsx)(s.code,{children:"state/query"}),": debug snapshot + path query for small state surfaces."]}),"\n",(0,l.jsxs)(s.li,{children:["(Phase 2) ",(0,l.jsx)(s.code,{children:"replay/*"}),": list/load/save/scrub/compare using existing replay formats from ",(0,l.jsx)(s.code,{children:"packages/core/src/replay/*"})," and a shell-local replay directory."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tooling & Automation"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Enable/disable via explicit env/flag (examples):","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"IDLE_ENGINE_ENABLE_MCP_SERVER=1"})}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"IDLE_ENGINE_MCP_PORT=..."})," (SSE)"]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"--enable-mcp-server"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"--mcp-port=..."})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:"Add an internal audit log (dev only) for tool invocations (tool name + sanitized args + timestamp)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Deployment"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Dev-only default: enable MCP server automatically when ",(0,l.jsx)(s.code,{children:"NODE_ENV=development"})," and the explicit env/flag is set."]}),"\n",(0,l.jsxs)(s.li,{children:["Production builds require explicit opt-in and bind to ",(0,l.jsx)(s.code,{children:"localhost"})," only."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Telemetry & Observability"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Log tool invocations (dev only) and optionally provide a ",(0,l.jsx)(s.code,{children:"debug/logs"})," tool that returns recent entries (bounded)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Security & Compliance"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Hard safety constraints:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["bind to ",(0,l.jsx)(s.code,{children:"127.0.0.1"})," only (SSE),"]}),"\n",(0,l.jsx)(s.li,{children:"strict allowlist of tool operations,"}),"\n",(0,l.jsx)(s.li,{children:"constrain filesystem reads to compiled assets and constrained replay directories,"}),"\n",(0,l.jsx)(s.li,{children:"no arbitrary command execution, no network proxying, no secrets export."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:"Optional: require a one-time session token printed to console (or shown in the UI) that clients must provide."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,l.jsx)(s.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"Issue Title"}),(0,l.jsx)(s.th,{children:"Scope Summary"}),(0,l.jsx)(s.th,{children:"Proposed Assignee/Agent"}),(0,l.jsx)(s.th,{children:"Dependencies"}),(0,l.jsx)(s.th,{children:"Acceptance Criteria"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"feat(shell-desktop): add embedded MCP server scaffold"})}),(0,l.jsx)(s.td,{children:"Add MCP server module, feature flagging, and a transport (SSE recommended first) with a minimal \u201chealth/capabilities\u201d tool."}),(0,l.jsx)(s.td,{children:"Runtime/Shell Agent"}),(0,l.jsx)(s.td,{children:"Doc approval"}),(0,l.jsx)(s.td,{children:"MCP server starts when enabled; binds to localhost; exposes at least one tool; unit tests cover tool registration and enable/disable behavior."})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"feat(shell-desktop): implement sim/* MCP tools"})}),(0,l.jsxs)(s.td,{children:["Implement ",(0,l.jsx)(s.code,{children:"sim/status"}),", ",(0,l.jsx)(s.code,{children:"sim/start"}),", ",(0,l.jsx)(s.code,{children:"sim/stop"}),", ",(0,l.jsx)(s.code,{children:"sim/pause"}),", ",(0,l.jsx)(s.code,{children:"sim/resume"}),", ",(0,l.jsx)(s.code,{children:"sim/step"}),", ",(0,l.jsx)(s.code,{children:"sim/enqueue"})," bridging to the sim worker controller."]}),(0,l.jsx)(s.td,{children:"Tool Handler Agent"}),(0,l.jsx)(s.td,{children:"MCP scaffold"}),(0,l.jsx)(s.td,{children:"Tools behave deterministically; invalid inputs are rejected; sim lifecycle is test-covered with worker/electron mocks."})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"feat(shell-desktop): implement window/* + input/* MCP tools"})}),(0,l.jsxs)(s.td,{children:["Implement window inspection/screenshot/resize/devtools and ",(0,l.jsx)(s.code,{children:"input/controlEvent"})," (and optional key/mouse helpers)."]}),(0,l.jsx)(s.td,{children:"Tool Handler Agent"}),(0,l.jsx)(s.td,{children:"MCP scaffold"}),(0,l.jsxs)(s.td,{children:["Screenshot returns PNG bytes/base64; window operations are local-only; ",(0,l.jsx)(s.code,{children:"input/controlEvent"})," matches existing IPC semantics; tests cover critical branches."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"feat(shell-desktop): implement asset/* MCP tools"})}),(0,l.jsxs)(s.td,{children:["Implement ",(0,l.jsx)(s.code,{children:"asset/list"})," and ",(0,l.jsx)(s.code,{children:"asset/read"})," limited to compiled assets root with robust path traversal protection."]}),(0,l.jsx)(s.td,{children:"Tool Handler Agent"}),(0,l.jsx)(s.td,{children:"MCP scaffold"}),(0,l.jsx)(s.td,{children:"Assets can be enumerated and read; path traversal is rejected; behavior is unit tested."})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"docs(shell-desktop): document MCP setup + example workflows"})}),(0,l.jsx)(s.td,{children:"Document enablement flags, Claude Desktop/Cursor config, and example prompts for regression, debugging, and content iteration."}),(0,l.jsx)(s.td,{children:"Docs Agent"}),(0,l.jsx)(s.td,{children:"Core tools implemented"}),(0,l.jsx)(s.td,{children:"Docs include a minimal quickstart; example prompts are provided; design doc references updated if scope changes."})]})]})]}),"\n",(0,l.jsx)(s.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Phase 1 (MVP)"}),": MCP scaffold + ",(0,l.jsx)(s.code,{children:"sim/*"}),", ",(0,l.jsx)(s.code,{children:"window/*"}),", ",(0,l.jsx)(s.code,{children:"input/*"}),", and ",(0,l.jsx)(s.code,{children:"asset/*"})," tools with unit tests and docs."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Phase 2"}),": Add ",(0,l.jsx)(s.code,{children:"state/*"})," (debug snapshot + query) and ",(0,l.jsx)(s.code,{children:"replay/*"})," tools once the shell has a stable replay IO surface."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Phase 3"}),": Hardening (token auth, richer diagnostics), and optional stdio transport if client demand requires it."]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"73-coordination-notes",children:"7.3 Coordination Notes"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Hand-off Package"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Source: ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.ts"}),", ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/sim-worker.ts"}),", ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/ipc.ts"}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["Reference designs: ",(0,l.jsx)(s.code,{children:"docs/desktop-shell-webgpu-renderer-replay-design-issue-778.md"}),", ",(0,l.jsx)(s.code,{children:"docs/automation-system-api.md"})," (agent/tooling conventions)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Communication Cadence"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Keep tools small and ship in slices; each PR should include handler tests and docs updates as appropriate."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Do not edit checked-in ",(0,l.jsx)(s.code,{children:"dist/**"})," outputs by hand; rely on package build scripts."]}),"\n",(0,l.jsxs)(s.li,{children:["Keep simulation deterministic: ",(0,l.jsx)(s.code,{children:"sim/step"})," and ",(0,l.jsx)(s.code,{children:"sim/enqueue"})," must not depend on wall-clock time (derive timestamps from ",(0,l.jsx)(s.code,{children:"step * stepSizeMs"})," like existing code)."]}),"\n",(0,l.jsx)(s.li,{children:"Prefer pure tool handlers with explicit validation and bounded outputs; avoid returning huge object graphs."}),"\n",(0,l.jsxs)(s.li,{children:["Validation hooks:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"pnpm lint"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"pnpm test --filter @idle-engine/shell-desktop"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"External CDP-based automation"})," (Playwright/CDP MCP servers): easy UI driving, but cannot directly access main-process APIs, sim worker wiring, or typed IPC; requires debug ports/flags."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Separate MCP bridge process"})," that talks to the app via custom IPC: keeps app cleaner but violates the \u201cembedded\u201d goal and adds operational complexity (discoverability, lifecycle coordination)."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Expose a bespoke HTTP API"}),": simpler technically, but loses MCP ecosystem interoperability and tool schema conventions."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Unit / Integration"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Add ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/mcp/*.test.ts"})," covering:","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"server enablement/disablement,"}),"\n",(0,l.jsx)(s.li,{children:"tool schema validation,"}),"\n",(0,l.jsxs)(s.li,{children:["handler behavior with mocked ",(0,l.jsx)(s.code,{children:"BrowserWindow"}),", ",(0,l.jsx)(s.code,{children:"Worker"}),", and tick loop."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["Add focused tests for path traversal protection (",(0,l.jsx)(s.code,{children:"asset/read"}),")."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Performance"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Ensure screenshot capture and asset reads are bounded; avoid large memory spikes (cap screenshot size or provide downscale option)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tooling / A11y"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["N/A (developer tooling), but ensure no extra console noise in tests that could break ",(0,l.jsx)(s.code,{children:"vitest-llm-reporter"})," output."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Security exposure"}),": Even localhost endpoints can be abused (malware/other local processes).","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Mitigation: opt-in flags, localhost bind, optional session token, strict allowlist."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"API creep"}),": tools expand to \u201cdo everything\u201d and become unmaintainable.","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Mitigation: phased roadmap; require design update for new tool categories."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Flaky tests / Electron coupling"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Mitigation: keep handlers pure; mock Electron/Worker layers like existing ",(0,l.jsx)(s.code,{children:"main.test.ts"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"State query ambiguity"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Mitigation: start with explicit debug snapshots and add stable state APIs only once schemas are ready."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsx)(s.li,{children:"Land MCP scaffold behind explicit enable flag."}),"\n",(0,l.jsxs)(s.li,{children:["Add core tool set (",(0,l.jsx)(s.code,{children:"sim/*"}),", ",(0,l.jsx)(s.code,{children:"window/*"}),", ",(0,l.jsx)(s.code,{children:"input/*"}),", ",(0,l.jsx)(s.code,{children:"asset/*"}),") with tests."]}),"\n",(0,l.jsx)(s.li,{children:"Document setup for common clients and provide example workflows."}),"\n",(0,l.jsx)(s.li,{children:"Iterate on state/replay tools once shell runtime IO surfaces stabilize."}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Transport"}),": SSE on localhost is implemented; do we need an additional transport (stdio/Streamable HTTP) for broader client compatibility?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Auth model"}),": Is a session token required even for localhost? How is it communicated (console vs UI)?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"State surface"}),": What is the \u201cblessed\u201d debug state snapshot for ",(0,l.jsx)(s.code,{children:"shell-desktop"})," today (demo state vs progression snapshot vs diagnostics timeline)?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Replay storage"}),": Where should replays live (repo-local dev folder vs ",(0,l.jsx)(s.code,{children:"app.getPath('userData')"}),") and what is the default format (JSONL per ",(0,l.jsx)(s.code,{children:"packages/core/src/replay/*"}),")?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tool scope"}),": Which \u201cproposed tools\u201d are required for the initial acceptance criteria vs follow-up phases (especially ",(0,l.jsx)(s.code,{children:"replay/*"})," and rich ",(0,l.jsx)(s.code,{children:"state/*"}),")?"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Add ",(0,l.jsx)(s.code,{children:"state/*"})," tools once a stable, JSON-friendly debug snapshot is defined for the shell runtime."]}),"\n",(0,l.jsxs)(s.li,{children:["Add ",(0,l.jsx)(s.code,{children:"replay/*"})," tools and integrate with the core replay pipeline (including compare tooling and visual regression hooks)."]}),"\n",(0,l.jsxs)(s.li,{children:["Add richer diagnostics tools (",(0,l.jsx)(s.code,{children:"diagnostics/timeline"}),", command failures/outcomes) if needed for debugging workflows."]}),"\n",(0,l.jsx)(s.li,{children:"Consider a \u201cstdio bridge\u201d helper if SSE is insufficient for some clients."}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"15-references",children:"15. References"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Issue: ",(0,l.jsx)(s.a,{href:"https://github.com/hansjm10/Idle-Game-Engine/issues/857",children:"https://github.com/hansjm10/Idle-Game-Engine/issues/857"})]}),"\n",(0,l.jsxs)(s.li,{children:["MCP: ",(0,l.jsx)(s.a,{href:"https://modelcontextprotocol.io/",children:"https://modelcontextprotocol.io/"})]}),"\n",(0,l.jsxs)(s.li,{children:["MCP TypeScript SDK: ",(0,l.jsx)(s.a,{href:"https://github.com/modelcontextprotocol/typescript-sdk",children:"https://github.com/modelcontextprotocol/typescript-sdk"})]}),"\n",(0,l.jsxs)(s.li,{children:["Electron security guide: ",(0,l.jsx)(s.a,{href:"https://www.electronjs.org/docs/latest/tutorial/security",children:"https://www.electronjs.org/docs/latest/tutorial/security"})]}),"\n",(0,l.jsxs)(s.li,{children:["Shell architecture: ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/main.ts"}),", ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/ipc.ts"}),", ",(0,l.jsx)(s.code,{children:"packages/shell-desktop/src/sim-worker.ts"})]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"appendix-a--glossary",children:"Appendix A \u2014 Glossary"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"MCP"}),": Model Context Protocol; a standard for tool-based integrations with AI agents."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"SSE"}),": Server-Sent Events; a simple HTTP streaming transport."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"CDP"}),": Chrome DevTools Protocol; remote debugging/automation protocol for Chromium."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"IPC"}),": Inter-process communication; here, Electron renderer \u2194 main process messaging."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"appendix-b--change-log",children:"Appendix B \u2014 Change Log"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"Date"}),(0,l.jsx)(s.th,{children:"Author"}),(0,l.jsx)(s.th,{children:"Change Summary"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"2026-01-27"}),(0,l.jsx)(s.td,{children:"Ralph (AI)"}),(0,l.jsx)(s.td,{children:"Initial draft."})]})})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);