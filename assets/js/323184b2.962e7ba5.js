"use strict";(globalThis.webpackChunk_idle_engine_docs=globalThis.webpackChunk_idle_engine_docs||[]).push([[7672],{7002:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"issue-775-design","title":"Document Cost Calculation Formulas","description":"Document Control","source":"@site/../../docs/issue-775-design.md","sourceDirName":".","slug":"/issue-775-design","permalink":"/Idle-Game-Engine/issue-775-design","draft":false,"unlisted":false,"editUrl":"https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/issue-775-design.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Document Cost Calculation Formulas","sidebar_position":4}}');var i=s(5270),t=s(7678);const r={title:"Document Cost Calculation Formulas",sidebar_position:4},o="Document Cost Calculation Formulas",d={},c=[{value:"Document Control",id:"document-control",level:2},{value:"1. Summary",id:"1-summary",level:2},{value:"2. Context &amp; Problem Statement",id:"2-context--problem-statement",level:2},{value:"3. Goals &amp; Non-Goals",id:"3-goals--non-goals",level:2},{value:"4. Stakeholders, Agents &amp; Impacted Surfaces",id:"4-stakeholders-agents--impacted-surfaces",level:2},{value:"5. Current State",id:"5-current-state",level:2},{value:"6. Proposed Solution",id:"6-proposed-solution",level:2},{value:"6.1 Documentation Updates",id:"61-documentation-updates",level:3},{value:"6.2 Detailed Design",id:"62-detailed-design",level:3},{value:"6.3 Operational Considerations",id:"63-operational-considerations",level:3},{value:"7. Work Breakdown &amp; Delivery Plan",id:"7-work-breakdown--delivery-plan",level:2},{value:"7.1 Issue Map",id:"71-issue-map",level:3},{value:"7.2 Milestones",id:"72-milestones",level:3},{value:"8. Agent Guidance &amp; Guardrails",id:"8-agent-guidance--guardrails",level:2},{value:"9. Alternatives Considered",id:"9-alternatives-considered",level:2},{value:"10. Testing &amp; Validation Plan",id:"10-testing--validation-plan",level:2},{value:"11. Risks &amp; Mitigations",id:"11-risks--mitigations",level:2},{value:"12. Rollout Plan",id:"12-rollout-plan",level:2},{value:"13. Open Questions",id:"13-open-questions",level:2},{value:"14. Follow-Up Work",id:"14-follow-up-work",level:2}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"document-cost-calculation-formulas",children:"Document Cost Calculation Formulas"})}),"\n",(0,i.jsx)(n.h2,{id:"document-control",children:"Document Control"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Title"}),": Document Cost Calculation Formulas"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authors"}),": Opencode (AI Agent)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reviewers"}),": TBD"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Status"}),": Draft"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Last Updated"}),": 2026-01-23"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Related Issues"}),": #775"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Execution Mode"}),": AI-led"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1-summary",children:"1. Summary"}),"\n",(0,i.jsxs)(n.p,{children:["This design document proposes documenting the exact mathematical formulas used to calculate generator and upgrade costs within the Idle Game Engine. The documentation will cover the various ",(0,i.jsx)(n.code,{children:"costCurve"})," types (exponential, linear, polynomial, etc.) and how ",(0,i.jsx)(n.code,{children:"costMultiplier"})," and upgrade effects are applied. This will enable content creators to accurately balance their games using spreadsheets or other external tools."]}),"\n",(0,i.jsx)(n.h2,{id:"2-context--problem-statement",children:"2. Context & Problem Statement"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Background"}),": The engine uses a flexible system for defining costs via ",(0,i.jsx)(n.code,{children:"costCurve"})," (which supports various mathematical functions) and ",(0,i.jsx)(n.code,{children:"costMultiplier"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),": The exact formulas are not documented. Content creators resort to trial-and-error or reverse-engineering to understand how costs scale with level, leading to unexpected values and inefficient balancing workflows. The issue reporter specifically noted confusion around the ",(0,i.jsx)(n.code,{children:"exponential"})," curve and how ",(0,i.jsx)(n.code,{children:"offset"})," applies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Forces"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Accuracy: The documentation must strictly reflect the runtime implementation."}),"\n",(0,i.jsx)(n.li,{children:"Clarity: Formulas should be expressed in standard mathematical notation where possible, alongside JSON examples."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-goals--non-goals",children:"3. Goals & Non-Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Goals"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Document the cost calculation flow in ",(0,i.jsx)(n.code,{children:"docs/content-dsl-usage-guidelines.md"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Provide explicit formulas for ",(0,i.jsx)(n.code,{children:"linear"}),", ",(0,i.jsx)(n.code,{children:"exponential"}),", ",(0,i.jsx)(n.code,{children:"polynomial"}),", ",(0,i.jsx)(n.code,{children:"constant"}),", and ",(0,i.jsx)(n.code,{children:"piecewise"})," curve types."]}),"\n",(0,i.jsxs)(n.li,{children:["Explain the role of ",(0,i.jsx)(n.code,{children:"costMultiplier"})," and runtime upgrade multipliers."]}),"\n",(0,i.jsxs)(n.li,{children:["Clarify the behavior of the ",(0,i.jsx)(n.code,{children:"offset"})," property in exponential curves (additive vs level-offset)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Non-Goals"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Changing the actual cost calculation logic."}),"\n",(0,i.jsx)(n.li,{children:"Implementing new formula types."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4-stakeholders-agents--impacted-surfaces",children:"4. Stakeholders, Agents & Impacted Surfaces"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Primary Stakeholders"}),": Content Creators / Game Designers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Agent Roles"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Documentation Agent"}),": Responsible for updating the markdown files."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Affected Packages/Services"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docs/"})," (documentation only)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Compatibility Considerations"}),": None (doc change only)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"5-current-state",children:"5. Current State"}),"\n",(0,i.jsx)(n.p,{children:"The cost calculation logic resides in:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/core/src/progression/generator-manager.ts"}),": Orchestrates the cost calculation, applying ",(0,i.jsx)(n.code,{children:"costMultiplier"})," and upgrade effects."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"packages/content-schema/src/base/formula-evaluator.ts"}),": Evaluates the raw ",(0,i.jsx)(n.code,{children:"NumericFormula"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The core logic is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"cost = evaluateNumericFormula(curve, { level: purchaseIndex }) * costMultiplier * upgradeMultiplier\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Where ",(0,i.jsx)(n.code,{children:"evaluateNumericFormula"})," behaves as follows:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exponential"}),": ",(0,i.jsx)(n.code,{children:"base * growth^level + offset"})," (where offset defaults to 0)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Linear"}),": ",(0,i.jsx)(n.code,{children:"base + slope * level"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Constant"}),": ",(0,i.jsx)(n.code,{children:"value"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-proposed-solution",children:"6. Proposed Solution"}),"\n",(0,i.jsx)(n.h3,{id:"61-documentation-updates",children:"6.1 Documentation Updates"}),"\n",(0,i.jsxs)(n.p,{children:['We will add a new section "Cost Calculation Formulas" to ',(0,i.jsx)(n.code,{children:"docs/content-dsl-usage-guidelines.md"})," (or ",(0,i.jsx)(n.code,{children:"docs/content-quick-reference.md"}),' as requested, but "Usage Guidelines" seems more appropriate for deep dives).']}),"\n",(0,i.jsx)(n.p,{children:"The section will detail:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generator Cost Formula"}),": ",(0,i.jsx)(n.code,{children:"FinalCost = BaseCostFromCurve * CostMultiplier * GlobalMultipliers"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Upgrade Cost Formula"}),": ",(0,i.jsx)(n.code,{children:"FinalCost = BaseCostFromCurve * CostMultiplier * RepeatableAdjustment"})," (no global multipliers; RepeatableAdjustment comes from ",(0,i.jsx)(n.code,{children:"repeatable.costCurve"})," for repeatable upgrades, defaults to 1 otherwise)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Curve Formulas"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exponential"}),": ",(0,i.jsx)(n.code,{children:"Cost(level) = base * growth^level + offset"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsxs)(n.em,{children:["Note: Explicitly clarify that ",(0,i.jsx)(n.code,{children:"offset"})," is added to the result, not the level."]})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Linear"}),": ",(0,i.jsx)(n.code,{children:"Cost(level) = base + slope * level"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Constant"}),": ",(0,i.jsx)(n.code,{children:"Cost(level) = value"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Polynomial"}),": ",(0,i.jsx)(n.code,{children:"Cost(level) = sum(coefficient_i * level^i)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),": JSON snippets + calculated values for levels 0, 1, 10."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"62-detailed-design",children:"6.2 Detailed Design"}),"\n",(0,i.jsx)(n.p,{children:"No code changes."}),"\n",(0,i.jsx)(n.h3,{id:"63-operational-considerations",children:"6.3 Operational Considerations"}),"\n",(0,i.jsx)(n.p,{children:"None."}),"\n",(0,i.jsx)(n.h2,{id:"7-work-breakdown--delivery-plan",children:"7. Work Breakdown & Delivery Plan"}),"\n",(0,i.jsx)(n.h3,{id:"71-issue-map",children:"7.1 Issue Map"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Issue Title"}),(0,i.jsx)(n.th,{children:"Scope Summary"}),(0,i.jsx)(n.th,{children:"Proposed Assignee/Agent"}),(0,i.jsx)(n.th,{children:"Dependencies"}),(0,i.jsx)(n.th,{children:"Acceptance Criteria"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"docs: add cost calculation formulas"}),(0,i.jsxs)(n.td,{children:["Update ",(0,i.jsx)(n.code,{children:"content-dsl-usage-guidelines.md"})," with formulas and examples"]}),(0,i.jsx)(n.td,{children:"General/Docs Agent"}),(0,i.jsx)(n.td,{children:"Design approval"}),(0,i.jsx)(n.td,{children:"Docs contain correct formulas matching code"})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"72-milestones",children:"7.2 Milestones"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Phase 1"}),": Update documentation."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"8-agent-guidance--guardrails",children:"8. Agent Guidance & Guardrails"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Context Packets"}),": ",(0,i.jsx)(n.code,{children:"packages/core/src/progression/generator-manager.ts"}),", ",(0,i.jsx)(n.code,{children:"packages/content-schema/src/base/formula-evaluator.ts"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation"}),": Ensure formulas in docs match the TS implementation exactly."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"9-alternatives-considered",children:"9. Alternatives Considered"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Changing the formula"}),": We could change ",(0,i.jsx)(n.code,{children:"exponential"})," to support ",(0,i.jsx)(n.code,{children:"growth^(level+offset)"}),", but that would break existing content or require a schema change. Better to just document the current behavior clearly."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"10-testing--validation-plan",children:"10. Testing & Validation Plan"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verification"}),": Manually verify the documented examples against a simple script or the existing unit tests in ",(0,i.jsx)(n.code,{children:"packages/core"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"11-risks--mitigations",children:"11. Risks & Mitigations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Risk"}),': Users might still be confused if they want "level offset" behavior.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mitigation"}),': Provide a "Common Patterns" subsection showing how to achieve level offset mathematically (e.g. adjust ',(0,i.jsx)(n.code,{children:"base"})," to ",(0,i.jsx)(n.code,{children:"base * growth^k"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"12-rollout-plan",children:"12. Rollout Plan"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Merge PR."}),"\n",(0,i.jsx)(n.li,{children:"Content creators will see updated docs."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"13-open-questions",children:"13. Open Questions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"None."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"14-follow-up-work",children:"14. Follow-Up Work"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"None."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},7678:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var l=s(9430);const i={},t=l.createContext(i);function r(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);