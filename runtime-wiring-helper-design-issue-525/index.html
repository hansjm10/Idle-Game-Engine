<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-runtime-wiring-helper-design-issue-525" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Runtime Wiring Helper — Standard Runtime Integration (issue-525) | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/runtime-wiring-helper-design-issue-525"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Runtime Wiring Helper — Standard Runtime Integration (issue-525) | Idle Engine Docs"><meta data-rh="true" name="description" content="Document Control"><meta data-rh="true" property="og:description" content="Document Control"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-wiring-helper-design-issue-525"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-wiring-helper-design-issue-525" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-wiring-helper-design-issue-525" hreflang="x-default"><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.e9f4ef78.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.267f9d33.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a class="navbar__item navbar__link" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><main class="docMainContainer_tfRv docMainContainerEnhanced_qAvX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Runtime Wiring Helper — Standard Runtime Integration (issue-525)</h1></header><h2 class="anchor anchorTargetStickyNavbar_EdDC" id="document-control">Document Control<a href="#document-control" class="hash-link" aria-label="Direct link to Document Control" title="Direct link to Document Control" translate="no">​</a></h2>
<ul>
<li class=""><strong>Title</strong>: Provide a standard runtime wiring helper (issue-525)</li>
<li class=""><strong>Authors</strong>: Idle Engine Design-Authoring Agent (AI)</li>
<li class=""><strong>Reviewers</strong>: Core Runtime Maintainers; Shell-Web Maintainers</li>
<li class=""><strong>Status</strong>: Draft</li>
<li class=""><strong>Last Updated</strong>: 2025-12-18</li>
<li class=""><strong>Related Issues</strong>: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/525" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/525</a>, <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/560" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/560</a></li>
<li class=""><strong>Execution Mode</strong>: AI-led</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-summary">1. Summary<a href="#1-summary" class="hash-link" aria-label="Direct link to 1. Summary" title="Direct link to 1. Summary" translate="no">​</a></h2>
<p>This design document addresses GitHub issue <strong>#525</strong> by introducing a first-class helper in <code>@idle-engine/core</code> that wires <code>IdleEngineRuntime</code> to <code>ProgressionCoordinator</code>, <code>ProductionSystem</code>, <code>AutomationSystem</code>, and standard command handlers in a deterministic, tested, and documented order. The helper reduces shell-specific glue code and prevents order-sensitive integration bugs by providing a canonical system sequence (including optional finalize/apply semantics) plus a reference manual wiring snippet for advanced shells that opt out.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-context--problem-statement">2. Context &amp; Problem Statement<a href="#2-context--problem-statement" class="hash-link" aria-label="Direct link to 2. Context &amp; Problem Statement" title="Direct link to 2. Context &amp; Problem Statement" translate="no">​</a></h2>
<ul>
<li class=""><strong>Background</strong>:<!-- -->
<ul>
<li class="">Shells currently wire runtime subsystems manually, including command queue/dispatcher, the progression coordinator, automation system, and per-step coordinator updates (example: <code>packages/shell-web/src/runtime.worker.ts:127</code>).</li>
<li class=""><code>IdleEngineRuntime.tick()</code> executes commands for <code>currentStep</code>, then runs added systems in registration order (<code>packages/core/src/index.ts:273</code>), making system ordering a correctness constraint.</li>
<li class="">Production can be integrated via <code>createProductionSystem</code>, including an opt-in finalize/apply mode (<code>applyViaFinalizeTick</code>) that requires <code>ResourceState.finalizeTick</code> ordering correctness (<code>packages/core/src/production-system.ts:309</code>).</li>
</ul>
</li>
<li class=""><strong>Problem</strong> (issue-525):<!-- -->
<ul>
<li class="">A typical game loop needs to connect:<!-- -->
<ul>
<li class="">Runtime step lifecycle (<code>IdleEngineRuntime</code>)</li>
<li class="">Progression updates aligned with runtime steps (<code>ProgressionCoordinator.updateForStep</code>)</li>
<li class="">Production execution order (especially when using finalize/apply semantics)</li>
<li class="">Automation execution order and unlock wiring (upgrade-granted automation ids)</li>
<li class="">Registration of standard command handlers (resource/generator/upgrade/prestige, plus automation control)</li>
</ul>
</li>
<li class="">Today this wiring is order-sensitive and re-implemented per shell/harness, which is easy to get wrong and hard to review consistently (examples: <code>packages/shell-web/src/runtime.worker.ts:127</code>, <code>packages/core/src/offline-catchup-command-handlers.test.ts:79</code>).</li>
</ul>
</li>
<li class=""><strong>Forces</strong>:<!-- -->
<ul>
<li class=""><strong>Determinism</strong>: Wiring must preserve deterministic step stamping and timestamps (see <code>docs/runtime-step-lifecycle.md:1</code>).</li>
<li class=""><strong>Performance</strong>: The helper must not impose per-step O(N) overhead beyond existing system work; it must be safe for offline catch-up and backlog processing.</li>
<li class=""><strong>API stability</strong>: The helper must be optional and additive; manual wiring remains supported (issue-525).</li>
<li class=""><strong>Correctness under backlog</strong>: <code>IdleEngineRuntime.tick()</code> may process multiple steps per invocation (<code>packages/core/src/index.ts:282</code>), so order-sensitive logic must remain correct under multi-step processing.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-goals--non-goals">3. Goals &amp; Non-Goals<a href="#3-goals--non-goals" class="hash-link" aria-label="Direct link to 3. Goals &amp; Non-Goals" title="Direct link to 3. Goals &amp; Non-Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Goals</strong>:<!-- -->
<ol>
<li class="">Implement issue-525 by adding a core-owned helper that produces a working, standard-wired runtime with minimal glue code.</li>
<li class="">Provide a <strong>canonical, documented system ordering</strong> for: progression updates, production, automation, and (when enabled) finalize/apply semantics.</li>
<li class="">Register standard command handlers as part of the wiring helper, including resource/generator/upgrade/prestige handlers and automation toggle handlers.</li>
<li class="">Add a unit test that asserts the helper’s system ordering and step-update semantics (issue-525 acceptance criteria).</li>
<li class="">Add documentation that includes a manual reference wiring snippet and diagram (issue-525 acceptance criteria).</li>
</ol>
</li>
<li class=""><strong>Non-Goals</strong>:<!-- -->
<ul>
<li class="">Replacing or rewriting <code>IdleEngineRuntime</code>’s tick loop semantics (out of scope for issue-525; only a helper/reference implementation is required).</li>
<li class="">Refactoring ProductionSystem to a command-only model (documented in older notes; not required to satisfy issue-525).</li>
<li class="">Building new shell-web UI panels or changing worker-bridge message schemas; only wiring simplification is in scope.</li>
<li class="">Standardizing tick scheduling, snapshot publication, or transport buffering; shells/harnesses remain responsible for publishing state (e.g., via <code>buildProgressionSnapshot</code>) and choosing a publish cadence.</li>
<li class="">Enforcing a single “one true” game loop for all shells; advanced shells may keep manual wiring (issue-525).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-stakeholders-agents--impacted-surfaces">4. Stakeholders, Agents &amp; Impacted Surfaces<a href="#4-stakeholders-agents--impacted-surfaces" class="hash-link" aria-label="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" title="Direct link to 4. Stakeholders, Agents &amp; Impacted Surfaces" translate="no">​</a></h2>
<ul>
<li class=""><strong>Primary Stakeholders</strong>:<!-- -->
<ul>
<li class="">Core Runtime Maintainers (API surface, determinism guarantees)</li>
<li class="">Shell-Web Maintainers (worker wiring, state publication cadence)</li>
<li class="">Content Authors (indirectly: fewer integration bugs in production/automation unlock flows)</li>
</ul>
</li>
<li class=""><strong>Agent Roles</strong> (AI-led execution):<!-- -->
<ul>
<li class=""><strong>Runtime Implementation Agent</strong>: implement helper API in <code>packages/core</code>, ensure exports across Node/browser entrypoints.</li>
<li class=""><strong>Test &amp; Determinism Agent</strong>: add unit/integration tests that assert system order and step-update semantics under multi-step <code>runtime.tick</code>.</li>
<li class=""><strong>Docs Agent</strong>: write manual wiring reference and ordering diagram; cross-link to relevant existing docs and code.</li>
<li class=""><strong>Shell Integration Agent</strong>: adopt the helper in <code>packages/shell-web</code> worker wiring (optional but recommended), ensuring no behavior regressions.</li>
</ul>
</li>
<li class=""><strong>Affected Packages/Services</strong>:<!-- -->
<ul>
<li class=""><code>packages/core</code> (new helper + tests + documentation references)</li>
<li class=""><code>packages/shell-web</code> (optional adoption; reduced wiring code)</li>
<li class=""><code>docs/</code> (new/updated documentation for standard wiring)</li>
</ul>
</li>
<li class=""><strong>Compatibility Considerations</strong>:<!-- -->
<ul>
<li class="">The helper is additive; existing manual wiring remains valid.</li>
<li class="">System IDs introduced by the helper must be stable and documented so tests, telemetry, and diagnostics timelines remain readable.</li>
<li class="">The helper must preserve existing step-stamping semantics (<code>runtime.getNextExecutableStep()</code> and <code>context.step + 1</code> patterns).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-current-state">5. Current State<a href="#5-current-state" class="hash-link" aria-label="Direct link to 5. Current State" title="Direct link to 5. Current State" translate="no">​</a></h2>
<ul>
<li class=""><strong>Runtime step lifecycle and system ordering</strong>:<!-- -->
<ul>
<li class="">Commands for <code>currentStep</code> execute before systems, and systems run in the order added (<code>packages/core/src/index.ts:309</code>, <code>packages/core/src/index.ts:373</code>).</li>
<li class="">Multi-step processing can occur in a single <code>tick(deltaMs)</code> call (<code>packages/core/src/index.ts:282</code>), so per-step wiring must be correct under backlog.</li>
</ul>
</li>
<li class=""><strong>Shell-web wiring today (manual, order-sensitive)</strong>:<!-- -->
<ul>
<li class="">Worker constructs queue/dispatcher/runtime, creates a progression coordinator, registers resource command handlers, wires automation system, and adds a coordinator update system that calls <code>updateForStep(step + 1, { events })</code> (<code>packages/shell-web/src/runtime.worker.ts:127</code>, <code>packages/shell-web/src/runtime.worker.ts:208</code>).</li>
<li class="">Production is not wired in the worker today, so other harnesses re-implement production ordering (example test harness: <code>packages/core/src/offline-catchup-command-handlers.test.ts:79</code>).</li>
</ul>
</li>
<li class=""><strong>Finalize/apply semantics are opt-in and integration-dependent</strong>:<!-- -->
<ul>
<li class=""><code>createProductionSystem</code> supports <code>applyViaFinalizeTick</code> which requires <code>resourceState.finalizeTick(deltaMs)</code> for balances to update (<code>packages/core/src/production-system.ts:309</code>).</li>
<li class=""><code>ResourceState.applyIncome/applyExpense</code> are additive per tick and therefore require a publish/reset once per tick after <code>snapshot({ mode: &#x27;publish&#x27; })</code> (<code>docs/resource-state-storage-design.md:455</code>, <code>packages/core/src/resource-state.ts:951</code>).</li>
<li class=""><code>buildProgressionSnapshot</code> currently calls <code>ResourceState.snapshot({ mode: &#x27;publish&#x27; })</code> and then <code>resetPerTickAccumulators()</code> as a side-effect (<code>packages/core/src/progression.ts:234</code>), which is convenient but can be misapplied when steps are processed in batches.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-architecture-overview">6.1 Architecture Overview<a href="#61-architecture-overview" class="hash-link" aria-label="Direct link to 6.1 Architecture Overview" title="Direct link to 6.1 Architecture Overview" translate="no">​</a></h3>
<ul>
<li class=""><strong>Narrative</strong>:<!-- -->
<ul>
<li class="">Implement issue-525 by adding a <strong>standard runtime wiring helper</strong> in <code>packages/core</code> that:<!-- -->
<ul>
<li class="">creates or wires <code>IdleEngineRuntime</code> + <code>ProgressionCoordinator</code></li>
<li class="">creates standard systems (<code>ProductionSystem</code>, <code>AutomationSystem</code>, coordinator update system)</li>
<li class="">registers standard command handlers</li>
<li class="">returns a small, inspectable wiring object that exposes the instantiated systems in canonical order</li>
</ul>
</li>
<li class="">The helper is optional; manual wiring remains supported and documented.</li>
</ul>
</li>
<li class=""><strong>Diagram</strong> (logical ordering; finalize/apply system is conditional):<!-- -->
<div class="language-mermaid codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-mermaid codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token plain">flowchart TD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  A[IdleEngineRuntime.tick step N] --&gt; B[Execute commands @ step N]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  B --&gt; C[System: ProductionSystem]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  C --&gt; D{applyViaFinalizeTick?}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  D -- yes --&gt; E[System: ResourceFinalizeSystem]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  D -- no --&gt; F[System: AutomationSystem]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  E --&gt; F[System: AutomationSystem]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  F --&gt; G[System: ProgressionCoordinatorUpdateSystem&lt;br/&gt;updateForStep(step+1)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  G --&gt; H[Runtime increments currentStep to N+1]</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-detailed-design">6.2 Detailed Design<a href="#62-detailed-design" class="hash-link" aria-label="Direct link to 6.2 Detailed Design" title="Direct link to 6.2 Detailed Design" translate="no">​</a></h3>
<ul>
<li class=""><strong>New Core API surface (issue-525)</strong>:<!-- -->
<ul>
<li class="">Add <code>createGameRuntime(options)</code> as the primary API for standard runtime integration (issue-525).</li>
<li class="">Add <code>wireGameRuntime(options)</code> as a lower-level primitive for shells that already constructed a runtime/coordinator but want canonical system wiring.</li>
<li class=""><code>createGameRuntime</code> constructs <code>CommandQueue</code>, <code>CommandDispatcher</code>, <code>IdleEngineRuntime</code>, and <code>ProgressionCoordinator</code>, then delegates to <code>wireGameRuntime</code> for system wiring + handler registration.</li>
<li class=""><code>wireGameRuntime</code> only wires systems + handlers; it does not own tick scheduling, worker messaging, or save/restore flows.</li>
<li class="">Step size alignment (determinism): <code>createGameRuntime</code> MUST use a single <code>stepSizeMs</code> value for both <code>IdleEngineRuntime</code> and <code>ProgressionCoordinator</code> (<code>stepDurationMs</code>). <code>wireGameRuntime</code> MUST validate alignment (or require the caller to pass the shared step size explicitly).</li>
<li class="">Provisional options (enough to satisfy issue-525 without over-scoping):<!-- -->
<ul>
<li class=""><code>content: NormalizedContentPack</code> (required)</li>
<li class=""><code>stepSizeMs?: number</code> (default: <code>100</code>)</li>
<li class=""><code>maxStepsPerFrame?: number</code> (default: <code>IdleEngineRuntime</code> default; when <code>applyViaFinalizeTick: true</code>, default becomes <code>1</code> unless explicitly set; see Section 13)</li>
<li class=""><code>initialProgressionState?: ProgressionAuthoritativeState</code> (optional; passed to <code>createProgressionCoordinator</code>)</li>
<li class=""><code>enableProduction?: boolean</code> (default: <code>content.generators.length &gt; 0</code>)</li>
<li class=""><code>enableAutomation?: boolean</code> (default: <code>content.automations.length &gt; 0</code>)</li>
<li class=""><code>enableTransforms?: boolean</code> (default: <code>content.transforms.length &gt; 0</code>)</li>
<li class=""><code>production?: { applyViaFinalizeTick?: boolean }</code> (default: <code>false</code>; see finalize/apply notes below)</li>
<li class=""><code>registerOfflineCatchup?: boolean</code> (default: <code>true</code>; see Section 13)</li>
</ul>
</li>
<li class="">Return a <code>GameRuntimeWiring</code> object that includes:<!-- -->
<ul>
<li class=""><code>runtime: IdleEngineRuntime</code></li>
<li class=""><code>coordinator: ProgressionCoordinator</code></li>
<li class=""><code>productionSystem?: ProductionSystem</code></li>
<li class=""><code>automationSystem?: ReturnType&lt;typeof createAutomationSystem&gt;</code></li>
<li class=""><code>transformSystem?: ReturnType&lt;typeof createTransformSystem&gt;</code></li>
<li class=""><code>systems: readonly System[]</code> (the exact system instances in the order added; used by tests and diagnostics)</li>
<li class=""><code>commandQueue: CommandQueue</code> and <code>commandDispatcher: CommandDispatcher</code> (or references via runtime getters)</li>
</ul>
</li>
</ul>
</li>
<li class=""><strong>Canonical system IDs and ordering</strong>:<!-- -->
<ul>
<li class="">The helper MUST add systems in a fixed, documented order matching the diagram above:<!-- -->
<ol>
<li class="">Production (if content has generators, and production is enabled)</li>
<li class="">Resource finalize (only when production is configured with <code>applyViaFinalizeTick: true</code>)</li>
<li class="">Automation (if content has automations, and automation is enabled)</li>
<li class="">Transforms (if content has transforms, and transforms are enabled)</li>
<li class="">Progression coordinator update system (always; provides step alignment)</li>
</ol>
</li>
<li class="">Ordering rationale:<!-- -->
<ul>
<li class="">Production runs before automation so resource mutations (or queued rates) are visible when automation evaluates thresholds.</li>
<li class="">When enabled, <code>resourceState.finalizeTick(deltaMs)</code> runs immediately after production so balances are applied before automation reads amounts.</li>
<li class="">Transform runs after automation to mirror shell-web wiring and ensure automation toggles/commands land before transform evaluation.</li>
<li class="">The coordinator update system runs last and uses <code>updateForStep(step + 1)</code> so achievement-derived unlocks/rewards (which are evaluated inside <code>updateForStep</code>) become visible starting the next tick, avoiding “unlock-and-fire” chains within the same step while preserving immediate command-side effects.</li>
</ul>
</li>
<li class="">Canonical system IDs (defaults; used by tests and diagnostics):<!-- -->
<ul>
<li class="">Production: <code>production</code> (default id from <code>createProductionSystem</code>)</li>
<li class="">Resource finalize: <code>resource-finalize</code> (new system owned by the helper)</li>
<li class="">Automation: <code>automation-system</code> (id from <code>createAutomationSystem</code>)</li>
<li class="">Transform: <code>transform-system</code> (id from <code>createTransformSystem</code>)</li>
<li class="">Coordinator update: <code>progression-coordinator</code> (matches <code>packages/shell-web/src/runtime.worker.ts:209</code>)</li>
</ul>
</li>
<li class="">The coordinator update system MUST call <code>coordinator.updateForStep(context.step + 1, { events: context.events })</code> to keep coordinator state aligned with the runtime’s <code>currentStep</code> after the tick completes (existing pattern: <code>packages/shell-web/src/runtime.worker.ts:208</code>).</li>
</ul>
</li>
<li class=""><strong>Standard system wiring details</strong>:<!-- -->
<ul>
<li class="">Production: wire <code>createProductionSystem</code> against coordinator generator state by mapping coordinator generators into <code>GeneratorProductionState</code> (notably: ensure <code>produces</code>/<code>consumes</code> are always arrays; see snippet below) and <code>coordinator.resourceState</code>.</li>
<li class="">Automation: wire <code>createAutomationSystem</code> using <code>commandQueue: runtime.getCommandQueue()</code>, <code>resourceState: createResourceStateAdapter(coordinator.resourceState)</code>, <code>conditionContext: coordinator.getConditionContext()</code>, and <code>isAutomationUnlocked: (id) =&gt; coordinator.getGrantedAutomationIds().has(id)</code>.</li>
<li class="">Transforms: wire <code>createTransformSystem</code> using <code>transforms: content.transforms</code>, <code>resourceState: createResourceStateAdapter(coordinator.resourceState)</code>, <code>conditionContext: coordinator.getConditionContext()</code>, and <code>stepDurationMs</code>.</li>
</ul>
</li>
<li class=""><strong>Finalize/apply semantics wiring</strong>:<!-- -->
<ul>
<li class="">When <code>applyViaFinalizeTick: true</code>, insert a <code>ResourceFinalizeSystem</code> immediately after production and before automation so that:<!-- -->
<ul>
<li class="">production can queue per-second rates (<code>applyIncome/applyExpense</code>)</li>
<li class=""><code>resourceState.finalizeTick(context.deltaMs)</code> applies balances before automation evaluates resource thresholds</li>
</ul>
</li>
<li class="">When <code>applyViaFinalizeTick: false</code>, do not add finalize system (avoid per-step O(resourceCount) finalize loops).</li>
<li class="">UI rate display note: when using the core <code>ResourceState</code> (supports <code>finalizeTick</code>), direct-apply production updates balances but does not populate <code>incomePerSecond</code> / <code>expensePerSecond</code> / <code>netPerSecond</code>, so <code>buildProgressionSnapshot(...).resources[].perTick</code> will remain <code>0</code> unless finalize/apply semantics (or alternative rate tracking) are used.</li>
<li class="">Multi-step tick constraint: per-second rate fields are additive and must be cleared once per tick after a <code>snapshot({ mode: &#x27;publish&#x27; })</code> + <code>resetPerTickAccumulators()</code> boundary (<code>docs/resource-state-storage-design.md:455</code>). When <code>applyViaFinalizeTick: true</code>, the integration MUST ensure that boundary occurs once per processed step; the simplest safe default is to keep <code>maxStepsPerFrame: 1</code> (or otherwise ensure only one step runs between resource publish/resets). Offline/backlog fast-forward can still run by looping ticks and publishing/resetting per step, forwarding only the final snapshot to the UI.</li>
<li class="">Documentation MUST explicitly state that per-second rate accumulators are additive and require a publish/reset per tick (<code>packages/core/src/resource-state.ts:951</code>), and link to <code>docs/resource-state-storage-design.md:455</code>.</li>
</ul>
</li>
<li class=""><strong>Standard command handler registration</strong>:<!-- -->
<ul>
<li class="">The helper MUST register:<!-- -->
<ul>
<li class=""><code>registerResourceCommandHandlers</code> with coordinator-derived evaluators (generator purchases + toggles, plus optional upgrade/prestige evaluators when present) (<code>packages/shell-web/src/runtime.worker.ts:170</code>).</li>
<li class=""><code>registerAutomationCommandHandlers</code> when automation is enabled (<code>packages/shell-web/src/runtime.worker.ts:215</code>).</li>
<li class=""><code>registerTransformCommandHandlers</code> when transforms are enabled (<code>packages/shell-web/src/runtime.worker.ts:225</code>).</li>
</ul>
</li>
<li class="">The helper SHOULD register <code>registerOfflineCatchupCommandHandler</code> by default (<code>registerOfflineCatchup: true</code>) and allow opting out for shells that manage offline reconciliation externally (<code>packages/shell-web/src/runtime.worker.ts:188</code>).</li>
</ul>
</li>
<li class=""><strong>Documentation deliverable (issue-525)</strong>:<!-- -->
<ul>
<li class="">This design doc MUST include:<!-- -->
<ul>
<li class="">A “use the helper” snippet</li>
<li class="">A “manual wiring reference” snippet showing the same ordering and required calls</li>
<li class="">A diagram of tick ordering and the <code>updateForStep(step + 1)</code> rationale</li>
</ul>
</li>
<li class="">This page MUST cross-link to existing lifecycle notes (<code>docs/runtime-step-lifecycle.md:1</code>) and the worker as a concrete example (<code>packages/shell-web/src/runtime.worker.ts:127</code>).</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_EdDC" id="example-snippets-for-review">Example snippets (for review)<a href="#example-snippets-for-review" class="hash-link" aria-label="Direct link to Example snippets (for review)" title="Direct link to Example snippets (for review)" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_EdDC" id="use-the-helper">Use the helper<a href="#use-the-helper" class="hash-link" aria-label="Direct link to Use the helper" title="Direct link to Use the helper" translate="no">​</a></h5>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> buildProgressionSnapshot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> createGameRuntime </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@idle-engine/core&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> NormalizedContentPack </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@idle-engine/content-schema&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createWorkerRuntime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedContentPack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> wiring </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createGameRuntime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepSizeMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    registerOfflineCatchup</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// production: { applyViaFinalizeTick: true },</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// maxStepsPerFrame: 1, // recommended when applyViaFinalizeTick is enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> coordinator </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wiring</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coordinator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deltaMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> publishedAt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> processedSteps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deltaMs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processedSteps </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Coordinator state is already step-aligned by the update system.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildProgressionSnapshot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentStep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publishedAt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorTargetStickyNavbar_EdDC" id="manual-wiring-reference">Manual wiring reference<a href="#manual-wiring-reference" class="hash-link" aria-label="Direct link to Manual wiring reference" title="Direct link to Manual wiring reference" translate="no">​</a></h5>
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CommandDispatcher</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CommandQueue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IdleEngineRuntime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createAutomationSystem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createProductionSystem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createProgressionCoordinator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createResourceStateAdapter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registerAutomationCommandHandlers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registerOfflineCatchupCommandHandler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registerResourceCommandHandlers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@idle-engine/core&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> NormalizedContentPack </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@idle-engine/content-schema&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">STEP_SIZE_MS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wireRuntimeManually</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NormalizedContentPack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> applyViaFinalizeTick </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> commandQueue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CommandQueue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> commandDispatcher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CommandDispatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> runtime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IdleEngineRuntime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commandQueue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commandDispatcher</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepSizeMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">STEP_SIZE_MS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">applyViaFinalizeTick </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> maxStepsPerFrame</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> coordinator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createProgressionCoordinator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepDurationMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">STEP_SIZE_MS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">registerResourceCommandHandlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dispatcher</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCommandDispatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generatorPurchases</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">generatorEvaluator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generatorToggles</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upgradeEvaluator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> upgradePurchases</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upgradeEvaluator </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prestigeEvaluator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> prestigeSystem</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prestigeEvaluator </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">registerOfflineCatchupCommandHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dispatcher</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCommandDispatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coordinator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> productionSystem </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createProductionSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    applyViaFinalizeTick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">generators</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">generators </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">generator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        owned</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">owned</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enabled</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        produces</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">produces </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consumes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumes </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resourceState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">productionSystem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">applyViaFinalizeTick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;resource-finalize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function" style="color:#d73a49">tick</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> deltaMs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">finalizeTick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deltaMs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> automationSystem </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createAutomationSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    automations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">automations</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commandQueue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCommandQueue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resourceState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createResourceStateAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepDurationMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">STEP_SIZE_MS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditionContext</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConditionContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">isAutomationUnlocked</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">automationId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getGrantedAutomationIds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">automationId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">automationSystem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;progression-coordinator&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">tick</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> events </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      coordinator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">updateForStep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">step </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> events </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">registerAutomationCommandHandlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dispatcher</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCommandDispatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    automationSystem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> coordinator </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-operational-considerations">6.3 Operational Considerations<a href="#63-operational-considerations" class="hash-link" aria-label="Direct link to 6.3 Operational Considerations" title="Direct link to 6.3 Operational Considerations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Deployment</strong>: No runtime deployment changes; this is a library-level additive helper in <code>packages/core</code>.</li>
<li class=""><strong>Telemetry &amp; Observability</strong>:<!-- -->
<ul>
<li class="">System IDs provided by the helper should be stable to keep diagnostics readable (see <code>IdleEngineRuntime</code> diagnostics timeline integration in <code>packages/core/src/index.ts:294</code>).</li>
<li class="">Helper-generated wiring should not introduce new nondeterministic timestamps; continue using deterministic timestamps for automation enqueues as implemented (<code>docs/runtime-step-lifecycle.md:44</code>).</li>
</ul>
</li>
<li class=""><strong>Security &amp; Compliance</strong>:<!-- -->
<ul>
<li class="">No new PII surface; the helper only composes existing runtime components.</li>
<li class="">The helper must not relax command authorization rules (command authorization remains enforced by <code>CommandDispatcher</code>/authorizers; out of scope for issue-525).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-work-breakdown--delivery-plan">7. Work Breakdown &amp; Delivery Plan<a href="#7-work-breakdown--delivery-plan" class="hash-link" aria-label="Direct link to 7. Work Breakdown &amp; Delivery Plan" title="Direct link to 7. Work Breakdown &amp; Delivery Plan" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="71-issue-map">7.1 Issue Map<a href="#71-issue-map" class="hash-link" aria-label="Direct link to 7.1 Issue Map" title="Direct link to 7.1 Issue Map" translate="no">​</a></h3>
<table><thead><tr><th>Issue Title</th><th>Scope Summary</th><th>Proposed Assignee/Agent</th><th>Dependencies</th><th>Acceptance Criteria</th></tr></thead><tbody><tr><td><code>feat(core): add createGameRuntime wiring helper (issue-525)</code></td><td>Implement <code>createGameRuntime</code> + <code>wireGameRuntime</code>, canonical system IDs/order, and standard handler registration.</td><td>Runtime Implementation Agent</td><td>Design approved</td><td>Helper exported from both Node and browser entrypoints; <code>systems</code> list exposes canonical order; manual wiring remains possible.</td></tr><tr><td><code>test(core): assert runtime wiring helper order + step semantics (issue-525)</code></td><td>Add unit test(s) verifying <code>systems</code> order and <code>updateForStep(step+1)</code> alignment with <code>runtime.getCurrentStep()</code>.</td><td>Test &amp; Determinism Agent</td><td>Helper implementation</td><td>Tests pass under multi-step <code>runtime.tick</code> backlog; no flaky wall-clock dependence.</td></tr><tr><td><code>docs: add runtime wiring helper reference + manual snippet (issue-525)</code></td><td>New docs page with diagram/snippets; update cross-links from lifecycle docs if needed.</td><td>Docs Agent</td><td>Helper API shape finalized</td><td>Docs include helper snippet + manual wiring reference + ordering diagram; links to core code paths.</td></tr><tr><td><code>chore(shell-web): adopt core wiring helper in runtime.worker (issue-525)</code></td><td>Replace manual worker wiring with helper (optional but recommended).</td><td>Shell Integration Agent</td><td>Helper + docs</td><td>Worker compiles; behavior parity for automation and coordinator updates; no change to bridge schema.</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="72-milestones">7.2 Milestones<a href="#72-milestones" class="hash-link" aria-label="Direct link to 7.2 Milestones" title="Direct link to 7.2 Milestones" translate="no">​</a></h3>
<ul>
<li class=""><strong>Phase 1 (Core API + tests)</strong>:<!-- -->
<ul>
<li class="">Deliver <code>createGameRuntime</code>/<code>wireGameRuntime</code>, register handlers, and add unit tests proving order + step semantics.</li>
<li class="">Gate: reviewers approve API naming and canonical system ordering.</li>
</ul>
</li>
<li class=""><strong>Phase 2 (Docs + reference adoption)</strong>:<!-- -->
<ul>
<li class="">Publish docs page with diagram and manual wiring snippet.</li>
<li class="">Optionally adopt in <code>packages/shell-web</code> worker for dogfooding.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="73-coordination-notes">7.3 Coordination Notes<a href="#73-coordination-notes" class="hash-link" aria-label="Direct link to 7.3 Coordination Notes" title="Direct link to 7.3 Coordination Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Hand-off Package</strong>:<!-- -->
<ul>
<li class="">Issue scope: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/525" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/525</a></li>
<li class="">Reference wiring: <code>packages/shell-web/src/runtime.worker.ts:127</code></li>
<li class="">Runtime ordering: <code>packages/core/src/index.ts:309</code></li>
<li class="">Finalize/apply semantics: <code>packages/core/src/production-system.ts:309</code></li>
<li class="">Publish/reset requirement: <code>packages/core/src/resource-state.ts:951</code></li>
</ul>
</li>
<li class=""><strong>Communication Cadence</strong>:<!-- -->
<ul>
<li class="">Daily async updates in PR thread; request review once tests + docs are included.</li>
<li class="">Escalate any proposed changes to the defaults in Section 13 before merging.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-agent-guidance--guardrails">8. Agent Guidance &amp; Guardrails<a href="#8-agent-guidance--guardrails" class="hash-link" aria-label="Direct link to 8. Agent Guidance &amp; Guardrails" title="Direct link to 8. Agent Guidance &amp; Guardrails" translate="no">​</a></h2>
<ul>
<li class=""><strong>Context Packets</strong>:<!-- -->
<ul>
<li class="">Load issue text via <code>gh issue view 525 --repo hansjm10/Idle-Game-Engine</code> (source of truth).</li>
<li class="">Read worker wiring reference: <code>packages/shell-web/src/runtime.worker.ts:127</code>.</li>
<li class="">Read runtime step ordering: <code>packages/core/src/index.ts:273</code>.</li>
<li class="">Read per-tick accumulator rules: <code>docs/resource-state-storage-design.md:455</code>.</li>
</ul>
</li>
<li class=""><strong>Prompting &amp; Constraints</strong>:<!-- -->
<ul>
<li class="">Use TypeScript ES modules; follow <code>@typescript-eslint/consistent-type-imports</code> and type-only exports (<code>AGENTS.md</code> repo root).</li>
<li class="">Keep helper optional and additive; do not remove manual wiring pathways.</li>
<li class="">Keep system order a single source of truth (returned <code>systems</code> list must match actual registration order).</li>
<li class="">Avoid nondeterministic timestamps in tests; prefer step-based values.</li>
</ul>
</li>
<li class=""><strong>Safety Rails</strong>:<!-- -->
<ul>
<li class="">Do not edit checked-in generated <code>dist/</code> outputs (repo guideline).</li>
<li class="">Do not add console logging in tests (Vitest reporter expects clean output).</li>
<li class="">Do not change command type names or authorization policies as part of issue-525.</li>
</ul>
</li>
<li class=""><strong>Validation Hooks</strong>:<!-- -->
<ul>
<li class=""><code>pnpm lint</code></li>
<li class=""><code>pnpm test --filter @idle-engine/core</code></li>
<li class=""><code>pnpm test --filter shell-web</code> (only if worker wiring changes land)</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-alternatives-considered">9. Alternatives Considered<a href="#9-alternatives-considered" class="hash-link" aria-label="Direct link to 9. Alternatives Considered" title="Direct link to 9. Alternatives Considered" translate="no">​</a></h2>
<ul>
<li class=""><strong>Status quo (manual wiring in each shell)</strong>:<!-- -->
<ul>
<li class="">Rejected: repeats order-sensitive logic and fails issue-525’s “minimal glue code” goal.</li>
</ul>
</li>
<li class=""><strong>Docs-only reference without helper</strong>:<!-- -->
<ul>
<li class="">Rejected: improves guidance but does not prevent incorrect wiring; issue-525 explicitly requests a helper and a unit test.</li>
</ul>
</li>
<li class=""><strong>Make <code>IdleEngineRuntime</code> auto-wire progression/production/automation internally</strong>:<!-- -->
<ul>
<li class="">Rejected: too opinionated and risks breaking advanced shells; helper must remain optional (issue-525).</li>
</ul>
</li>
<li class=""><strong>Place helper in <code>packages/shell-web</code> instead of <code>packages/core</code></strong>:<!-- -->
<ul>
<li class="">Rejected: core should own canonical wiring to keep multiple shells/harnesses consistent.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-testing--validation-plan">10. Testing &amp; Validation Plan<a href="#10-testing--validation-plan" class="hash-link" aria-label="Direct link to 10. Testing &amp; Validation Plan" title="Direct link to 10. Testing &amp; Validation Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Unit / Integration</strong>:<!-- -->
<ul>
<li class="">Add unit tests in <code>packages/core</code> that:<!-- -->
<ul>
<li class="">assert <code>systems.map((s) =&gt; s.id)</code> matches canonical order (issue-525 acceptance criteria)</li>
<li class="">assert <code>coordinator.getLastUpdatedStep()</code> aligns with <code>runtime.getCurrentStep()</code> after ticking (step-update semantics)</li>
</ul>
</li>
<li class="">Add at least one test case that exercises <code>runtime.tick</code> processing &gt;1 step per call (to catch ordering regressions under backlog).</li>
</ul>
</li>
<li class=""><strong>Performance</strong>:<!-- -->
<ul>
<li class="">No new hot-loop allocations beyond existing wiring; avoid per-step O(N) work in helper itself.</li>
<li class="">If <code>applyViaFinalizeTick</code> is enabled, document the cost and require explicit opt-in.</li>
</ul>
</li>
<li class=""><strong>Tooling / A11y</strong>:<!-- -->
<ul>
<li class="">Not applicable to issue-525 unless <code>shell-web</code> UI flows change.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Risk: Incorrect canonical ordering causes subtle simulation drift</strong>.<!-- -->
<ul>
<li class="">Mitigation: unit tests asserting system order + step-update semantics; document order with diagram and code references.</li>
</ul>
</li>
<li class=""><strong>Risk: Helper becomes too opinionated and blocks advanced shells</strong>.<!-- -->
<ul>
<li class="">Mitigation: keep helper optional; provide <code>wireGameRuntime</code> for partial adoption; document manual wiring.</li>
</ul>
</li>
<li class=""><strong>Risk: Browser/Node entrypoint export drift</strong> (<code>index.ts</code> vs <code>index.browser.ts</code>).<!-- -->
<ul>
<li class="">Mitigation: add export tests or a single source module imported by both entrypoints (implementation detail to be decided by Runtime Implementation Agent).</li>
</ul>
</li>
<li class=""><strong>Risk: Performance regressions in backlog/offline catchup</strong>.<!-- -->
<ul>
<li class="">Mitigation: keep finalize/apply and any per-step finalize loops behind explicit options; do not build progression snapshots per step inside the helper.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ul>
<li class=""><strong>Milestones</strong>:<!-- -->
<ol>
<li class="">Land helper + tests in <code>packages/core</code> (issue-525 Phase 1).</li>
<li class="">Publish docs page with helper + manual reference wiring (issue-525 Phase 2).</li>
<li class="">Optionally migrate <code>packages/shell-web</code> worker to helper for dogfooding.</li>
</ol>
</li>
<li class=""><strong>Migration Strategy</strong>:<!-- -->
<ul>
<li class="">No data migrations; API is additive.</li>
<li class="">Shells can migrate incrementally: adopt helper in new shells first; optionally refactor existing worker wiring.</li>
</ul>
</li>
<li class=""><strong>Communication</strong>:<!-- -->
<ul>
<li class="">Announce the helper in <code>docs/automation-authoring-guide.md</code> or a runtime integration guide as follow-up (see Section 14).</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="13-open-questions">13. Open Questions<a href="#13-open-questions" class="hash-link" aria-label="Direct link to 13. Open Questions" title="Direct link to 13. Open Questions" translate="no">​</a></h2>
<p>The following items are treated as <strong>resolved decisions</strong> for the issue-525 implementation.</p>
<ol>
<li class=""><strong>API naming</strong>: Use <code>createGameRuntime</code> + <code>wireGameRuntime</code>.<!-- -->
<ul>
<li class="">Rationale: Matches issue-525 wording (“helper like <code>createGameRuntime</code>”), aligns with existing <code>create*</code> factory naming (<code>createVerificationRuntime</code>), and keeps one high-level entrypoint plus one composition-friendly primitive.</li>
</ul>
</li>
<li class=""><strong>Automation ordering semantics</strong>: Keep <code>AutomationSystem</code> <strong>before</strong> the coordinator update system, and keep the coordinator update system <strong>last</strong>.<!-- -->
<ul>
<li class="">Rationale: Matches existing shell-web wiring, keeps step alignment invariant (<code>coordinator.getLastUpdatedStep() === runtime.getCurrentStep()</code> after a tick), and avoids same-step “achievement unlock → automation fires” chains.</li>
</ul>
</li>
<li class=""><strong>Offline catchup default</strong>: Default <code>registerOfflineCatchup: true</code>, with an opt-out.<!-- -->
<ul>
<li class="">Rationale: Matches shell-web, and command authorization already blocks <code>OFFLINE_CATCHUP</code> from <code>PLAYER</code> priority, keeping the handler safe-by-default.</li>
</ul>
</li>
<li class=""><strong>Production default mode</strong>: Default <code>production.applyViaFinalizeTick: false</code>.<!-- -->
<ul>
<li class="">Rationale: Safe under backlog/multi-step <code>runtime.tick(deltaMs)</code> processing and avoids correctness hazards tied to additive per-second accumulators. The rate-display trade-off (<code>perTick</code> remaining <code>0</code>) is acceptable as a default; shells that want live rates can opt into finalize/apply mode with the constraints below.</li>
</ul>
</li>
<li class=""><strong>Finalize/apply safety default</strong>: When <code>production.applyViaFinalizeTick: true</code> and <code>maxStepsPerFrame</code> is not provided, set <code>maxStepsPerFrame = 1</code>.<!-- -->
<ul>
<li class="">Rationale: Prevents a subtle but severe drift bug when <code>runtime.tick()</code> processes multiple steps per call while per-second rate buffers are additive and only reset on publish/reset boundaries.</li>
</ul>
</li>
<li class=""><strong>Transforms</strong>: Wire <code>TransformSystem</code> in the helper when transforms are present (issue-598).<!-- -->
<ul>
<li class="">Rationale: Matches shell-web wiring, keeps save/load access to transform state, and remains opt-in via <code>enableTransforms</code> or empty <code>content.transforms</code>.</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="14-follow-up-work">14. Follow-Up Work<a href="#14-follow-up-work" class="hash-link" aria-label="Direct link to 14. Follow-Up Work" title="Direct link to 14. Follow-Up Work" translate="no">​</a></h2>
<ul>
<li class="">Add an “integration guide” page that consolidates runtime wiring helper usage, state publication patterns, and common pitfalls (Owner: Docs Agent).</li>
<li class="">Provide a <code>wireGameRuntime</code> example in <code>tools/</code> or <code>packages/content-sample</code> for headless simulation harnesses (Owner: Runtime Implementation Agent).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="15-references">15. References<a href="#15-references" class="hash-link" aria-label="Direct link to 15. References" title="Direct link to 15. References" translate="no">​</a></h2>
<ul>
<li class="">GitHub issue #525: <a href="https://github.com/hansjm10/Idle-Game-Engine/issues/525" target="_blank" rel="noopener noreferrer" class="">https://github.com/hansjm10/Idle-Game-Engine/issues/525</a></li>
<li class="">Worker manual wiring example: <code>packages/shell-web/src/runtime.worker.ts:127</code></li>
<li class="">Coordinator update semantics (step + 1): <code>packages/shell-web/src/runtime.worker.ts:208</code></li>
<li class="">Runtime tick ordering (commands then systems): <code>packages/core/src/index.ts:309</code></li>
<li class="">Production finalize/apply option: <code>packages/core/src/production-system.ts:309</code></li>
<li class="">Per-tick accumulator reset guard: <code>packages/core/src/resource-state.ts:951</code></li>
<li class="">Snapshot builder resets accumulators: <code>packages/core/src/progression.ts:234</code></li>
<li class="">Backlog/multi-step processing behavior: <code>packages/core/src/index.ts:282</code></li>
<li class="">Resource publish/reset design rationale: <code>docs/resource-state-storage-design.md:455</code></li>
<li class="">Step stamping overview: <code>docs/runtime-step-lifecycle.md:1</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-a--glossary">Appendix A — Glossary<a href="#appendix-a--glossary" class="hash-link" aria-label="Direct link to Appendix A — Glossary" title="Direct link to Appendix A — Glossary" translate="no">​</a></h2>
<ul>
<li class=""><strong>Issue-525</strong>: GitHub issue “enhancement(core): provide standard runtime wiring helper” defining the scope for this initiative.</li>
<li class=""><strong>Wiring helper</strong>: A core-provided function that constructs and/or wires runtime subsystems in a canonical order and registers handlers.</li>
<li class=""><strong>Coordinator update system</strong>: A runtime system that calls <code>ProgressionCoordinator.updateForStep(step + 1)</code> so coordinator-derived state aligns with <code>IdleEngineRuntime.getCurrentStep()</code>.</li>
<li class=""><strong>Finalize/apply semantics</strong>: Production mode (<code>applyViaFinalizeTick</code>) where systems queue per-second rates and <code>ResourceState.finalizeTick(deltaMs)</code> applies balances.</li>
<li class=""><strong>Per-tick accumulators</strong>: <code>ResourceState</code> fields (<code>incomePerSecond</code>, <code>expensePerSecond</code>, <code>netPerSecond</code>, <code>tickDelta</code>) that must be reset once per tick after publishing.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="appendix-b--change-log">Appendix B — Change Log<a href="#appendix-b--change-log" class="hash-link" aria-label="Direct link to Appendix B — Change Log" title="Direct link to Appendix B — Change Log" translate="no">​</a></h2>
<table><thead><tr><th>Date</th><th>Author</th><th>Change Summary</th></tr></thead><tbody><tr><td>2025-12-17</td><td>Idle Engine Design-Authoring Agent (AI)</td><td>Initial draft for issue-525: standard runtime wiring helper proposal, canonical ordering, tests, docs, and AI-led work plan.</td></tr><tr><td>2025-12-18</td><td>Codex CLI (AI)</td><td>Resolve issue-525 defaults (API naming, ordering, offline catchup, production mode, finalize safety, transforms scope) and align the doc wording with existing runtime/worker behavior.</td></tr><tr><td>2025-12-21</td><td>Codex CLI (AI)</td><td>Document transform wiring in the helper (issue-598) and update canonical ordering + handler registration notes.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/runtime-wiring-helper-design-issue-525.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#document-control" class="table-of-contents__link toc-highlight">Document Control</a></li><li><a href="#1-summary" class="table-of-contents__link toc-highlight">1. Summary</a></li><li><a href="#2-context--problem-statement" class="table-of-contents__link toc-highlight">2. Context &amp; Problem Statement</a></li><li><a href="#3-goals--non-goals" class="table-of-contents__link toc-highlight">3. Goals &amp; Non-Goals</a></li><li><a href="#4-stakeholders-agents--impacted-surfaces" class="table-of-contents__link toc-highlight">4. Stakeholders, Agents &amp; Impacted Surfaces</a></li><li><a href="#5-current-state" class="table-of-contents__link toc-highlight">5. Current State</a></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-architecture-overview" class="table-of-contents__link toc-highlight">6.1 Architecture Overview</a></li><li><a href="#62-detailed-design" class="table-of-contents__link toc-highlight">6.2 Detailed Design</a></li><li><a href="#63-operational-considerations" class="table-of-contents__link toc-highlight">6.3 Operational Considerations</a></li></ul></li><li><a href="#7-work-breakdown--delivery-plan" class="table-of-contents__link toc-highlight">7. Work Breakdown &amp; Delivery Plan</a><ul><li><a href="#71-issue-map" class="table-of-contents__link toc-highlight">7.1 Issue Map</a></li><li><a href="#72-milestones" class="table-of-contents__link toc-highlight">7.2 Milestones</a></li><li><a href="#73-coordination-notes" class="table-of-contents__link toc-highlight">7.3 Coordination Notes</a></li></ul></li><li><a href="#8-agent-guidance--guardrails" class="table-of-contents__link toc-highlight">8. Agent Guidance &amp; Guardrails</a></li><li><a href="#9-alternatives-considered" class="table-of-contents__link toc-highlight">9. Alternatives Considered</a></li><li><a href="#10-testing--validation-plan" class="table-of-contents__link toc-highlight">10. Testing &amp; Validation Plan</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li><li><a href="#13-open-questions" class="table-of-contents__link toc-highlight">13. Open Questions</a></li><li><a href="#14-follow-up-work" class="table-of-contents__link toc-highlight">14. Follow-Up Work</a></li><li><a href="#15-references" class="table-of-contents__link toc-highlight">15. References</a></li><li><a href="#appendix-a--glossary" class="table-of-contents__link toc-highlight">Appendix A — Glossary</a></li><li><a href="#appendix-b--change-log" class="table-of-contents__link toc-highlight">Appendix B — Change Log</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>