<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-diagnostic-timeline-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Diagnostic Timeline Instrumentation | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/diagnostic-timeline-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Diagnostic Timeline Instrumentation | Idle Engine Docs"><meta data-rh="true" name="description" content="Issue: #9 — Runtime Core Workstream"><meta data-rh="true" property="og:description" content="Issue: #9 — Runtime Core Workstream"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/diagnostic-timeline-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/diagnostic-timeline-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/diagnostic-timeline-design" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Diagnostic Timeline Instrumentation","item":"https://hansjm10.github.io/Idle-Game-Engine/diagnostic-timeline-design"}]}</script><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.38b6a5c8.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.f7253bbf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><aside class="theme-doc-sidebar-container docSidebarContainer_Xlvo"><div class="sidebarViewport_tjEA"><div class="sidebar_ubOv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_CfkH"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Idle-Game-Engine/"><span title="Getting Started" class="categoryLinkLabel_ebxo">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/"><span title="Overview" class="linkLabel_KsAJ">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/contributor-handbook"><span title="Contributor Handbook" class="linkLabel_KsAJ">Contributor Handbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/role-index"><span title="Role Index" class="linkLabel_KsAJ">Role Index</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/design-document-template"><span title="Design Document Template" class="linkLabel_KsAJ">Design Document Template</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Idle-Game-Engine/idle-engine-design"><span title="Core Runtime" class="categoryLinkLabel_ebxo">Core Runtime</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/idle-engine-design"><span title="Idle Engine Design Document" class="linkLabel_KsAJ">Idle Engine Design Document</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-step-lifecycle"><span title="Runtime Step Lifecycle Alignment" class="linkLabel_KsAJ">Runtime Step Lifecycle Alignment</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-command-queue-design"><span title="Runtime Command Queue Design Document" class="linkLabel_KsAJ">Runtime Command Queue Design Document</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-command-queue-validation-plan"><span title="Runtime Command Queue Validation Tracker" class="linkLabel_KsAJ">Runtime Command Queue Validation Tracker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-event-pubsub-design"><span title="Runtime Event Pub/Sub Design" class="linkLabel_KsAJ">Runtime Event Pub/Sub Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-event-bus-decisions"><span title="Decision Record: Runtime Event Bus Follow-ups" class="linkLabel_KsAJ">Decision Record: Runtime Event Bus Follow-ups</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-event-manifest-authoring"><span title="Runtime Event Manifest Authoring" class="linkLabel_KsAJ">Runtime Event Manifest Authoring</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/tick-accumulator-coverage-design"><span title="Tick Accumulator Edge Case Coverage" class="linkLabel_KsAJ">Tick Accumulator Edge Case Coverage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/resource-state-storage-design"><span title="Resource State Storage Design" class="linkLabel_KsAJ">Resource State Storage Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Idle-Game-Engine/diagnostic-timeline-design"><span title="Diagnostic Timeline Instrumentation" class="linkLabel_KsAJ">Diagnostic Timeline Instrumentation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content Pipeline" class="categoryLinkLabel_ebxo">Content Pipeline</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/accessibility-smoke-tests-design"><span title="Shell Integration" class="categoryLinkLabel_ebxo">Shell Integration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/coverage/"><span title="Diagnostics &amp; Quality" class="categoryLinkLabel_ebxo">Diagnostics &amp; Quality</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/implementation-plan"><span title="Operations &amp; Process" class="categoryLinkLabel_ebxo">Operations &amp; Process</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_tfRv"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_bxbs" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Idle-Game-Engine/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_p1A9"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core Runtime</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Diagnostic Timeline Instrumentation</span></li></ul></nav><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Diagnostic Timeline Instrumentation</h1></header>
<p>Issue: #9 — Runtime Core Workstream</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-problem-statement">1. Problem Statement<a href="#1-problem-statement" class="hash-link" aria-label="Direct link to 1. Problem Statement" title="Direct link to 1. Problem Statement" translate="no">​</a></h2>
<ul>
<li class="">The runtime core lacks a structured view of per-tick execution time, queue pressure, and system-level latency, making it hard to diagnose scheduling regressions described in <code>docs/idle-engine-design.md</code> §9.1.</li>
<li class="">Current telemetry only records coarse counters (<code>telemetry.recordTick</code>, event back-pressure snapshots) and cannot explain why a tick exceeded its budget or which system introduced jitter.</li>
<li class="">Without a deterministic diagnostic timeline, downstream tooling (shell devtools overlay, automated profiling agents) cannot surface actionable insights when the engine stutters or falls behind real time.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-goals">2. Goals<a href="#2-goals" class="hash-link" aria-label="Direct link to 2. Goals" title="Direct link to 2. Goals" translate="no">​</a></h2>
<ul>
<li class="">Capture high-resolution timing for each runtime tick, including queue drain, event dispatch, and system execution segments.</li>
<li class="">Attribute time spent to individual systems so integrators can identify hotspots while preserving deterministic execution.</li>
<li class="">Record queue depth, command throughput, and event bus counters alongside timing data to contextualize slow ticks.</li>
<li class="">Provide a structured-clone-safe ring buffer snapshot API usable from Workers (shell-web) and Node hosts without leaking mutable references.<sup><a href="#user-content-fn-structured-clone" id="user-content-fnref-structured-clone" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">1</a></sup></li>
<li class="">Emit guard-rail warnings (over-budget ticks, repeated slow systems) through the existing telemetry facade so production builds can trigger alerts without devtools attached.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-non-goals">3. Non-Goals<a href="#3-non-goals" class="hash-link" aria-label="Direct link to 3. Non-Goals" title="Direct link to 3. Non-Goals" translate="no">​</a></h2>
<ul>
<li class="">Shipping a visualization layer inside <code>packages/shell-web</code>; that devtools overlay remains a follow-up.</li>
<li class="">Persisting historical diagnostics beyond the in-memory ring buffer or streaming them to external observability stacks (Prometheus ingestion stays optional via telemetry).</li>
<li class="">Replacing the existing event bus diagnostics; the timeline consumes those snapshots but does not redefine their structure.</li>
<li class="">Enforcing adaptive scheduling or auto-throttling based on timeline results; the scope ends at recording and surfacing metadata.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-current-state">4. Current State<a href="#4-current-state" class="hash-link" aria-label="Direct link to 4. Current State" title="Direct link to 4. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>IdleEngineRuntime.tick</code> (see <code>packages/core/src/index.ts</code>) executes the fixed-step loop but only calls <code>telemetry.recordTick()</code> and event back-pressure counters after each iteration. There is no instrumentation around command draining, per-system execution, or total wall time.</li>
<li class=""><code>CommandQueue</code> records overflow warnings but does not expose queue depth trends or per-tick throughput.</li>
<li class=""><code>EventBus</code> exposes <code>getBackPressureSnapshot()</code> and frame export diagnostics, yet the runtime only samples these at the end of the tick, leaving large gaps between dispatch phases.</li>
<li class="">The design doc (<code>docs/implementation-plan.md</code>) tracks “Add DiagnosticTimeline to capture tick durations and system timings” as a TODO, and no API surfaces a timeline to consumers today.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-proposed-solution">5. Proposed Solution<a href="#5-proposed-solution" class="hash-link" aria-label="Direct link to 5. Proposed Solution" title="Direct link to 5. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="51-data-model--storage">5.1 Data Model &amp; Storage<a href="#51-data-model--storage" class="hash-link" aria-label="Direct link to 5.1 Data Model &amp; Storage" title="Direct link to 5.1 Data Model &amp; Storage" translate="no">​</a></h3>
<ul>
<li class="">Introduce <code>DiagnosticTimeline</code> inside <code>packages/core/src/diagnostics/</code>, backed by a fixed-capacity circular buffer (default 512 ticks, configurable).</li>
<li class="">Each <code>DiagnosticTimelineEntry</code> records:<!-- -->
<ul>
<li class=""><code>tick</code>: runtime step number.</li>
<li class=""><code>stepBudgetMs</code>: fixed-step budget applied to that simulation iteration (mirrors the resolved <code>stepSizeMs</code> so diagnostics stay deterministic across replays).<sup><a href="#user-content-fn-fixed-step" id="user-content-fnref-fixed-step" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">2</a></sup></li>
<li class=""><code>hostFrameMs</code>: raw wall-clock time supplied to the outer <code>tick</code> invocation, kept separate from the deterministic step budget so tooling can spot long render frames that trigger catch-up processing.</li>
<li class=""><code>lagBeforeMs</code> / <code>lagAfterMs</code>: accumulator backlog immediately before and after the step, exposing how far the runtime is behind real time when multiple fixed steps are executed in one host frame.<sup><a href="#user-content-fn-fixed-step-lag" id="user-content-fnref-fixed-step-lag" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">3</a></sup></li>
<li class=""><code>startedAtMs</code> / <code>durationMs</code>: high-resolution start timestamp and total wall-clock duration (converted to milliseconds with microsecond precision).</li>
<li class=""><code>queue</code>: <code>{ pendingBefore, drained, accepted, dropped, rejected }</code> captured via extended <code>CommandQueue</code> instrumentation so the timeline mirrors the accepted/outstanding counters that queueing platforms expose for monitoring (incoming, completed, abandoned, dead-lettered). Each tick begins by reading the queue size into <code>pendingBefore</code>; enqueue/dequeue paths increment <code>accepted</code>, <code>rejected</code>, <code>dropped</code>, and <code>drained</code>; and <code>commandQueue.flushDiagnostics()</code> returns the delta snapshot while resetting counters so every entry reports per-tick throughput rather than monotonic totals.<sup><a href="#user-content-fn-azure-service-bus-metrics" id="user-content-fnref-azure-service-bus-metrics" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">4</a></sup><sup><a href="#user-content-fn-otel-delta" id="user-content-fnref-otel-delta" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">5</a></sup></li>
<li class=""><code>phases</code>: ordered segments (<code>commands</code>, <code>eventDispatchBeforeSystems</code>, <code>system:&lt;id&gt;</code>, <code>eventDispatchAfterSystems</code>, <code>publish</code>) with <code>durationMs</code> and <code>offsetMs</code> from tick start.</li>
<li class=""><code>systems</code>: normalized table capturing <code>{ id, durationMs, slow: boolean, error?: ErrorLike }</code>.</li>
<li class=""><code>events</code>: structured counters captured once before systems run and once at tick end (<code>before</code>, <code>final</code>), plus optional per-system delta records when event pressure crosses configured thresholds. Calm ticks avoid copying the full <code>BackPressureSnapshot</code> payload multiple times, while spikes still surface enough detail for diagnosis.<sup><a href="#user-content-fn-perfetto-interning" id="user-content-fnref-perfetto-interning" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">6</a></sup><sup><a href="#user-content-fn-otel-performance" id="user-content-fnref-otel-performance" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">7</a></sup></li>
<li class=""><code>warnings</code>: bit flags (e.g., <code>EXCEEDED_STEP_BUDGET</code>, <code>SYSTEM_SLOW</code>, <code>QUEUE_STARVATION</code>) derived from thresholds in options.</li>
</ul>
</li>
<li class="">The buffer reuses a pooled set of mutable entry structs to avoid per-tick allocations, then clones and freezes plain-object copies on export. This follows the object-pool pattern for high-churn data while still handing immutable snapshots to consumers.<sup><a href="#user-content-fn-object-pool" id="user-content-fnref-object-pool" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">8</a></sup><sup><a href="#user-content-fn-object-freeze" id="user-content-fnref-object-freeze" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">9</a></sup><sup><a href="#user-content-fn-structured-clone" id="user-content-fnref-structured-clone-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">1</a></sup></li>
<li class="">Define <code>ErrorLike</code> as a plain object <code>{ readonly name: string; readonly message: string; readonly stack?: string; readonly cause?: string }</code> so structured clones remain deterministic across Workers while preserving telemetry details browsers guarantee when serializing errors.<sup><a href="#user-content-fn-mdn-structured-clone" id="user-content-fnref-mdn-structured-clone" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">10</a></sup></li>
<li class="">Split the instrumentation hooks from exported data by introducing a mutable <code>DiagnosticTimelineRecorder</code> (exposing <code>beginTick</code>, <code>capturePhase</code>, <code>captureSystem</code>, <code>endTick</code>) that never crosses structured-clone boundaries, plus an immutable <code>DiagnosticTimelineResult</code> returned by <code>readDiagnosticsDelta</code>. This mirrors telemetry guidelines where instrumentation libraries depend only on an API while exporters and tooling consume serialized snapshots.<sup><a href="#user-content-fn-otel-api-sdk" id="user-content-fnref-otel-api-sdk" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">11</a></sup></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="52-clock-abstraction">5.2 Clock Abstraction<a href="#52-clock-abstraction" class="hash-link" aria-label="Direct link to 5.2 Clock Abstraction" title="Direct link to 5.2 Clock Abstraction" translate="no">​</a></h3>
<ul>
<li class="">Define <code>HighResolutionClock</code> with <code>now(): number</code> returning a monotonically increasing timestamp in milliseconds with microsecond precision.</li>
<li class="">Default implementation wraps <code>performance.now()</code> in browsers/Workers and <code>performance.now()</code> (via <code>import { performance } from &#x27;node:perf_hooks&#x27;</code>) in Node; fallback to <code>Date.now()</code> when unavailable.</li>
<li class="">Allow dependency injection through <code>IdleEngineRuntimeOptions.diagnostics?.clock</code> for deterministic testing (Vitest can supply a fake clock).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="53-runtime-integration">5.3 Runtime Integration<a href="#53-runtime-integration" class="hash-link" aria-label="Direct link to 5.3 Runtime Integration" title="Direct link to 5.3 Runtime Integration" translate="no">​</a></h3>
<ul>
<li class="">Extend <code>IdleEngineRuntimeOptions</code> with an optional <code>diagnostics</code> block:<!-- -->
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">DiagnosticTimelineOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> enabled</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// default true in development, false otherwise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> capacity</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// default 512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> slowTickBudgetMs</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// defaults to current stepSizeMs (100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> slowSystemThresholdMs</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// defaults to 25% of step budget</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> clock</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> HighResolutionClock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class="">Maintain a lightweight controller inside <code>IdleEngineRuntime</code> that forwards to either a real <code>DiagnosticTimelineRecorder</code> or a noop implementation; diagnostics-disabled builds defer recorder allocation until explicitly enabled while keeping the hot path branchless.</li>
<li class="">Instrument <code>tick</code> as follows:<!-- -->
<ol>
<li class="">Snapshot <code>const accumulatorBefore = this.accumulator + deltaMs</code> before we clamp <code>steps</code>, then keep a local <code>remainingAccumulator</code> that we decrement inside the per-step loop. Each <code>beginTick(tick, { hostFrameMs: deltaMs, lagBeforeMs, stepBudgetMs: this.stepSizeMs, queueSize })</code> call uses that running remainder (<code>lagBeforeMs = Math.max(0, remainingAccumulator - this.stepSizeMs)</code>) so the entry reflects the backlog still outstanding before the slice runs. After the step finishes subtract <code>this.stepSizeMs</code> from <code>remainingAccumulator</code>, compute <code>lagAfterMs = Math.max(0, remainingAccumulator)</code>, and pass it to <code>endTick(...)</code> so every entry records both the pre- and post-step accumulator in line with fixed-step accumulator guidance.<sup><a href="#user-content-fn-fixed-step-lag" id="user-content-fnref-fixed-step-lag-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">3</a></sup><sup><a href="#user-content-fn-gaffer-accumulator" id="user-content-fnref-gaffer-accumulator" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">12</a></sup></li>
<li class="">On the first iteration call <code>const queueDiagnostics = commandQueue.beginDiagnosticsTick()</code> (cheap view over the shared counters) so the recorder starts with <code>pendingBefore = queueDiagnostics.pendingBefore</code>. As <code>enqueue</code> and <code>dequeue</code> operations occur they update the per-tick counters, and <code>commandQueue.flushDiagnostics()</code> returns the delta structure used when sealing the entry.</li>
<li class="">Wrap both command dequeuing and execution inside <code>timeline.capturePhase(&#x27;commands&#x27;, () =&gt; { ... })</code>, using the enhanced dequeue helper to capture <code>{ pendingBefore, drained, accepted, dropped, rejected }</code> in lockstep with the queue metrics we surface elsewhere. Nested slices per command type remain optional but provide richer traces when enabled.<sup><a href="#user-content-fn-perfetto-track-events" id="user-content-fnref-perfetto-track-events" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">13</a></sup><sup><a href="#user-content-fn-azure-service-bus-metrics" id="user-content-fnref-azure-service-bus-metrics-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">4</a></sup></li>
<li class="">Bracket every call to <code>eventBus.dispatch(...)</code> with <code>timeline.capturePhase</code> blocks so dispatch costs appear in the phase array (<code>eventDispatchBeforeSystems</code> before any systems run, <code>eventDispatchAfterSystems</code> between systems). A lightweight helper lets <code>resource-publish-transport</code> (or any alternative exporter) call <code>timeline.capturePhase(&#x27;publish&#x27;, ...)</code> around its own work so the timeline records publish costs without assuming the core runtime owns the transport call.<sup><a href="#user-content-fn-perfetto-track-events" id="user-content-fnref-perfetto-track-events-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">13</a></sup></li>
<li class="">Before running systems, capture <code>events.before = eventBus.getBackPressureSnapshot()</code>. During the system loop, only request a delta snapshot when utilization crosses configured thresholds; the recorder diffs that snapshot against the cached one so routine ticks avoid extra allocations while still logging the channels that spiked. After dispatch completes, capture a single <code>events.final</code> snapshot for context.</li>
<li class="">For each registered system, call <code>timeline.captureSystem(system.id, () =&gt; system.tick(context))</code>. The helper measures duration, marks slow flags, annotates thrown errors on the entry using the serialized <code>ErrorLike</code>, and rethrows so existing runtime telemetry (<code>SystemExecutionFailed</code>) continues to fire.</li>
<li class="">After system iteration, finalize any active phase spans, collect <code>const queue = commandQueue.flushDiagnostics()</code>, compute the merged warning set, and call <code>endTick({ backPressure, queue, warnings, lagAfterMs })</code> to seal the entry and write it into the ring buffer.</li>
</ol>
</li>
<li class="">Telemetry integration:<!-- -->
<ul>
<li class="">Emit <code>telemetry.recordWarning(&#x27;TickOverBudget&#x27;, { tick, durationMs, budgetMs })</code> when <code>durationMs &gt; slowTickBudgetMs</code>.</li>
<li class="">Emit <code>telemetry.recordWarning(&#x27;SystemSlow&#x27;, { systemId, durationMs, thresholdMs, tick })</code> when a system’s own execution history shows repeated slow samples—track a per-system ring buffer of the last <code>windowSize</code> executions so infrequent systems still surface regressions without being hidden by globally sparse tick windows.<sup><a href="#user-content-fn-datadog-multi-alert" id="user-content-fnref-datadog-multi-alert" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">14</a></sup></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="54-snapshot--api-surface">5.4 Snapshot &amp; API Surface<a href="#54-snapshot--api-surface" class="hash-link" aria-label="Direct link to 5.4 Snapshot &amp; API Surface" title="Direct link to 5.4 Snapshot &amp; API Surface" translate="no">​</a></h3>
<ul>
<li class="">Add <code>IdleEngineRuntime.readDiagnosticsDelta(sinceHead?: number): DiagnosticTimelineResult</code> exposing:<!-- -->
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">DiagnosticTimelineResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> entries</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> DiagnosticTimelineEntry</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> head</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// incrementing sequence for delta consumers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> configuration</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ResolvedDiagnosticTimelineOptions</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> dropped</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class="">When <code>sinceHead</code> is omitted the recorder exports the full buffer contents; otherwise it returns only the new entries since that head. The export path deep-clones the pooled structs, freezes the resulting plain objects, and hands back structured-clone-safe data without leaking mutable references.</li>
<li class="">The recorder stores <code>head</code> as a monotonic counter so clients can request only new entries and determine when the ring buffer overwrote older samples without juggling separate snapshot and delta APIs.<sup><a href="#user-content-fn-otel-delta" id="user-content-fnref-otel-delta-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">5</a></sup></li>
<li class="">Extend <code>CommandRecorder</code> replay context to optionally attach timeline entries when present, enabling deterministic replay comparisons.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="55-worker--transport-integration">5.5 Worker &amp; Transport Integration<a href="#55-worker--transport-integration" class="hash-link" aria-label="Direct link to 5.5 Worker &amp; Transport Integration" title="Direct link to 5.5 Worker &amp; Transport Integration" translate="no">​</a></h3>
<ul>
<li class="">Update <code>packages/core/src/resource-publish-transport.ts</code> to accept two optional diagnostics fields: <code>diagnosticsRecorder?: DiagnosticTimelineRecorder</code> for wrapping <code>capturePhase(&#x27;publish&#x27;, ...)</code> around build/release work, and <code>diagnosticsPayload?: DiagnosticTimelineResult</code> so call-sites can attach immutable timeline slices to the transport without smuggling recorder methods through structured-clone boundaries. The runtime hands the recorder directly to the transport, while the worker receives only the serialized payload.</li>
<li class="">The worker bridge (<code>packages/shell-web/src/runtime.worker.ts</code>) can request diagnostics by:<!-- -->
<ol>
<li class="">Storing the last seen <code>head</code>.</li>
<li class="">Calling <code>runtime.readDiagnosticsDelta(lastHead)</code> after each resource publish or on a polling cadence.</li>
<li class="">Forwarding only new entries to the UI devtools overlay.</li>
</ol>
</li>
<li class="">Timeline entries remain optional; publishing code should skip them when diagnostics are disabled to avoid extra bytes on production channels.</li>
<li class="">Devtools must explicitly opt in before the worker starts emitting timeline buffers. The UI posts a <code>DIAGNOSTICS_SUBSCRIBE</code> envelope via <code>WorkerBridge.enableDiagnostics()</code>, the worker enables the runtime timeline, resets its delta cursor, and immediately returns a baseline <code>DIAGNOSTICS_UPDATE</code> so tooling learns the configuration before streaming increments. Because <code>postMessage()</code> copies data by default,<sup><a href="#user-content-fn-postmessage-copy" id="user-content-fnref-postmessage-copy" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">15</a></sup> follow-up deltas are sent over the dedicated <code>DIAGNOSTICS_UPDATE</code> envelope only while the overlay is listening. Regular state updates stay slim, while the diagnostics envelope can transfer typed buffers once the overlay requests high-volume samples.<sup><a href="#user-content-fn-transferable-zero-copy" id="user-content-fnref-transferable-zero-copy" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">16</a></sup></li>
<li class=""><code>WorkerBridge.onDiagnosticsUpdate</code> forwards those <code>DIAGNOSTICS_UPDATE</code> payloads to devtools so the overlay can render timeline entries alongside existing state updates.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="56-configuration--extensibility">5.6 Configuration &amp; Extensibility<a href="#56-configuration--extensibility" class="hash-link" aria-label="Direct link to 5.6 Configuration &amp; Extensibility" title="Direct link to 5.6 Configuration &amp; Extensibility" translate="no">​</a></h3>
<ul>
<li class="">Expose <code>IdleEngineRuntime.enableDiagnostics(options)</code> to toggle recording at runtime (useful for automated test harnesses). The controller resolves defaults during construction, keeps a noop recorder active when disabled, and allocates the real recorder on demand without disrupting in-flight ticks.</li>
<li class="">Allow future hooks to append additional phases (e.g., persistence flush, social sync) by offering <code>diagnostics.addPhase(name, durationMs)</code> APIs outside of <code>IdleEngineRuntime</code>.</li>
<li class="">Store thresholds in the resolved configuration so downstream systems (e.g., shell overlay) know which budget triggered warnings.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-observability--tooling">6. Observability &amp; Tooling<a href="#6-observability--tooling" class="hash-link" aria-label="Direct link to 6. Observability &amp; Tooling" title="Direct link to 6. Observability &amp; Tooling" translate="no">​</a></h2>
<ul>
<li class="">Prometheus adapter (<code>telemetry-prometheus.ts</code>) increments new counters (<code>runtime_ticks_over_budget_total</code>, <code>runtime_system_slow_total</code>) when warnings fire, gated by explicit label registration.</li>
<li class="">Provide a small helper in <code>packages/core/src/devtools/diagnostics.ts</code> that formats the latest <code>DiagnosticTimelineEntry</code> for human-readable console output, mirroring the existing console telemetry scheme.</li>
<li class="">Document the timeline API in <code>docs/runtime-step-lifecycle.md</code> follow-up so implementation notes stay in sync with the design.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-performance-considerations">7. Performance Considerations<a href="#7-performance-considerations" class="hash-link" aria-label="Direct link to 7. Performance Considerations" title="Direct link to 7. Performance Considerations" translate="no">​</a></h2>
<ul>
<li class="">Timeline recording adds ~5 object allocations per tick (entry + phase arrays). The ring buffer reuses arrays via preallocation to avoid garbage churn.</li>
<li class="">High-resolution timestamps rely on monotonic clocks; fallbacks degrade precision but remain deterministic because start/end are still measured within the same clock.</li>
<li class="">Instrumentation branches are minimized by caching the recorder (either real or noop) and inline guards for disabled configuration.</li>
<li class="">Export snapshots clone arrays at most once per request; by freezing entries on write, consumers can reuse references safely.</li>
<li class="">A dedicated micro-benchmark (<code>packages/core/benchmarks/diagnostic-timeline-overhead.bench.mjs</code>) exercises multiple systems and high queue churn. On Node.js v22.20.0 running under WSL2, <code>pnpm --filter @idle-engine/core run benchmark:diagnostics</code> reported a mean +10.8 ms cost per 320 ticks (about 10.1% overhead) with a median delta of +9.0 ms.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-rollout-steps">8. Rollout Steps<a href="#8-rollout-steps" class="hash-link" aria-label="Direct link to 8. Rollout Steps" title="Direct link to 8. Rollout Steps" translate="no">​</a></h2>
<ol>
<li class="">Scaffold <code>packages/core/src/diagnostics/diagnostic-timeline.ts</code> with recorder, data model, and tests covering ring-buffer rollover, slow-tick detection, and noop mode.</li>
<li class="">Wire the recorder into <code>IdleEngineRuntime</code> constructor and tick loop; add integration tests (<code>packages/core/src/index.test.ts</code>) capturing synthetic ticks with fake clocks.</li>
<li class="">Extend <code>telemetry-prometheus.ts</code> to record new counters and verify via tests.</li>
<li class="">Update <code>resource-publish-transport.ts</code> (and worker bridge) to optionally include timeline deltas; cover with unit tests ensuring serialization safety.</li>
<li class="">Add developer documentation (<code>README.md</code> or <code>docs/runtime-step-lifecycle.md</code>) describing how to enable diagnostics in local builds.</li>
<li class="">Validate instrumentation overhead with a micro-benchmark and document observed cost in the PR summary.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-risks--mitigations">9. Risks &amp; Mitigations<a href="#9-risks--mitigations" class="hash-link" aria-label="Direct link to 9. Risks &amp; Mitigations" title="Direct link to 9. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Clock precision variance across environments</strong>: Provide explicit clock injection and unit tests using deterministic timers; fall back to <code>Date.now()</code> only when necessary.</li>
<li class=""><strong>Timeline flood in production builds</strong>: Keep diagnostics opt-in (<code>enabled: false</code> by default outside development) and ensure publish paths check configuration before attaching data.</li>
<li class=""><strong>Telemetry noise from transient spikes</strong>: Use dampening thresholds (e.g., require two slow samples within the last three ticks) before emitting warnings; expose configuration knobs so integrators can tune sensitivity.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-resolved-questions">10. Resolved Questions<a href="#10-resolved-questions" class="hash-link" aria-label="Direct link to 10. Resolved Questions" title="Direct link to 10. Resolved Questions" translate="no">​</a></h2>
<ul>
<li class=""><strong>Shell diagnostics transport</strong>: Provide a subscription handshake from the devtools overlay and stream timeline deltas only through a dedicated diagnostics message once listeners are active. Default state updates remain lean, minimizing structured-clone churn, and the diagnostics envelope can switch to transferable typed arrays for larger batches where supported.<sup><a href="#user-content-fn-postmessage-copy" id="user-content-fnref-postmessage-copy-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">15</a></sup><sup><a href="#user-content-fn-transferable-zero-copy" id="user-content-fnref-transferable-zero-copy-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">16</a></sup></li>
<li class=""><strong>GC visibility</strong>: Detect long GC pauses indirectly by observing <code>longtask</code> entries via <code>PerformanceObserver</code>, which surfaces 50ms+ main-thread stalls regardless of source.<sup><a href="#user-content-fn-longtasks" id="user-content-fnref-longtasks" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">17</a></sup> First-phase scope stops there; direct heap snapshots use <code>performance.measureUserAgentSpecificMemory()</code> only when shell builds opt into cross-origin isolation, because the legacy <code>performance.memory</code> API is deprecated, Chromium-only, and unreliable for multi-context captures.<sup><a href="#user-content-fn-perf-memory" id="user-content-fnref-perf-memory" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">18</a></sup><sup><a href="#user-content-fn-measure-uasm" id="user-content-fnref-measure-uasm" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">19</a></sup></li>
<li class=""><strong>Timeline buffer depth</strong>: Set the default ring buffer to 512 entries (~51 seconds at 100ms steps) so tooling can inspect a minute of history without triggering drops. This mirrors guidance from the Performance Timeline that buffers silently drop entries once full; exposing capacity controls and the dropped-entry count keeps the channel deterministic for observers.<sup><a href="#user-content-fn-performanceobserver-buffer" id="user-content-fnref-performanceobserver-buffer" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_EdDC">20</a></sup></li>
<li class=""><strong>Event counter snapshots</strong>: Cache the <code>BackPressureSnapshot</code> once before system execution and reuse it to compute diff payloads only when channel utilization breaches configured thresholds, keeping the steady-state payload small while still reusing the existing event bus diagnostic shape (<code>packages/core/src/events/event-bus.ts</code>).</li>
<li class=""><strong>System error handling</strong>: <code>timeline.captureSystem()</code> annotates thrown errors but rethrows them so the existing <code>IdleEngineRuntime</code> catch block continues to emit <code>SystemExecutionFailed</code> telemetry and keeps later systems running (<code>packages/core/src/index.ts:198</code>, <code>packages/core/src/index.test.ts:250</code>).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-acceptance-criteria">11. Acceptance Criteria<a href="#11-acceptance-criteria" class="hash-link" aria-label="Direct link to 11. Acceptance Criteria" title="Direct link to 11. Acceptance Criteria" translate="no">​</a></h2>
<ul>
<li class="">Runtime exposes a documented <code>DiagnosticTimeline</code> API that records tick phases, per-system durations, and queue/event metrics.</li>
<li class="">Telemetry warnings fire when ticks exceed configured budgets, and Prometheus integration reflects the new counters.</li>
<li class="">Resource publish transport (or equivalent channel) can surface timeline deltas to the Worker bridge without breaking existing consumers when diagnostics are disabled.</li>
<li class="">Unit tests cover timeline recording, slow-tick detection, and disabled/noop scenarios.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-references">12. References<a href="#12-references" class="hash-link" aria-label="Direct link to 12. References" title="Direct link to 12. References" translate="no">​</a></h2>
<ul>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
<li class=""></li>
</ul>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorTargetStickyNavbar_EdDC sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes" translate="no">​</a></h2>
<ol>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-structured-clone">
<p>“Structured clone creates a copy of most types of objects, and the original object is not transferred.” — <em>Structured clone algorithm</em>, MDN Web Docs. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm</a> <a href="#user-content-fnref-structured-clone" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-structured-clone-2" data-footnote-backref="" aria-label="Back to reference 1-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-fixed-step">
<p>Glenn Fiedler, “Fix Your Timestep!”, <em>Gaffer On Games</em>. Highlights maintaining a constant simulation <code>dt</code> per step for deterministic behavior. <a href="https://gafferongames.com/post/fix_your_timestep/" target="_blank" rel="noopener noreferrer" class="">https://gafferongames.com/post/fix_your_timestep/</a> <a href="#user-content-fnref-fixed-step" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-fixed-step-lag">
<p>Glenn Fiedler, “Fix Your Timestep!”, <em>Gaffer On Games</em>. Discusses accumulating frame deltas, executing multiple fixed steps during catch-up, and retaining the remainder in an accumulator to reflect real-time lag. <a href="https://gafferongames.com/post/fix_your_timestep/" target="_blank" rel="noopener noreferrer" class="">https://gafferongames.com/post/fix_your_timestep/</a> <a href="#user-content-fnref-fixed-step-lag" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-fixed-step-lag-2" data-footnote-backref="" aria-label="Back to reference 3-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-azure-service-bus-metrics">
<p>“Monitoring data reference for Azure Service Bus,” Microsoft Learn. Documents per-queue metrics such as incoming, completed, abandoned, and dead-lettered messages used to track throughput and loss. <a href="https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-metrics-azure-monitor" target="_blank" rel="noopener noreferrer" class="">https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-metrics-azure-monitor</a> <a href="#user-content-fnref-azure-service-bus-metrics" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-azure-service-bus-metrics-2" data-footnote-backref="" aria-label="Back to reference 4-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-otel-delta">
<p>“Metrics that are input and output with Delta temporality unburden the client from keeping high-cardinality state… The use of deltas allows downstream services to bear the cost of conversion into cumulative timeseries.” — <em>Metrics Data Model</em>, OpenTelemetry Specification. <a href="https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/metrics/data-model.md" target="_blank" rel="noopener noreferrer" class="">https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/metrics/data-model.md</a> <a href="#user-content-fnref-otel-delta" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-otel-delta-2" data-footnote-backref="" aria-label="Back to reference 5-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-perfetto-interning">
<p>“Interning can be used to avoid repeating the same constant data (e.g., event names) throughout the trace.” — <em>Track events (Tracing SDK)</em>, Perfetto Docs. <a href="https://raw.githubusercontent.com/google/perfetto/master/docs/instrumentation/track-events.md" target="_blank" rel="noopener noreferrer" class="">https://raw.githubusercontent.com/google/perfetto/master/docs/instrumentation/track-events.md</a> <a href="#user-content-fnref-perfetto-interning" data-footnote-backref="" aria-label="Back to reference 6" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-otel-performance">
<p>“Library should not consume unbounded memory resource… API should not degrade the end-user application as possible.” — <em>Performance and Blocking of OpenTelemetry API</em>, OpenTelemetry Specification. <a href="https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/performance.md" target="_blank" rel="noopener noreferrer" class="">https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/performance.md</a> <a href="#user-content-fnref-otel-performance" data-footnote-backref="" aria-label="Back to reference 7" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-object-pool">
<p>Robert Nystrom, <em>Game Programming Patterns: Object Pool</em>, on reusing preallocated objects to avoid allocation spikes in high-churn systems. <a href="https://gameprogrammingpatterns.com/object-pool.html" target="_blank" rel="noopener noreferrer" class="">https://gameprogrammingpatterns.com/object-pool.html</a> <a href="#user-content-fnref-object-pool" data-footnote-backref="" aria-label="Back to reference 8" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-object-freeze">
<p>MDN Web Docs, “Object.freeze()”, noting that frozen objects cannot be modified or extended. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze</a> <a href="#user-content-fnref-object-freeze" data-footnote-backref="" aria-label="Back to reference 9" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-mdn-structured-clone">
<p>“Browsers must serialize the properties <code>name</code> and <code>message</code>, and are expected to serialize other ‘interesting’ properties of the errors such as <code>stack</code>...” — <em>Structured clone algorithm</em>, MDN content repository. <a href="https://raw.githubusercontent.com/mdn/content/main/files/en-us/web/api/web_workers_api/structured_clone_algorithm/index.md" target="_blank" rel="noopener noreferrer" class="">https://raw.githubusercontent.com/mdn/content/main/files/en-us/web/api/web_workers_api/structured_clone_algorithm/index.md</a> <a href="#user-content-fnref-mdn-structured-clone" data-footnote-backref="" aria-label="Back to reference 10" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-otel-api-sdk">
<p><em>OpenTelemetry Client Design Principles</em>, OpenTelemetry Specification. Highlights keeping the API (instrumentation) separate from the SDK/exporters so libraries depend only on stable hooks. <a href="https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/library-guidelines.md" target="_blank" rel="noopener noreferrer" class="">https://raw.githubusercontent.com/open-telemetry/opentelemetry-specification/main/specification/library-guidelines.md</a> <a href="#user-content-fnref-otel-api-sdk" data-footnote-backref="" aria-label="Back to reference 11" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-gaffer-accumulator">
<p>Glenn Fiedler, “Fix Your Timestep!”, <em>Gaffer On Games</em>. Notes that the accumulator remainder directly expresses how far the simulation is between fixed steps, making it a reliable backlog signal. <a href="https://gafferongames.com/post/fix_your_timestep/" target="_blank" rel="noopener noreferrer" class="">https://gafferongames.com/post/fix_your_timestep/</a> <a href="#user-content-fnref-gaffer-accumulator" data-footnote-backref="" aria-label="Back to reference 12" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-perfetto-track-events">
<p>“Tracing SDK - Perfetto Tracing Docs”, describing time-bounded track events via <code>TRACE_EVENT</code> spans to attribute work in profiling traces. <a href="https://perfetto.dev/docs/instrumentation/tracing-sdk" target="_blank" rel="noopener noreferrer" class="">https://perfetto.dev/docs/instrumentation/tracing-sdk</a> <a href="#user-content-fnref-perfetto-track-events" data-footnote-backref="" aria-label="Back to reference 13" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-perfetto-track-events-2" data-footnote-backref="" aria-label="Back to reference 13-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-datadog-multi-alert">
<p>“Multi Alert mode,” <em>Datadog Monitors Configuration</em>. Highlights emitting one notification per group (dimension) so thresholds evaluate per entity instead of across aggregated series. <a href="https://docs.datadoghq.com/monitors/configuration/?tab=multi-alert" target="_blank" rel="noopener noreferrer" class="">https://docs.datadoghq.com/monitors/configuration/?tab=multi-alert</a> <a href="#user-content-fnref-datadog-multi-alert" data-footnote-backref="" aria-label="Back to reference 14" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-postmessage-copy">
<p>“Data is sent between workers and the main thread via a system of messages… The data is copied rather than shared.” — <em>Using Web Workers</em>, MDN Web Docs. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers</a> <a href="#user-content-fnref-postmessage-copy" data-footnote-backref="" aria-label="Back to reference 15" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-postmessage-copy-2" data-footnote-backref="" aria-label="Back to reference 15-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-transferable-zero-copy">
<p>“Transferable objects are transferred… with a zero-copy operation, which results in a vast performance improvement when sending large data sets.” — <em>Using Web Workers</em>, MDN Web Docs. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers</a> <a href="#user-content-fnref-transferable-zero-copy" data-footnote-backref="" aria-label="Back to reference 16" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-transferable-zero-copy-2" data-footnote-backref="" aria-label="Back to reference 16-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-longtasks">
<p>Long Tasks API introduction describing 50ms+ main-thread stalls and their impact on responsiveness. <a href="https://w3c.github.io/longtasks/" target="_blank" rel="noopener noreferrer" class="">https://w3c.github.io/longtasks/</a> <a href="#user-content-fnref-longtasks" data-footnote-backref="" aria-label="Back to reference 17" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-perf-memory">
<p>“performance.memory… Deprecated… Non-standard… API is only available in Chromium-based browsers.” — <em>Performance: memory property</em>, MDN Web Docs. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/memory" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/API/Performance/memory</a> <a href="#user-content-fnref-perf-memory" data-footnote-backref="" aria-label="Back to reference 18" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-measure-uasm">
<p><em>Monitor your web page&#x27;s total memory usage with measureUserAgentSpecificMemory()</em> — highlights cross-origin isolation requirements and sampling guidance. <a href="https://web.dev/articles/monitor-total-page-memory-usage" target="_blank" rel="noopener noreferrer" class="">https://web.dev/articles/monitor-total-page-memory-usage</a> <a href="#user-content-fnref-measure-uasm" data-footnote-backref="" aria-label="Back to reference 19" class="data-footnote-backref">↩</a></p>
</li>
<li class="anchorTargetStickyNavbar_EdDC" id="user-content-fn-performanceobserver-buffer">
<p>PerformanceObserver constructor docs noting dropped entries when the internal buffer fills and recommending explicit buffer sizing. <a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver/PerformanceObserver" target="_blank" rel="noopener noreferrer" class="">https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver/PerformanceObserver</a> <a href="#user-content-fnref-performanceobserver-buffer" data-footnote-backref="" aria-label="Back to reference 20" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/diagnostic-timeline-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Idle-Game-Engine/resource-state-storage-design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Resource State Storage Design</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Idle-Game-Engine/content-dsl-schema-design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Content DSL Schema Design</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-problem-statement" class="table-of-contents__link toc-highlight">1. Problem Statement</a></li><li><a href="#2-goals" class="table-of-contents__link toc-highlight">2. Goals</a></li><li><a href="#3-non-goals" class="table-of-contents__link toc-highlight">3. Non-Goals</a></li><li><a href="#4-current-state" class="table-of-contents__link toc-highlight">4. Current State</a></li><li><a href="#5-proposed-solution" class="table-of-contents__link toc-highlight">5. Proposed Solution</a><ul><li><a href="#51-data-model--storage" class="table-of-contents__link toc-highlight">5.1 Data Model &amp; Storage</a></li><li><a href="#52-clock-abstraction" class="table-of-contents__link toc-highlight">5.2 Clock Abstraction</a></li><li><a href="#53-runtime-integration" class="table-of-contents__link toc-highlight">5.3 Runtime Integration</a></li><li><a href="#54-snapshot--api-surface" class="table-of-contents__link toc-highlight">5.4 Snapshot &amp; API Surface</a></li><li><a href="#55-worker--transport-integration" class="table-of-contents__link toc-highlight">5.5 Worker &amp; Transport Integration</a></li><li><a href="#56-configuration--extensibility" class="table-of-contents__link toc-highlight">5.6 Configuration &amp; Extensibility</a></li></ul></li><li><a href="#6-observability--tooling" class="table-of-contents__link toc-highlight">6. Observability &amp; Tooling</a></li><li><a href="#7-performance-considerations" class="table-of-contents__link toc-highlight">7. Performance Considerations</a></li><li><a href="#8-rollout-steps" class="table-of-contents__link toc-highlight">8. Rollout Steps</a></li><li><a href="#9-risks--mitigations" class="table-of-contents__link toc-highlight">9. Risks &amp; Mitigations</a></li><li><a href="#10-resolved-questions" class="table-of-contents__link toc-highlight">10. Resolved Questions</a></li><li><a href="#11-acceptance-criteria" class="table-of-contents__link toc-highlight">11. Acceptance Criteria</a></li><li><a href="#12-references" class="table-of-contents__link toc-highlight">12. References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>