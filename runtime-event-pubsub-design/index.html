<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-runtime-event-pubsub-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Runtime Event Pub/Sub Design | Idle Engine Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hansjm10.github.io/Idle-Game-Engine/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-pubsub-design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Runtime Event Pub/Sub Design | Idle Engine Docs"><meta data-rh="true" name="description" content="Issue: #8"><meta data-rh="true" property="og:description" content="Issue: #8"><link data-rh="true" rel="icon" href="/Idle-Game-Engine/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-pubsub-design"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-pubsub-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hansjm10.github.io/Idle-Game-Engine/runtime-event-pubsub-design" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Runtime Event Pub/Sub Design","item":"https://hansjm10.github.io/Idle-Game-Engine/runtime-event-pubsub-design"}]}</script><link rel="stylesheet" href="/Idle-Game-Engine/assets/css/styles.ddf7989c.css">
<script src="/Idle-Game-Engine/assets/js/runtime~main.6a83704e.js" defer="defer"></script>
<script src="/Idle-Game-Engine/assets/js/main.f7253bbf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Idle-Game-Engine/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_li4T" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Idle-Game-Engine/"><div class="navbar__logo"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--light_vaEm"><img src="/Idle-Game-Engine/img/logo.svg" alt="Idle Engine Logo" class="themedComponent_wqtB themedComponent--dark_axH8"></div><b class="navbar__title text--truncate">Idle Engine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Idle-Game-Engine/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle__Exw colorModeToggle_Lslw"><button class="clean-btn toggleButton_AMBK toggleButtonDisabled_p4Bd" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 lightToggleIcon_p2sk"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 darkToggleIcon_B2qX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_uZx1 systemToggleIcon_PWgn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_RKai"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_nqaE"><div class="docsWrapper_CSLE"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sOWX" type="button"></button><div class="docRoot_qxtV"><aside class="theme-doc-sidebar-container docSidebarContainer_Xlvo"><div class="sidebarViewport_tjEA"><div class="sidebar_ubOv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_CfkH"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/Idle-Game-Engine/"><span title="Getting Started" class="categoryLinkLabel_ebxo">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/"><span title="Overview" class="linkLabel_KsAJ">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/contributor-handbook"><span title="Contributor Handbook" class="linkLabel_KsAJ">Contributor Handbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/role-index"><span title="Role Index" class="linkLabel_KsAJ">Role Index</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/design-document-template"><span title="Design Document Template" class="linkLabel_KsAJ">Design Document Template</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Idle-Game-Engine/idle-engine-design"><span title="Core Runtime" class="categoryLinkLabel_ebxo">Core Runtime</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/idle-engine-design"><span title="Idle Engine Design Document" class="linkLabel_KsAJ">Idle Engine Design Document</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-step-lifecycle"><span title="Runtime Step Lifecycle Alignment" class="linkLabel_KsAJ">Runtime Step Lifecycle Alignment</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-command-queue-design"><span title="Runtime Command Queue Design Document" class="linkLabel_KsAJ">Runtime Command Queue Design Document</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-command-queue-validation-plan"><span title="Runtime Command Queue Validation Tracker" class="linkLabel_KsAJ">Runtime Command Queue Validation Tracker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Idle-Game-Engine/runtime-event-pubsub-design"><span title="Runtime Event Pub/Sub Design" class="linkLabel_KsAJ">Runtime Event Pub/Sub Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-event-bus-decisions"><span title="Decision Record: Runtime Event Bus Follow-ups" class="linkLabel_KsAJ">Decision Record: Runtime Event Bus Follow-ups</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/runtime-event-manifest-authoring"><span title="Runtime Event Manifest Authoring" class="linkLabel_KsAJ">Runtime Event Manifest Authoring</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/tick-accumulator-coverage-design"><span title="Tick Accumulator Edge Case Coverage" class="linkLabel_KsAJ">Tick Accumulator Edge Case Coverage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/resource-state-storage-design"><span title="Resource State Storage Design" class="linkLabel_KsAJ">Resource State Storage Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Idle-Game-Engine/diagnostic-timeline-design"><span title="Diagnostic Timeline Instrumentation" class="linkLabel_KsAJ">Diagnostic Timeline Instrumentation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/content-dsl-schema-design"><span title="Content Pipeline" class="categoryLinkLabel_ebxo">Content Pipeline</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/accessibility-smoke-tests-design"><span title="Shell Integration" class="categoryLinkLabel_ebxo">Shell Integration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/coverage/"><span title="Diagnostics &amp; Quality" class="categoryLinkLabel_ebxo">Diagnostics &amp; Quality</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_ziOL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Idle-Game-Engine/implementation-plan"><span title="Operations &amp; Process" class="categoryLinkLabel_ebxo">Operations &amp; Process</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_tfRv"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hyci"><div class="docItemContainer_tcAC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_bxbs" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Idle-Game-Engine/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_p1A9"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core Runtime</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Runtime Event Pub/Sub Design</span></li></ul></nav><div class="tocCollapsible_WMbj theme-doc-toc-mobile tocMobile_wI3e"><button type="button" class="clean-btn tocCollapsibleButton_rjEa">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Runtime Event Pub/Sub Design</h1></header>
<p><strong>Issue:</strong> #8<br>
<strong>Workstream:</strong> Runtime Core<br>
<strong>Status:</strong> Draft<br>
<strong>Last Updated:</strong> 2025-10-14</p>
<blockquote>
<p>This document specifies the event publication and subscription system that
powers cross-system signalling inside the Idle Engine runtime. It pairs with
the command queue design (<code>docs/runtime-command-queue-design.md</code>) and aligns
with the implementation sequencing captured in <code>docs/implementation-plan.md</code>
Phase 1.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="1-overview">1. Overview<a href="#1-overview" class="hash-link" aria-label="Direct link to 1. Overview" title="Direct link to 1. Overview" translate="no">​</a></h2>
<p>Issue #8 calls for a deterministic in-process event bus so systems, command
handlers, and integrations can react to runtime activity without tight coupling
or shared mutable state. The engine currently relies on direct callbacks and
resource polling; the new event layer supplies an explicit contract for domain
events (threshold triggers, automation toggles, social notifications, etc.)
while preserving the single-threaded simulation model described in
<code>docs/idle-engine-design.md</code> §9.</p>
<p>The pub/sub system emits immutable event payloads tagged with tick metadata and
routes them to two audiences:</p>
<ol>
<li class=""><strong>Internal systems</strong> running inside the simulation worker.</li>
<li class=""><strong>External observers</strong> (presentation shell, telemetry, persistence replay)
that consume batched event frames via existing transport buffers.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="2-goals">2. Goals<a href="#2-goals" class="hash-link" aria-label="Direct link to 2. Goals" title="Direct link to 2. Goals" translate="no">​</a></h2>
<ul>
<li class=""><strong>Deterministic ordering:</strong> Events flow through a single queue processed in a
repeatable sequence per tick so offline catch-up and replays remain stable.</li>
<li class=""><strong>Type-safe contracts:</strong> Event payloads use shared discriminated unions to
prevent runtime casting, mirroring the command payload strategy.</li>
<li class=""><strong>Bounded allocations:</strong> Event storage relies on recyclable buffers to avoid
per-tick garbage that would erode performance over long sessions.</li>
<li class=""><strong>Scoped subscriptions:</strong> Systems register interest during initialization and
receive only the event categories they declare to keep dispatch efficient.</li>
<li class=""><strong>Snapshot-ready batches:</strong> The bus emits compact frames the existing
transport layer can forward to the presentation shell without bespoke wiring.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="3-non-goals">3. Non-Goals<a href="#3-non-goals" class="hash-link" aria-label="Direct link to 3. Non-Goals" title="Direct link to 3. Non-Goals" translate="no">​</a></h2>
<ul>
<li class="">Building cross-process or network delivery (handled later by social services
and backend integrations).</li>
<li class="">Persisting a long-lived analytics stream; the bus retains only the current
tick plus the in-flight snapshot batch.</li>
<li class="">Supporting asynchronous listeners; all handlers execute within the simulation
tick and may not yield control or schedule promises.</li>
<li class="">Publishing UI layout events or rendering hints (handled by the shell based on
state snapshots).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="4-current-state">4. Current State<a href="#4-current-state" class="hash-link" aria-label="Direct link to 4. Current State" title="Direct link to 4. Current State" translate="no">​</a></h2>
<ul>
<li class=""><code>packages/core</code> exposes a command queue, dispatcher, and recorder but lacks a
general event aggregation mechanism. Systems communicate via direct function
calls and shared resource state (<code>resource-state.ts</code>).</li>
<li class=""><code>resource-publish-transport.ts</code> mirrors resource deltas to the presentation
shell yet cannot emit domain-specific events (e.g., achievement unlocked).</li>
<li class="">Telemetry utilities (<code>telemetry.ts</code>) provide logging hooks but cannot
subscribe to structured runtime events.</li>
<li class="">No test scaffolding exists to assert deterministic delivery order or to
validate that subscriptions remain isolated between saves.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="5-requirements">5. Requirements<a href="#5-requirements" class="hash-link" aria-label="Direct link to 5. Requirements" title="Direct link to 5. Requirements" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="51-functional-requirements">5.1 Functional Requirements<a href="#51-functional-requirements" class="hash-link" aria-label="Direct link to 5.1 Functional Requirements" title="Direct link to 5.1 Functional Requirements" translate="no">​</a></h3>
<ol>
<li class="">Register event categories and payload schemas at engine bootstrap with
compile-time typing (leveraging TypeScript discriminated unions).</li>
<li class="">Allow command handlers, systems, and scripts to publish events during the
active tick via a lightweight <code>EventPublisher</code>.</li>
<li class="">Deliver published events to subscribing systems during the same tick, after
command execution but before snapshot emission, so state mutations precede
reactions.</li>
<li class="">Accumulate events into a <code>RuntimeEventFrame</code> structure exported alongside
resource deltas for the presentation shell.</li>
<li class="">Reset the event buffers between ticks (or when the simulation is paused) to
prevent stale payload leakage across frames.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="52-non-functional-requirements">5.2 Non-Functional Requirements<a href="#52-non-functional-requirements" class="hash-link" aria-label="Direct link to 5.2 Non-Functional Requirements" title="Direct link to 5.2 Non-Functional Requirements" translate="no">​</a></h3>
<ol>
<li class="">Zero observable impact on tick cadence at 60 Hz under typical load (≤200
events per tick).</li>
<li class="">No reliance on dynamic reflection; event routing must remain pure TypeScript
for compatibility with worker contexts.</li>
<li class="">Provide explicit back-pressure diagnostics when publisher volume exceeds the
configured buffer limits.</li>
<li class="">Ensure the bus is replayable: given the same command stream, the emitted
event batches must be identical.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="6-proposed-solution">6. Proposed Solution<a href="#6-proposed-solution" class="hash-link" aria-label="Direct link to 6. Proposed Solution" title="Direct link to 6. Proposed Solution" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="61-event-taxonomy--schema">6.1 Event Taxonomy &amp; Schema<a href="#61-event-taxonomy--schema" class="hash-link" aria-label="Direct link to 6.1 Event Taxonomy &amp; Schema" title="Direct link to 6.1 Event Taxonomy &amp; Schema" translate="no">​</a></h3>
<ul>
<li class="">Define <code>RuntimeEvent&lt;TType extends string, TPayload&gt;</code> in
<code>packages/core/src/events/runtime-event.ts</code>. Each event is a readonly object:<!-- -->
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">RuntimeEvent</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name">TType </span><span class="token class-name keyword" style="color:#00009f">extends</span><span class="token class-name"> RuntimeEventType</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name"> TPayload</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TType</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> tick</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> issuedAt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// monotonic ms within session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> payload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Readonly</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TPayload</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class=""><code>RuntimeEventType</code> is a string literal union grouped by domains (<code>resource</code>,
<code>automation</code>, <code>social</code>, <code>telemetry</code>). Runtime-owned types live in
<code>packages/core</code>, while content packs contribute additional entries through an
offline manifest. Pack manifests emit <code>eventTypes</code> metadata that is sorted by
<code>(packSlug, eventKey)</code> during generation so every build produces the same
declaration file and replay manifests stay stable.</li>
<li class="">Export canonical payload types under <code>@idle-engine/core/events</code> (e.g.,
<code>ResourceThresholdReachedEvent</code>, <code>AutomationToggleEvent</code>) so command handlers
and systems share definitions.</li>
<li class="">Per-pack manifests authored in <code>content/event-types.json</code> files describe
additional event types. Running <code>pnpm generate</code> merges the manifests with the
core catalogue, refreshes the deterministic manifest hash, and updates the
<code>ContentRuntimeEventType</code> union exported by <code>@idle-engine/core</code>. See
<code>docs/runtime-event-manifest-authoring.md</code> for authoring guidance.</li>
<li class="">The generator also publishes a manifest hash consumed by the recorder; replay
files embed the hash and fail fast if the runtime attempts to load a different
catalogue, preventing content drift across environments.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="62-event-bus-core">6.2 Event Bus Core<a href="#62-event-bus-core" class="hash-link" aria-label="Direct link to 6.2 Event Bus Core" title="Direct link to 6.2 Event Bus Core" translate="no">​</a></h3>
<ul>
<li class="">Introduce <code>EventBus</code> in <code>packages/core/src/events/event-bus.ts</code> encapsulating
three concepts:<!-- -->
<ol>
<li class=""><code>EventRegistry</code>: maps event type → payload validator/encoder and assigns
each type a numeric channel index for fast lookups.</li>
<li class=""><code>EventBuffer</code>: ring buffer storing <code>RuntimeEvent</code> instances for the current
tick. Two buffers exist per channel: one for internal subscribers, one for
outbound snapshot frames. Buffers reuse preallocated slots (<code>ObjectPool</code>).</li>
<li class=""><code>SubscriberTable</code>: fixed-length array of subscription callbacks keyed by
channel index.</li>
</ol>
</li>
<li class="">The bus exposes:<!-- -->
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">EventPublisher</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token generic-function function" style="color:#d73a49">publish</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">TType </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> RuntimeEventType</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> RuntimeEventPayload</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">EventHandler</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name">TType </span><span class="token class-name keyword" style="color:#00009f">extends</span><span class="token class-name"> RuntimeEventType</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> RuntimeEvent</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventDispatchContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
</li>
<li class=""><code>EventDispatchContext</code> carries references to immutable runtime state snapshots
needed for read-only inspection while forbidding mutation outside commands.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="63-tick-lifecycle-integration">6.3 Tick Lifecycle Integration<a href="#63-tick-lifecycle-integration" class="hash-link" aria-label="Direct link to 6.3 Tick Lifecycle Integration" title="Direct link to 6.3 Tick Lifecycle Integration" translate="no">​</a></h3>
<ol>
<li class=""><strong>Tick Start:</strong> Scheduler resets all event buffers, bumping the logical tick
counter. Systems may register or deregister subscriptions only at this
boundary (avoids mid-tick mutations to the subscriber table).</li>
<li class=""><strong>Command Execution:</strong> Command queue drains and mutates state as designed in
issue #6. Command handlers can call <code>publish</code> to emit domain events.</li>
<li class=""><strong>System Update Phase:</strong> After all commands, systems execute in their
deterministic order (§9 of the engine design). Systems can publish additional
events and receive events emitted earlier in the same tick.</li>
<li class=""><strong>Event Dispatch:</strong> For each channel, the bus iterates events in FIFO order
and invokes subscriber handlers synchronously. The dispatcher guards against
re-entrant publication causing infinite loops by allowing nested publishes
but enqueuing them to the tail of the current tick buffer.</li>
<li class=""><strong>Snapshot Emission:</strong> Once internal subscribers finish, the bus compacts the
outbound buffers into a <code>RuntimeEventFrame</code> (typed arrays + string table)
handed to <code>resource-publish-transport</code> so the presentation shell receives
both state deltas and events in the same transferable payload.</li>
<li class=""><strong>Tick End:</strong> Telemetry records buffer metrics (events per channel, dropped
events) and clears transient data.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="64-buffer-management--back-pressure">6.4 Buffer Management &amp; Back-Pressure<a href="#64-buffer-management--back-pressure" class="hash-link" aria-label="Direct link to 6.4 Buffer Management &amp; Back-Pressure" title="Direct link to 6.4 Buffer Management &amp; Back-Pressure" translate="no">​</a></h3>
<ul>
<li class="">Default buffer capacity per channel is 256 events. <code>EventChannelConfiguration</code>
exposes an optional <code>diagnostics</code> block and <code>channelConfigs</code> allows
per-channel overrides so integrators can tune <code>maxEventsPerTick</code>,
<code>maxEventsPerSecond</code>, <code>cooldownTicks</code>, and <code>maxCooldownTicks</code> without
rewriting the bus. <code>maxEventsPerTick</code> defaults to the resolved soft limit and
<code>maxEventsPerSecond</code> falls back to four times that threshold to flag bursts.</li>
<li class="">Publishing beyond the configured soft limit triggers the <code>EventDiagnostics</code>
rate limiter. The first breach issues an <code>EventSoftLimitBreach</code> warning with
remaining capacity and increments <code>events.soft_limited</code> alongside the
per-channel <code>events.soft_limit_breaches</code> telemetry counter. Subsequent
breaches back off exponentially before logging again, keeping telemetry
actionable while publishers adapt.</li>
<li class="">Overflowing the hard capacity still throws <code>EventBufferOverflowError</code> and
records <code>events.overflowed</code>, causing the tick to rewind at <code>beginTick()</code>. Hard
limits remain deterministic safeguards and bypass the rate limiter.</li>
<li class=""><code>eventBus.getBackPressureSnapshot()</code> surfaces per-channel <code>inUse</code>,
<code>remainingCapacity</code>, <code>highWaterMark</code>, <code>cooldownTicksRemaining</code>,
<code>softLimitBreaches</code>, and the most recent <code>eventsPerSecond</code> sample so
dashboards and transports can plot sustained load alongside cumulative
counters (<code>events.published</code>, <code>events.soft_limited</code>, <code>events.overflowed</code>,
<code>events.subscribers</code>).</li>
<li class="">Buffers use struct-of-arrays layouts mirroring resource storage so we can
transfer them to the shell with minimal copying. Strings (event types, IDs)
enter a deduplicated string table shared with resource snapshots. When the
rolling 256-tick average drops below two events per channel, the exporter can
flip a feature flag to emit compact object arrays instead; diagnostics record
the transition so we can revisit the default if sparse workloads dominate.
Both frame shapes share a <code>format</code> discriminator and diagnostics payload so
downstream tooling can branch safely when the fallback is active.</li>
<li class="">When offline catch-up runs for many hours, the bus batches events into
configurable windows (default 5 minutes) to prevent unbounded array growth.
The implementation segments the backlog into <code>RuntimeEventFrame</code> chunks and
streams them through the existing recorder infrastructure.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="65-subscription-api-ergonomics">6.5 Subscription API Ergonomics<a href="#65-subscription-api-ergonomics" class="hash-link" aria-label="Direct link to 6.5 Subscription API Ergonomics" title="Direct link to 6.5 Subscription API Ergonomics" translate="no">​</a></h3>
<ul>
<li class="">Systems register via:<!-- -->
<div class="language-ts codeBlockContainer_b5Q5 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yI8N"><pre tabindex="0" class="prism-code language-ts codeBlock_DEW9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_eNcQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">EventSubscriptionHost</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token generic-function function" style="color:#d73a49">on</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">TType </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> RuntimeEventType</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventHandler</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventSubscription</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class=""><code>EventSubscription</code> exposes <code>unsubscribe()</code> used during system teardown
(prestige resets, content unload). Teardown defers actual removal until the
next tick boundary.</li>
<li class="">Provide convenience helpers for common patterns:<!-- -->
<ul>
<li class=""><code>onResourceThreshold(resourceId, comparator, handler)</code> to reduce boilerplate.</li>
<li class=""><code>once(eventType, handler)</code> that auto-unsubscribes after first invocation.</li>
</ul>
</li>
<li class="">Scripts running inside the deterministic sandbox receive a limited proxy that
only allows them to subscribe to whitelisted event types (guarded by content
permissions).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_EdDC" id="66-external-publishing--replay">6.6 External Publishing &amp; Replay<a href="#66-external-publishing--replay" class="hash-link" aria-label="Direct link to 6.6 External Publishing &amp; Replay" title="Direct link to 6.6 External Publishing &amp; Replay" translate="no">​</a></h3>
<ul>
<li class="">Event frames feed into the command recorder (<code>packages/core/src/command-recorder.ts</code>) so replay files contain both commands and events. Replays validate
that emitted events match recorded ones.</li>
<li class="">Presentation shell consumes event frames to trigger UI transitions (e.g.,
toast notifications). The Vite web shell filters events client-side to avoid
jank during heavy tick loads, as detailed in <code>packages/shell-web</code>.</li>
<li class="">Persistence layer optionally stores the most recent N frames (configurable) to
resume UI transitions after reload.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="7-integration--sequencing">7. Integration &amp; Sequencing<a href="#7-integration--sequencing" class="hash-link" aria-label="Direct link to 7. Integration &amp; Sequencing" title="Direct link to 7. Integration &amp; Sequencing" translate="no">​</a></h2>
<ol>
<li class=""><strong>Bootstrap wiring:</strong> Extend the runtime initialization entry point
(<code>packages/core/src/index.ts</code>) to accept an <code>EventBusOptions</code> object and
provide a default bus instance.</li>
<li class=""><strong>Command queue hook:</strong> Inject the publisher into the existing command
dispatcher so handlers can emit events without importing the bus directly.</li>
<li class=""><strong>System registration:</strong> Update system registries to declare event
dependencies alongside execution order. This change blocks systems that
subscribe to unknown events at bootstrap.</li>
<li class=""><strong>Transport linkage:</strong> Enhance <code>resource-publish-transport.ts</code> (or extract a
shared <code>state-transport.ts</code>) to serialise <code>RuntimeEventFrame</code> payloads.</li>
<li class=""><strong>Telemetry coupling:</strong> Forward bus stats into the telemetry facade for Grafana instrumentation when running under Node.</li>
<li class=""><strong>Documentation:</strong> Publish event catalog tables in <code>docs/runtime-step-lifecycle.md</code> once initial channels ship.</li>
</ol>
<p>Sequencing aligns with the Phase 1 Runtime Core tasks outlined in the
implementation plan: command queue integration precedes transport updates to
keep merges small and reviewable.</p>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="8-testing-strategy">8. Testing Strategy<a href="#8-testing-strategy" class="hash-link" aria-label="Direct link to 8. Testing Strategy" title="Direct link to 8. Testing Strategy" translate="no">​</a></h2>
<ul>
<li class=""><strong>Unit tests:</strong> Validate publish/subscribe order, handler isolation, buffer
limits, and nested publication semantics in
<code>packages/core/src/events/event-bus.test.ts</code>.</li>
<li class=""><strong>Integration tests:</strong> Simulate a multi-system tick (resource system +
automation system) to confirm deterministic playback across multiple ticks.</li>
<li class=""><strong>Replay verification:</strong> Extend <code>command-recorder.test.ts</code> to assert that
recorded event frames match live emissions when re-running the same command
sequence.</li>
<li class=""><strong>Performance tests:</strong> Benchmark publishing 10k events per tick to ensure the
bus respects the 100ms budget, mirroring the profiling harness planned in the
implementation plan.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="9-observability">9. Observability<a href="#9-observability" class="hash-link" aria-label="Direct link to 9. Observability" title="Direct link to 9. Observability" translate="no">​</a></h2>
<ul>
<li class="">Emit telemetry counters for <code>events.published</code>, <code>events.soft_limited</code>,
<code>events.overflowed</code>, and <code>events.subscribers</code> per tick.</li>
<li class="">Surface per-channel gauges (<code>idle_engine_events_soft_limit_cooldown_ticks</code>) and
counters (<code>idle_engine_events_soft_limit_breaches_total</code>) so dashboards can
highlight channels that continue to push into the soft limit window.</li>
<li class="">Log structured warnings when handlers exceed execution time thresholds (e.g.,<!-- -->
<blockquote>
<p>2 ms) to surface slow subscribers.</p>
</blockquote>
</li>
<li class="">Expose a developer-mode event inspector in the web shell that reads the
transfer frame and renders the last N events for debugging, including the
current soft-limit cooldown, breach counts, and per-channel rates sourced from
the back-pressure snapshot.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="10-resolved-follow-ups">10. Resolved Follow-Ups<a href="#10-resolved-follow-ups" class="hash-link" aria-label="Direct link to 10. Resolved Follow-Ups" title="Direct link to 10. Resolved Follow-Ups" translate="no">​</a></h2>
<p>All deferred decisions from the draft have been finalised in
<code>docs/runtime-event-bus-decisions.md</code> (issue #87). Highlights:</p>
<ol>
<li class=""><strong>Content-defined events:</strong> Content packs contribute event types through
schema-backed manifests generated at build time, preserving deterministic
replay manifests.</li>
<li class=""><strong>Priority channels:</strong> The bus keeps a single FIFO dispatch order; publishers
control sequencing by when they emit events rather than via priority tiers.</li>
<li class=""><strong>Back-pressure strategy:</strong> Channel-scoped diagnostics throttle soft-limit
warnings with configurable limits and exponential backoff while hard caps
still abort the tick.</li>
<li class=""><strong>Serialization format:</strong> Struct-of-arrays remains the default, with a
feature-flagged downgrade to object arrays when rolling density metrics show
sparse workloads.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="11-risks--mitigations">11. Risks &amp; Mitigations<a href="#11-risks--mitigations" class="hash-link" aria-label="Direct link to 11. Risks &amp; Mitigations" title="Direct link to 11. Risks &amp; Mitigations" translate="no">​</a></h2>
<ul>
<li class=""><strong>Runaway publishers:</strong> Excessive event emission could starve tick time.
Mitigation: channel-level thresholds with telemetry alerts and optional
publisher throttles.</li>
<li class=""><strong>Subscriber side effects:</strong> Handlers mutating shared state outside commands
would break determinism. Mitigation: pass read-only contexts and audit tests
for unauthorized mutations.</li>
<li class=""><strong>Transport bloat:</strong> Event frames may enlarge the payload sent to the shell.
Mitigation: compress string tables and allow shell to opt into specific
channels.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_EdDC" id="12-rollout-plan">12. Rollout Plan<a href="#12-rollout-plan" class="hash-link" aria-label="Direct link to 12. Rollout Plan" title="Direct link to 12. Rollout Plan" translate="no">​</a></h2>
<ol>
<li class="">Land the core event bus with unit tests and documentation stubs.</li>
<li class="">Integrate resource threshold events and confirm shell transport round-trip.</li>
<li class="">Expand coverage to automation toggles and prestige resets.</li>
<li class="">Enable recording/replay validation and ship developer tooling for inspection.</li>
<li class="">Update implementation plan and project board cards once early adopters
integrate (saves, UI toasts, analytics).</li>
</ol>
<p>Completion of this rollout closes issue #8 and unlocks downstream features that
depend on structured runtime event streams.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_QKxP"><a href="https://github.com/hansjm10/Idle-Game-Engine/edit/main/docs/../../docs/runtime-event-pubsub-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_wOWh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Basj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Idle-Game-Engine/runtime-command-queue-validation-plan"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Runtime Command Queue Validation Tracker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Idle-Game-Engine/runtime-event-bus-decisions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Decision Record: Runtime Event Bus Follow-ups</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AUZ0 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-overview" class="table-of-contents__link toc-highlight">1. Overview</a></li><li><a href="#2-goals" class="table-of-contents__link toc-highlight">2. Goals</a></li><li><a href="#3-non-goals" class="table-of-contents__link toc-highlight">3. Non-Goals</a></li><li><a href="#4-current-state" class="table-of-contents__link toc-highlight">4. Current State</a></li><li><a href="#5-requirements" class="table-of-contents__link toc-highlight">5. Requirements</a><ul><li><a href="#51-functional-requirements" class="table-of-contents__link toc-highlight">5.1 Functional Requirements</a></li><li><a href="#52-non-functional-requirements" class="table-of-contents__link toc-highlight">5.2 Non-Functional Requirements</a></li></ul></li><li><a href="#6-proposed-solution" class="table-of-contents__link toc-highlight">6. Proposed Solution</a><ul><li><a href="#61-event-taxonomy--schema" class="table-of-contents__link toc-highlight">6.1 Event Taxonomy &amp; Schema</a></li><li><a href="#62-event-bus-core" class="table-of-contents__link toc-highlight">6.2 Event Bus Core</a></li><li><a href="#63-tick-lifecycle-integration" class="table-of-contents__link toc-highlight">6.3 Tick Lifecycle Integration</a></li><li><a href="#64-buffer-management--back-pressure" class="table-of-contents__link toc-highlight">6.4 Buffer Management &amp; Back-Pressure</a></li><li><a href="#65-subscription-api-ergonomics" class="table-of-contents__link toc-highlight">6.5 Subscription API Ergonomics</a></li><li><a href="#66-external-publishing--replay" class="table-of-contents__link toc-highlight">6.6 External Publishing &amp; Replay</a></li></ul></li><li><a href="#7-integration--sequencing" class="table-of-contents__link toc-highlight">7. Integration &amp; Sequencing</a></li><li><a href="#8-testing-strategy" class="table-of-contents__link toc-highlight">8. Testing Strategy</a></li><li><a href="#9-observability" class="table-of-contents__link toc-highlight">9. Observability</a></li><li><a href="#10-resolved-follow-ups" class="table-of-contents__link toc-highlight">10. Resolved Follow-Ups</a></li><li><a href="#11-risks--mitigations" class="table-of-contents__link toc-highlight">11. Risks &amp; Mitigations</a></li><li><a href="#12-rollout-plan" class="table-of-contents__link toc-highlight">12. Rollout Plan</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/Idle-Game-Engine/contributor-handbook">Contributor Handbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/hansjm10/Idle-Game-Engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_cYRj"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Idle Engine.</div></div></div></footer></div>
</body>
</html>